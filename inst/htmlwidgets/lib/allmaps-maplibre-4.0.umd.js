(function(Sr,wt){typeof exports=="object"&&typeof module<"u"?wt(exports):typeof define=="function"&&define.amd?define(["exports"],wt):(Sr=typeof globalThis<"u"?globalThis:Sr||self,wt(Sr.Allmaps={}))})(this,function(Sr){"use strict";var wt=typeof document<"u"?document.currentScript:null;function et(i,e){const t=e[0],r=e[1];return[i[0]*t+i[2]*r+i[4],i[1]*t+i[3]*r+i[5]]}function Ql(){return[1,0,0,1,0,0]}function ps(i,e){const t=i[0],r=i[1],n=i[2],s=i[3],o=i[4],a=i[5],c=e[0],l=e[1],u=e[2],h=e[3],d=e[4],g=e[5];return[t*c+n*l,r*c+s*l,t*u+n*h,r*u+s*h,t*d+n*g+o,r*d+s*g+a]}function ms(i,e,t,r,n,s,o){const a=Math.sin(n),c=Math.cos(n);return[t*c,r*a,-t*a,r*c,s*t*c-o*t*a+i,s*r*a+o*r*c+e]}function gs(i){const e=eu(i),t=i[0],r=i[1],n=i[2],s=i[3],o=i[4],a=i[5];return[s/e,-r/e,-n/e,t/e,(n*a-s*o)/e,-(t*a-r*o)/e]}function eu(i){return i[0]*i[3]-i[1]*i[2]}function Qr(i){const e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return e[0]=i[0],e[1]=i[1],e[4]=i[2],e[5]=i[3],e[12]=i[4],e[13]=i[5],e}async function tu(i,e,t){let r;if(typeof t=="function"?r=await t(i,e):r=await fetch(i,e),!r.ok)throw new Error(r.statusText);return r}async function ru(i,e,t){return await(await tu(i,e,t)).json()}async function iu(i,e,t){return await ru(`${i}/info.json`,e,t)}function $o(i,e=!1){switch(i.type){case"Polygon":return i.coordinates?{...i,coordinates:zo(i.coordinates,e)}:i;case"MultiPolygon":return i.coordinates?{...i,coordinates:i.coordinates.map(t=>zo(t,e))}:i;case"GeometryCollection":return{...i,geometries:i.geometries.map(t=>$o(t,e))};default:return i}}function zo(i,e){if(i.length===0)return i;const t=[];for(let r=0;r<i.length;r++)t.push(nu(i[r],r===0?e:!e));return t}function nu(i,e){let t=0,r=0;for(let n=0,s=i.length,o=s-1;n<s;o=n++){const a=(i[n][0]-i[o][0])*(i[o][1]+i[n][1]),c=t+a;r+=Math.abs(t)>=Math.abs(a)?t-c+a:a-c+t,t=c}return t+r>=0!=!!e?i.slice().reverse():i}function Ne(i){return Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"}function it(i){return Array.isArray(i)&&i.every(Ne)}function su(i){return Array.isArray(i)&&i.every(Ne)}function ut(i){return Array.isArray(i)&&i.every(su)}function Rt(i){return Array.isArray(i)&&i.every(Ne)}function It(i){return Array.isArray(i)&&i.every(it)}function kt(i){return Array.isArray(i)&&i.every(ut)}function vs(i){if(i=i.filter(function(e,t,r){return t===0||!ws(e,r[t-1])}),i.length<2)throw new Error("LineString should contain at least 2 points");return i}function Wo(i){if(i=i.filter(function(e,t,r){return t===0||!ws(e,r[t-1])}),cu(i)&&i.splice(-1),i.length<3)throw new Error("Ring should contain at least 3 points");return i}function ys(i){return i.map(e=>Wo(e))}function ou(i){return i.map(e=>vs(e))}function au(i){return i.map(e=>ys(e))}function Yi(i){return{type:"Point",coordinates:i}}function Hi(i){return{type:"LineString",coordinates:i}}function qi(i,e=!0){const t={type:"Polygon",coordinates:e?i.map(r=>[...r,r[0]]):i};return $o(t)}function cu(i){return Array.isArray(i)&&i.length>=2&&ws(i[0],i[i.length-1])}function ws(i,e){return i===e?!0:i===null||e===null?!1:i[0]===e[0]&&i[1]===e[1]}function Xo(i,e){if(i.length!==e.length)throw new Error("Point arrays should be of same lenght");return i.map((t,r)=>[t,e[r]])}function Yo(i){return i.reduce((e,t,r)=>[...e,[t,i[(r+1)%i.length]]],[])}function lu(i){return[i[0],-i[1]]}function bs(i,e,t){return i*(1-t)+e*t}function _s(i,e,t){return[bs(i[0],e[0],t),bs(i[1],e[1],t)]}function Ts(...i){const e=[0,0];for(let t=0;t<i.length;t++)e[0]+=i[t][0],e[1]+=i[t][1];return e[0]=e[0]/i.length,e[1]=e[1]/i.length,e}function uu(i){return Math.atan2(i[1][1]-i[0][1],i[1][0]-i[0][0])}function hu(i,e,t){return[i[0]+Math.cos(t)*e,i[1]+Math.sin(t)*e]}function At(i,e){if(it(i)&&i.length===2)return At(i[0],i[1]);if(Ne(i)&&e===void 0)return At(i,[0,0]);if(Ne(i)&&Ne(e))return Math.sqrt(Ct(i,e));throw new Error("Input type not supported")}function Ct(i,e){if(it(i)&&i.length===2)return Ct(i[0],i[1]);if(Ne(i)&&e===void 0)return Ct(i,[0,0]);if(Ne(i)&&Ne(e))return(e[0]-i[0])**2+(e[1]-i[1])**2;throw new Error("Input type not supported")}function du(i){return .5*Math.abs(i[0][0]*(i[1][1]-i[2][1])+i[1][0]*(i[2][1]-i[0][1])+i[2][0]*(i[0][1]-i[1][1]))}function jt(i){return typeof i=="object"&&i!==null&&i.type==="Point"&&Ne(i.coordinates)}function Lt(i){return typeof i=="object"&&i!==null&&i.type==="LineString"&&it(i.coordinates)}function Ft(i){return typeof i=="object"&&i!==null&&i.type==="Polygon"&&Array.isArray(i.coordinates)&&ut(i.coordinates)}function Ot(i){return typeof i=="object"&&i!==null&&i.type==="MultiPoint"&&Rt(i.coordinates)}function Gt(i){return typeof i=="object"&&i!==null&&i.type==="MultiLineString"&&It(i.coordinates)}function Nt(i){return typeof i=="object"&&i!==null&&i.type==="MultiPolygon"&&Array.isArray(i.coordinates)&&kt(i.coordinates)}function fu(i){const e=typeof i=="object"&&i!==null,r=e&&"type"in i&&typeof i.type=="string"&&(i.type==="Point"||i.type==="LineString"||i.type==="Polygon"||i.type==="MultiPoint"||i.type==="MultiLineString"||i.type==="MultiPolygon"),n=e&&"coordinates"in i&&Array.isArray(i.coordinates);return r&&n}function ei(i){return i.coordinates}function ti(i){return vs(i.coordinates)}function ri(i,e=!1){let t=i.coordinates;return t=ys(t),e?t.map(r=>[...r,r[0]]):t}function pu(i){return i.coordinates}function mu(i){return ou(i.coordinates)}function gu(i,e=!1){let t=i.coordinates;return t=au(t),e?t.map(r=>r.map(n=>[...n,n[0]])):t}function vu(i){if(jt(i))return ei(i);if(Lt(i))return ti(i);if(Ft(i))return ri(i);if(Ot(i))return pu(i);if(Gt(i))return mu(i);if(Nt(i))return gu(i);throw new Error("Geometry type not supported")}function Ki(i){return i.coordinates.map(e=>({type:"Point",coordinates:e}))}function Ji(i){return i.coordinates.map(e=>({type:"LineString",coordinates:e}))}function Qi(i){return i.coordinates.map(e=>({type:"Polygon",coordinates:e}))}function en(i){return{type:"MultiPoint",coordinates:i.map(e=>e.coordinates)}}function tn(i){return{type:"MultiLineString",coordinates:i.map(e=>e.coordinates)}}function rn(i){return{type:"MultiPolygon",coordinates:i.map(e=>e.coordinates)}}function yu(i,e){return{type:"Feature",properties:e||{},geometry:i}}function wu(i,e){return{type:"FeatureCollection",features:i.map((t,r)=>yu(t))}}function bu(i){return i.geometry}function _u(i){return i.features.map(bu)}function Ho(i){let e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY;for(const r of i)e===void 0?r>=r&&(e=t=r):(e>r&&(e=r),t<r&&(t=r));return[e,t]}function Ve(i){if(Ne(i)&&(i=[i]),ut(i)&&(i=i.flat()),fu(i))return Ve(vu(i));const e=[],t=[];for(const a of i)e.push(a[0]),t.push(a[1]);const[r,n]=Ho(e),[s,o]=Ho(t);return[r,s,n,o]}function qo(i,e){return[Math.min(i[0],e[0]),Math.min(i[1],e[1]),Math.max(i[2],e[2]),Math.max(i[3],e[3])]}function Tu(i,e){const t=i[2]>=e[0]&&e[2]>=i[0],r=i[3]>=e[1]&&e[3]>=i[1];return t&&r}function xu(i,e,t){return t===void 0&&(t=e),[i[0]-e,i[1]-t,i[2]+e,i[3]+t]}function Ko(i,e){if(e==0)return i;const t=nn(i);return xu(i,...t.map(r=>r*e/2))}function dr(i){return[[i[0],i[1]],[i[2],i[1]],[i[2],i[3]],[i[0],i[3]]]}function Mu(i){return[[i[0],i[1]],[i[2],i[3]]]}function Eu(i){return At(Mu(i))}function Pr(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function nn(i){return[i[2]-i[0],i[3]-i[1]]}function xs(i){return[.5*(At(i[0],i[1])+At(i[2],i[3])),.5*(At(i[1],i[2])+At(i[3],i[0]))]}function sn(i,e,t){return t?t==="contain"?e[0]>=e[1]?i[0]/e[0]:i[1]/e[1]:e[0]>=e[1]?i[1]/e[1]:i[0]/e[0]:Math.sqrt(i[0]*i[1]/(e[0]*e[1]))}function Su(i){return i[0]*i[1]}function Jo(i,e){return sn(xs(i),xs(e))}function Ms(i,e,t,r=()=>!0,n=()=>!0){if(i.has(e)&&r(i.get(e)))return i.get(e);{const s=t();return n(s)&&i.set(e,s),s}}function Qo(i,e,t,r,n=()=>!0,s=()=>!0){if(i.get(e)?.has(t)&&n(i.get(e)?.get(t)))return i.get(e)?.get(t);{const o=r();return s(o)&&(i.get(e)||i.set(e,new Map),i.get(e)?.set(t,o)),o}}function Pu(i){const e=parseInt(i.replace(/^#/,""),16),t=e>>16&255,r=e>>8&255,n=e&255;return[t,r,n]}function Fe(i){return Pu(i).map(e=>e/255)}function Ru(i){return i*(Math.PI/180)}function Iu(i,e){for(let t=0;t<e.length;t++)if(i.indexOf(e[t])==-1)return!1;return!0}function ku(i,e){return!i||!e||i.size!==e.size?!1:[...i].every(t=>e.has(t))}function ea(i,e){if(i!==void 0&&e!==void 0)return Math.max(i,e);if(i!==void 0)return i;if(e!==void 0)return e}function Ie(i,e){return e?{...i,...e}:i}function Au(i,e){e===void 0&&(e={});var t=e.offsetLine||0,r=e.offsetColumn||0,n=i.split(`
`),s=0,o=n.map(function(h,d){var g=s+h.length+1,f={start:s,end:g,line:d};return s=g,f}),a=0;function c(h,d){return h.start<=d&&d<h.end}function l(h,d){return{line:t+h.line,column:r+d-h.start,character:d}}function u(h,d){typeof h=="string"&&(h=i.indexOf(h,d||0));for(var g=o[a],f=h>=g.end?1:-1;g;){if(c(g,h))return l(g,h);a+=f,g=o[a]}}return u}function Cu(i,e,t){return Au(i,t)(e,t)}var ta=/[a-zA-Z0-9:_-]/,ra=/[\s\t\r\n]/,ju=/['"]/;function Lu(i,e){for(var t="";e--;)t+=i;return t}function Fu(i){var e="",t=[],r=a,n=null,s=null;function o(v){var T=Cu(i,m),A=T.line,F=T.column,R=i.slice(0,m),p=/(^|\n).*$/.exec(R)[0].replace(/\t/g,"  "),_=i.slice(m),x=/.*(\n|$)/.exec(_)[0],M=""+p+x+`
`+Lu(" ",p.length)+"^";throw new Error(v+" ("+A+":"+F+`). If this is valid SVG, it's probably a bug in svg-parser. Please raise an issue at https://github.com/Rich-Harris/svg-parser/issues â€“ thanks!

`+M)}function a(){for(;m<i.length&&i[m]!=="<"||!ta.test(i[m+1]);)e+=i[m++];return c()}function c(){for(var v="";m<i.length&&i[m]!=="<";)v+=i[m++];return/\S/.test(v)&&n.children.push({type:"text",value:v}),i[m]==="<"?l:c}function l(){var v=i[m];if(v==="?")return c;if(v==="!"){if(i.slice(m+1,m+3)==="--")return u;if(i.slice(m+1,m+8)==="[CDATA[")return h;if(/doctype/i.test(i.slice(m+1,m+8)))return c}if(v==="/")return d;var T=g(),A={type:"element",tagName:T,properties:{},children:[]};n?n.children.push(A):s=A;for(var F;m<i.length&&(F=f());)A.properties[F.name]=F.value;var R=!1;return i[m]==="/"&&(m+=1,R=!0),i[m]!==">"&&o("Expected >"),R||(n=A,t.push(A)),c}function u(){var v=i.indexOf("-->",m);return~v||o("expected -->"),m=v+2,c}function h(){var v=i.indexOf("]]>",m);return~v||o("expected ]]>"),n.children.push(i.slice(m+7,v)),m=v+2,c}function d(){var v=g();return v||o("Expected tag name"),v!==n.tagName&&o("Expected closing tag </"+v+"> to match opening tag <"+n.tagName+">"),P(),i[m]!==">"&&o("Expected >"),t.pop(),n=t[t.length-1],c}function g(){for(var v="";m<i.length&&ta.test(i[m]);)v+=i[m++];return v}function f(){if(!ra.test(i[m]))return null;P();var v=g();if(!v)return null;var T=!0;return P(),i[m]==="="&&(m+=1,P(),T=y(),!isNaN(T)&&T.trim()!==""&&(T=+T)),{name:v,value:T}}function y(){return ju.test(i[m])?w():E()}function E(){var v="";do{var T=i[m];if(T===" "||T===">"||T==="/")return v;v+=T,m+=1}while(m<i.length);return v}function w(){for(var v=i[m++],T="",A=!1;m<i.length;){var F=i[m++];if(F===v&&!A)return T;F==="\\"&&!A&&(A=!0),T+=A?"\\"+F:F,A=!1}}function P(){for(;m<i.length&&ra.test(i[m]);)m+=1}for(var m=a.length;m<i.length;)r||o("Unexpected character"),r=r(),m+=1;return r!==c&&o("Unexpected end of input"),s.tagName==="svg"&&(s.metadata=e),{type:"root",children:[s]}}function*Ou(i){function*e(r){if("children"in r)for(const n of r.children)typeof n!="string"&&(yield*e(n));yield r}const t=Fu(i);for(const r of e(t))if("tagName"in r&&r.tagName!=="svg"&&r.tagName!=="g"){const n=Gu(r);n&&(yield n)}}function Gu(i){const e=i?.tagName?.toLowerCase();if(e==="circle")return{type:"circle",coordinates:[Oe(i,"cx"),Oe(i,"cy")]};if(e==="line")return{type:"line",coordinates:[[Oe(i,"x1"),Oe(i,"y1")],[Oe(i,"x2"),Oe(i,"y2")]]};if(e==="polyline")return{type:"polyline",coordinates:ia(i)};if(e==="polygon")return{type:"polygon",coordinates:ia(i)};if(e==="rect")return{type:"rect",coordinates:[[Oe(i,"x"),Oe(i,"y")],[Oe(i,"x")+Oe(i,"width"),Oe(i,"y")],[Oe(i,"x")+Oe(i,"width"),Oe(i,"y")+Oe(i,"height")],[Oe(i,"x"),Oe(i,"y")+Oe(i,"height")],[Oe(i,"x"),Oe(i,"y")]]};throw new Error(`Unsupported SVG element: ${e}`)}function Oe(i,e){const t=i?.properties?.[e];return Number(t)||0}function ia(i){const e=i?.properties?.points;return e?String(e).trim().split(/\s+/).map(t=>{const r=t.split(",").map(n=>Number(n));return[r[0],r[1]]}):[]}function na(i){return i.map(e=>e.join(",")).join(" ")}function Nu(i){return`<svg xmlns="http://www.w3.org/2000/svg">
  ${i.map(Zu).join(`
`)}
</svg>`}function Zu(i){if(i.type==="circle")return ii("circle",{...i.attributes,cx:i.coordinates[0],cy:i.coordinates[1]});if(i.type==="line")return ii("line",{...i.attributes,x1:i.coordinates[0][0],y1:i.coordinates[0][1],x2:i.coordinates[1][0],y2:i.coordinates[1][1]});if(i.type==="polyline")return ii("polyline",{...i.attributes,points:na(i.coordinates)});if(i.type==="polygon")return ii("polygon",{...i.attributes,points:na(i.coordinates)});if(i.type==="rect")return ii("rect",{...i.attributes,x:i.coordinates[0][0],y:i.coordinates[0][1],width:i.coordinates[1][0]-i.coordinates[0][0],height:i.coordinates[2][1]-i.coordinates[0][1]});throw new Error("Unknown SVG element")}function ii(i,e){const t=Object.entries(e).map(([r,n])=>`${r}="${n}"`);return`<${i} ${t.join(" ")} />`}function Rr([i,e]){const r=6378137*Ru(i),n=6378137*Math.log(Math.tan(Math.PI/4+e*(Math.PI/180)/2));return[r,n]}function Es([i,e]){const r=Math.PI*6378137,n=i/r*180;let s=e/r*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),[n,s]}let Du=class Go{geoCenter;geoRectangle;geoSize;geoResolution;geoRectangleBbox;projectedGeoCenter;projectedGeoRectangle;projectedGeoSize;projectedGeoResolution;projectedGeoRectangleBbox;rotation;projectedGeoPerViewportScale;viewportCenter;viewportRectangle;viewportSize;viewportResolution;viewportBbox;devicePixelRatio;canvasCenter;canvasRectangle;canvasSize;canvasResolution;canvasBbox;projectedGeoPerCanvasScale;projectedGeoToViewportTransform=[1,0,0,1,0,0];projectedGeoToClipTransform=[1,0,0,1,0,0];viewportToClipTransform=[1,0,0,1,0,0];constructor(e,t,r,n,s=1){this.projectedGeoCenter=t,this.projectedGeoPerViewportScale=r,this.rotation=n,this.viewportSize=e,this.devicePixelRatio=s,this.projectedGeoRectangle=this.computeProjectedGeoRectangle(this.projectedGeoCenter,this.projectedGeoPerViewportScale,this.rotation,this.viewportSize),this.projectedGeoRectangleBbox=Ve(this.projectedGeoRectangle),this.projectedGeoSize=[this.viewportSize[0]*r,this.viewportSize[1]*r],this.projectedGeoResolution=this.projectedGeoSize[0]*this.projectedGeoSize[1],this.geoCenter=Es(this.projectedGeoCenter),this.geoRectangle=this.projectedGeoRectangle.map(o=>Es(o)),this.geoRectangleBbox=Ve(this.geoRectangle),this.geoSize=nn(this.geoRectangleBbox),this.geoResolution=this.geoSize[0]*this.geoSize[1],this.viewportResolution=this.viewportSize[0]*this.viewportSize[1],this.viewportCenter=[this.viewportSize[0]/2,this.viewportSize[1]/2],this.viewportBbox=[0,0,...this.viewportSize],this.viewportRectangle=dr(this.viewportBbox),this.canvasCenter=[this.viewportCenter[0]*this.devicePixelRatio,this.viewportSize[1]*this.devicePixelRatio],this.canvasSize=[this.viewportSize[0]*this.devicePixelRatio,this.viewportSize[1]*this.devicePixelRatio],this.canvasResolution=this.canvasSize[0]*this.canvasSize[1],this.canvasBbox=[0,0,...this.canvasSize],this.canvasRectangle=dr(this.canvasBbox),this.projectedGeoPerCanvasScale=this.projectedGeoPerViewportScale/this.devicePixelRatio,this.projectedGeoToViewportTransform=this.composeProjectedGeoToViewportTransform(),this.projectedGeoToClipTransform=this.composeProjectedGeoToClipTransform(),this.viewportToClipTransform=this.composeViewportToClipTransform()}static fromWarpedMapList(e,t,r,n="contain",s=1){const o=t.getProjectedCenter(),a=t.getProjectedBbox();if(!o||!a)throw new Error("WarpedMapList has no projected center or bbox");const c=nn(a),l=sn(c,e,n)*(1/s);return new Go(e,o,l,0,r)}static fromProjectedGeoBbox(e,t,r,n="contain"){const s=Pr(t),o=nn(t),a=sn(o,e,n);return new Go(e,s,a,0,r)}getProjectedGeoBufferedRectangle(e){const t=Ko(this.viewportBbox,e);return dr(t).map(r=>et(gs(this.projectedGeoToViewportTransform),r))}composeProjectedGeoToViewportTransform(){return ms(this.viewportCenter[0],this.viewportCenter[1],1/this.projectedGeoPerViewportScale,-1/this.projectedGeoPerViewportScale,-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}composeProjectedGeoToClipTransform(){return ms(0,0,2/(this.projectedGeoPerViewportScale*this.viewportSize[0]),2/(this.projectedGeoPerViewportScale*this.viewportSize[1]),-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}composeViewportToClipTransform(){return ms(0,0,2/this.viewportSize[0],-2/this.viewportSize[1],0,-this.viewportCenter[0],-this.viewportCenter[1])}computeProjectedGeoRectangle(e,t,r,n){const s=t*n[0]/2,o=t*n[1]/2,a=Math.cos(r),c=Math.sin(r),l=s*a,u=s*c,h=o*a,d=o*c,g=e[0],f=e[1];return[[g-l+d,f-u-h],[g-l-d,f-u+h],[g+l-d,f+u+h],[g+l+d,f+u-h]]}};var Me;(function(i){i.assertEqual=n=>n;function e(n){}i.assertIs=e;function t(n){throw new Error}i.assertNever=t,i.arrayToEnum=n=>{const s={};for(const o of n)s[o]=o;return s},i.getValidEnumValues=n=>{const s=i.objectKeys(n).filter(a=>typeof n[n[a]]!="number"),o={};for(const a of s)o[a]=n[a];return i.objectValues(o)},i.objectValues=n=>i.objectKeys(n).map(function(s){return n[s]}),i.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const s=[];for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&s.push(o);return s},i.find=(n,s)=>{for(const o of n)if(s(o))return o},i.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,s=" | "){return n.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}i.joinValues=r,i.jsonStringifyReplacer=(n,s)=>typeof s=="bigint"?s.toString():s})(Me||(Me={}));var Ss;(function(i){i.mergeShapes=(e,t)=>({...e,...t})})(Ss||(Ss={}));const J=Me.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Zt=i=>{switch(typeof i){case"undefined":return J.undefined;case"string":return J.string;case"number":return isNaN(i)?J.nan:J.number;case"boolean":return J.boolean;case"function":return J.function;case"bigint":return J.bigint;case"symbol":return J.symbol;case"object":return Array.isArray(i)?J.array:i===null?J.null:i.then&&typeof i.then=="function"&&i.catch&&typeof i.catch=="function"?J.promise:typeof Map<"u"&&i instanceof Map?J.map:typeof Set<"u"&&i instanceof Set?J.set:typeof Date<"u"&&i instanceof Date?J.date:J.object;default:return J.unknown}},B=Me.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Vu=i=>JSON.stringify(i,null,2).replace(/"([^"]+)":/g,"$1:");let ht=class Xl extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(s){return s.message},r={_errors:[]},n=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(n);else if(o.code==="invalid_return_type")n(o.returnTypeError);else if(o.code==="invalid_arguments")n(o.argumentsError);else if(o.path.length===0)r._errors.push(t(o));else{let a=r,c=0;for(;c<o.path.length;){const l=o.path[c];c===o.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(t(o))):a[l]=a[l]||{_errors:[]},a=a[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof Xl))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Me.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}};ht.create=i=>new ht(i);const Ir=(i,e)=>{let t;switch(i.code){case B.invalid_type:i.received===J.undefined?t="Required":t=`Expected ${i.expected}, received ${i.received}`;break;case B.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(i.expected,Me.jsonStringifyReplacer)}`;break;case B.unrecognized_keys:t=`Unrecognized key(s) in object: ${Me.joinValues(i.keys,", ")}`;break;case B.invalid_union:t="Invalid input";break;case B.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Me.joinValues(i.options)}`;break;case B.invalid_enum_value:t=`Invalid enum value. Expected ${Me.joinValues(i.options)}, received '${i.received}'`;break;case B.invalid_arguments:t="Invalid function arguments";break;case B.invalid_return_type:t="Invalid function return type";break;case B.invalid_date:t="Invalid date";break;case B.invalid_string:typeof i.validation=="object"?"includes"in i.validation?(t=`Invalid input: must include "${i.validation.includes}"`,typeof i.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${i.validation.position}`)):"startsWith"in i.validation?t=`Invalid input: must start with "${i.validation.startsWith}"`:"endsWith"in i.validation?t=`Invalid input: must end with "${i.validation.endsWith}"`:Me.assertNever(i.validation):i.validation!=="regex"?t=`Invalid ${i.validation}`:t="Invalid";break;case B.too_small:i.type==="array"?t=`Array must contain ${i.exact?"exactly":i.inclusive?"at least":"more than"} ${i.minimum} element(s)`:i.type==="string"?t=`String must contain ${i.exact?"exactly":i.inclusive?"at least":"over"} ${i.minimum} character(s)`:i.type==="number"?t=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="date"?t=`Date must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(i.minimum))}`:t="Invalid input";break;case B.too_big:i.type==="array"?t=`Array must contain ${i.exact?"exactly":i.inclusive?"at most":"less than"} ${i.maximum} element(s)`:i.type==="string"?t=`String must contain ${i.exact?"exactly":i.inclusive?"at most":"under"} ${i.maximum} character(s)`:i.type==="number"?t=`Number must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="bigint"?t=`BigInt must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="date"?t=`Date must be ${i.exact?"exactly":i.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(i.maximum))}`:t="Invalid input";break;case B.custom:t="Invalid input";break;case B.invalid_intersection_types:t="Intersection results could not be merged";break;case B.not_multiple_of:t=`Number must be a multiple of ${i.multipleOf}`;break;case B.not_finite:t="Number must be finite";break;default:t=e.defaultError,Me.assertNever(i)}return{message:t}};let sa=Ir;function Bu(i){sa=i}function on(){return sa}const an=i=>{const{data:e,path:t,errorMaps:r,issueData:n}=i,s=[...t,...n.path||[]],o={...n,path:s};if(n.message!==void 0)return{...n,path:s,message:n.message};let a="";const c=r.filter(l=>!!l).slice().reverse();for(const l of c)a=l(o,{data:e,defaultError:a}).message;return{...n,path:s,message:a}},Uu=[];function Y(i,e){const t=on(),r=an({issueData:e,data:i.data,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,t,t===Ir?void 0:Ir].filter(n=>!!n)});i.common.issues.push(r)}let qe=class Yl{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const n of t){if(n.status==="aborted")return ce;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const n of t){const s=await n.key,o=await n.value;r.push({key:s,value:o})}return Yl.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const n of t){const{key:s,value:o}=n;if(s.status==="aborted"||o.status==="aborted")return ce;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||n.alwaysSet)&&(r[s.value]=o.value)}return{status:e.value,value:r}}};const ce=Object.freeze({status:"aborted"}),kr=i=>({status:"dirty",value:i}),ze=i=>({status:"valid",value:i}),Ps=i=>i.status==="aborted",Rs=i=>i.status==="dirty",fr=i=>i.status==="valid",ni=i=>typeof Promise<"u"&&i instanceof Promise;function cn(i,e,t,r){if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(i)}function oa(i,e,t,r,n){if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(i,t),t}typeof SuppressedError=="function"&&SuppressedError;var ie;(function(i){i.errToObj=e=>typeof e=="string"?{message:e}:e||{},i.toString=e=>typeof e=="string"?e:e?.message})(ie||(ie={}));var si,oi;let bt=class{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const aa=(i,e)=>{if(fr(e))return{success:!0,data:e.value};if(!i.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ht(i.common.issues);return this._error=t,this._error}}};function he(i){if(!i)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:n}=i;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(o,a)=>{var c,l;const{message:u}=i;return o.code==="invalid_enum_value"?{message:u??a.defaultError}:typeof a.data>"u"?{message:(c=u??r)!==null&&c!==void 0?c:a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:(l=u??t)!==null&&l!==void 0?l:a.defaultError}},description:n}}let fe=class{get description(){return this._def.description}_getType(e){return Zt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Zt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new qe,ctx:{common:e.parent.common,data:e.data,parsedType:Zt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ni(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const n={common:{issues:[],async:(r=t?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Zt(e)},s=this._parseSync({data:e,path:n.path,parent:n});return aa(n,s)}"~validate"(e){var t,r;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Zt(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:n});return fr(s)?{value:s.value}:{issues:n.common.issues}}catch(s){!((r=(t=s?.message)===null||t===void 0?void 0:t.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(s=>fr(s)?{value:s.value}:{issues:n.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Zt(e)},n=this._parse({data:e,path:r.path,parent:r}),s=await(ni(n)?n:Promise.resolve(n));return aa(r,s)}refine(e,t){const r=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,s)=>{const o=e(n),a=()=>s.addIssue({code:B.custom,...r(n)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof t=="function"?t(r,n):t),!1))}_refinement(e){return new dt({schema:this,typeName:oe.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return _t.create(this,this._def)}nullable(){return Qt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return mr.create(this)}promise(){return Lr.create(this,this._def)}or(e){return fi.create([this,e],this._def)}and(e){return pi.create(this,e,this._def)}transform(e){return new dt({...he(this._def),schema:this,typeName:oe.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new wi({...he(this._def),innerType:this,defaultValue:t,typeName:oe.ZodDefault})}brand(){return new As({typeName:oe.ZodBranded,type:this,...he(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new bi({...he(this._def),innerType:this,catchValue:t,typeName:oe.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Cs.create(this,e)}readonly(){return _i.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const $u=/^c[^\s-]{8,}$/i,zu=/^[0-9a-z]+$/,Wu=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Xu=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Yu=/^[a-z0-9_-]{21}$/i,Hu=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,qu=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Ku=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Ju="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Is;const Qu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,eh=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,th=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,rh=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ih=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nh=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ca="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",sh=new RegExp(`^${ca}$`);function la(i){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return i.precision?e=`${e}\\.\\d{${i.precision}}`:i.precision==null&&(e=`${e}(\\.\\d+)?`),e}function oh(i){return new RegExp(`^${la(i)}$`)}function ua(i){let e=`${ca}T${la(i)}`;const t=[];return t.push(i.local?"Z?":"Z"),i.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function ah(i,e){return!!((e==="v4"||!e)&&Qu.test(i)||(e==="v6"||!e)&&th.test(i))}function ch(i,e){if(!Hu.test(i))return!1;try{const[t]=i.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function lh(i,e){return!!((e==="v4"||!e)&&eh.test(i)||(e==="v6"||!e)&&rh.test(i))}let Ar=class Xi extends fe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==J.string){const s=this._getOrReturnCtx(e);return Y(s,{code:B.invalid_type,expected:J.string,received:s.parsedType}),ce}const r=new qe;let n;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(n=this._getOrReturnCtx(e,n),Y(n,{code:B.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(n=this._getOrReturnCtx(e,n),Y(n,{code:B.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const o=e.data.length>s.value,a=e.data.length<s.value;(o||a)&&(n=this._getOrReturnCtx(e,n),o?Y(n,{code:B.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&Y(n,{code:B.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")Ku.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"email",code:B.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")Is||(Is=new RegExp(Ju,"u")),Is.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"emoji",code:B.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")Xu.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"uuid",code:B.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")Yu.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"nanoid",code:B.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")$u.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"cuid",code:B.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")zu.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"cuid2",code:B.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")Wu.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"ulid",code:B.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),Y(n,{validation:"url",code:B.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"regex",code:B.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(n=this._getOrReturnCtx(e,n),Y(n,{code:B.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(n=this._getOrReturnCtx(e,n),Y(n,{code:B.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(n=this._getOrReturnCtx(e,n),Y(n,{code:B.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?ua(s).test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{code:B.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?sh.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{code:B.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?oh(s).test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{code:B.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?qu.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"duration",code:B.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?ah(e.data,s.version)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"ip",code:B.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?ch(e.data,s.alg)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"jwt",code:B.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?lh(e.data,s.version)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"cidr",code:B.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?ih.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"base64",code:B.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?nh.test(e.data)||(n=this._getOrReturnCtx(e,n),Y(n,{validation:"base64url",code:B.invalid_string,message:s.message}),r.dirty()):Me.assertNever(s);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(n=>e.test(n),{validation:t,code:B.invalid_string,...ie.errToObj(r)})}_addCheck(e){return new Xi({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ie.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ie.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ie.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ie.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ie.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ie.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ie.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ie.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ie.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ie.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ie.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ie.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ie.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...ie.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...ie.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...ie.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...ie.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...ie.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...ie.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...ie.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...ie.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...ie.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...ie.errToObj(t)})}nonempty(e){return this.min(1,ie.errToObj(e))}trim(){return new Xi({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Xi({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Xi({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Ar.create=i=>{var e;return new Ar({checks:[],typeName:oe.ZodString,coerce:(e=i?.coerce)!==null&&e!==void 0?e:!1,...he(i)})};function uh(i,e){const t=(i.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=t>r?t:r,s=parseInt(i.toFixed(n).replace(".","")),o=parseInt(e.toFixed(n).replace(".",""));return s%o/Math.pow(10,n)}let ai=class No extends fe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==J.number){const s=this._getOrReturnCtx(e);return Y(s,{code:B.invalid_type,expected:J.number,received:s.parsedType}),ce}let r;const n=new qe;for(const s of this._def.checks)s.kind==="int"?Me.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),Y(r,{code:B.invalid_type,expected:"integer",received:"float",message:s.message}),n.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),Y(r,{code:B.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),Y(r,{code:B.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):s.kind==="multipleOf"?uh(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),Y(r,{code:B.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),Y(r,{code:B.not_finite,message:s.message}),n.dirty()):Me.assertNever(s);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ie.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ie.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ie.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ie.toString(t))}setLimit(e,t,r,n){return new No({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:ie.toString(n)}]})}_addCheck(e){return new No({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ie.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ie.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ie.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ie.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ie.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ie.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:ie.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ie.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ie.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Me.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}};ai.create=i=>new ai({checks:[],typeName:oe.ZodNumber,coerce:i?.coerce||!1,...he(i)});let ci=class Zo extends fe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==J.bigint)return this._getInvalidInput(e);let r;const n=new qe;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),Y(r,{code:B.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),Y(r,{code:B.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),Y(r,{code:B.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):Me.assertNever(s);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Y(t,{code:B.invalid_type,expected:J.bigint,received:t.parsedType}),ce}gte(e,t){return this.setLimit("min",e,!0,ie.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ie.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ie.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ie.toString(t))}setLimit(e,t,r,n){return new Zo({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:ie.toString(n)}]})}_addCheck(e){return new Zo({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ie.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ie.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ie.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ie.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ie.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};ci.create=i=>{var e;return new ci({checks:[],typeName:oe.ZodBigInt,coerce:(e=i?.coerce)!==null&&e!==void 0?e:!1,...he(i)})};let li=class extends fe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==J.boolean){const r=this._getOrReturnCtx(e);return Y(r,{code:B.invalid_type,expected:J.boolean,received:r.parsedType}),ce}return ze(e.data)}};li.create=i=>new li({typeName:oe.ZodBoolean,coerce:i?.coerce||!1,...he(i)});let ui=class Hl extends fe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==J.date){const s=this._getOrReturnCtx(e);return Y(s,{code:B.invalid_type,expected:J.date,received:s.parsedType}),ce}if(isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return Y(s,{code:B.invalid_date}),ce}const r=new qe;let n;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(n=this._getOrReturnCtx(e,n),Y(n,{code:B.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(n=this._getOrReturnCtx(e,n),Y(n,{code:B.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):Me.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Hl({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:ie.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:ie.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};ui.create=i=>new ui({checks:[],coerce:i?.coerce||!1,typeName:oe.ZodDate,...he(i)});let ln=class extends fe{_parse(e){if(this._getType(e)!==J.symbol){const r=this._getOrReturnCtx(e);return Y(r,{code:B.invalid_type,expected:J.symbol,received:r.parsedType}),ce}return ze(e.data)}};ln.create=i=>new ln({typeName:oe.ZodSymbol,...he(i)});let hi=class extends fe{_parse(e){if(this._getType(e)!==J.undefined){const r=this._getOrReturnCtx(e);return Y(r,{code:B.invalid_type,expected:J.undefined,received:r.parsedType}),ce}return ze(e.data)}};hi.create=i=>new hi({typeName:oe.ZodUndefined,...he(i)});let di=class extends fe{_parse(e){if(this._getType(e)!==J.null){const r=this._getOrReturnCtx(e);return Y(r,{code:B.invalid_type,expected:J.null,received:r.parsedType}),ce}return ze(e.data)}};di.create=i=>new di({typeName:oe.ZodNull,...he(i)});let Cr=class extends fe{constructor(){super(...arguments),this._any=!0}_parse(e){return ze(e.data)}};Cr.create=i=>new Cr({typeName:oe.ZodAny,...he(i)});let pr=class extends fe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ze(e.data)}};pr.create=i=>new pr({typeName:oe.ZodUnknown,...he(i)});let Dt=class extends fe{_parse(e){const t=this._getOrReturnCtx(e);return Y(t,{code:B.invalid_type,expected:J.never,received:t.parsedType}),ce}};Dt.create=i=>new Dt({typeName:oe.ZodNever,...he(i)});let un=class extends fe{_parse(e){if(this._getType(e)!==J.undefined){const r=this._getOrReturnCtx(e);return Y(r,{code:B.invalid_type,expected:J.void,received:r.parsedType}),ce}return ze(e.data)}};un.create=i=>new un({typeName:oe.ZodVoid,...he(i)});let mr=class ds extends fe{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==J.array)return Y(t,{code:B.invalid_type,expected:J.array,received:t.parsedType}),ce;if(n.exactLength!==null){const o=t.data.length>n.exactLength.value,a=t.data.length<n.exactLength.value;(o||a)&&(Y(t,{code:o?B.too_big:B.too_small,minimum:a?n.exactLength.value:void 0,maximum:o?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(Y(t,{code:B.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(Y(t,{code:B.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>n.type._parseAsync(new bt(t,o,t.path,a)))).then(o=>qe.mergeArray(r,o));const s=[...t.data].map((o,a)=>n.type._parseSync(new bt(t,o,t.path,a)));return qe.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new ds({...this._def,minLength:{value:e,message:ie.toString(t)}})}max(e,t){return new ds({...this._def,maxLength:{value:e,message:ie.toString(t)}})}length(e,t){return new ds({...this._def,exactLength:{value:e,message:ie.toString(t)}})}nonempty(e){return this.min(1,e)}};mr.create=(i,e)=>new mr({type:i,minLength:null,maxLength:null,exactLength:null,typeName:oe.ZodArray,...he(e)});function jr(i){if(i instanceof nt){const e={};for(const t in i.shape){const r=i.shape[t];e[t]=_t.create(jr(r))}return new nt({...i._def,shape:()=>e})}else return i instanceof mr?new mr({...i._def,type:jr(i.element)}):i instanceof _t?_t.create(jr(i.unwrap())):i instanceof Qt?Qt.create(jr(i.unwrap())):i instanceof Jt?Jt.create(i.items.map(e=>jr(e))):i}let nt=class yt extends fe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Me.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==J.object){const l=this._getOrReturnCtx(e);return Y(l,{code:B.invalid_type,expected:J.object,received:l.parsedType}),ce}const{status:r,ctx:n}=this._processInputParams(e),{shape:s,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof Dt&&this._def.unknownKeys==="strip"))for(const l in n.data)o.includes(l)||a.push(l);const c=[];for(const l of o){const u=s[l],h=n.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new bt(n,h,n.path,l)),alwaysSet:l in n.data})}if(this._def.catchall instanceof Dt){const l=this._def.unknownKeys;if(l==="passthrough")for(const u of a)c.push({key:{status:"valid",value:u},value:{status:"valid",value:n.data[u]}});else if(l==="strict")a.length>0&&(Y(n,{code:B.unrecognized_keys,keys:a}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const u of a){const h=n.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new bt(n,h,n.path,u)),alwaysSet:u in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const l=[];for(const u of c){const h=await u.key,d=await u.value;l.push({key:h,value:d,alwaysSet:u.alwaysSet})}return l}).then(l=>qe.mergeObjectSync(r,l)):qe.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(e){return ie.errToObj,new yt({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var n,s,o,a;const c=(o=(s=(n=this._def).errorMap)===null||s===void 0?void 0:s.call(n,t,r).message)!==null&&o!==void 0?o:r.defaultError;return t.code==="unrecognized_keys"?{message:(a=ie.errToObj(e).message)!==null&&a!==void 0?a:c}:{message:c}}}:{}})}strip(){return new yt({...this._def,unknownKeys:"strip"})}passthrough(){return new yt({...this._def,unknownKeys:"passthrough"})}extend(e){return new yt({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new yt({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:oe.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new yt({...this._def,catchall:e})}pick(e){const t={};return Me.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new yt({...this._def,shape:()=>t})}omit(e){const t={};return Me.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new yt({...this._def,shape:()=>t})}deepPartial(){return jr(this)}partial(e){const t={};return Me.objectKeys(this.shape).forEach(r=>{const n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()}),new yt({...this._def,shape:()=>t})}required(e){const t={};return Me.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof _t;)s=s._def.innerType;t[r]=s}}),new yt({...this._def,shape:()=>t})}keyof(){return pa(Me.objectKeys(this.shape))}};nt.create=(i,e)=>new nt({shape:()=>i,unknownKeys:"strip",catchall:Dt.create(),typeName:oe.ZodObject,...he(e)}),nt.strictCreate=(i,e)=>new nt({shape:()=>i,unknownKeys:"strict",catchall:Dt.create(),typeName:oe.ZodObject,...he(e)}),nt.lazycreate=(i,e)=>new nt({shape:i,unknownKeys:"strip",catchall:Dt.create(),typeName:oe.ZodObject,...he(e)});let fi=class extends fe{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function n(s){for(const a of s)if(a.result.status==="valid")return a.result;for(const a of s)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(a=>new ht(a.ctx.common.issues));return Y(t,{code:B.invalid_union,unionErrors:o}),ce}if(t.common.async)return Promise.all(r.map(async s=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(n);{let s;const o=[];for(const c of r){const l={...t,common:{...t.common,issues:[]},parent:null},u=c._parseSync({data:t.data,path:t.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!s&&(s={result:u,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const a=o.map(c=>new ht(c));return Y(t,{code:B.invalid_union,unionErrors:a}),ce}}get options(){return this._def.options}};fi.create=(i,e)=>new fi({options:i,typeName:oe.ZodUnion,...he(e)});const Vt=i=>i instanceof mi?Vt(i.schema):i instanceof dt?Vt(i.innerType()):i instanceof gi?[i.value]:i instanceof vi?i.options:i instanceof yi?Me.objectValues(i.enum):i instanceof wi?Vt(i._def.innerType):i instanceof hi?[void 0]:i instanceof di?[null]:i instanceof _t?[void 0,...Vt(i.unwrap())]:i instanceof Qt?[null,...Vt(i.unwrap())]:i instanceof As||i instanceof _i?Vt(i.unwrap()):i instanceof bi?Vt(i._def.innerType):[];let ha=class ql extends fe{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==J.object)return Y(t,{code:B.invalid_type,expected:J.object,received:t.parsedType}),ce;const r=this.discriminator,n=t.data[r],s=this.optionsMap.get(n);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(Y(t,{code:B.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ce)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const n=new Map;for(const s of t){const o=Vt(s.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of o){if(n.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);n.set(a,s)}}return new ql({typeName:oe.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...he(r)})}};function ks(i,e){const t=Zt(i),r=Zt(e);if(i===e)return{valid:!0,data:i};if(t===J.object&&r===J.object){const n=Me.objectKeys(e),s=Me.objectKeys(i).filter(a=>n.indexOf(a)!==-1),o={...i,...e};for(const a of s){const c=ks(i[a],e[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(t===J.array&&r===J.array){if(i.length!==e.length)return{valid:!1};const n=[];for(let s=0;s<i.length;s++){const o=i[s],a=e[s],c=ks(o,a);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return t===J.date&&r===J.date&&+i==+e?{valid:!0,data:i}:{valid:!1}}let pi=class extends fe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=(s,o)=>{if(Ps(s)||Ps(o))return ce;const a=ks(s.value,o.value);return a.valid?((Rs(s)||Rs(o))&&t.dirty(),{status:t.value,value:a.data}):(Y(r,{code:B.invalid_intersection_types}),ce)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,o])=>n(s,o)):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};pi.create=(i,e,t)=>new pi({left:i,right:e,typeName:oe.ZodIntersection,...he(t)});let Jt=class Kl extends fe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==J.array)return Y(r,{code:B.invalid_type,expected:J.array,received:r.parsedType}),ce;if(r.data.length<this._def.items.length)return Y(r,{code:B.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ce;!this._def.rest&&r.data.length>this._def.items.length&&(Y(r,{code:B.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...r.data].map((o,a)=>{const c=this._def.items[a]||this._def.rest;return c?c._parse(new bt(r,o,r.path,a)):null}).filter(o=>!!o);return r.common.async?Promise.all(s).then(o=>qe.mergeArray(t,o)):qe.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new Kl({...this._def,rest:e})}};Jt.create=(i,e)=>{if(!Array.isArray(i))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Jt({items:i,typeName:oe.ZodTuple,rest:null,...he(e)})};let da=class Do extends fe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==J.object)return Y(r,{code:B.invalid_type,expected:J.object,received:r.parsedType}),ce;const n=[],s=this._def.keyType,o=this._def.valueType;for(const a in r.data)n.push({key:s._parse(new bt(r,a,r.path,a)),value:o._parse(new bt(r,r.data[a],r.path,a)),alwaysSet:a in r.data});return r.common.async?qe.mergeObjectAsync(t,n):qe.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof fe?new Do({keyType:e,valueType:t,typeName:oe.ZodRecord,...he(r)}):new Do({keyType:Ar.create(),valueType:e,typeName:oe.ZodRecord,...he(t)})}},hn=class extends fe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==J.map)return Y(r,{code:B.invalid_type,expected:J.map,received:r.parsedType}),ce;const n=this._def.keyType,s=this._def.valueType,o=[...r.data.entries()].map(([a,c],l)=>({key:n._parse(new bt(r,a,r.path,[l,"key"])),value:s._parse(new bt(r,c,r.path,[l,"value"]))}));if(r.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const c of o){const l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return ce;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(l.value,u.value)}return{status:t.value,value:a}})}else{const a=new Map;for(const c of o){const l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return ce;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(l.value,u.value)}return{status:t.value,value:a}}}};hn.create=(i,e,t)=>new hn({valueType:e,keyType:i,typeName:oe.ZodMap,...he(t)});let dn=class Vo extends fe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==J.set)return Y(r,{code:B.invalid_type,expected:J.set,received:r.parsedType}),ce;const n=this._def;n.minSize!==null&&r.data.size<n.minSize.value&&(Y(r,{code:B.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&r.data.size>n.maxSize.value&&(Y(r,{code:B.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const s=this._def.valueType;function o(c){const l=new Set;for(const u of c){if(u.status==="aborted")return ce;u.status==="dirty"&&t.dirty(),l.add(u.value)}return{status:t.value,value:l}}const a=[...r.data.values()].map((c,l)=>s._parse(new bt(r,c,r.path,l)));return r.common.async?Promise.all(a).then(c=>o(c)):o(a)}min(e,t){return new Vo({...this._def,minSize:{value:e,message:ie.toString(t)}})}max(e,t){return new Vo({...this._def,maxSize:{value:e,message:ie.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};dn.create=(i,e)=>new dn({valueType:i,minSize:null,maxSize:null,typeName:oe.ZodSet,...he(e)});let fa=class fs extends fe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==J.function)return Y(t,{code:B.invalid_type,expected:J.function,received:t.parsedType}),ce;function r(a,c){return an({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,on(),Ir].filter(l=>!!l),issueData:{code:B.invalid_arguments,argumentsError:c}})}function n(a,c){return an({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,on(),Ir].filter(l=>!!l),issueData:{code:B.invalid_return_type,returnTypeError:c}})}const s={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof Lr){const a=this;return ze(async function(...c){const l=new ht([]),u=await a._def.args.parseAsync(c,s).catch(g=>{throw l.addIssue(r(c,g)),l}),h=await Reflect.apply(o,this,u);return await a._def.returns._def.type.parseAsync(h,s).catch(g=>{throw l.addIssue(n(h,g)),l})})}else{const a=this;return ze(function(...c){const l=a._def.args.safeParse(c,s);if(!l.success)throw new ht([r(c,l.error)]);const u=Reflect.apply(o,this,l.data),h=a._def.returns.safeParse(u,s);if(!h.success)throw new ht([n(u,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new fs({...this._def,args:Jt.create(e).rest(pr.create())})}returns(e){return new fs({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new fs({args:e||Jt.create([]).rest(pr.create()),returns:t||pr.create(),typeName:oe.ZodFunction,...he(r)})}},mi=class extends fe{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};mi.create=(i,e)=>new mi({getter:i,typeName:oe.ZodLazy,...he(e)});let gi=class extends fe{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Y(t,{received:t.data,code:B.invalid_literal,expected:this._def.value}),ce}return{status:"valid",value:e.data}}get value(){return this._def.value}};gi.create=(i,e)=>new gi({value:i,typeName:oe.ZodLiteral,...he(e)});function pa(i,e){return new vi({values:i,typeName:oe.ZodEnum,...he(e)})}let vi=class Bo extends fe{constructor(){super(...arguments),si.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return Y(t,{expected:Me.joinValues(r),received:t.parsedType,code:B.invalid_type}),ce}if(cn(this,si)||oa(this,si,new Set(this._def.values)),!cn(this,si).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return Y(t,{received:t.data,code:B.invalid_enum_value,options:r}),ce}return ze(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Bo.create(e,{...this._def,...t})}exclude(e,t=this._def){return Bo.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}};si=new WeakMap,vi.create=pa;let yi=class extends fe{constructor(){super(...arguments),oi.set(this,void 0)}_parse(e){const t=Me.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==J.string&&r.parsedType!==J.number){const n=Me.objectValues(t);return Y(r,{expected:Me.joinValues(n),received:r.parsedType,code:B.invalid_type}),ce}if(cn(this,oi)||oa(this,oi,new Set(Me.getValidEnumValues(this._def.values))),!cn(this,oi).has(e.data)){const n=Me.objectValues(t);return Y(r,{received:r.data,code:B.invalid_enum_value,options:n}),ce}return ze(e.data)}get enum(){return this._def.values}};oi=new WeakMap,yi.create=(i,e)=>new yi({values:i,typeName:oe.ZodNativeEnum,...he(e)});let Lr=class extends fe{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==J.promise&&t.common.async===!1)return Y(t,{code:B.invalid_type,expected:J.promise,received:t.parsedType}),ce;const r=t.parsedType===J.promise?t.data:Promise.resolve(t.data);return ze(r.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Lr.create=(i,e)=>new Lr({type:i,typeName:oe.ZodPromise,...he(e)});let dt=class extends fe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===oe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,s={addIssue:o=>{Y(r,o),o.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),n.type==="preprocess"){const o=n.transform(r.data,s);if(r.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return ce;const c=await this._def.schema._parseAsync({data:a,path:r.path,parent:r});return c.status==="aborted"?ce:c.status==="dirty"||t.value==="dirty"?kr(c.value):c});{if(t.value==="aborted")return ce;const a=this._def.schema._parseSync({data:o,path:r.path,parent:r});return a.status==="aborted"?ce:a.status==="dirty"||t.value==="dirty"?kr(a.value):a}}if(n.type==="refinement"){const o=a=>{const c=n.refinement(a,s);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?ce:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?ce:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(n.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!fr(o))return o;const a=n.transform(o.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>fr(o)?Promise.resolve(n.transform(o.value,s)).then(a=>({status:t.value,value:a})):o);Me.assertNever(n)}};dt.create=(i,e,t)=>new dt({schema:i,typeName:oe.ZodEffects,effect:e,...he(t)}),dt.createWithPreprocess=(i,e,t)=>new dt({schema:e,effect:{type:"preprocess",transform:i},typeName:oe.ZodEffects,...he(t)});let _t=class extends fe{_parse(e){return this._getType(e)===J.undefined?ze(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};_t.create=(i,e)=>new _t({innerType:i,typeName:oe.ZodOptional,...he(e)});let Qt=class extends fe{_parse(e){return this._getType(e)===J.null?ze(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Qt.create=(i,e)=>new Qt({innerType:i,typeName:oe.ZodNullable,...he(e)});let wi=class extends fe{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===J.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};wi.create=(i,e)=>new wi({innerType:i,typeName:oe.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...he(e)});let bi=class extends fe{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ni(n)?n.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ht(r.common.issues)},input:r.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new ht(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};bi.create=(i,e)=>new bi({innerType:i,typeName:oe.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...he(e)});let fn=class extends fe{_parse(e){if(this._getType(e)!==J.nan){const r=this._getOrReturnCtx(e);return Y(r,{code:B.invalid_type,expected:J.nan,received:r.parsedType}),ce}return{status:"valid",value:e.data}}};fn.create=i=>new fn({typeName:oe.ZodNaN,...he(i)});const hh=Symbol("zod_brand");let As=class extends fe{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}},Cs=class Jl extends fe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?ce:s.status==="dirty"?(t.dirty(),kr(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const n=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return n.status==="aborted"?ce:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:r.path,parent:r})}}static create(e,t){return new Jl({in:e,out:t,typeName:oe.ZodPipeline})}},_i=class extends fe{_parse(e){const t=this._def.innerType._parse(e),r=n=>(fr(n)&&(n.value=Object.freeze(n.value)),n);return ni(t)?t.then(n=>r(n)):r(t)}unwrap(){return this._def.innerType}};_i.create=(i,e)=>new _i({innerType:i,typeName:oe.ZodReadonly,...he(e)});function ma(i,e={},t){return i?Cr.create().superRefine((r,n)=>{var s,o;if(!i(r)){const a=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,c=(o=(s=a.fatal)!==null&&s!==void 0?s:t)!==null&&o!==void 0?o:!0,l=typeof a=="string"?{message:a}:a;n.addIssue({code:"custom",...l,fatal:c})}}):Cr.create()}const dh={object:nt.lazycreate};var oe;(function(i){i.ZodString="ZodString",i.ZodNumber="ZodNumber",i.ZodNaN="ZodNaN",i.ZodBigInt="ZodBigInt",i.ZodBoolean="ZodBoolean",i.ZodDate="ZodDate",i.ZodSymbol="ZodSymbol",i.ZodUndefined="ZodUndefined",i.ZodNull="ZodNull",i.ZodAny="ZodAny",i.ZodUnknown="ZodUnknown",i.ZodNever="ZodNever",i.ZodVoid="ZodVoid",i.ZodArray="ZodArray",i.ZodObject="ZodObject",i.ZodUnion="ZodUnion",i.ZodDiscriminatedUnion="ZodDiscriminatedUnion",i.ZodIntersection="ZodIntersection",i.ZodTuple="ZodTuple",i.ZodRecord="ZodRecord",i.ZodMap="ZodMap",i.ZodSet="ZodSet",i.ZodFunction="ZodFunction",i.ZodLazy="ZodLazy",i.ZodLiteral="ZodLiteral",i.ZodEnum="ZodEnum",i.ZodEffects="ZodEffects",i.ZodNativeEnum="ZodNativeEnum",i.ZodOptional="ZodOptional",i.ZodNullable="ZodNullable",i.ZodDefault="ZodDefault",i.ZodCatch="ZodCatch",i.ZodPromise="ZodPromise",i.ZodBranded="ZodBranded",i.ZodPipeline="ZodPipeline",i.ZodReadonly="ZodReadonly"})(oe||(oe={}));const fh=(i,e={message:`Input not instance of ${i.name}`})=>ma(t=>t instanceof i,e),ga=Ar.create,va=ai.create,ph=fn.create,mh=ci.create,ya=li.create,gh=ui.create,vh=ln.create,yh=hi.create,wh=di.create,bh=Cr.create,_h=pr.create,Th=Dt.create,xh=un.create,Mh=mr.create,Eh=nt.create,Sh=nt.strictCreate,Ph=fi.create,Rh=ha.create,Ih=pi.create,kh=Jt.create,Ah=da.create,Ch=hn.create,jh=dn.create,Lh=fa.create,Fh=mi.create,Oh=gi.create,Gh=vi.create,Nh=yi.create,Zh=Lr.create,wa=dt.create,Dh=_t.create,Vh=Qt.create,Bh=dt.createWithPreprocess,Uh=Cs.create;var C=Object.freeze({__proto__:null,defaultErrorMap:Ir,setErrorMap:Bu,getErrorMap:on,makeIssue:an,EMPTY_PATH:Uu,addIssueToContext:Y,ParseStatus:qe,INVALID:ce,DIRTY:kr,OK:ze,isAborted:Ps,isDirty:Rs,isValid:fr,isAsync:ni,get util(){return Me},get objectUtil(){return Ss},ZodParsedType:J,getParsedType:Zt,ZodType:fe,datetimeRegex:ua,ZodString:Ar,ZodNumber:ai,ZodBigInt:ci,ZodBoolean:li,ZodDate:ui,ZodSymbol:ln,ZodUndefined:hi,ZodNull:di,ZodAny:Cr,ZodUnknown:pr,ZodNever:Dt,ZodVoid:un,ZodArray:mr,ZodObject:nt,ZodUnion:fi,ZodDiscriminatedUnion:ha,ZodIntersection:pi,ZodTuple:Jt,ZodRecord:da,ZodMap:hn,ZodSet:dn,ZodFunction:fa,ZodLazy:mi,ZodLiteral:gi,ZodEnum:vi,ZodNativeEnum:yi,ZodPromise:Lr,ZodEffects:dt,ZodTransformer:dt,ZodOptional:_t,ZodNullable:Qt,ZodDefault:wi,ZodCatch:bi,ZodNaN:fn,BRAND:hh,ZodBranded:As,ZodPipeline:Cs,ZodReadonly:_i,custom:ma,Schema:fe,ZodSchema:fe,late:dh,get ZodFirstPartyTypeKind(){return oe},coerce:{string:i=>Ar.create({...i,coerce:!0}),number:i=>ai.create({...i,coerce:!0}),boolean:i=>li.create({...i,coerce:!0}),bigint:i=>ci.create({...i,coerce:!0}),date:i=>ui.create({...i,coerce:!0})},any:bh,array:Mh,bigint:mh,boolean:ya,date:gh,discriminatedUnion:Rh,effect:wa,enum:Gh,function:Lh,instanceof:fh,intersection:Ih,lazy:Fh,literal:Oh,map:Ch,nan:ph,nativeEnum:Nh,never:Th,null:wh,nullable:Vh,number:va,object:Eh,oboolean:()=>ya().optional(),onumber:()=>va().optional(),optional:Dh,ostring:()=>ga().optional(),pipeline:Uh,preprocess:Bh,promise:Zh,record:Ah,set:jh,strictObject:Sh,string:ga,symbol:vh,transformer:wa,tuple:kh,undefined:yh,union:Ph,unknown:_h,void:xh,NEVER:ce,ZodIssueCode:B,quotelessJson:Vu,ZodError:ht});const pn=/^https?:\/\/library.stanford.edu\/iiif\/image-api\/1.1\/compliance.html#level(?<level>[012])$/,ba=C.string().regex(pn),$h=ba,mn="http://library.stanford.edu/iiif/image-api/1.1/context.json",_a="http://iiif.io/api/image/1/context.json",Ta=C.literal(mn),js=C.object({"@context":Ta,"@id":C.string().url(),profile:ba.optional(),width:C.number().int(),height:C.number().int(),scale_factors:C.number().array().optional(),tile_width:C.number().optional(),tile_height:C.number().optional()}),xa=C.object({width:C.number().int(),height:C.number().int()}),Ma=C.object({width:C.number().int(),height:C.number().int().optional(),scaleFactors:C.array(C.number().int())}),zh=["ImageService1","ImageService2","ImageService3"],Ea=C.enum(zh),gn=/^https?:\/\/iiif.io\/api\/image\/2.*level(?<level>[012])(.json)?$/,Sa=C.string().regex(gn),Wh=C.object({formats:C.string().array().optional(),maxArea:C.number().int().optional(),maxHeight:C.number().int().optional(),maxWidth:C.number().int().optional(),qualities:C.string().array().optional(),supports:C.string().array().optional()}),vn=Sa.or(C.array(C.union([Sa,Wh,C.any()]))),yn="http://iiif.io/api/image/2/context.json",Pa=C.union([C.literal(yn),C.literal("https://iiif.io/api/image/2/context.json")]),Ls=C.object({"@id":C.string().url(),"@type":C.literal("iiif:Image").or(C.literal("ImageService2")).optional(),"@context":Pa,protocol:C.literal("http://iiif.io/api/image"),width:C.number().int(),height:C.number().int(),profile:vn,sizes:xa.array().optional(),tiles:Ma.array().optional()}),Xh=["level0","level1","level2"],Ra=C.enum(Xh),Fs=C.object({id:C.string().url(),type:C.literal("ImageService3"),protocol:C.literal("http://iiif.io/api/image"),profile:Ra,width:C.number().int(),height:C.number().int(),maxWidth:C.number().int().optional(),maxHeight:C.number().int().optional(),maxArea:C.number().int().optional(),sizes:xa.array().optional(),tiles:Ma.array().optional(),extraFeatures:C.string().array().optional()}),Yh=C.object({"@id":C.string().url(),"@type":Ea.optional(),profile:$h.or(vn).or(Ra),width:C.number().int().optional(),height:C.number().int().optional(),"@context":Ta.or(C.literal("http://iiif.io/api/image/1/context.json")).or(Pa).optional()}),Hh=["level0","level1","level2"],qh=C.object({id:C.string().url(),type:C.literal("ImageService2"),profile:vn}).or(C.object({"@id":C.string().url(),"@type":C.literal("ImageService2"),profile:vn})),Kh=C.object({id:C.string().url(),type:Ea,profile:C.enum(Hh)}),Jh=C.union([qh,Kh]),Ia=Yh.or(Jh),ka=C.string().or(C.number()).or(C.boolean()),Os=ka.or(ka.array()),Aa=C.union([C.object({"@language":C.string().optional(),"@value":Os}),C.object({language:C.string().optional(),value:Os}),C.any()]).transform(i=>{if(i&&typeof i=="object"){if("@language"in i&&"@value"in i)return i;if("language"in i&&"value"in i)return{"@language":i.language,"@value":i.value}}}),er=C.union([Os,Aa.array(),Aa]),Ca=C.union([C.any(),C.object({label:er.optional(),value:er.optional()})]).transform(i=>{if(i&&typeof i=="object"&&"label"in i&&"value"in i)return i}).array(),Qh=C.object({width:C.number().int().optional(),height:C.number().int().optional(),service:Ia}),ed=C.object({resource:Qh}),Gs=C.object({"@id":C.string().url(),"@type":C.literal("sc:Canvas"),width:C.number().int(),height:C.number().int(),images:ed.array().length(1),label:er.optional(),metadata:Ca.optional()}),td=C.object({canvases:Gs.array().nonempty()}),ja=C.object({"@id":C.string().url(),"@type":C.literal("sc:Manifest"),sequences:td.array().length(1),label:er.optional(),description:er.optional(),metadata:Ca.optional()}),La=C.lazy(()=>C.object({"@id":C.string().url(),"@type":C.literal("sc:Manifest"),label:er.optional()})),wn=C.lazy(()=>C.object({"@id":C.string().url(),"@type":C.literal("sc:Collection"),label:er.optional(),manifests:La.array().optional(),collections:wn.array().optional(),members:C.union([La,wn,Fa]).array().optional()})),Fa=C.object({"@id":C.string().url(),"@type":C.literal("sc:Collection"),label:er.optional()}),rd=C.string().or(C.number()).or(C.boolean()),tr=C.record(C.string(),rd.array()),Oa=C.union([C.any(),C.object({label:tr.optional(),value:tr.optional()})]).transform(i=>{if(i&&typeof i=="object"&&"label"in i&&"value"in i)return i}).array(),Ns=C.object({type:C.literal("Image"),width:C.number().int().optional(),height:C.number().int().optional(),service:Ia.array()}),id=C.object({type:C.literal("Choice"),items:Ns.array()}),nd=C.object({type:C.literal("Annotation"),body:C.union([Ns,Ns.array().length(1),id])}),sd=C.object({type:C.literal("AnnotationPage"),items:nd.array().length(1)}),Zs=C.object({id:C.string().url(),type:C.literal("Canvas"),width:C.number().int(),height:C.number().int(),items:sd.array().length(1),label:tr.optional(),metadata:Oa.optional()}),Ga=C.object({id:C.string().url(),type:C.literal("Manifest"),items:Zs.array().nonempty(),label:tr.optional(),description:tr.optional(),metadata:Oa.optional()}),od=C.lazy(()=>C.object({id:C.string().url(),type:C.literal("Manifest"),label:tr.optional()})),Ds=C.lazy(()=>C.object({id:C.string().url(),type:C.literal("Collection"),label:tr.optional(),items:C.union([od,Ds,Na]).array()})),Na=C.object({id:C.string().url(),type:C.literal("Collection"),label:tr.optional()}),ad=C.union([js,Ls,Fs]);C.union([Gs,Zs]),C.union([ja,Ga]),C.union([wn,Fa,Ds,Na]);const cd=js,ld=C.union([wn,ja,Gs,Ls]),ud=C.union([Ds,Ga,Zs,Fs]);C.union([cd,ld,ud]);function Za({width:i,height:e},t,r,n){const s=r*t.originalWidth,o=n*t.originalHeight,a=r*t.originalWidth+t.width*t.scaleFactor>i?i-r*t.originalWidth:t.width*t.scaleFactor,c=n*t.originalHeight+t.height*t.scaleFactor>e?e-n*t.originalHeight:t.height*t.scaleFactor;let l=t.width,u=t.height;return s+t.width*t.scaleFactor>i&&(l=Math.floor((i-s+t.scaleFactor-1)/t.scaleFactor)),o+t.height*t.scaleFactor>e&&(u=Math.floor((e-o+t.scaleFactor-1)/t.scaleFactor)),{region:{x:s,y:o,width:a,height:c},size:{width:l,height:u}}}function hd({width:i,height:e},t=768){const r=Math.max(i,e)/t,n=Math.ceil(Math.log(r)/Math.log(2));return{scaleFactors:Array.from({length:n},(s,o)=>2**o),width:t}}function dd({width:i,height:e},t,r){const n=t.height||t.width,s=t.width*r,o=n*r;return{scaleFactor:r,width:t.width,height:n,originalWidth:s,originalHeight:o,columns:Math.ceil(i/s),rows:Math.ceil(e/o)}}function fd(i,e){return e.map(t=>t.scaleFactors.map(r=>dd(i,t,r))).flat()}function pd(i){return!!i.some(e=>e.width&&e.scaleFactors&&e.scaleFactors.length)}function md(i,e,t){if(!e||!pd(e))if(t)e=[hd(i)];else throw new Error("Image does not support tiles or custom regions and sizes.");return fd(i,e)}function gd(i,e,t="cover"){if(t==="cover"||t==="contain"){const r=e.width/i.width,n=e.height/i.height,s=t==="cover"?Math.max(r,n):Math.min(r,n),o=i.width*s,a=i.height*s;return{width:o,height:a}}else throw new Error('Mode must be either "cover" or "contain"')}const vd=.8,yd=1.5;function Da(i,e,t="cover",{sizes:r,tileZoomLevels:n,supportsAnyRegionAndSize:s,maxWidth:o,maxHeight:a,maxArea:c}){let{width:l,height:u}=gd(i,e,t);if(o&&l>o&&(u=u/l*o,l=o),a&&u>a&&(l=l/u*a,u=a),c&&l*u>c){const d=u/l,f=Math.floor(Math.sqrt(c/d))*d;l=Math.floor(f)/d,u=l*d}const h=i.width/i.height;if(l=Math.floor(l),u=Math.round(l/h),r){let d;for(const g of r){const f=g.width/l;if(f>=vd&&f<=yd){d=g;break}}if(d)return{size:d}}if(s)return{size:{width:Math.round(l),height:Math.round(u)}};if(n){const d=i.width/l,g=n.map(({scaleFactor:P},m)=>({index:m,scaleFactor:P,diff:Math.abs(P-d)})).sort((P,m)=>P.diff-m.diff),f=n[g[0].index],y=Math.ceil(i.width/(f.scaleFactor*n[0].width)),E=Math.ceil(i.height/(f.scaleFactor*n[0].height)),w=[];for(let P=0;P<E;P++){const m=[];for(let v=0;v<y;v++){const T=Za(i,f,v,P);m.push(T)}w.push(m)}return w}throw new Error("Unable to create thumbnail")}const Va=["regionByPx","sizeByWh"];function wd(i){const e=i.match(pn);if(e&&e.groups)return parseInt(e.groups.level)}function Ba(i){const e=i.match(gn);if(e&&e.groups)return parseInt(e.groups.level)}function bd(i){return{maxWidth:i?.maxWidth,maxHeight:i?.maxHeight,maxArea:i?.maxArea,supportsAnyRegionAndSize:Va.every(e=>i?.supports&&i?.supports?.includes(e))}}function _d(i){if("type"in i&&i.type==="ImageService3")return 3;if("type"in i&&i.type==="ImageService2"||"@type"in i&&i["@type"]==="ImageService2"||"@context"in i&&i["@context"]===yn)return 2;if("@context"in i&&(i["@context"]===mn||i["@context"]===_a))return 1;if("profile"in i){let e;return Array.isArray(i.profile)?e=i.profile[0]:e=i.profile,e.match(pn)?1:e.match(gn)?2:3}else throw new Error("Unsupported IIIF Image Service")}function Vs(i){if("type"in i||"@type"in i){const e=i.profile;let t=!1;return e==="level0"||typeof e=="string"&&e.endsWith("level0.json")?"extraFeatures"in i&&(t=Va.every(r=>i.extraFeatures&&i.extraFeatures.includes(r))):t=!0,{maxWidth:"maxWidth"in i?i.maxWidth:void 0,maxHeight:"maxHeight"in i?i.maxHeight:void 0,maxArea:"maxArea"in i?i.maxArea:void 0,supportsAnyRegionAndSize:t}}else if(Array.isArray(i.profile)){let e=!1,t=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return i.profile.forEach(s=>{if(typeof s=="string"){const o=Ba(s);o&&(e=e||o>=1)}else{const{maxWidth:o,maxHeight:a,maxArea:c,supportsAnyRegionAndSize:l}=bd(s);o!==void 0&&(r=Math.max(o,r)),a!==void 0&&(t=Math.max(a,t)),c!==void 0&&(n=Math.max(c,n)),e=e||l}}),{maxWidth:r>=0?r:void 0,maxHeight:t>=0?t:void 0,maxArea:n>=0?n:void 0,supportsAnyRegionAndSize:e}}else if("profile"in i&&i.profile){const e=wd(i.profile),t=Ba(i.profile);return e?{supportsAnyRegionAndSize:e>=1}:t?{supportsAnyRegionAndSize:t>=1}:{supportsAnyRegionAndSize:!1}}else throw new Error("Invalid Image")}const Td="image";class xd{embedded=!0;uri;type=Td;maxWidth;maxHeight;maxArea;supportsAnyRegionAndSize;width;height;majorVersion;constructor(...e){const t=e[0],r=e[1];if(e.length===2){const n=e[0];let s,o;if(Array.isArray(n.service)?n.service.forEach(a=>{try{const c=_d(a);(!o||c>o)&&(o=c,s=a)}catch{}}):s=n.service,!s)throw new Error("Unsupported IIIF Image Service");if("@id"in s)this.uri=s["@id"];else if("id"in s)this.uri=s.id;else throw new Error("Unsupported IIIF Image Service");if("type"in s&&s.type==="ImageService3")this.majorVersion=3;else if("type"in s&&s.type==="ImageService2"||"@type"in s&&s["@type"]==="ImageService2"||"@context"in s&&s["@context"]===yn)this.majorVersion=2;else if("@context"in s&&(s["@context"]===mn||s["@context"]===_a))this.majorVersion=1;else if("profile"in s){let a;Array.isArray(s.profile)?a=s.profile[0]:a=s.profile,a.match(pn)?this.majorVersion=1:a.match(gn)?this.majorVersion=2:this.majorVersion=3}else throw new Error("Unsupported IIIF Image Service");if("profile"in s){const a=Vs(s);this.supportsAnyRegionAndSize=a.supportsAnyRegionAndSize,this.maxWidth=a.maxWidth,this.maxHeight=a.maxHeight,this.maxArea=a.maxArea}else this.supportsAnyRegionAndSize=!1}else{if("@id"in t)this.uri=t["@id"];else if("id"in t)this.uri=t.id;else throw new Error("Unsupported IIIF Image");if("type"in t&&t.type==="ImageService3")this.majorVersion=3;else if("@type"in t&&t["@type"]==="iiif:Image"||"@context"in t&&t["@context"]===yn)this.majorVersion=2;else if("@context"in t&&t["@context"]===mn)this.majorVersion=1;else throw new Error("Unsupported IIIF Image");if("profile"in t){const n=Vs(t);this.supportsAnyRegionAndSize=n.supportsAnyRegionAndSize,this.maxWidth=n.maxWidth,this.maxHeight=n.maxHeight,this.maxArea=n.maxArea}else this.supportsAnyRegionAndSize=!1}if(t.width!==void 0)this.width=t.width;else if(r)this.width=r.width;else throw new Error("Width not present on either Canvas or Image Resource");if(t.height!==void 0)this.height=t.height;else if(r)this.height=r.height;else throw new Error("Height not present on either Canvas or Image Resource")}getImageUrl(e){const{region:t,size:r}=e;let n,s,o,a,c;t?(c=`${t.x},${t.y},${t.width},${t.height}`,o=t.height,a=t.width):(c="full",o=this.height,a=this.width);let l;if(r){n=Math.round(r.width),s=Math.round(r.height);const d=String(n);let g=String(s);const f=a/o,E=s*f/f;s===Math.round(E)&&(g=""),l=`${d},${g}`}else n=this.width,s=this.height,l=this.majorVersion===2?"full":"max";const u=n*s;if(this.maxWidth!==void 0&&n>this.maxWidth)throw new Error(`Width of requested image is too large: ${n} > ${this.maxWidth}`);if(this.maxHeight!==void 0&&s>this.maxHeight)throw new Error(`Height of requested image is too large: ${s} > ${this.maxHeight}`);if(this.maxArea!==void 0&&u>this.maxArea)throw new Error(`Area of requested image is too large: ${u} > ${this.maxArea}`);const h=this.majorVersion===1?"native":"default";return`${this.uri}/${c}/${l}/0/${h}.jpg`}getThumbnail(e,t="cover"){return Da({width:this.width,height:this.height},e,t,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}}class Bs extends xd{tileZoomLevels;sizes;embedded=!1;constructor(e){super(e);const t=Vs(e);let r;"tiles"in e&&(r=e.tiles),this.tileZoomLevels=md({width:this.width,height:this.height},r,t.supportsAnyRegionAndSize),"sizes"in e&&(this.sizes=e.sizes)}static parse(e,t=null){let r;return t===1?r=js.parse(e):t===2?r=Ls.parse(e):t===3?r=Fs.parse(e):r=ad.parse(e),new Bs(r)}getIiifTile(e,t,r){return Za({width:this.width,height:this.height},e,t,r)}getThumbnail(e,t="cover"){return Da({width:this.width,height:this.height},e,t,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,sizes:this.sizes,tileZoomLevels:this.tileZoomLevels,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}}const Ua=C.record(C.string(),C.string().array());C.object({label:Ua.optional(),value:Ua.optional()});var Ke=63710088e-1,$a={centimeters:Ke*100,centimetres:Ke*100,degrees:Ke/111325,feet:Ke*3.28084,inches:Ke*39.37,kilometers:Ke/1e3,kilometres:Ke/1e3,meters:Ke,metres:Ke,miles:Ke/1609.344,millimeters:Ke*1e3,millimetres:Ke*1e3,nauticalmiles:Ke/1852,radians:1,yards:Ke*1.0936};function Md(i,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=i,r}function Ed(i,e,t){if(t===void 0&&(t={}),!i)throw new Error("coordinates is required");if(!Array.isArray(i))throw new Error("coordinates must be an Array");if(i.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!za(i[0])||!za(i[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:i};return Md(r,e,t)}function Sd(i,e){e===void 0&&(e="kilometers");var t=$a[e];if(!t)throw new Error(e+" units is invalid");return i*t}function Pd(i,e){e===void 0&&(e="kilometers");var t=$a[e];if(!t)throw new Error(e+" units is invalid");return i/t}function Us(i){var e=i%(2*Math.PI);return e*180/Math.PI}function ft(i){var e=i%360;return e*Math.PI/180}function za(i){return!isNaN(i)&&i!==null&&!Array.isArray(i)}function Fr(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Rd(i){return i.type==="Feature"?i.geometry:i}function Wa(i,e,t){if(t===void 0&&(t={}),t.final===!0)return Id(i,e);var r=Fr(i),n=Fr(e),s=ft(r[0]),o=ft(n[0]),a=ft(r[1]),c=ft(n[1]),l=Math.sin(o-s)*Math.cos(c),u=Math.cos(a)*Math.sin(c)-Math.sin(a)*Math.cos(c)*Math.cos(o-s);return Us(Math.atan2(l,u))}function Id(i,e){var t=Wa(e,i);return t=(t+180)%360,t}function kd(i,e,t,r){r===void 0&&(r={});var n=Fr(i),s=ft(n[0]),o=ft(n[1]),a=ft(t),c=Pd(e,r.units),l=Math.asin(Math.sin(o)*Math.cos(c)+Math.cos(o)*Math.sin(c)*Math.cos(a)),u=s+Math.atan2(Math.sin(a)*Math.sin(c)*Math.cos(o),Math.cos(c)-Math.sin(o)*Math.sin(l)),h=Us(u),d=Us(l);return Ed([h,d],r.properties)}function $s(i,e,t){t===void 0&&(t={});var r=Fr(i),n=Fr(e),s=ft(n[1]-r[1]),o=ft(n[0]-r[0]),a=ft(r[1]),c=ft(n[1]),l=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(a)*Math.cos(c);return Sd(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),t.units)}function bn(i,e){var t=$s(i,e),r=Wa(i,e),n=kd(i,t/2,r);return n}function Xa(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),t}var be={};const Ad=Object.prototype.toString;function Ti(i){const e=Ad.call(i);return e.endsWith("Array]")&&!e.includes("Big")}const Cd=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:Ti},Symbol.toStringTag,{value:"Module"})),jd=Xa(Cd);function Ld(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ti(i))throw new TypeError("input must be an array");if(i.length===0)throw new TypeError("input must not be empty");var t=e.fromIndex,r=t===void 0?0:t,n=e.toIndex,s=n===void 0?i.length:n;if(r<0||r>=i.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>i.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=i[r],a=r+1;a<s;a++)i[a]>o&&(o=i[a]);return o}function Fd(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ti(i))throw new TypeError("input must be an array");if(i.length===0)throw new TypeError("input must not be empty");var t=e.fromIndex,r=t===void 0?0:t,n=e.toIndex,s=n===void 0?i.length:n;if(r<0||r>=i.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>i.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=i[r],a=r+1;a<s;a++)i[a]<o&&(o=i[a]);return o}function Od(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ti(i)){if(i.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var t;if(e.output!==void 0){if(!Ti(e.output))throw new TypeError("output option must be an array if specified");t=e.output}else t=new Array(i.length);var r=Fd(i),n=Ld(i);if(r===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=e.min,o=s===void 0?e.autoMinMax?r:0:s,a=e.max,c=a===void 0?e.autoMinMax?n:1:a;if(o>=c)throw new RangeError("min option must be smaller than max option");for(var l=(c-o)/(n-r),u=0;u<i.length;u++)t[u]=(i[u]-r)*l+o;return t}const Gd=Object.freeze(Object.defineProperty({__proto__:null,default:Od},Symbol.toStringTag,{value:"Module"})),Nd=Xa(Gd);Object.defineProperty(be,"__esModule",{value:!0});var Je=jd,Ya=Nd;const _n=" ".repeat(2),Ha=" ".repeat(4);function Zd(){return qa(this)}function qa(i,e={}){const{maxRows:t=15,maxColumns:r=10,maxNumSize:n=8,padMinus:s="auto"}=e;return`${i.constructor.name} {
${_n}[
${Ha}${Dd(i,t,r,n,s)}
${_n}]
${_n}rows: ${i.rows}
${_n}columns: ${i.columns}
}`}function Dd(i,e,t,r,n){const{rows:s,columns:o}=i,a=Math.min(s,e),c=Math.min(o,t),l=[];if(n==="auto"){n=!1;e:for(let u=0;u<a;u++)for(let h=0;h<c;h++)if(i.get(u,h)<0){n=!0;break e}}for(let u=0;u<a;u++){let h=[];for(let d=0;d<c;d++)h.push(Vd(i.get(u,d),r,n));l.push(`${h.join(" ")}`)}return c!==o&&(l[l.length-1]+=` ... ${o-t} more columns`),a!==s&&l.push(`... ${s-e} more rows`),l.join(`
${Ha}`)}function Vd(i,e,t){return(i>=0&&t?` ${Ka(i,e-1)}`:Ka(i,e)).padEnd(e)}function Ka(i,e){let t=i.toString();if(t.length<=e)return t;let r=i.toFixed(e);if(r.length>e&&(r=i.toFixed(Math.max(0,e-(r.length-e)))),r.length<=e&&!r.startsWith("0.000")&&!r.startsWith("-0.000"))return r;let n=i.toExponential(e);return n.length>e&&(n=i.toExponential(Math.max(0,e-(n.length-e)))),n.slice(0)}function Bd(i,e){i.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},i.prototype.addS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+t);return this},i.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+t.get(r,n));return this},i.add=function(t,r){return new e(t).add(r)},i.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},i.prototype.subS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-t);return this},i.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-t.get(r,n));return this},i.sub=function(t,r){return new e(t).sub(r)},i.prototype.subtract=i.prototype.sub,i.prototype.subtractS=i.prototype.subS,i.prototype.subtractM=i.prototype.subM,i.subtract=i.sub,i.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},i.prototype.mulS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*t);return this},i.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*t.get(r,n));return this},i.mul=function(t,r){return new e(t).mul(r)},i.prototype.multiply=i.prototype.mul,i.prototype.multiplyS=i.prototype.mulS,i.prototype.multiplyM=i.prototype.mulM,i.multiply=i.mul,i.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},i.prototype.divS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/t);return this},i.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/t.get(r,n));return this},i.div=function(t,r){return new e(t).div(r)},i.prototype.divide=i.prototype.div,i.prototype.divideS=i.prototype.divS,i.prototype.divideM=i.prototype.divM,i.divide=i.div,i.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},i.prototype.modS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)%t);return this},i.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)%t.get(r,n));return this},i.mod=function(t,r){return new e(t).mod(r)},i.prototype.modulus=i.prototype.mod,i.prototype.modulusS=i.prototype.modS,i.prototype.modulusM=i.prototype.modM,i.modulus=i.mod,i.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},i.prototype.andS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)&t);return this},i.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)&t.get(r,n));return this},i.and=function(t,r){return new e(t).and(r)},i.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},i.prototype.orS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)|t);return this},i.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)|t.get(r,n));return this},i.or=function(t,r){return new e(t).or(r)},i.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},i.prototype.xorS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)^t);return this},i.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)^t.get(r,n));return this},i.xor=function(t,r){return new e(t).xor(r)},i.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},i.prototype.leftShiftS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)<<t);return this},i.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)<<t.get(r,n));return this},i.leftShift=function(t,r){return new e(t).leftShift(r)},i.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},i.prototype.signPropagatingRightShiftS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)>>t);return this},i.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)>>t.get(r,n));return this},i.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},i.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},i.prototype.rightShiftS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)>>>t);return this},i.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)>>>t.get(r,n));return this},i.rightShift=function(t,r){return new e(t).rightShift(r)},i.prototype.zeroFillRightShift=i.prototype.rightShift,i.prototype.zeroFillRightShiftS=i.prototype.rightShiftS,i.prototype.zeroFillRightShiftM=i.prototype.rightShiftM,i.zeroFillRightShift=i.rightShift,i.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,~this.get(t,r));return this},i.not=function(t){return new e(t).not()},i.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.abs(this.get(t,r)));return this},i.abs=function(t){return new e(t).abs()},i.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.acos(this.get(t,r)));return this},i.acos=function(t){return new e(t).acos()},i.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.acosh(this.get(t,r)));return this},i.acosh=function(t){return new e(t).acosh()},i.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.asin(this.get(t,r)));return this},i.asin=function(t){return new e(t).asin()},i.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.asinh(this.get(t,r)));return this},i.asinh=function(t){return new e(t).asinh()},i.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.atan(this.get(t,r)));return this},i.atan=function(t){return new e(t).atan()},i.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.atanh(this.get(t,r)));return this},i.atanh=function(t){return new e(t).atanh()},i.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.cbrt(this.get(t,r)));return this},i.cbrt=function(t){return new e(t).cbrt()},i.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.ceil(this.get(t,r)));return this},i.ceil=function(t){return new e(t).ceil()},i.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.clz32(this.get(t,r)));return this},i.clz32=function(t){return new e(t).clz32()},i.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.cos(this.get(t,r)));return this},i.cos=function(t){return new e(t).cos()},i.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.cosh(this.get(t,r)));return this},i.cosh=function(t){return new e(t).cosh()},i.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.exp(this.get(t,r)));return this},i.exp=function(t){return new e(t).exp()},i.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.expm1(this.get(t,r)));return this},i.expm1=function(t){return new e(t).expm1()},i.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.floor(this.get(t,r)));return this},i.floor=function(t){return new e(t).floor()},i.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.fround(this.get(t,r)));return this},i.fround=function(t){return new e(t).fround()},i.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.log(this.get(t,r)));return this},i.log=function(t){return new e(t).log()},i.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.log1p(this.get(t,r)));return this},i.log1p=function(t){return new e(t).log1p()},i.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.log10(this.get(t,r)));return this},i.log10=function(t){return new e(t).log10()},i.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.log2(this.get(t,r)));return this},i.log2=function(t){return new e(t).log2()},i.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.round(this.get(t,r)));return this},i.round=function(t){return new e(t).round()},i.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.sign(this.get(t,r)));return this},i.sign=function(t){return new e(t).sign()},i.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.sin(this.get(t,r)));return this},i.sin=function(t){return new e(t).sin()},i.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.sinh(this.get(t,r)));return this},i.sinh=function(t){return new e(t).sinh()},i.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.sqrt(this.get(t,r)));return this},i.sqrt=function(t){return new e(t).sqrt()},i.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.tan(this.get(t,r)));return this},i.tan=function(t){return new e(t).tan()},i.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.tanh(this.get(t,r)));return this},i.tanh=function(t){return new e(t).tanh()},i.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.trunc(this.get(t,r)));return this},i.trunc=function(t){return new e(t).trunc()},i.pow=function(t,r){return new e(t).pow(r)},i.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},i.prototype.powS=function(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)**t);return this},i.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)**t.get(r,n));return this}}function st(i,e,t){let r=t?i.rows:i.rows-1;if(e<0||e>r)throw new RangeError("Row index out of range")}function ot(i,e,t){let r=t?i.columns:i.columns-1;if(e<0||e>r)throw new RangeError("Column index out of range")}function Or(i,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==i.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function Gr(i,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==i.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function zs(i,e){if(!Je.isAnyArray(e))throw new TypeError("row indices must be an array");for(let t=0;t<e.length;t++)if(e[t]<0||e[t]>=i.rows)throw new RangeError("row indices are out of range")}function Ws(i,e){if(!Je.isAnyArray(e))throw new TypeError("column indices must be an array");for(let t=0;t<e.length;t++)if(e[t]<0||e[t]>=i.columns)throw new RangeError("column indices are out of range")}function Xs(i,e,t,r,n){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(xn("startRow",e),xn("endRow",t),xn("startColumn",r),xn("endColumn",n),e>t||r>n||e<0||e>=i.rows||t<0||t>=i.rows||r<0||r>=i.columns||n<0||n>=i.columns)throw new RangeError("Submatrix indices are out of range")}function Tn(i,e=0){let t=[];for(let r=0;r<i;r++)t.push(e);return t}function xn(i,e){if(typeof e!="number")throw new TypeError(`${i} must be a number`)}function Nr(i){if(i.isEmpty())throw new Error("Empty matrix has no elements to index")}function Ud(i){let e=Tn(i.rows);for(let t=0;t<i.rows;++t)for(let r=0;r<i.columns;++r)e[t]+=i.get(t,r);return e}function $d(i){let e=Tn(i.columns);for(let t=0;t<i.rows;++t)for(let r=0;r<i.columns;++r)e[r]+=i.get(t,r);return e}function zd(i){let e=0;for(let t=0;t<i.rows;t++)for(let r=0;r<i.columns;r++)e+=i.get(t,r);return e}function Wd(i){let e=Tn(i.rows,1);for(let t=0;t<i.rows;++t)for(let r=0;r<i.columns;++r)e[t]*=i.get(t,r);return e}function Xd(i){let e=Tn(i.columns,1);for(let t=0;t<i.rows;++t)for(let r=0;r<i.columns;++r)e[r]*=i.get(t,r);return e}function Yd(i){let e=1;for(let t=0;t<i.rows;t++)for(let r=0;r<i.columns;r++)e*=i.get(t,r);return e}function Hd(i,e,t){const r=i.rows,n=i.columns,s=[];for(let o=0;o<r;o++){let a=0,c=0,l=0;for(let u=0;u<n;u++)l=i.get(o,u)-t[o],a+=l,c+=l*l;e?s.push((c-a*a/n)/(n-1)):s.push((c-a*a/n)/n)}return s}function qd(i,e,t){const r=i.rows,n=i.columns,s=[];for(let o=0;o<n;o++){let a=0,c=0,l=0;for(let u=0;u<r;u++)l=i.get(u,o)-t[o],a+=l,c+=l*l;e?s.push((c-a*a/r)/(r-1)):s.push((c-a*a/r)/r)}return s}function Kd(i,e,t){const r=i.rows,n=i.columns,s=r*n;let o=0,a=0,c=0;for(let l=0;l<r;l++)for(let u=0;u<n;u++)c=i.get(l,u)-t,o+=c,a+=c*c;return e?(a-o*o/s)/(s-1):(a-o*o/s)/s}function Jd(i,e){for(let t=0;t<i.rows;t++)for(let r=0;r<i.columns;r++)i.set(t,r,i.get(t,r)-e[t])}function Qd(i,e){for(let t=0;t<i.rows;t++)for(let r=0;r<i.columns;r++)i.set(t,r,i.get(t,r)-e[r])}function ef(i,e){for(let t=0;t<i.rows;t++)for(let r=0;r<i.columns;r++)i.set(t,r,i.get(t,r)-e)}function tf(i){const e=[];for(let t=0;t<i.rows;t++){let r=0;for(let n=0;n<i.columns;n++)r+=i.get(t,n)**2/(i.columns-1);e.push(Math.sqrt(r))}return e}function rf(i,e){for(let t=0;t<i.rows;t++)for(let r=0;r<i.columns;r++)i.set(t,r,i.get(t,r)/e[t])}function nf(i){const e=[];for(let t=0;t<i.columns;t++){let r=0;for(let n=0;n<i.rows;n++)r+=i.get(n,t)**2/(i.rows-1);e.push(Math.sqrt(r))}return e}function sf(i,e){for(let t=0;t<i.rows;t++)for(let r=0;r<i.columns;r++)i.set(t,r,i.get(t,r)/e[r])}function of(i){const e=i.size-1;let t=0;for(let r=0;r<i.columns;r++)for(let n=0;n<i.rows;n++)t+=i.get(n,r)**2/e;return Math.sqrt(t)}function af(i,e){for(let t=0;t<i.rows;t++)for(let r=0;r<i.columns;r++)i.set(t,r,i.get(t,r)/e)}let Ce=class De{static from1DArray(e,t,r){if(e*t!==r.length)throw new RangeError("data length does not match given dimensions");let n=new z(e,t);for(let s=0;s<e;s++)for(let o=0;o<t;o++)n.set(s,o,r[s*t+o]);return n}static rowVector(e){let t=new z(1,e.length);for(let r=0;r<e.length;r++)t.set(0,r,e[r]);return t}static columnVector(e){let t=new z(e.length,1);for(let r=0;r<e.length;r++)t.set(r,0,e[r]);return t}static zeros(e,t){return new z(e,t)}static ones(e,t){return new z(e,t).fill(1)}static rand(e,t,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{random:n=Math.random}=r;let s=new z(e,t);for(let o=0;o<e;o++)for(let a=0;a<t;a++)s.set(o,a,n());return s}static randInt(e,t,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:n=0,max:s=1e3,random:o=Math.random}=r;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(n>=s)throw new RangeError("min must be smaller than max");let a=s-n,c=new z(e,t);for(let l=0;l<e;l++)for(let u=0;u<t;u++){let h=n+Math.round(o()*a);c.set(l,u,h)}return c}static eye(e,t,r){t===void 0&&(t=e),r===void 0&&(r=1);let n=Math.min(e,t),s=this.zeros(e,t);for(let o=0;o<n;o++)s.set(o,o,r);return s}static diag(e,t,r){let n=e.length;t===void 0&&(t=n),r===void 0&&(r=t);let s=Math.min(n,t,r),o=this.zeros(t,r);for(let a=0;a<s;a++)o.set(a,a,e[a]);return o}static min(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);let r=e.rows,n=e.columns,s=new z(r,n);for(let o=0;o<r;o++)for(let a=0;a<n;a++)s.set(o,a,Math.min(e.get(o,a),t.get(o,a)));return s}static max(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);let r=e.rows,n=e.columns,s=new this(r,n);for(let o=0;o<r;o++)for(let a=0;a<n;a++)s.set(o,a,Math.max(e.get(o,a),t.get(o,a)));return s}static checkMatrix(e){return De.isMatrix(e)?e:new z(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e.call(this,t,r);return this}to1DArray(){let e=[];for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}to2DArray(){let e=[];for(let t=0;t<this.rows;t++){e.push([]);for(let r=0;r<this.columns;r++)e[t].push(this.get(t,r))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let t=0;t<=e;t++)if(this.get(e,t)!==this.get(t,e))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let e=0;e<this.rows;e++)if(this.get(e,e)!==0)return!1;return!0}isEchelonForm(){let e=0,t=0,r=-1,n=!0,s=!1;for(;e<this.rows&&n;){for(t=0,s=!1;t<this.columns&&s===!1;)this.get(e,t)===0?t++:this.get(e,t)===1&&t>r?(s=!0,r=t):(n=!1,s=!0);e++}return n}isReducedEchelonForm(){let e=0,t=0,r=-1,n=!0,s=!1;for(;e<this.rows&&n;){for(t=0,s=!1;t<this.columns&&s===!1;)this.get(e,t)===0?t++:this.get(e,t)===1&&t>r?(s=!0,r=t):(n=!1,s=!0);for(let o=t+1;o<this.rows;o++)this.get(e,o)!==0&&(n=!1);e++}return n}echelonForm(){let e=this.clone(),t=0,r=0;for(;t<e.rows&&r<e.columns;){let n=t;for(let s=t;s<e.rows;s++)e.get(s,r)>e.get(n,r)&&(n=s);if(e.get(n,r)===0)r++;else{e.swapRows(t,n);let s=e.get(t,r);for(let o=r;o<e.columns;o++)e.set(t,o,e.get(t,o)/s);for(let o=t+1;o<e.rows;o++){let a=e.get(o,r)/e.get(t,r);e.set(o,r,0);for(let c=r+1;c<e.columns;c++)e.set(o,c,e.get(o,c)-e.get(t,c)*a)}t++,r++}}return e}reducedEchelonForm(){let e=this.echelonForm(),t=e.columns,r=e.rows,n=r-1;for(;n>=0;)if(e.maxRow(n)===0)n--;else{let s=0,o=!1;for(;s<r&&o===!1;)e.get(n,s)===1?o=!0:s++;for(let a=0;a<n;a++){let c=e.get(a,s);for(let l=s;l<t;l++){let u=e.get(a,l)-c*e.get(n,l);e.set(a,l,u)}}n--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:t=1,columns:r=1}=e;if(!Number.isInteger(t)||t<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let n=new z(this.rows*t,this.columns*r);for(let s=0;s<t;s++)for(let o=0;o<r;o++)n.setSubMatrix(this,this.rows*s,this.columns*o);return n}fill(e){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,e);return this}neg(){return this.mulS(-1)}getRow(e){st(this,e);let t=[];for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}getRowVector(e){return z.rowVector(this.getRow(e))}setRow(e,t){st(this,e),t=Or(this,t);for(let r=0;r<this.columns;r++)this.set(e,r,t[r]);return this}swapRows(e,t){st(this,e),st(this,t);for(let r=0;r<this.columns;r++){let n=this.get(e,r);this.set(e,r,this.get(t,r)),this.set(t,r,n)}return this}getColumn(e){ot(this,e);let t=[];for(let r=0;r<this.rows;r++)t.push(this.get(r,e));return t}getColumnVector(e){return z.columnVector(this.getColumn(e))}setColumn(e,t){ot(this,e),t=Gr(this,t);for(let r=0;r<this.rows;r++)this.set(r,e,t[r]);return this}swapColumns(e,t){ot(this,e),ot(this,t);for(let r=0;r<this.rows;r++){let n=this.get(r,e);this.set(r,e,this.get(r,t)),this.set(r,t,n)}return this}addRowVector(e){e=Or(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)+e[r]);return this}subRowVector(e){e=Or(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)-e[r]);return this}mulRowVector(e){e=Or(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e[r]);return this}divRowVector(e){e=Or(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)/e[r]);return this}addColumnVector(e){e=Gr(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)+e[t]);return this}subColumnVector(e){e=Gr(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)-e[t]);return this}mulColumnVector(e){e=Gr(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e[t]);return this}divColumnVector(e){e=Gr(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)/e[t]);return this}mulRow(e,t){st(this,e);for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this}mulColumn(e,t){ot(this,e);for(let r=0;r<this.rows;r++)this.set(r,e,this.get(r,e)*t);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{const t=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)>t[r]&&(t[r]=this.get(r,n));return t}case"column":{const t=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)>t[n]&&(t[n]=this.get(r,n));return t}case void 0:{let t=this.get(0,0);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)>t&&(t=this.get(r,n));return t}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){Nr(this);let e=this.get(0,0),t=[0,0];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)>e&&(e=this.get(r,n),t[0]=r,t[1]=n);return t}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{const t=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)<t[r]&&(t[r]=this.get(r,n));return t}case"column":{const t=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)<t[n]&&(t[n]=this.get(r,n));return t}case void 0:{let t=this.get(0,0);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)<t&&(t=this.get(r,n));return t}default:throw new Error(`invalid option: ${e}`)}}minIndex(){Nr(this);let e=this.get(0,0),t=[0,0];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)<e&&(e=this.get(r,n),t[0]=r,t[1]=n);return t}maxRow(e){if(st(this,e),this.isEmpty())return NaN;let t=this.get(e,0);for(let r=1;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxRowIndex(e){st(this,e),Nr(this);let t=this.get(e,0),r=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n),r[1]=n);return r}minRow(e){if(st(this,e),this.isEmpty())return NaN;let t=this.get(e,0);for(let r=1;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minRowIndex(e){st(this,e),Nr(this);let t=this.get(e,0),r=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n),r[1]=n);return r}maxColumn(e){if(ot(this,e),this.isEmpty())return NaN;let t=this.get(0,e);for(let r=1;r<this.rows;r++)this.get(r,e)>t&&(t=this.get(r,e));return t}maxColumnIndex(e){ot(this,e),Nr(this);let t=this.get(0,e),r=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)>t&&(t=this.get(n,e),r[0]=n);return r}minColumn(e){if(ot(this,e),this.isEmpty())return NaN;let t=this.get(0,e);for(let r=1;r<this.rows;r++)this.get(r,e)<t&&(t=this.get(r,e));return t}minColumnIndex(e){ot(this,e),Nr(this);let t=this.get(0,e),r=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)<t&&(t=this.get(n,e),r[0]=n);return r}diag(){let e=Math.min(this.rows,this.columns),t=[];for(let r=0;r<e;r++)t.push(this.get(r,r));return t}norm(e="frobenius"){switch(e){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${e}`)}}cumulativeSum(){let e=0;for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r),this.set(t,r,e);return this}dot(e){De.isMatrix(e)&&(e=e.to1DArray());let t=this.to1DArray();if(t.length!==e.length)throw new RangeError("vectors do not have the same size");let r=0;for(let n=0;n<t.length;n++)r+=t[n]*e[n];return r}mmul(e){e=z.checkMatrix(e);let t=this.rows,r=this.columns,n=e.columns,s=new z(t,n),o=new Float64Array(r);for(let a=0;a<n;a++){for(let c=0;c<r;c++)o[c]=e.get(c,a);for(let c=0;c<t;c++){let l=0;for(let u=0;u<r;u++)l+=this.get(c,u)*o[u];s.set(c,a,l)}}return s}mpow(e){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(e)||e<0)throw new RangeError("Exponent must be a non-negative integer");let t=z.eye(this.rows),r=this;for(let n=e;n>1;n/=2)n&1&&(t=t.mmul(r)),r=r.mmul(r);return t}strassen2x2(e){e=z.checkMatrix(e);let t=new z(2,2);const r=this.get(0,0),n=e.get(0,0),s=this.get(0,1),o=e.get(0,1),a=this.get(1,0),c=e.get(1,0),l=this.get(1,1),u=e.get(1,1),h=(r+l)*(n+u),d=(a+l)*n,g=r*(o-u),f=l*(c-n),y=(r+s)*u,E=(a-r)*(n+o),w=(s-l)*(c+u),P=h+f-y+w,m=g+y,v=d+f,T=h-d+g+E;return t.set(0,0,P),t.set(0,1,m),t.set(1,0,v),t.set(1,1,T),t}strassen3x3(e){e=z.checkMatrix(e);let t=new z(3,3);const r=this.get(0,0),n=this.get(0,1),s=this.get(0,2),o=this.get(1,0),a=this.get(1,1),c=this.get(1,2),l=this.get(2,0),u=this.get(2,1),h=this.get(2,2),d=e.get(0,0),g=e.get(0,1),f=e.get(0,2),y=e.get(1,0),E=e.get(1,1),w=e.get(1,2),P=e.get(2,0),m=e.get(2,1),v=e.get(2,2),T=(r+n+s-o-a-u-h)*E,A=(r-o)*(-g+E),F=a*(-d+g+y-E-w-P+v),R=(-r+o+a)*(d-g+E),p=(o+a)*(-d+g),_=r*d,x=(-r+l+u)*(d-f+w),M=(-r+l)*(f-w),K=(l+u)*(-d+f),b=(r+n+s-a-c-l-u)*w,S=u*(-d+f+y-E-w-P+m),I=(-s+u+h)*(E+P-m),j=(s-h)*(E-m),L=s*P,Z=(u+h)*(-P+m),k=(-s+a+c)*(w+P-v),O=(s-c)*(w-v),N=(a+c)*(-P+v),V=n*y,X=c*m,W=o*f,te=l*g,re=h*v,ge=_+L+V,ve=T+R+p+_+I+L+Z,ye=_+x+K+b+L+k+N,_e=A+F+R+_+L+k+O,we=A+R+p+_+X,Te=L+k+O+N+W,vt=_+x+M+S+I+j+L,Er=I+j+L+Z+te,Ze=_+x+M+K+re;return t.set(0,0,ge),t.set(0,1,ve),t.set(0,2,ye),t.set(1,0,_e),t.set(1,1,we),t.set(1,2,Te),t.set(2,0,vt),t.set(2,1,Er),t.set(2,2,Ze),t}mmulStrassen(e){e=z.checkMatrix(e);let t=this.clone(),r=t.rows,n=t.columns,s=e.rows,o=e.columns;n!==s&&console.warn(`Multiplying ${r} x ${n} and ${s} x ${o} matrix: dimensions do not match.`);function a(h,d,g){let f=h.rows,y=h.columns;if(f===d&&y===g)return h;{let E=De.zeros(d,g);return E=E.setSubMatrix(h,0,0),E}}let c=Math.max(r,s),l=Math.max(n,o);t=a(t,c,l),e=a(e,c,l);function u(h,d,g,f){if(g<=512||f<=512)return h.mmul(d);g%2===1&&f%2===1?(h=a(h,g+1,f+1),d=a(d,g+1,f+1)):g%2===1?(h=a(h,g+1,f),d=a(d,g+1,f)):f%2===1&&(h=a(h,g,f+1),d=a(d,g,f+1));let y=parseInt(h.rows/2,10),E=parseInt(h.columns/2,10),w=h.subMatrix(0,y-1,0,E-1),P=d.subMatrix(0,y-1,0,E-1),m=h.subMatrix(0,y-1,E,h.columns-1),v=d.subMatrix(0,y-1,E,d.columns-1),T=h.subMatrix(y,h.rows-1,0,E-1),A=d.subMatrix(y,d.rows-1,0,E-1),F=h.subMatrix(y,h.rows-1,E,h.columns-1),R=d.subMatrix(y,d.rows-1,E,d.columns-1),p=u(De.add(w,F),De.add(P,R),y,E),_=u(De.add(T,F),P,y,E),x=u(w,De.sub(v,R),y,E),M=u(F,De.sub(A,P),y,E),K=u(De.add(w,m),R,y,E),b=u(De.sub(T,w),De.add(P,v),y,E),S=u(De.sub(m,F),De.add(A,R),y,E),I=De.add(p,M);I.sub(K),I.add(S);let j=De.add(x,K),L=De.add(_,M),Z=De.sub(p,_);Z.add(x),Z.add(b);let k=De.zeros(2*I.rows,2*I.columns);return k=k.setSubMatrix(I,0,0),k=k.setSubMatrix(j,I.rows,0),k=k.setSubMatrix(L,0,I.columns),k=k.setSubMatrix(Z,I.rows,I.columns),k.subMatrix(0,g-1,0,f-1)}return u(t,e,c,l)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:t=0,max:r=1}=e;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(t>=r)throw new RangeError("min must be smaller than max");let n=new z(this.rows,this.columns);for(let s=0;s<this.rows;s++){const o=this.getRow(s);o.length>0&&Ya(o,{min:t,max:r,output:o}),n.setRow(s,o)}return n}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:t=0,max:r=1}=e;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(t>=r)throw new RangeError("min must be smaller than max");let n=new z(this.rows,this.columns);for(let s=0;s<this.columns;s++){const o=this.getColumn(s);o.length&&Ya(o,{min:t,max:r,output:o}),n.setColumn(s,o)}return n}flipRows(){const e=Math.ceil(this.columns/2);for(let t=0;t<this.rows;t++)for(let r=0;r<e;r++){let n=this.get(t,r),s=this.get(t,this.columns-1-r);this.set(t,r,s),this.set(t,this.columns-1-r,n)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let t=0;t<this.columns;t++)for(let r=0;r<e;r++){let n=this.get(r,t),s=this.get(this.rows-1-r,t);this.set(r,t,s),this.set(this.rows-1-r,t,n)}return this}kroneckerProduct(e){e=z.checkMatrix(e);let t=this.rows,r=this.columns,n=e.rows,s=e.columns,o=new z(t*n,r*s);for(let a=0;a<t;a++)for(let c=0;c<r;c++)for(let l=0;l<n;l++)for(let u=0;u<s;u++)o.set(n*a+l,s*c+u,this.get(a,c)*e.get(l,u));return o}kroneckerSum(e){if(e=z.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let t=this.rows,r=e.rows,n=this.kroneckerProduct(z.eye(r,r)),s=z.eye(t,t).kroneckerProduct(e);return n.add(s)}transpose(){let e=new z(this.columns,this.rows);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e.set(r,t,this.get(t,r));return e}sortRows(e=Ja){for(let t=0;t<this.rows;t++)this.setRow(t,this.getRow(t).sort(e));return this}sortColumns(e=Ja){for(let t=0;t<this.columns;t++)this.setColumn(t,this.getColumn(t).sort(e));return this}subMatrix(e,t,r,n){Xs(this,e,t,r,n);let s=new z(t-e+1,n-r+1);for(let o=e;o<=t;o++)for(let a=r;a<=n;a++)s.set(o-e,a-r,this.get(o,a));return s}subMatrixRow(e,t,r){if(t===void 0&&(t=0),r===void 0&&(r=this.columns-1),t>r||t<0||t>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let n=new z(e.length,r-t+1);for(let s=0;s<e.length;s++)for(let o=t;o<=r;o++){if(e[s]<0||e[s]>=this.rows)throw new RangeError(`Row index out of range: ${e[s]}`);n.set(s,o-t,this.get(e[s],o))}return n}subMatrixColumn(e,t,r){if(t===void 0&&(t=0),r===void 0&&(r=this.rows-1),t>r||t<0||t>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let n=new z(r-t+1,e.length);for(let s=0;s<e.length;s++)for(let o=t;o<=r;o++){if(e[s]<0||e[s]>=this.columns)throw new RangeError(`Column index out of range: ${e[s]}`);n.set(o-t,s,this.get(o,e[s]))}return n}setSubMatrix(e,t,r){if(e=z.checkMatrix(e),e.isEmpty())return this;let n=t+e.rows-1,s=r+e.columns-1;Xs(this,t,n,r,s);for(let o=0;o<e.rows;o++)for(let a=0;a<e.columns;a++)this.set(t+o,r+a,e.get(o,a));return this}selection(e,t){zs(this,e),Ws(this,t);let r=new z(e.length,t.length);for(let n=0;n<e.length;n++){let s=e[n];for(let o=0;o<t.length;o++){let a=t[o];r.set(n,o,this.get(s,a))}}return r}trace(){let e=Math.min(this.rows,this.columns),t=0;for(let r=0;r<e;r++)t+=this.get(r,r);return t}clone(){return this.constructor.copy(this,new z(this.rows,this.columns))}static copy(e,t){for(const[r,n,s]of e.entries())t.set(r,n,s);return t}sum(e){switch(e){case"row":return Ud(this);case"column":return $d(this);case void 0:return zd(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return Wd(this);case"column":return Xd(this);case void 0:return Yd(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const t=this.sum(e);switch(e){case"row":{for(let r=0;r<this.rows;r++)t[r]/=this.columns;return t}case"column":{for(let r=0;r<this.columns;r++)t[r]/=this.rows;return t}case void 0:return t/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");const{unbiased:r=!0,mean:n=this.mean(e)}=t;if(typeof r!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!Je.isAnyArray(n))throw new TypeError("mean must be an array");return Hd(this,r,n)}case"column":{if(!Je.isAnyArray(n))throw new TypeError("mean must be an array");return qd(this,r,n)}case void 0:{if(typeof n!="number")throw new TypeError("mean must be a number");return Kd(this,r,n)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,t){typeof e=="object"&&(t=e,e=void 0);const r=this.variance(e,t);if(e===void 0)return Math.sqrt(r);for(let n=0;n<r.length;n++)r[n]=Math.sqrt(r[n]);return r}center(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");const{center:r=this.mean(e)}=t;switch(e){case"row":{if(!Je.isAnyArray(r))throw new TypeError("center must be an array");return Jd(this,r),this}case"column":{if(!Je.isAnyArray(r))throw new TypeError("center must be an array");return Qd(this,r),this}case void 0:{if(typeof r!="number")throw new TypeError("center must be a number");return ef(this,r),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");let r=t.scale;switch(e){case"row":{if(r===void 0)r=tf(this);else if(!Je.isAnyArray(r))throw new TypeError("scale must be an array");return rf(this,r),this}case"column":{if(r===void 0)r=nf(this);else if(!Je.isAnyArray(r))throw new TypeError("scale must be an array");return sf(this,r),this}case void 0:{if(r===void 0)r=of(this);else if(typeof r!="number")throw new TypeError("scale must be a number");return af(this,r),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return qa(this,e)}[Symbol.iterator](){return this.entries()}*entries(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)yield[e,t,this.get(e,t)]}*values(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)yield this.get(e,t)}};Ce.prototype.klass="Matrix",typeof Symbol<"u"&&(Ce.prototype[Symbol.for("nodejs.util.inspect.custom")]=Zd);function Ja(i,e){return i-e}function cf(i){return i.every(e=>typeof e=="number")}Ce.random=Ce.rand,Ce.randomInt=Ce.randInt,Ce.diagonal=Ce.diag,Ce.prototype.diagonal=Ce.prototype.diag,Ce.identity=Ce.eye,Ce.prototype.negate=Ce.prototype.neg,Ce.prototype.tensorProduct=Ce.prototype.kroneckerProduct;let z=class Uo extends Ce{data;#e(e,t){if(this.data=[],Number.isInteger(t)&&t>=0)for(let r=0;r<e;r++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=t}constructor(e,t){if(super(),Uo.isMatrix(e))this.#e(e.rows,e.columns),Uo.copy(e,this);else if(Number.isInteger(e)&&e>=0)this.#e(e,t);else if(Je.isAnyArray(e)){const r=e;if(e=r.length,t=e?r[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<e;n++){if(r[n].length!==t)throw new RangeError("Inconsistent array dimensions");if(!cf(r[n]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(r[n]))}this.rows=e,this.columns=t}else throw new TypeError("First argument must be a positive number or an array")}set(e,t,r){return this.data[e][t]=r,this}get(e,t){return this.data[e][t]}removeRow(e){return st(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return t===void 0&&(t=e,e=this.rows),st(this,e,!0),t=Float64Array.from(Or(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){ot(this,e);for(let t=0;t<this.rows;t++){const r=new Float64Array(this.columns-1);for(let n=0;n<e;n++)r[n]=this.data[t][n];for(let n=e+1;n<this.columns;n++)r[n-1]=this.data[t][n];this.data[t]=r}return this.columns-=1,this}addColumn(e,t){typeof t>"u"&&(t=e,e=this.columns),ot(this,e,!0),t=Gr(this,t);for(let r=0;r<this.rows;r++){const n=new Float64Array(this.columns+1);let s=0;for(;s<e;s++)n[s]=this.data[r][s];for(n[s++]=t[r];s<this.columns+1;s++)n[s]=this.data[r][s-1];this.data[r]=n}return this.columns+=1,this}};Bd(Ce,z);class rr extends Ce{#e;get size(){return this.#e.size}get rows(){return this.#e.rows}get columns(){return this.#e.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return z.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}constructor(e){if(super(),z.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");this.#e=z.copy(e,new z(e.rows,e.rows))}else if(Number.isInteger(e)&&e>=0)this.#e=new z(e,e);else if(this.#e=new z(e),!this.isSymmetric())throw new TypeError("not symmetric data")}clone(){const e=new rr(this.diagonalSize);for(const[t,r,n]of this.upperRightEntries())e.set(t,r,n);return e}toMatrix(){return new z(this)}get(e,t){return this.#e.get(e,t)}set(e,t,r){return this.#e.set(e,t,r),this.#e.set(t,e,r),this}removeCross(e){return this.#e.removeRow(e),this.#e.removeColumn(e),this}addCross(e,t){t===void 0&&(t=e,e=this.diagonalSize);const r=t.slice();return r.splice(e,1),this.#e.addRow(e,r),this.#e.addColumn(e,t),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const t=[];for(const[r,n]of e.entries())n||t.push(r);t.reverse();for(const r of t)this.removeCross(r);return this}toCompact(){const{diagonalSize:e}=this,t=new Array(e*(e+1)/2);for(let r=0,n=0,s=0;s<t.length;s++)t[s]=this.get(n,r),++r>=e&&(r=++n);return t}static fromCompact(e){const t=e.length,r=(Math.sqrt(8*t+1)-1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const n=new rr(r);for(let s=0,o=0,a=0;a<t;a++)n.set(s,o,e[a]),++s>=r&&(s=++o);return n}*upperRightEntries(){for(let e=0,t=0;e<this.diagonalSize;void 0){const r=this.get(e,t);yield[e,t,r],++t>=this.diagonalSize&&(t=++e)}}*upperRightValues(){for(let e=0,t=0;e<this.diagonalSize;void 0)yield this.get(e,t),++t>=this.diagonalSize&&(t=++e)}}rr.prototype.klassType="SymmetricMatrix";class Mn extends rr{static isDistanceMatrix(e){return rr.isSymmetricMatrix(e)&&e.klassSubType==="DistanceMatrix"}constructor(e){if(super(e),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(e,t,r){return e===t&&(r=0),super.set(e,t,r)}addCross(e,t){return t===void 0&&(t=e,e=this.diagonalSize),t=t.slice(),t[e]=0,super.addCross(e,t)}toSymmetricMatrix(){return new rr(this)}clone(){const e=new Mn(this.diagonalSize);for(const[t,r,n]of this.upperRightEntries())t!==r&&e.set(t,r,n);return e}toCompact(){const{diagonalSize:e}=this,t=(e-1)*e/2,r=new Array(t);for(let n=1,s=0,o=0;o<r.length;o++)r[o]=this.get(s,n),++n>=e&&(n=++s+1);return r}static fromCompact(e){const t=e.length;if(t===0)return new this(0);const r=(Math.sqrt(8*t+1)+1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(e)}`);const n=new this(r);for(let s=1,o=0,a=0;a<t;a++)n.set(s,o,e[a]),++s>=r&&(s=++o+1);return n}}Mn.prototype.klassSubType="DistanceMatrix";class Bt extends Ce{constructor(e,t,r){super(),this.matrix=e,this.rows=t,this.columns=r}}class lf extends Bt{constructor(e,t){ot(e,t),super(e,e.rows,1),this.column=t}set(e,t,r){return this.matrix.set(e,this.column,r),this}get(e){return this.matrix.get(e,this.column)}}class uf extends Bt{constructor(e,t){Ws(e,t),super(e,e.rows,t.length),this.columnIndices=t}set(e,t,r){return this.matrix.set(e,this.columnIndices[t],r),this}get(e,t){return this.matrix.get(e,this.columnIndices[t])}}class hf extends Bt{constructor(e){super(e,e.rows,e.columns)}set(e,t,r){return this.matrix.set(e,this.columns-t-1,r),this}get(e,t){return this.matrix.get(e,this.columns-t-1)}}class df extends Bt{constructor(e){super(e,e.rows,e.columns)}set(e,t,r){return this.matrix.set(this.rows-e-1,t,r),this}get(e,t){return this.matrix.get(this.rows-e-1,t)}}class ff extends Bt{constructor(e,t){st(e,t),super(e,1,e.columns),this.row=t}set(e,t,r){return this.matrix.set(this.row,t,r),this}get(e,t){return this.matrix.get(this.row,t)}}class pf extends Bt{constructor(e,t){zs(e,t),super(e,t.length,e.columns),this.rowIndices=t}set(e,t,r){return this.matrix.set(this.rowIndices[e],t,r),this}get(e,t){return this.matrix.get(this.rowIndices[e],t)}}class En extends Bt{constructor(e,t,r){zs(e,t),Ws(e,r),super(e,t.length,r.length),this.rowIndices=t,this.columnIndices=r}set(e,t,r){return this.matrix.set(this.rowIndices[e],this.columnIndices[t],r),this}get(e,t){return this.matrix.get(this.rowIndices[e],this.columnIndices[t])}}class mf extends Bt{constructor(e,t,r,n,s){Xs(e,t,r,n,s),super(e,r-t+1,s-n+1),this.startRow=t,this.startColumn=n}set(e,t,r){return this.matrix.set(this.startRow+e,this.startColumn+t,r),this}get(e,t){return this.matrix.get(this.startRow+e,this.startColumn+t)}}class gf extends Bt{constructor(e){super(e,e.columns,e.rows)}set(e,t,r){return this.matrix.set(t,e,r),this}get(e,t){return this.matrix.get(t,e)}}let Qa=class extends Ce{constructor(e,t={}){const{rows:r=1}=t;if(e.length%r!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=e.length/r,this.data=e}set(e,t,r){let n=this._calculateIndex(e,t);return this.data[n]=r,this}get(e,t){let r=this._calculateIndex(e,t);return this.data[r]}_calculateIndex(e,t){return e*this.columns+t}},tt=class extends Ce{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,t,r){return this.data[e][t]=r,this}get(e,t){return this.data[e][t]}};function vf(i,e){if(Je.isAnyArray(i))return i[0]&&Je.isAnyArray(i[0])?new tt(i):new Qa(i,e);throw new Error("the argument is not an array")}class Sn{constructor(e){e=tt.checkMatrix(e);let t=e.clone(),r=t.rows,n=t.columns,s=new Float64Array(r),o=1,a,c,l,u,h,d,g,f,y;for(a=0;a<r;a++)s[a]=a;for(f=new Float64Array(r),c=0;c<n;c++){for(a=0;a<r;a++)f[a]=t.get(a,c);for(a=0;a<r;a++){for(y=Math.min(a,c),h=0,l=0;l<y;l++)h+=t.get(a,l)*f[l];f[a]-=h,t.set(a,c,f[a])}for(u=c,a=c+1;a<r;a++)Math.abs(f[a])>Math.abs(f[u])&&(u=a);if(u!==c){for(l=0;l<n;l++)d=t.get(u,l),t.set(u,l,t.get(c,l)),t.set(c,l,d);g=s[u],s[u]=s[c],s[c]=g,o=-o}if(c<r&&t.get(c,c)!==0)for(a=c+1;a<r;a++)t.set(a,c,t.get(a,c)/t.get(c,c))}this.LU=t,this.pivotVector=s,this.pivotSign=o}isSingular(){let e=this.LU,t=e.columns;for(let r=0;r<t;r++)if(e.get(r,r)===0)return!0;return!1}solve(e){e=z.checkMatrix(e);let t=this.LU;if(t.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r=e.columns,n=e.subMatrixRow(this.pivotVector,0,r-1),s=t.columns,o,a,c;for(c=0;c<s;c++)for(o=c+1;o<s;o++)for(a=0;a<r;a++)n.set(o,a,n.get(o,a)-n.get(c,a)*t.get(o,c));for(c=s-1;c>=0;c--){for(a=0;a<r;a++)n.set(c,a,n.get(c,a)/t.get(c,c));for(o=0;o<c;o++)for(a=0;a<r;a++)n.set(o,a,n.get(o,a)-n.get(c,a)*t.get(o,c))}return n}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let t=this.pivotSign,r=e.columns;for(let n=0;n<r;n++)t*=e.get(n,n);return t}get lowerTriangularMatrix(){let e=this.LU,t=e.rows,r=e.columns,n=new z(t,r);for(let s=0;s<t;s++)for(let o=0;o<r;o++)s>o?n.set(s,o,e.get(s,o)):s===o?n.set(s,o,1):n.set(s,o,0);return n}get upperTriangularMatrix(){let e=this.LU,t=e.rows,r=e.columns,n=new z(t,r);for(let s=0;s<t;s++)for(let o=0;o<r;o++)s<=o?n.set(s,o,e.get(s,o)):n.set(s,o,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function Ut(i,e){let t=0;return Math.abs(i)>Math.abs(e)?(t=e/i,Math.abs(i)*Math.sqrt(1+t*t)):e!==0?(t=i/e,Math.abs(e)*Math.sqrt(1+t*t)):0}class Ys{constructor(e){e=tt.checkMatrix(e);let t=e.clone(),r=e.rows,n=e.columns,s=new Float64Array(n),o,a,c,l;for(c=0;c<n;c++){let u=0;for(o=c;o<r;o++)u=Ut(u,t.get(o,c));if(u!==0){for(t.get(c,c)<0&&(u=-u),o=c;o<r;o++)t.set(o,c,t.get(o,c)/u);for(t.set(c,c,t.get(c,c)+1),a=c+1;a<n;a++){for(l=0,o=c;o<r;o++)l+=t.get(o,c)*t.get(o,a);for(l=-l/t.get(c,c),o=c;o<r;o++)t.set(o,a,t.get(o,a)+l*t.get(o,c))}}s[c]=-u}this.QR=t,this.Rdiag=s}solve(e){e=z.checkMatrix(e);let t=this.QR,r=t.rows;if(e.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n=e.columns,s=e.clone(),o=t.columns,a,c,l,u;for(l=0;l<o;l++)for(c=0;c<n;c++){for(u=0,a=l;a<r;a++)u+=t.get(a,l)*s.get(a,c);for(u=-u/t.get(l,l),a=l;a<r;a++)s.set(a,c,s.get(a,c)+u*t.get(a,l))}for(l=o-1;l>=0;l--){for(c=0;c<n;c++)s.set(l,c,s.get(l,c)/this.Rdiag[l]);for(a=0;a<l;a++)for(c=0;c<n;c++)s.set(a,c,s.get(a,c)-s.get(l,c)*t.get(a,l))}return s.subMatrix(0,o-1,0,n-1)}isFullRank(){let e=this.QR.columns;for(let t=0;t<e;t++)if(this.Rdiag[t]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,t=e.columns,r=new z(t,t),n,s;for(n=0;n<t;n++)for(s=0;s<t;s++)n<s?r.set(n,s,e.get(n,s)):n===s?r.set(n,s,this.Rdiag[n]):r.set(n,s,0);return r}get orthogonalMatrix(){let e=this.QR,t=e.rows,r=e.columns,n=new z(t,r),s,o,a,c;for(a=r-1;a>=0;a--){for(s=0;s<t;s++)n.set(s,a,0);for(n.set(a,a,1),o=a;o<r;o++)if(e.get(a,a)!==0){for(c=0,s=a;s<t;s++)c+=e.get(s,a)*n.get(s,o);for(c=-c/e.get(a,a),s=a;s<t;s++)n.set(s,o,n.get(s,o)+c*e.get(s,a))}}return n}}let Zr=class{constructor(i,e={}){if(i=tt.checkMatrix(i),i.isEmpty())throw new Error("Matrix must be non-empty");let t=i.rows,r=i.columns;const{computeLeftSingularVectors:n=!0,computeRightSingularVectors:s=!0,autoTranspose:o=!1}=e;let a=!!n,c=!!s,l=!1,u;if(t<r)if(!o)u=i.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{u=i.transpose(),t=u.rows,r=u.columns,l=!0;let p=a;a=c,c=p}else u=i.clone();let h=Math.min(t,r),d=Math.min(t+1,r),g=new Float64Array(d),f=new z(t,h),y=new z(r,r),E=new Float64Array(r),w=new Float64Array(t),P=new Float64Array(d);for(let p=0;p<d;p++)P[p]=p;let m=Math.min(t-1,r),v=Math.max(0,Math.min(r-2,t)),T=Math.max(m,v);for(let p=0;p<T;p++){if(p<m){g[p]=0;for(let _=p;_<t;_++)g[p]=Ut(g[p],u.get(_,p));if(g[p]!==0){u.get(p,p)<0&&(g[p]=-g[p]);for(let _=p;_<t;_++)u.set(_,p,u.get(_,p)/g[p]);u.set(p,p,u.get(p,p)+1)}g[p]=-g[p]}for(let _=p+1;_<r;_++){if(p<m&&g[p]!==0){let x=0;for(let M=p;M<t;M++)x+=u.get(M,p)*u.get(M,_);x=-x/u.get(p,p);for(let M=p;M<t;M++)u.set(M,_,u.get(M,_)+x*u.get(M,p))}E[_]=u.get(p,_)}if(a&&p<m)for(let _=p;_<t;_++)f.set(_,p,u.get(_,p));if(p<v){E[p]=0;for(let _=p+1;_<r;_++)E[p]=Ut(E[p],E[_]);if(E[p]!==0){E[p+1]<0&&(E[p]=0-E[p]);for(let _=p+1;_<r;_++)E[_]/=E[p];E[p+1]+=1}if(E[p]=-E[p],p+1<t&&E[p]!==0){for(let _=p+1;_<t;_++)w[_]=0;for(let _=p+1;_<t;_++)for(let x=p+1;x<r;x++)w[_]+=E[x]*u.get(_,x);for(let _=p+1;_<r;_++){let x=-E[_]/E[p+1];for(let M=p+1;M<t;M++)u.set(M,_,u.get(M,_)+x*w[M])}}if(c)for(let _=p+1;_<r;_++)y.set(_,p,E[_])}}let A=Math.min(r,t+1);if(m<r&&(g[m]=u.get(m,m)),t<A&&(g[A-1]=0),v+1<A&&(E[v]=u.get(v,A-1)),E[A-1]=0,a){for(let p=m;p<h;p++){for(let _=0;_<t;_++)f.set(_,p,0);f.set(p,p,1)}for(let p=m-1;p>=0;p--)if(g[p]!==0){for(let _=p+1;_<h;_++){let x=0;for(let M=p;M<t;M++)x+=f.get(M,p)*f.get(M,_);x=-x/f.get(p,p);for(let M=p;M<t;M++)f.set(M,_,f.get(M,_)+x*f.get(M,p))}for(let _=p;_<t;_++)f.set(_,p,-f.get(_,p));f.set(p,p,1+f.get(p,p));for(let _=0;_<p-1;_++)f.set(_,p,0)}else{for(let _=0;_<t;_++)f.set(_,p,0);f.set(p,p,1)}}if(c)for(let p=r-1;p>=0;p--){if(p<v&&E[p]!==0)for(let _=p+1;_<r;_++){let x=0;for(let M=p+1;M<r;M++)x+=y.get(M,p)*y.get(M,_);x=-x/y.get(p+1,p);for(let M=p+1;M<r;M++)y.set(M,_,y.get(M,_)+x*y.get(M,p))}for(let _=0;_<r;_++)y.set(_,p,0);y.set(p,p,1)}let F=A-1,R=Number.EPSILON;for(;A>0;){let p,_;for(p=A-2;p>=-1&&p!==-1;p--){const x=Number.MIN_VALUE+R*Math.abs(g[p]+Math.abs(g[p+1]));if(Math.abs(E[p])<=x||Number.isNaN(E[p])){E[p]=0;break}}if(p===A-2)_=4;else{let x;for(x=A-1;x>=p&&x!==p;x--){let M=(x!==A?Math.abs(E[x]):0)+(x!==p+1?Math.abs(E[x-1]):0);if(Math.abs(g[x])<=R*M){g[x]=0;break}}x===p?_=3:x===A-1?_=1:(_=2,p=x)}switch(p++,_){case 1:{let x=E[A-2];E[A-2]=0;for(let M=A-2;M>=p;M--){let K=Ut(g[M],x),b=g[M]/K,S=x/K;if(g[M]=K,M!==p&&(x=-S*E[M-1],E[M-1]=b*E[M-1]),c)for(let I=0;I<r;I++)K=b*y.get(I,M)+S*y.get(I,A-1),y.set(I,A-1,-S*y.get(I,M)+b*y.get(I,A-1)),y.set(I,M,K)}break}case 2:{let x=E[p-1];E[p-1]=0;for(let M=p;M<A;M++){let K=Ut(g[M],x),b=g[M]/K,S=x/K;if(g[M]=K,x=-S*E[M],E[M]=b*E[M],a)for(let I=0;I<t;I++)K=b*f.get(I,M)+S*f.get(I,p-1),f.set(I,p-1,-S*f.get(I,M)+b*f.get(I,p-1)),f.set(I,M,K)}break}case 3:{const x=Math.max(Math.abs(g[A-1]),Math.abs(g[A-2]),Math.abs(E[A-2]),Math.abs(g[p]),Math.abs(E[p])),M=g[A-1]/x,K=g[A-2]/x,b=E[A-2]/x,S=g[p]/x,I=E[p]/x,j=((K+M)*(K-M)+b*b)/2,L=M*b*(M*b);let Z=0;(j!==0||L!==0)&&(j<0?Z=0-Math.sqrt(j*j+L):Z=Math.sqrt(j*j+L),Z=L/(j+Z));let k=(S+M)*(S-M)+Z,O=S*I;for(let N=p;N<A-1;N++){let V=Ut(k,O);V===0&&(V=Number.MIN_VALUE);let X=k/V,W=O/V;if(N!==p&&(E[N-1]=V),k=X*g[N]+W*E[N],E[N]=X*E[N]-W*g[N],O=W*g[N+1],g[N+1]=X*g[N+1],c)for(let te=0;te<r;te++)V=X*y.get(te,N)+W*y.get(te,N+1),y.set(te,N+1,-W*y.get(te,N)+X*y.get(te,N+1)),y.set(te,N,V);if(V=Ut(k,O),V===0&&(V=Number.MIN_VALUE),X=k/V,W=O/V,g[N]=V,k=X*E[N]+W*g[N+1],g[N+1]=-W*E[N]+X*g[N+1],O=W*E[N+1],E[N+1]=X*E[N+1],a&&N<t-1)for(let te=0;te<t;te++)V=X*f.get(te,N)+W*f.get(te,N+1),f.set(te,N+1,-W*f.get(te,N)+X*f.get(te,N+1)),f.set(te,N,V)}E[A-2]=k;break}case 4:{if(g[p]<=0&&(g[p]=g[p]<0?-g[p]:0,c))for(let x=0;x<=F;x++)y.set(x,p,-y.get(x,p));for(;p<F&&!(g[p]>=g[p+1]);){let x=g[p];if(g[p]=g[p+1],g[p+1]=x,c&&p<r-1)for(let M=0;M<r;M++)x=y.get(M,p+1),y.set(M,p+1,y.get(M,p)),y.set(M,p,x);if(a&&p<t-1)for(let M=0;M<t;M++)x=f.get(M,p+1),f.set(M,p+1,f.get(M,p)),f.set(M,p,x);p++}A--;break}}}if(l){let p=y;y=f,f=p}this.m=t,this.n=r,this.s=g,this.U=f,this.V=y}solve(i){let e=i,t=this.threshold,r=this.s.length,n=z.zeros(r,r);for(let h=0;h<r;h++)Math.abs(this.s[h])<=t?n.set(h,h,0):n.set(h,h,1/this.s[h]);let s=this.U,o=this.rightSingularVectors,a=o.mmul(n),c=o.rows,l=s.rows,u=z.zeros(c,l);for(let h=0;h<c;h++)for(let d=0;d<l;d++){let g=0;for(let f=0;f<r;f++)g+=a.get(h,f)*s.get(d,f);u.set(h,d,g)}return u.mmul(e)}solveForDiagonal(i){return this.solve(z.diag(i))}inverse(){let i=this.V,e=this.threshold,t=i.rows,r=i.columns,n=new z(t,this.s.length);for(let l=0;l<t;l++)for(let u=0;u<r;u++)Math.abs(this.s[u])>e&&n.set(l,u,i.get(l,u)/this.s[u]);let s=this.U,o=s.rows,a=s.columns,c=new z(t,o);for(let l=0;l<t;l++)for(let u=0;u<o;u++){let h=0;for(let d=0;d<a;d++)h+=n.get(l,d)*s.get(u,d);c.set(l,u,h)}return c}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let i=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,t=this.s;for(let r=0,n=t.length;r<n;r++)t[r]>i&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return z.diag(this.s)}};function yf(i,e=!1){return i=tt.checkMatrix(i),e?new Zr(i).inverse():ec(i,z.eye(i.rows))}function ec(i,e,t=!1){return i=tt.checkMatrix(i),e=tt.checkMatrix(e),t?new Zr(i).solve(e):i.isSquare()?new Sn(i).solve(e):new Ys(i).solve(e)}function Pn(i){if(i=z.checkMatrix(i),i.isSquare()){if(i.columns===0)return 1;let e,t,r,n;if(i.columns===2)return e=i.get(0,0),t=i.get(0,1),r=i.get(1,0),n=i.get(1,1),e*n-t*r;if(i.columns===3){let s,o,a;return s=new En(i,[1,2],[1,2]),o=new En(i,[1,2],[0,2]),a=new En(i,[1,2],[0,1]),e=i.get(0,0),t=i.get(0,1),r=i.get(0,2),e*Pn(s)-t*Pn(o)+r*Pn(a)}else return new Sn(i).determinant}else throw Error("determinant can only be calculated for a square matrix")}function wf(i,e){let t=[];for(let r=0;r<i;r++)r!==e&&t.push(r);return t}function bf(i,e,t,r=1e-9,n=1e-9){if(i>n)return new Array(e.rows+1).fill(0);{let s=e.addRow(t,[0]);for(let o=0;o<s.rows;o++)Math.abs(s.get(o,0))<r&&s.set(o,0,0);return s.to1DArray()}}function _f(i,e={}){const{thresholdValue:t=1e-9,thresholdError:r=1e-9}=e;i=z.checkMatrix(i);let n=i.rows,s=new z(n,n);for(let o=0;o<n;o++){let a=z.columnVector(i.getRow(o)),c=i.subMatrixRow(wf(n,o)).transpose(),l=new Zr(c).solve(a),u=z.sub(a,c.mmul(l)).abs().max();s.setRow(o,bf(u,l,o,t,r))}return s}function Tf(i,e=Number.EPSILON){if(i=z.checkMatrix(i),i.isEmpty())return i.transpose();let t=new Zr(i,{autoTranspose:!0}),r=t.leftSingularVectors,n=t.rightSingularVectors,s=t.diagonal;for(let o=0;o<s.length;o++)Math.abs(s[o])>e?s[o]=1/s[o]:s[o]=0;return n.mmul(z.diag(s).mmul(r.transpose()))}function xf(i,e=i,t={}){i=new z(i);let r=!1;if(typeof e=="object"&&!z.isMatrix(e)&&!Je.isAnyArray(e)?(t=e,e=i,r=!0):e=new z(e),i.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0}=t;n&&(i=i.center("column"),r||(e=e.center("column")));const s=i.transpose().mmul(e);for(let o=0;o<s.rows;o++)for(let a=0;a<s.columns;a++)s.set(o,a,s.get(o,a)*(1/(i.rows-1)));return s}function Mf(i,e=i,t={}){i=new z(i);let r=!1;if(typeof e=="object"&&!z.isMatrix(e)&&!Je.isAnyArray(e)?(t=e,e=i,r=!0):e=new z(e),i.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0,scale:s=!0}=t;n&&(i.center("column"),r||e.center("column")),s&&(i.scale("column"),r||e.scale("column"));const o=i.standardDeviation("column",{unbiased:!0}),a=r?o:e.standardDeviation("column",{unbiased:!0}),c=i.transpose().mmul(e);for(let l=0;l<c.rows;l++)for(let u=0;u<c.columns;u++)c.set(l,u,c.get(l,u)*(1/(o[l]*a[u]))*(1/(i.rows-1)));return c}class tc{constructor(e,t={}){const{assumeSymmetric:r=!1}=t;if(e=tt.checkMatrix(e),!e.isSquare())throw new Error("Matrix is not a square matrix");if(e.isEmpty())throw new Error("Matrix must be non-empty");let n=e.columns,s=new z(n,n),o=new Float64Array(n),a=new Float64Array(n),c=e,l,u,h=!1;if(r?h=!0:h=e.isSymmetric(),h){for(l=0;l<n;l++)for(u=0;u<n;u++)s.set(l,u,c.get(l,u));Ef(n,a,o,s),Sf(n,a,o,s)}else{let d=new z(n,n),g=new Float64Array(n);for(u=0;u<n;u++)for(l=0;l<n;l++)d.set(l,u,c.get(l,u));Pf(n,d,g,s),Rf(n,a,o,s,d)}this.n=n,this.e=a,this.d=o,this.V=s}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let e=this.n,t=this.e,r=this.d,n=new z(e,e),s,o;for(s=0;s<e;s++){for(o=0;o<e;o++)n.set(s,o,0);n.set(s,s,r[s]),t[s]>0?n.set(s,s+1,t[s]):t[s]<0&&n.set(s,s-1,t[s])}return n}}function Ef(i,e,t,r){let n,s,o,a,c,l,u,h;for(c=0;c<i;c++)t[c]=r.get(i-1,c);for(a=i-1;a>0;a--){for(h=0,o=0,l=0;l<a;l++)h=h+Math.abs(t[l]);if(h===0)for(e[a]=t[a-1],c=0;c<a;c++)t[c]=r.get(a-1,c),r.set(a,c,0),r.set(c,a,0);else{for(l=0;l<a;l++)t[l]/=h,o+=t[l]*t[l];for(n=t[a-1],s=Math.sqrt(o),n>0&&(s=-s),e[a]=h*s,o=o-n*s,t[a-1]=n-s,c=0;c<a;c++)e[c]=0;for(c=0;c<a;c++){for(n=t[c],r.set(c,a,n),s=e[c]+r.get(c,c)*n,l=c+1;l<=a-1;l++)s+=r.get(l,c)*t[l],e[l]+=r.get(l,c)*n;e[c]=s}for(n=0,c=0;c<a;c++)e[c]/=o,n+=e[c]*t[c];for(u=n/(o+o),c=0;c<a;c++)e[c]-=u*t[c];for(c=0;c<a;c++){for(n=t[c],s=e[c],l=c;l<=a-1;l++)r.set(l,c,r.get(l,c)-(n*e[l]+s*t[l]));t[c]=r.get(a-1,c),r.set(a,c,0)}}t[a]=o}for(a=0;a<i-1;a++){if(r.set(i-1,a,r.get(a,a)),r.set(a,a,1),o=t[a+1],o!==0){for(l=0;l<=a;l++)t[l]=r.get(l,a+1)/o;for(c=0;c<=a;c++){for(s=0,l=0;l<=a;l++)s+=r.get(l,a+1)*r.get(l,c);for(l=0;l<=a;l++)r.set(l,c,r.get(l,c)-s*t[l])}}for(l=0;l<=a;l++)r.set(l,a+1,0)}for(c=0;c<i;c++)t[c]=r.get(i-1,c),r.set(i-1,c,0);r.set(i-1,i-1,1),e[0]=0}function Sf(i,e,t,r){let n,s,o,a,c,l,u,h,d,g,f,y,E,w,P,m;for(o=1;o<i;o++)e[o-1]=e[o];e[i-1]=0;let v=0,T=0,A=Number.EPSILON;for(l=0;l<i;l++){for(T=Math.max(T,Math.abs(t[l])+Math.abs(e[l])),u=l;u<i&&!(Math.abs(e[u])<=A*T);)u++;if(u>l)do{for(n=t[l],h=(t[l+1]-n)/(2*e[l]),d=Ut(h,1),h<0&&(d=-d),t[l]=e[l]/(h+d),t[l+1]=e[l]*(h+d),g=t[l+1],s=n-t[l],o=l+2;o<i;o++)t[o]-=s;for(v=v+s,h=t[u],f=1,y=f,E=f,w=e[l+1],P=0,m=0,o=u-1;o>=l;o--)for(E=y,y=f,m=P,n=f*e[o],s=f*h,d=Ut(h,e[o]),e[o+1]=P*d,P=e[o]/d,f=h/d,h=f*t[o]-P*n,t[o+1]=s+P*(f*n+P*t[o]),c=0;c<i;c++)s=r.get(c,o+1),r.set(c,o+1,P*r.get(c,o)+f*s),r.set(c,o,f*r.get(c,o)-P*s);h=-P*m*E*w*e[l]/g,e[l]=P*h,t[l]=f*h}while(Math.abs(e[l])>A*T);t[l]=t[l]+v,e[l]=0}for(o=0;o<i-1;o++){for(c=o,h=t[o],a=o+1;a<i;a++)t[a]<h&&(c=a,h=t[a]);if(c!==o)for(t[c]=t[o],t[o]=h,a=0;a<i;a++)h=r.get(a,o),r.set(a,o,r.get(a,c)),r.set(a,c,h)}}function Pf(i,e,t,r){let n=0,s=i-1,o,a,c,l,u,h,d;for(h=n+1;h<=s-1;h++){for(d=0,l=h;l<=s;l++)d=d+Math.abs(e.get(l,h-1));if(d!==0){for(c=0,l=s;l>=h;l--)t[l]=e.get(l,h-1)/d,c+=t[l]*t[l];for(a=Math.sqrt(c),t[h]>0&&(a=-a),c=c-t[h]*a,t[h]=t[h]-a,u=h;u<i;u++){for(o=0,l=s;l>=h;l--)o+=t[l]*e.get(l,u);for(o=o/c,l=h;l<=s;l++)e.set(l,u,e.get(l,u)-o*t[l])}for(l=0;l<=s;l++){for(o=0,u=s;u>=h;u--)o+=t[u]*e.get(l,u);for(o=o/c,u=h;u<=s;u++)e.set(l,u,e.get(l,u)-o*t[u])}t[h]=d*t[h],e.set(h,h-1,d*a)}}for(l=0;l<i;l++)for(u=0;u<i;u++)r.set(l,u,l===u?1:0);for(h=s-1;h>=n+1;h--)if(e.get(h,h-1)!==0){for(l=h+1;l<=s;l++)t[l]=e.get(l,h-1);for(u=h;u<=s;u++){for(a=0,l=h;l<=s;l++)a+=t[l]*r.get(l,u);for(a=a/t[h]/e.get(h,h-1),l=h;l<=s;l++)r.set(l,u,r.get(l,u)+a*t[l])}}}function Rf(i,e,t,r,n){let s=i-1,o=0,a=i-1,c=Number.EPSILON,l=0,u=0,h=0,d=0,g=0,f=0,y=0,E=0,w,P,m,v,T,A,F,R,p,_,x,M,K,b,S;for(w=0;w<i;w++)for((w<o||w>a)&&(t[w]=n.get(w,w),e[w]=0),P=Math.max(w-1,0);P<i;P++)u=u+Math.abs(n.get(w,P));for(;s>=o;){for(v=s;v>o&&(f=Math.abs(n.get(v-1,v-1))+Math.abs(n.get(v,v)),f===0&&(f=u),!(Math.abs(n.get(v,v-1))<c*f));)v--;if(v===s)n.set(s,s,n.get(s,s)+l),t[s]=n.get(s,s),e[s]=0,s--,E=0;else if(v===s-1){if(F=n.get(s,s-1)*n.get(s-1,s),h=(n.get(s-1,s-1)-n.get(s,s))/2,d=h*h+F,y=Math.sqrt(Math.abs(d)),n.set(s,s,n.get(s,s)+l),n.set(s-1,s-1,n.get(s-1,s-1)+l),R=n.get(s,s),d>=0){for(y=h>=0?h+y:h-y,t[s-1]=R+y,t[s]=t[s-1],y!==0&&(t[s]=R-F/y),e[s-1]=0,e[s]=0,R=n.get(s,s-1),f=Math.abs(R)+Math.abs(y),h=R/f,d=y/f,g=Math.sqrt(h*h+d*d),h=h/g,d=d/g,P=s-1;P<i;P++)y=n.get(s-1,P),n.set(s-1,P,d*y+h*n.get(s,P)),n.set(s,P,d*n.get(s,P)-h*y);for(w=0;w<=s;w++)y=n.get(w,s-1),n.set(w,s-1,d*y+h*n.get(w,s)),n.set(w,s,d*n.get(w,s)-h*y);for(w=o;w<=a;w++)y=r.get(w,s-1),r.set(w,s-1,d*y+h*r.get(w,s)),r.set(w,s,d*r.get(w,s)-h*y)}else t[s-1]=R+h,t[s]=R+h,e[s-1]=y,e[s]=-y;s=s-2,E=0}else{if(R=n.get(s,s),p=0,F=0,v<s&&(p=n.get(s-1,s-1),F=n.get(s,s-1)*n.get(s-1,s)),E===10){for(l+=R,w=o;w<=s;w++)n.set(w,w,n.get(w,w)-R);f=Math.abs(n.get(s,s-1))+Math.abs(n.get(s-1,s-2)),R=p=.75*f,F=-.4375*f*f}if(E===30&&(f=(p-R)/2,f=f*f+F,f>0)){for(f=Math.sqrt(f),p<R&&(f=-f),f=R-F/((p-R)/2+f),w=o;w<=s;w++)n.set(w,w,n.get(w,w)-f);l+=f,R=p=F=.964}for(E=E+1,T=s-2;T>=v&&(y=n.get(T,T),g=R-y,f=p-y,h=(g*f-F)/n.get(T+1,T)+n.get(T,T+1),d=n.get(T+1,T+1)-y-g-f,g=n.get(T+2,T+1),f=Math.abs(h)+Math.abs(d)+Math.abs(g),h=h/f,d=d/f,g=g/f,!(T===v||Math.abs(n.get(T,T-1))*(Math.abs(d)+Math.abs(g))<c*(Math.abs(h)*(Math.abs(n.get(T-1,T-1))+Math.abs(y)+Math.abs(n.get(T+1,T+1))))));)T--;for(w=T+2;w<=s;w++)n.set(w,w-2,0),w>T+2&&n.set(w,w-3,0);for(m=T;m<=s-1&&(b=m!==s-1,m!==T&&(h=n.get(m,m-1),d=n.get(m+1,m-1),g=b?n.get(m+2,m-1):0,R=Math.abs(h)+Math.abs(d)+Math.abs(g),R!==0&&(h=h/R,d=d/R,g=g/R)),R!==0);m++)if(f=Math.sqrt(h*h+d*d+g*g),h<0&&(f=-f),f!==0){for(m!==T?n.set(m,m-1,-f*R):v!==T&&n.set(m,m-1,-n.get(m,m-1)),h=h+f,R=h/f,p=d/f,y=g/f,d=d/h,g=g/h,P=m;P<i;P++)h=n.get(m,P)+d*n.get(m+1,P),b&&(h=h+g*n.get(m+2,P),n.set(m+2,P,n.get(m+2,P)-h*y)),n.set(m,P,n.get(m,P)-h*R),n.set(m+1,P,n.get(m+1,P)-h*p);for(w=0;w<=Math.min(s,m+3);w++)h=R*n.get(w,m)+p*n.get(w,m+1),b&&(h=h+y*n.get(w,m+2),n.set(w,m+2,n.get(w,m+2)-h*g)),n.set(w,m,n.get(w,m)-h),n.set(w,m+1,n.get(w,m+1)-h*d);for(w=o;w<=a;w++)h=R*r.get(w,m)+p*r.get(w,m+1),b&&(h=h+y*r.get(w,m+2),r.set(w,m+2,r.get(w,m+2)-h*g)),r.set(w,m,r.get(w,m)-h),r.set(w,m+1,r.get(w,m+1)-h*d)}}}if(u!==0){for(s=i-1;s>=0;s--)if(h=t[s],d=e[s],d===0)for(v=s,n.set(s,s,1),w=s-1;w>=0;w--){for(F=n.get(w,w)-h,g=0,P=v;P<=s;P++)g=g+n.get(w,P)*n.get(P,s);if(e[w]<0)y=F,f=g;else if(v=w,e[w]===0?n.set(w,s,F!==0?-g/F:-g/(c*u)):(R=n.get(w,w+1),p=n.get(w+1,w),d=(t[w]-h)*(t[w]-h)+e[w]*e[w],A=(R*f-y*g)/d,n.set(w,s,A),n.set(w+1,s,Math.abs(R)>Math.abs(y)?(-g-F*A)/R:(-f-p*A)/y)),A=Math.abs(n.get(w,s)),c*A*A>1)for(P=w;P<=s;P++)n.set(P,s,n.get(P,s)/A)}else if(d<0)for(v=s-1,Math.abs(n.get(s,s-1))>Math.abs(n.get(s-1,s))?(n.set(s-1,s-1,d/n.get(s,s-1)),n.set(s-1,s,-(n.get(s,s)-h)/n.get(s,s-1))):(S=Rn(0,-n.get(s-1,s),n.get(s-1,s-1)-h,d),n.set(s-1,s-1,S[0]),n.set(s-1,s,S[1])),n.set(s,s-1,0),n.set(s,s,1),w=s-2;w>=0;w--){for(_=0,x=0,P=v;P<=s;P++)_=_+n.get(w,P)*n.get(P,s-1),x=x+n.get(w,P)*n.get(P,s);if(F=n.get(w,w)-h,e[w]<0)y=F,g=_,f=x;else if(v=w,e[w]===0?(S=Rn(-_,-x,F,d),n.set(w,s-1,S[0]),n.set(w,s,S[1])):(R=n.get(w,w+1),p=n.get(w+1,w),M=(t[w]-h)*(t[w]-h)+e[w]*e[w]-d*d,K=(t[w]-h)*2*d,M===0&&K===0&&(M=c*u*(Math.abs(F)+Math.abs(d)+Math.abs(R)+Math.abs(p)+Math.abs(y))),S=Rn(R*g-y*_+d*x,R*f-y*x-d*_,M,K),n.set(w,s-1,S[0]),n.set(w,s,S[1]),Math.abs(R)>Math.abs(y)+Math.abs(d)?(n.set(w+1,s-1,(-_-F*n.get(w,s-1)+d*n.get(w,s))/R),n.set(w+1,s,(-x-F*n.get(w,s)-d*n.get(w,s-1))/R)):(S=Rn(-g-p*n.get(w,s-1),-f-p*n.get(w,s),y,d),n.set(w+1,s-1,S[0]),n.set(w+1,s,S[1]))),A=Math.max(Math.abs(n.get(w,s-1)),Math.abs(n.get(w,s))),c*A*A>1)for(P=w;P<=s;P++)n.set(P,s-1,n.get(P,s-1)/A),n.set(P,s,n.get(P,s)/A)}for(w=0;w<i;w++)if(w<o||w>a)for(P=w;P<i;P++)r.set(w,P,n.get(w,P));for(P=i-1;P>=o;P--)for(w=o;w<=a;w++){for(y=0,m=o;m<=Math.min(P,a);m++)y=y+r.get(w,m)*n.get(m,P);r.set(w,P,y)}}}function Rn(i,e,t,r){let n,s;return Math.abs(t)>Math.abs(r)?(n=r/t,s=t+n*r,[(i+n*e)/s,(e-n*i)/s]):(n=t/r,s=r+n*t,[(n*i+e)/s,(n*e-i)/s])}class rc{constructor(e){if(e=tt.checkMatrix(e),!e.isSymmetric())throw new Error("Matrix is not symmetric");let t=e,r=t.rows,n=new z(r,r),s=!0,o,a,c;for(a=0;a<r;a++){let l=0;for(c=0;c<a;c++){let u=0;for(o=0;o<c;o++)u+=n.get(c,o)*n.get(a,o);u=(t.get(a,c)-u)/n.get(c,c),n.set(a,c,u),l=l+u*u}for(l=t.get(a,a)-l,s&&=l>0,n.set(a,a,Math.sqrt(Math.max(l,0))),c=a+1;c<r;c++)n.set(a,c,0)}this.L=n,this.positiveDefinite=s}isPositiveDefinite(){return this.positiveDefinite}solve(e){e=tt.checkMatrix(e);let t=this.L,r=t.rows;if(e.rows!==r)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let n=e.columns,s=e.clone(),o,a,c;for(c=0;c<r;c++)for(a=0;a<n;a++){for(o=0;o<c;o++)s.set(c,a,s.get(c,a)-s.get(o,a)*t.get(c,o));s.set(c,a,s.get(c,a)/t.get(c,c))}for(c=r-1;c>=0;c--)for(a=0;a<n;a++){for(o=c+1;o<r;o++)s.set(c,a,s.get(c,a)-s.get(o,a)*t.get(o,c));s.set(c,a,s.get(c,a)/t.get(c,c))}return s}get lowerTriangularMatrix(){return this.L}}class ic{constructor(e,t={}){e=tt.checkMatrix(e);let{Y:r}=t;const{scaleScores:n=!1,maxIterations:s=1e3,terminationCriteria:o=1e-10}=t;let a;if(r){if(Je.isAnyArray(r)&&typeof r[0]=="number"?r=z.columnVector(r):r=tt.checkMatrix(r),r.rows!==e.rows)throw new Error("Y should have the same number of rows as X");a=r.getColumnVector(0)}else a=e.getColumnVector(0);let c=1,l,u,h,d;for(let g=0;g<s&&c>o;g++)h=e.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),h=h.div(h.norm()),l=e.mmul(h).div(h.transpose().mmul(h).get(0,0)),g>0&&(c=l.clone().sub(d).pow(2).sum()),d=l.clone(),r?(u=r.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),u=u.div(u.norm()),a=r.mmul(u).div(u.transpose().mmul(u).get(0,0))):a=l;if(r){let g=e.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0));g=g.div(g.norm());let f=e.clone().sub(l.clone().mmul(g.transpose())),y=a.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),E=r.clone().sub(l.clone().mulS(y.get(0,0)).mmul(u.transpose()));this.t=l,this.p=g.transpose(),this.w=h.transpose(),this.q=u,this.u=a,this.s=l.transpose().mmul(l),this.xResidual=f,this.yResidual=E,this.betas=y}else this.w=h.transpose(),this.s=l.transpose().mmul(l).sqrt(),n?this.t=l.clone().div(this.s.get(0,0)):this.t=l,this.xResidual=e.sub(l.mmul(h.transpose()))}}be.AbstractMatrix=Ce,be.CHO=rc,be.CholeskyDecomposition=rc,be.DistanceMatrix=Mn,be.EVD=tc,be.EigenvalueDecomposition=tc,be.LU=Sn,be.LuDecomposition=Sn;var If=be.Matrix=z;be.MatrixColumnSelectionView=uf,be.MatrixColumnView=lf,be.MatrixFlipColumnView=hf,be.MatrixFlipRowView=df,be.MatrixRowSelectionView=pf,be.MatrixRowView=ff,be.MatrixSelectionView=En,be.MatrixSubView=mf,be.MatrixTransposeView=gf,be.NIPALS=ic,be.Nipals=ic,be.QR=Ys,be.QrDecomposition=Ys,be.SVD=Zr;var kf=be.SingularValueDecomposition=Zr;be.SymmetricMatrix=rr,be.WrapperMatrix1D=Qa,be.WrapperMatrix2D=tt,be.correlation=Mf,be.covariance=xf;var nc=be.default=z;be.determinant=Pn;var Af=be.inverse=yf;be.linearDependencies=_f;var Cf=be.pseudoInverse=Tf;be.solve=ec,be.wrap=vf;const at=If,jf=kf;nc.Matrix&&nc.Matrix;const Lf=Af,sc=Cf;class xi{sourcePoints;destinationPoints;pointCount;pointCountMinimum;type;constructor(e,t,r,n){if(this.sourcePoints=e,this.destinationPoints=t,this.pointCount=this.sourcePoints.length,this.type=r,this.pointCountMinimum=n,this.pointCount<this.pointCountMinimum)throw new Error("Not enough control points. A "+this.type+" transformation requires a minimum of "+this.pointCountMinimum+" points, but "+this.pointCount+" are given.")}evaluate(e,t="function"){if(t=="function")return this.evaluateFunction(e);if(t=="partialDerivativeX")return this.evaluatePartialDerivativeX(e);if(t=="partialDerivativeY")return this.evaluatePartialDerivativeY(e);throw new Error("Evaluation of type "+t+" not supported")}}class oc extends xi{helmertParametersMatrix;helmertParameters;scale;rotation;translation;constructor(e,t){super(e,t,"helmert",2);const r=at.columnVector(t.flat()),n=at.zeros(2*this.pointCount,4);for(let o=0;o<this.pointCount;o++)n.set(2*o,0,1),n.set(2*o,1,0),n.set(2*o,2,this.sourcePoints[o][0]),n.set(2*o,3,-this.sourcePoints[o][1]),n.set(2*o+1,0,0),n.set(2*o+1,1,1),n.set(2*o+1,2,this.sourcePoints[o][1]),n.set(2*o+1,3,this.sourcePoints[o][0]);const s=sc(n);this.helmertParametersMatrix=s.mmul(r),this.helmertParameters=this.helmertParametersMatrix.to1DArray(),this.scale=Math.sqrt(this.helmertParameters[2]**2+this.helmertParameters[3]**2),this.rotation=Math.atan2(this.helmertParameters[3],this.helmertParameters[2]),this.translation=[this.helmertParameters[0],this.helmertParameters[1]]}evaluateFunction(e){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[this.helmertParameters[0]+this.helmertParameters[2]*e[0]-this.helmertParameters[3]*e[1],this.helmertParameters[1]+this.helmertParameters[2]*e[1]+this.helmertParameters[3]*e[0]]}evaluatePartialDerivativeX(e){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[this.helmertParameters[2],this.helmertParameters[3]]}evaluatePartialDerivativeY(e){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[-this.helmertParameters[3],this.helmertParameters[2]]}}class Ff extends xi{scale;sourcePointsCenter;destinationPointsCenter;translation;constructor(e,t){super(e,t,"straight",2);const r=new oc(this.sourcePoints,this.destinationPoints);if(this.scale=r.scale,!this.scale)throw new Error("Scale could not be computed");this.sourcePointsCenter=this.sourcePoints.reduce((s,o)=>[s[0]+o[0],s[1]+o[1]]).map(s=>s/this.pointCount),this.destinationPointsCenter=this.destinationPoints.reduce((s,o)=>[s[0]+o[0],s[1]+o[1]]).map(s=>s/this.pointCount);const n=this.scale;this.translation=this.destinationPointsCenter.map((s,o)=>s-this.sourcePointsCenter[o]*n)}evaluateFunction(e){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[this.translation[0]+this.scale*e[0],this.translation[1]+this.scale*e[1]]}evaluatePartialDerivativeX(e){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[this.scale,0]}evaluatePartialDerivativeY(e){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[0,this.scale]}}class Hs extends xi{polynomialParametersMatrices;polynomialParameters;order;pointCountMinimum;constructor(e,t,r){r=r||1;const n=(r+1)*(r+2)/2;if(super(e,t,"polynomial"+r,n),this.order=r,this.pointCountMinimum=n,this.order<1||this.order>3)throw new Error("Only polynomial transformations of order 1, 2 or 3 are supported");const s=[at.columnVector(this.destinationPoints.map(c=>c[0])),at.columnVector(this.destinationPoints.map(c=>c[1]))],o=at.zeros(this.pointCount,this.pointCountMinimum);for(let c=0;c<this.pointCount;c++)switch(this.order){case 1:o.set(c,0,1),o.set(c,1,this.sourcePoints[c][0]),o.set(c,2,this.sourcePoints[c][1]);break;case 2:o.set(c,0,1),o.set(c,1,this.sourcePoints[c][0]),o.set(c,2,this.sourcePoints[c][1]),o.set(c,3,this.sourcePoints[c][0]**2),o.set(c,4,this.sourcePoints[c][1]**2),o.set(c,5,this.sourcePoints[c][0]*this.sourcePoints[c][1]);break;case 3:o.set(c,0,1),o.set(c,1,this.sourcePoints[c][0]),o.set(c,2,this.sourcePoints[c][1]),o.set(c,3,this.sourcePoints[c][0]**2),o.set(c,4,this.sourcePoints[c][1]**2),o.set(c,5,this.sourcePoints[c][0]*this.sourcePoints[c][1]),o.set(c,6,this.sourcePoints[c][0]**3),o.set(c,7,this.sourcePoints[c][1]**3),o.set(c,8,this.sourcePoints[c][0]**2*this.sourcePoints[c][1]),o.set(c,9,this.sourcePoints[c][0]*this.sourcePoints[c][1]**2);break}const a=sc(o);this.polynomialParametersMatrices=[a.mmul(s[0]),a.mmul(s[1])],this.polynomialParameters=this.polynomialParametersMatrices.map(c=>c.to1DArray())}evaluateFunction(e){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const t=[0,0];for(let r=0;r<2;r++)switch(this.order){case 1:t[r]+=this.polynomialParameters[r][0]+this.polynomialParameters[r][1]*e[0]+this.polynomialParameters[r][2]*e[1];break;case 2:t[r]+=this.polynomialParameters[r][0]+this.polynomialParameters[r][1]*e[0]+this.polynomialParameters[r][2]*e[1]+this.polynomialParameters[r][3]*e[0]**2+this.polynomialParameters[r][4]*e[1]**2+this.polynomialParameters[r][5]*e[0]*e[1];break;case 3:t[r]+=this.polynomialParameters[r][0]+this.polynomialParameters[r][1]*e[0]+this.polynomialParameters[r][2]*e[1]+this.polynomialParameters[r][3]*e[0]**2+this.polynomialParameters[r][4]*e[1]**2+this.polynomialParameters[r][5]*e[0]*e[1]+this.polynomialParameters[r][6]*e[0]**3+this.polynomialParameters[r][7]*e[1]**3+this.polynomialParameters[r][8]*e[0]**2*e[1]+this.polynomialParameters[r][9]*e[0]*e[1]**2;break}return t}evaluatePartialDerivativeX(e){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const t=[0,0];for(let r=0;r<2;r++)switch(this.order){case 1:t[r]+=this.polynomialParameters[r][1];break;case 2:t[r]+=this.polynomialParameters[r][1]+2*this.polynomialParameters[r][3]*e[0]+this.polynomialParameters[r][5]*e[1];break;case 3:t[r]+=this.polynomialParameters[r][1]+2*this.polynomialParameters[r][3]*e[0]+this.polynomialParameters[r][5]*e[1]+3*this.polynomialParameters[r][6]*e[0]**2+2*this.polynomialParameters[r][8]*e[0]*e[1]+this.polynomialParameters[r][9]*e[1]**2;break}return t}evaluatePartialDerivativeY(e){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const t=[0,0];for(let r=0;r<2;r++)switch(this.order){case 1:t[r]+=this.polynomialParameters[r][2];break;case 2:t[r]+=this.polynomialParameters[r][2]+2*this.polynomialParameters[r][4]*e[1]+this.polynomialParameters[r][5]*e[0];break;case 3:t[r]+=this.polynomialParameters[r][2]+2*this.polynomialParameters[r][4]*e[1]+this.polynomialParameters[r][5]*e[0]+3*this.polynomialParameters[r][7]*e[1]**2+this.polynomialParameters[r][8]*e[0]**2+2*this.polynomialParameters[r][9]*e[0]*e[1];break}return t}}class Of extends xi{projectiveParametersMatrix;projectiveParameters;constructor(e,t){super(e,t,"projective",4);const r=at.zeros(2*this.pointCount,9);for(let s=0;s<this.pointCount;s++)r.set(2*s,0,-e[s][0]),r.set(2*s,1,-e[s][1]),r.set(2*s,2,-1),r.set(2*s,3,0),r.set(2*s,4,0),r.set(2*s,5,0),r.set(2*s,6,t[s][0]*e[s][0]),r.set(2*s,7,t[s][0]*e[s][1]),r.set(2*s,8,t[s][0]),r.set(2*s+1,0,0),r.set(2*s+1,1,0),r.set(2*s+1,2,0),r.set(2*s+1,3,-e[s][0]),r.set(2*s+1,4,-e[s][1]),r.set(2*s+1,5,-1),r.set(2*s+1,6,t[s][1]*e[s][0]),r.set(2*s+1,7,t[s][1]*e[s][1]),r.set(2*s+1,8,t[s][1]);const n=new jf(r);this.projectiveParametersMatrix=at.from1DArray(3,3,n.rightSingularVectors.getColumn(8)).transpose(),this.projectiveParameters=this.projectiveParametersMatrix.to2DArray()}evaluateFunction(e){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const t=this.projectiveParameters[0][2]*e[0]+this.projectiveParameters[1][2]*e[1]+this.projectiveParameters[2][2],r=this.projectiveParameters[0][0]*e[0]+this.projectiveParameters[1][0]*e[1]+this.projectiveParameters[2][0],n=this.projectiveParameters[0][1]*e[0]+this.projectiveParameters[1][1]*e[1]+this.projectiveParameters[2][1];return[r/t,n/t]}evaluatePartialDerivativeX(e){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const t=this.projectiveParameters[0][2]*e[0]+this.projectiveParameters[1][2]*e[1]+this.projectiveParameters[2][2],r=this.projectiveParameters[0][0]*e[0]+this.projectiveParameters[1][0]*e[1]+this.projectiveParameters[2][0],n=this.projectiveParameters[0][1]*e[0]+this.projectiveParameters[1][1]*e[1]+this.projectiveParameters[2][1];return[(t*this.projectiveParameters[0][0]-this.projectiveParameters[0][2]*r)/t**2,(t*this.projectiveParameters[0][1]-this.projectiveParameters[0][2]*n)/t**2]}evaluatePartialDerivativeY(e){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const t=this.projectiveParameters[0][2]*e[0]+this.projectiveParameters[1][2]*e[1]+this.projectiveParameters[2][2],r=this.projectiveParameters[0][0]*e[0]+this.projectiveParameters[1][0]*e[1]+this.projectiveParameters[2][0],n=this.projectiveParameters[0][1]*e[0]+this.projectiveParameters[1][1]*e[1]+this.projectiveParameters[2][1];return[(t*this.projectiveParameters[1][0]-this.projectiveParameters[1][2]*r)/t**2,(t*this.projectiveParameters[1][1]-this.projectiveParameters[1][2]*n)/t**2]}}class Gf extends xi{kernelFunction;normFunction;weightsMatrices;rbfWeights;affineWeights;epsilon;constructor(e,t,r,n,s){super(e,t,"thinPlateSpline",3),this.kernelFunction=r,this.normFunction=n;const o=[at.columnVector([...this.destinationPoints,[0,0],[0,0],[0,0]].map(h=>h[0])),at.columnVector([...this.destinationPoints,[0,0],[0,0],[0,0]].map(h=>h[1]))],a=at.zeros(this.pointCount,this.pointCount);for(let h=0;h<this.pointCount;h++)for(let d=0;d<this.pointCount;d++)a.set(h,d,n(this.sourcePoints[h],this.sourcePoints[d]));s===void 0&&(s=a.sum()/(Math.pow(this.pointCount,2)-this.pointCount)),this.epsilon=s;for(let h=0;h<this.pointCount;h++)for(let d=0;d<this.pointCount;d++)a.set(h,d,r(a.get(h,d),{epsilon:s}));const c=at.zeros(this.pointCount,3),l=at.zeros(this.pointCount+3,this.pointCount+3);for(let h=0;h<this.pointCount;h++)c.set(h,0,1),c.set(h,1,this.sourcePoints[h][0]),c.set(h,2,this.sourcePoints[h][1]);for(let h=0;h<this.pointCount+3;h++)for(let d=0;d<this.pointCount+3;d++)h<this.pointCount&&d<this.pointCount?l.set(h,d,a.get(h,d)):h>=this.pointCount&&d<this.pointCount?l.set(h,d,c.transpose().get(h-this.pointCount,d)):h<this.pointCount&&d>=this.pointCount&&l.set(h,d,c.get(h,d-this.pointCount));const u=Lf(l);this.weightsMatrices=[u.mmul(o[0]),u.mmul(o[1])],this.rbfWeights=this.weightsMatrices.map(h=>h.selection([...Array(this.pointCount).keys()],[0]).to1DArray()),this.affineWeights=this.weightsMatrices.map(h=>h.selection([0,1,2].map(d=>d+this.pointCount),[0]).to1DArray())}evaluateFunction(e){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const t=this.sourcePoints.map(n=>this.normFunction(e,n)),r=[0,0];for(let n=0;n<2;n++)r[n]=t.reduce((s,o,a)=>s+this.kernelFunction(o,{epsilon:this.epsilon})*this.rbfWeights[n][a],0),r[n]+=this.affineWeights[n][0]+this.affineWeights[n][1]*e[0]+this.affineWeights[n][2]*e[1];return r}evaluatePartialDerivativeX(e){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const t=this.sourcePoints.map(n=>this.normFunction(e,n)),r=[0,0];for(let n=0;n<2;n++)r[n]=t.reduce((s,o,a)=>s+(o==0?0:this.kernelFunction(o,{derivative:1,epsilon:this.epsilon})*((e[0]-this.sourcePoints[a][0])/o)*this.rbfWeights[n][a]),0),r[n]+=this.affineWeights[n][1];return r}evaluatePartialDerivativeY(e){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const t=this.sourcePoints.map(n=>this.normFunction(e,n)),r=[0,0];for(let n=0;n<2;n++)r[n]=t.reduce((s,o,a)=>s+(o==0?0:this.kernelFunction(o,{derivative:1,epsilon:this.epsilon})*((e[1]-this.sourcePoints[a][1])/o)*this.rbfWeights[n][a]),0),r[n]+=this.affineWeights[n][2];return r}}function Nf(i,e){if(e.derivative){if(e.derivative==1)return i===0?0:i+2*i*Math.log(i);throw new Error("Derivate of order "+e.derivative+" not implemented")}else return i===0?0:Math.pow(i,2)*Math.log(i)}function Zf(i,e){const t=[e[0]-i[0],e[1]-i[1]];return Math.sqrt(t[0]**2+t[1]**2)}const ac={maxDepth:0,minOffsetRatio:0,minOffsetDistance:1/0,minLineDistance:1/0,sourceMidPointFunction:Ts,destinationMidPointFunction:Ts,destinationDistanceFunction:At,returnDomain:"destination"};function In(i,e,t){i=vs(i);const r=i.map(s=>({source:s,destination:e(s)})),n=lc(r,!1).map(s=>kn(s,e,t,0)).flat(1);return uc(n,!0).map(s=>t.returnDomain=="destination"?s.destination:s.source)}function cc(i,e,t){i=Wo(i);const r=i.map(s=>({source:s,destination:e(s)})),n=lc(r,!0).map(s=>kn(s,e,t,0)).flat(1);return uc(n,!1).map(s=>t.returnDomain=="destination"?s.destination:s.source)}function kn(i,e,t,r){const n=Df(i,e,t,r);return n?[kn([i[0],n],e,t,r+1),kn([n,i[1]],e,t,r+1)].flat(1):[i]}function Df(i,e,t,r){if(r>=t.maxDepth||t.maxDepth<=0)return;const{sourceMidPoint:n,destinationMidPointFromRefinementFunction:s,destinationMidPointsDistance:o,destinationLineDistance:a,destinationRefinedLineDistance:c}=Vf(i,e,t);return Bf({destinationMidPointsDistance:o,destinationLineDistance:a,destinationRefinedLineDistance:c},t)?{source:n,destination:s}:void 0}function Vf(i,e,t){const r=t.sourceMidPointFunction(i[0].source,i[1].source),n=t.destinationMidPointFunction(i[0].destination,i[1].destination),s=e(r),o=t.destinationDistanceFunction(i[0].destination,i[1].destination),a=t.destinationDistanceFunction(e(i[0].source),e(i[1].source)),c=t.destinationDistanceFunction(n,s);return{sourceMidPoint:r,destinationMidPointFromRefinementFunction:s,destinationMidPointsDistance:c,destinationLineDistance:o,destinationRefinedLineDistance:a}}function Bf({destinationMidPointsDistance:i,destinationLineDistance:e,destinationRefinedLineDistance:t},r){return i/e>r.minOffsetRatio||i>r.minOffsetDistance||t>r.minLineDistance}function Uf(i,e,t){const r=dr(i),n=r[2],s=r[3],o=r[1],a=r[0],c=t.sourceMidPointFunction(n,o),l=t.sourceMidPointFunction(s,a),u=t.sourceMidPointFunction(n,s),h=t.sourceMidPointFunction(o,a),d=[c,l],g=[u,h],f=In(d,e,{...t,returnDomain:"source"}),y=In(g,e,{...t,returnDomain:"source"});if(f.length==2&&y.length==2)return;const E=[];for(let v=0;v<f.length-1;v++)E.push(Ct(f[v],f[v+1]));const w=Math.sqrt(Math.min(...E)),P=[];for(let v=0;v<y.length-1;v++)P.push(Ct(y[v],y[v+1]));const m=Math.sqrt(Math.min(...P));return Math.min(w,m)}function lc(i,e=!1){const t=i.length-(e?0:1),r=[];for(let n=0;n<t;n++)r.push([i[n],i[(n+1)%i.length]]);return r}function uc(i,e=!1){const t=i.map(r=>r[0]);return e&&t.push(i[i.length-1][1]),t}const $f={maxDepth:0,minOffsetRatio:0,minOffsetDistance:1/0,minLineDistance:1/0,destinationIsGeographic:!1,sourceIsGeographic:!1,inputIsMultiGeometry:!1,differentHandedness:!1,evaluationType:"function",returnDomain:"normal"};function qs(i){const e=Ie(ac,{minOffsetRatio:i.minOffsetRatio,minOffsetDistance:i.minOffsetDistance,minLineDistance:i.minLineDistance,maxDepth:i.maxDepth});return i.sourceIsGeographic&&(e.sourceMidPointFunction=(t,r)=>bn(t,r).geometry.coordinates),i.destinationIsGeographic&&(e.destinationMidPointFunction=(t,r)=>bn(t,r).geometry.coordinates,e.destinationDistanceFunction=$s),i.returnDomain=="inverse"&&(e.returnDomain="source"),e}function hc(i){const e=Ie(ac,{minOffsetRatio:i.minOffsetRatio,minOffsetDistance:i.minOffsetDistance,minLineDistance:i.minLineDistance,maxDepth:i.maxDepth});return i.destinationIsGeographic&&(e.sourceMidPointFunction=(t,r)=>bn(t,r).geometry.coordinates),i.sourceIsGeographic&&(e.destinationMidPointFunction=(t,r)=>bn(t,r).geometry.coordinates,e.destinationDistanceFunction=$s),i.returnDomain=="inverse"&&(e.returnDomain="source"),e}function An(i,e,t){return In(i,r=>e.transformForward(r),qs(t))}function Cn(i,e,t){return In(i,r=>e.transformBackward(r),hc(t))}function zf(i,e,t){return cc(i,r=>e.transformForward(r),qs(t))}function Wf(i,e,t){return cc(i,r=>e.transformBackward(r),hc(t))}function jn(i,e,t){return i.map(r=>zf(r,e,t))}function Ln(i,e,t){return i.map(r=>Wf(r,e,t))}function Xf(i,e,t){const r=Ie(e.options,t);return Uf(i,n=>e.transformForward(n),qs(r))}class Ks{gcps;sourcePoints;destinationPoints;type;options;forwardTransformation;backwardTransformation;constructor(e,t="polynomial",r){if(this.options=Ie($f,r),e.length===0)throw new Error("No control points");this.gcps=e.map(n=>{if("resource"in n&&"geo"in n)return{source:n.resource,destination:n.geo};if("source"in n&&"destination"in n)return n;throw new Error("Unsupported GCP type")}),this.sourcePoints=this.gcps.map(n=>n.source),this.destinationPoints=this.gcps.map(n=>n.destination),this.type=t}createForwardTransformation(){this.forwardTransformation=this.computeTransformation(this.sourcePoints.map(e=>this.assureEqualHandedness(e)),this.destinationPoints)}createBackwardTransformation(){this.backwardTransformation=this.computeTransformation(this.destinationPoints,this.sourcePoints.map(e=>this.assureEqualHandedness(e)))}transformForward(e,t){const r=Ie(this.options,t);if(!r.inputIsMultiGeometry){if(Ne(e))return this.forwardTransformation||this.createForwardTransformation(),this.forwardTransformation.evaluate(this.assureEqualHandedness(e),r.evaluationType);if(jt(e))return this.transformForward(ei(e),r);if(it(e))return An(e,this,r);if(Lt(e))return An(ti(e),this,Ie(r,{sourceIsGeographic:!0}));if(ut(e))return jn(e,this,r);if(Ft(e))return jn(ri(e),this,Ie(r,{sourceIsGeographic:!0}))}if(t&&(t.inputIsMultiGeometry=!1),Rt(e))return e.map(n=>this.transformForward(n,t));if(Ot(e))return Ki(e).map(n=>this.transformForward(n,t));if(It(e))return e.map(n=>this.transformForward(n,t));if(Gt(e))return Ji(e).map(n=>this.transformForward(n,t));if(kt(e))return e.map(n=>this.transformForward(n,t));if(Nt(e))return Qi(e).map(n=>this.transformForward(n,t));throw new Error("Input type not supported")}transformForwardAsGeojson(e,t){const r=Ie(this.options,t);if(!r.inputIsMultiGeometry){if(Ne(e))return Yi(this.transformForward(e));if(jt(e))return Yi(this.transformForward(ei(e)));if(it(e))return Hi(An(e,this,Ie(r,{destinationIsGeographic:!0})));if(Lt(e))return Hi(An(ti(e),this,Ie(r,{sourceIsGeographic:!0,destinationIsGeographic:!0})));if(ut(e))return qi(jn(e,this,Ie(r,{destinationIsGeographic:!0})));if(Ft(e))return qi(jn(ri(e),this,Ie(r,{sourceIsGeographic:!0,destinationIsGeographic:!0})))}if(t&&(t.inputIsMultiGeometry=!1),Rt(e))return en(e.map(n=>this.transformForwardAsGeojson(n,t)));if(Ot(e))return en(Ki(e).map(n=>this.transformForwardAsGeojson(n,t)));if(It(e))return tn(e.map(n=>this.transformForwardAsGeojson(n,t)));if(Gt(e))return tn(Ji(e).map(n=>this.transformForwardAsGeojson(n,t)));if(kt(e))return rn(e.map(n=>this.transformForwardAsGeojson(n,t)));if(Nt(e))return rn(Qi(e).map(n=>this.transformForwardAsGeojson(n,t)));throw new Error("Input type not supported")}transformBackward(e,t){const r=Ie(this.options,t);if(!r.inputIsMultiGeometry){if(Ne(e))return this.backwardTransformation||this.createBackwardTransformation(),this.assureEqualHandedness(this.backwardTransformation.evaluate(e));if(jt(e))return this.transformBackward(ei(e));if(it(e))return Cn(e,this,r);if(Lt(e))return Cn(ti(e),this,Ie(r,{destinationIsGeographic:!0}));if(ut(e))return Ln(e,this,r);if(Ft(e))return Ln(ri(e),this,Ie(r,{destinationIsGeographic:!0}))}if(t&&(t.inputIsMultiGeometry=!1),Rt(e))return e.map(n=>this.transformBackward(n,t));if(Ot(e))return Ki(e).map(n=>this.transformBackward(n,t));if(It(e))return e.map(n=>this.transformBackward(n,t));if(Gt(e))return Ji(e).map(n=>this.transformBackward(n,t));if(kt(e))return e.map(n=>this.transformBackward(n,t));if(Nt(e))return Qi(e).map(n=>this.transformBackward(n,t));throw new Error("Input type not supported")}transformBackwardAsGeojson(e,t){const r=Ie(this.options,t);if(!r.inputIsMultiGeometry){if(Ne(e))return Yi(this.transformBackward(e));if(jt(e))return Yi(this.transformBackward(ei(e)));if(it(e))return Hi(Cn(e,this,Ie(r,{sourceIsGeographic:!0})));if(Lt(e))return Hi(Cn(ti(e),this,Ie(r,{sourceIsGeographic:!0,destinationIsGeographic:!0})));if(ut(e))return qi(Ln(e,this,Ie(r,{sourceIsGeographic:!0})));if(Ft(e))return qi(Ln(ri(e),this,Ie(r,{sourceIsGeographic:!0,destinationIsGeographic:!0})))}if(t&&(t.inputIsMultiGeometry=!1),Rt(e))return en(e.map(n=>this.transformBackwardAsGeojson(n,t)));if(Ot(e))return en(Ki(e).map(n=>this.transformBackwardAsGeojson(n,t)));if(It(e))return tn(e.map(n=>this.transformBackwardAsGeojson(n,t)));if(Gt(e))return tn(Ji(e).map(n=>this.transformBackwardAsGeojson(n,t)));if(kt(e))return rn(e.map(n=>this.transformBackwardAsGeojson(n,t)));if(Nt(e))return rn(Qi(e).map(n=>this.transformBackwardAsGeojson(n,t)));throw new Error("Input type not supported")}transformToGeo(e,t){if(!Ie(this.options,t).inputIsMultiGeometry){if(Ne(e))return this.transformForward(e,t);if(jt(e))return this.transformForward(e,t);if(it(e))return this.transformForward(e,t);if(Lt(e))return this.transformForward(e,t);if(ut(e))return this.transformForward(e,t);if(Ft(e))return this.transformForward(e,t)}if(t&&(t.inputIsMultiGeometry=!1),Rt(e))return this.transformForward(e,t);if(Ot(e))return this.transformForward(e,t);if(It(e))return this.transformForward(e,t);if(Gt(e))return this.transformForward(e,t);if(kt(e))return this.transformForward(e,t);if(Nt(e))return this.transformForward(e,t);throw new Error("Input type not supported")}transformToGeoAsGeojson(e,t){if(!Ie(this.options,t).inputIsMultiGeometry){if(Ne(e))return this.transformForwardAsGeojson(e,t);if(jt(e))return this.transformForwardAsGeojson(e,t);if(it(e))return this.transformForwardAsGeojson(e,t);if(Lt(e))return this.transformForwardAsGeojson(e,t);if(ut(e))return this.transformForwardAsGeojson(e,t);if(Ft(e))return this.transformForwardAsGeojson(e,t)}if(t&&(t.inputIsMultiGeometry=!1),Rt(e))return this.transformForwardAsGeojson(e,t);if(Ot(e))return this.transformForwardAsGeojson(e,t);if(It(e))return this.transformForwardAsGeojson(e,t);if(Gt(e))return this.transformForwardAsGeojson(e,t);if(kt(e))return this.transformForwardAsGeojson(e,t);if(Nt(e))return this.transformForwardAsGeojson(e,t);throw new Error("Input type not supported")}transformToResource(e,t){if(!Ie(this.options,t).inputIsMultiGeometry){if(Ne(e))return this.transformBackward(e,t);if(jt(e))return this.transformBackward(e,t);if(it(e))return this.transformBackward(e,t);if(Lt(e))return this.transformBackward(e,t);if(ut(e))return this.transformBackward(e,t);if(Ft(e))return this.transformBackward(e,t)}if(t&&(t.inputIsMultiGeometry=!1),Rt(e))return this.transformBackward(e,t);if(Ot(e))return this.transformBackward(e,t);if(It(e))return this.transformBackward(e,t);if(Gt(e))return this.transformBackward(e,t);if(kt(e))return this.transformBackward(e,t);if(Nt(e))return this.transformBackward(e,t);throw new Error("Input type not supported")}transformToResourceAsGeojson(e,t){if(!Ie(this.options,t).inputIsMultiGeometry){if(Ne(e))return this.transformBackwardAsGeojson(e,t);if(jt(e))return this.transformBackwardAsGeojson(e,t);if(it(e))return this.transformBackwardAsGeojson(e,t);if(Lt(e))return this.transformBackwardAsGeojson(e,t);if(ut(e))return this.transformBackwardAsGeojson(e,t);if(Ft(e))return this.transformBackwardAsGeojson(e,t)}if(t&&(t.inputIsMultiGeometry=!1),Rt(e))return this.transformBackwardAsGeojson(e,t);if(Ot(e))return this.transformBackwardAsGeojson(e,t);if(It(e))return this.transformBackwardAsGeojson(e,t);if(Gt(e))return this.transformBackwardAsGeojson(e,t);if(kt(e))return this.transformBackwardAsGeojson(e,t);if(Nt(e))return this.transformBackwardAsGeojson(e,t);throw new Error("Input type not supported")}transformSvgToGeojson(e,t){if(e.type==="circle")return this.transformForwardAsGeojson(e.coordinates);if(e.type==="line")return this.transformForwardAsGeojson(e.coordinates,t);if(e.type==="polyline")return this.transformForwardAsGeojson(e.coordinates,t);if(e.type==="rect")return this.transformForwardAsGeojson([e.coordinates],t);if(e.type==="polygon")return this.transformForwardAsGeojson([e.coordinates],t);throw new Error("Unsupported SVG geometry")}transformSvgStringToGeojsonFeatureCollection(e,t){const r=[];for(const n of Ou(e)){const s=this.transformSvgToGeojson(n,t);r.push(s)}return wu(r)}transformGeojsonToSvg(e,t){if(e.type==="Point")return{type:"circle",coordinates:this.transformBackward(e)};if(e.type==="LineString")return{type:"polyline",coordinates:this.transformBackward(e,t)};if(e.type==="Polygon")return{type:"polygon",coordinates:this.transformBackward(e,t)[0]};throw new Error("Unsupported GeoJSON geometry")}transformGeojsonFeatureCollectionToSvgString(e,t){const r=[];for(const n of _u(e)){const s=this.transformGeojsonToSvg(n,t);r.push(s)}return Nu(r)}assureEqualHandedness(e){return this.options?.differentHandedness?lu(e):e}computeTransformation(e,t){if(this.type==="straight")return new Ff(e,t);if(this.type==="helmert")return new oc(e,t);if(this.type==="polynomial1"||this.type==="polynomial")return new Hs(e,t);if(this.type==="polynomial2")return new Hs(e,t,2);if(this.type==="polynomial3")return new Hs(e,t,3);if(this.type==="projective")return new Of(e,t);if(this.type==="thinPlateSpline")return new Gf(e,t,Nf,Zf);throw new Error(`Unsupported transformation type: ${this.type}`)}}const Js=["log2sigma","twoOmega","airyKavr","signDetJ","thetaa"];function Yf(i,e,t,r=1){if(i.length==0)return new Map;if(!e||!t)return new Map(i.map(c=>[c,0]));const{E:n,F:s,a:o,b:a}=Hf(e,t);return new Map(i.map(c=>{if(Js.indexOf(c)==-1)throw new Error("Distortion "+c+" not supported");switch(Js.indexOf(c)){case 0:return[c,qf(o,a,r)];case 1:return[c,Kf(o,a)];case 2:return[c,Jf(o,a,r)];case 3:return[c,Qf(e,t)];case 4:return[c,ep(e,o,a,n,s)];default:return[c,0]}}))}function Hf(i,e){const t=i[0]**2+i[1]**2,r=i[0]*e[0]+i[1]*e[1],n=e[0]**2+e[1]**2,s=Math.sqrt(.5*(t+n+Math.sqrt((t-n)**2+4*r**2))),o=Math.sqrt(.5*(t+n-Math.sqrt((t-n)**2+4*r**2)));return{E:t,F:r,G:n,a:s,b:o}}function qf(i,e,t=1){return(Math.log(i*e)-2*Math.log(t))/Math.log(2)}function Kf(i,e){return 2*Math.asin((i-e)/(i+e))}function Jf(i,e,t=1){return .5*(Math.log(i/t)**2+Math.log(e/t)**2)}function Qf(i,e){return Math.sign(i[0]*e[1]-i[1]*e[0])}function ep(i,e,t,r,n){const s=Math.atan(i[1]/i[0]),o=Math.sign(-n)*Math.asin(Math.sqrt((1-e**2/r)/(1-(e/t)**2)));return s-o}var $=(i=>(i.GEOREFERENCEANNOTATIONADDED="georeferenceannotationadded",i.GEOREFERENCEANNOTATIONREMOVED="georeferenceannotationremoved",i.WARPEDMAPADDED="warpedmapadded",i.WARPEDMAPREMOVED="warpedmapremoved",i.WARPEDMAPENTER="warpedmapenter",i.WARPEDMAPLEAVE="warpedmapleave",i.IMAGEINFOLOADED="imageinfoloaded",i.TILEFETCHED="tilefetched",i.TILEFETCHERROR="tilefetcherror",i.MAPTILELOADED="maptileloaded",i.MAPTILEREMOVED="maptileremoved",i.FIRSTMAPTILELOADED="firstmaptileloaded",i.ALLREQUESTEDTILESLOADED="allrequestedtilesloaded",i.TEXTURESUPDATED="texturesupdated",i.PRECHANGE="prechange",i.ZINDICESCHANGED="zindiceschanged",i.RESOURCEMASKUPDATED="resourcemaskupdated",i.GCPSUPDATED="gcpsupdated",i.VISIBILITYCHANGED="visibilitychanged",i.TRANSFORMATIONCHANGED="transformationchanged",i.DISTORTIONCHANGED="distortionchanged",i.CHANGED="changed",i.CLEARED="cleared",i))($||{});let ue=class extends Event{data;constructor(e,t){super(e),this.data=t}};const Qs={minOffsetRatio:.01,minOffsetDistance:4,maxDepth:4,differentHandedness:!0},dc=!0;function tp(){return{visible:dc}}let rp=class extends EventTarget{mapId;georeferencedMap;gcps;projectedGcps;projectedGeoPoints;projectedGeoPreviousTransformedResourcePoints;projectedGeoTransformedResourcePoints;resourcePreviousMask;resourceMask;resourceMaskBbox;resourceMaskRectangle;resourceFullMask;resourceFullMaskBbox;resourceFullMaskRectangle;imageInformations;parsedImage;loadingImageInfo;fetchFn;abortController;visible;mixed=!1;previousTransformationType;transformationType;transformer;projectedPreviousTransformer;projectedTransformer;transformerByTransformationType=new Map;projectedTransformerByTransformationType=new Map;geoMask;geoMaskBbox;geoMaskRectangle;geoFullMask;geoFullMaskBbox;geoFullMaskRectangle;projectedGeoMask;projectedGeoMaskBbox;projectedGeoMaskRectangle;projectedGeoFullMask;projectedGeoFullMaskBbox;projectedGeoFullMaskRectangle;resourceToProjectedGeoScale;previousDistortionMeasure;distortionMeasure;tileZoomLevelForViewport;overviewTileZoomLevelForViewport;projectedGeoBufferedViewportRectangleForViewport;projectedGeoBufferedViewportRectangleBboxForViewport;resourceBufferedViewportRingForViewport;resourceBufferedViewportRingBboxForViewport;fetchableTilesForViewport=[];overviewFetchableTilesForViewport=[];constructor(e,t,r){super(),r={...tp(),...r},this.mapId=e,this.georeferencedMap=t,this.gcps=this.georeferencedMap.gcps,this.projectedGcps=this.gcps.map(({resource:o,geo:a})=>({resource:o,geo:Rr(a)})),this.projectedGeoPoints=this.projectedGcps.map(o=>o.geo),this.resourceMask=this.georeferencedMap.resourceMask,this.updateResourceMaskProperties();const n=this.georeferencedMap.resource.width,s=this.georeferencedMap.resource.height;n&&s?this.resourceFullMask=[[0,0],[n,0],[n,s],[0,s]]:this.resourceFullMask=dr(this.resourceMaskBbox),this.resourceFullMaskBbox=Ve(this.resourceFullMask),this.resourceFullMaskRectangle=dr(this.resourceFullMaskBbox),this.imageInformations=r.imageInformations,this.loadingImageInfo=!1,this.visible=r.visible||dc,this.fetchFn=r.fetchFn,this.transformationType=r.transformation?.type||this.georeferencedMap.transformation?.type||"polynomial",this.previousTransformationType=this.transformationType,this.updateTransformerProperties()}getViewportMask(e){return this.projectedGeoMask.map(t=>et(e.projectedGeoToViewportTransform,t))}getViewportMaskBbox(e){return Ve(this.getViewportMask(e))}getViewportMaskRectangle(e){return this.projectedGeoMaskRectangle.map(t=>et(e.projectedGeoToViewportTransform,t))}getViewportFullMask(e){return this.projectedGeoFullMask.map(t=>et(e.projectedGeoToViewportTransform,t))}getViewportFullMaskBbox(e){return Ve(this.getViewportFullMask(e))}getViewportFullMaskRectangle(e){return this.projectedGeoFullMaskRectangle.map(t=>et(e.projectedGeoToViewportTransform,t))}getResourceToViewportScale(e){return Jo(this.resourceMaskRectangle,this.getViewportMaskRectangle(e))}getResourceToCanvasScale(e){return this.getResourceToViewportScale(e)/e.devicePixelRatio}getReferenceScale(){const e=Ms(this.projectedTransformerByTransformationType,"helmert",()=>new Ks(this.projectedGcps,"helmert",Qs));return e.forwardTransformation||e.createForwardTransformation(),e.forwardTransformation.scale}setResourceMask(e){this.resourceMask=e,this.updateResourceMaskProperties(),this.updateGeoMask(),this.updateProjectedGeoMask(),this.updateResourceToProjectedGeoScale()}setTransformationType(e){this.transformationType=e,this.updateTransformerProperties()}setDistortionMeasure(e){this.distortionMeasure=e,this.updateDistortionProperties()}setGcps(e){this.gcps=e,this.updateTransformerProperties(!1)}setTileZoomLevelForViewport(e){this.tileZoomLevelForViewport=e}setOverviewTileZoomLevelForViewport(e){this.overviewTileZoomLevelForViewport=e}setProjectedGeoBufferedViewportRectangleForViewport(e){this.projectedGeoBufferedViewportRectangleForViewport=e,this.projectedGeoBufferedViewportRectangleBboxForViewport=e?Ve(e):void 0}setResourceBufferedViewportRingForViewport(e){this.resourceBufferedViewportRingForViewport=e,this.resourceBufferedViewportRingBboxForViewport=e?Ve(e):void 0}setFetchableTilesForViewport(e){this.fetchableTilesForViewport=e}setOverviewFetchableTilesForViewport(e){this.overviewFetchableTilesForViewport=e}resetForViewport(){this.setTileZoomLevelForViewport(),this.setOverviewTileZoomLevelForViewport(),this.setProjectedGeoBufferedViewportRectangleForViewport(),this.setResourceBufferedViewportRingForViewport(),this.setFetchableTilesForViewport([]),this.setOverviewFetchableTilesForViewport([])}resetPrevious(){this.mixed=!1,this.previousTransformationType=this.transformationType,this.previousDistortionMeasure=this.distortionMeasure,this.projectedPreviousTransformer=this.projectedTransformer,this.projectedGeoPreviousTransformedResourcePoints=this.projectedGeoTransformedResourcePoints,this.resourcePreviousMask=this.resourceMask}mixPreviousAndNew(e){this.mixed=!0,this.previousTransformationType=this.transformationType,this.previousDistortionMeasure=this.distortionMeasure,this.projectedPreviousTransformer=this.projectedTransformer,this.projectedGeoPreviousTransformedResourcePoints=this.projectedGeoTransformedResourcePoints.map((t,r)=>_s(t,this.projectedGeoPreviousTransformedResourcePoints[r],e))}hasImageInfo(){return this.parsedImage!==void 0}async loadImageInfo(){try{this.loadingImageInfo=!0;const e=this.georeferencedMap.resource.id;let t;if(this.imageInformations?.get(e))t=this.imageInformations.get(e);else{this.abortController=new AbortController;const r=this.abortController.signal;t=await iu(e,{signal:r},this.fetchFn),this.abortController=void 0,this.imageInformations?.set(e,t)}this.parsedImage=Bs.parse(t),this.dispatchEvent(new ue($.IMAGEINFOLOADED))}catch(e){throw this.loadingImageInfo=!1,e}finally{this.loadingImageInfo=!1}}updateResourceMaskProperties(){this.resourceMaskBbox=Ve(this.resourceMask),this.resourceMaskRectangle=dr(this.resourceMaskBbox),this.resourcePreviousMask||(this.resourcePreviousMask=this.resourceMask)}updateTransformerProperties(e=!0){this.updateTransformer(e),this.updateProjectedTransformer(e),this.updateProjectedGeoTransformedResourcePoints(),this.updateGeoMask(),this.updateFullGeoMask(),this.updateProjectedGeoMask(),this.updateProjectedFullGeoMask(),this.updateResourceToProjectedGeoScale()}updateTransformer(e=!0){this.transformer=Ms(this.transformerByTransformationType,this.transformationType,()=>new Ks(this.gcps,this.transformationType,Qs),()=>e)}updateProjectedTransformer(e=!0){this.projectedTransformer=Ms(this.projectedTransformerByTransformationType,this.transformationType,()=>new Ks(this.projectedGcps,this.transformationType,Qs),()=>e),this.projectedPreviousTransformer||(this.projectedPreviousTransformer=this.projectedTransformer)}updateProjectedGeoTransformedResourcePoints(){this.projectedGeoTransformedResourcePoints=this.gcps.map(e=>this.projectedTransformer.transformToGeo(e.resource)),this.projectedGeoPreviousTransformedResourcePoints||(this.projectedGeoPreviousTransformedResourcePoints=this.projectedGeoTransformedResourcePoints)}updateGeoMask(){this.geoMask=this.transformer.transformToGeoAsGeojson([this.resourceMask]),this.geoMaskBbox=Ve(this.geoMask),this.geoMaskRectangle=this.transformer.transformToGeo([this.resourceMaskRectangle],{maxDepth:0})[0]}updateFullGeoMask(){this.geoFullMask=this.transformer.transformToGeoAsGeojson([this.resourceFullMask]),this.geoFullMaskBbox=Ve(this.geoFullMask),this.geoFullMaskRectangle=this.transformer.transformToGeo([this.resourceFullMaskRectangle],{maxDepth:0})[0]}updateProjectedGeoMask(){this.projectedGeoMask=this.projectedTransformer.transformToGeo([this.resourceMask])[0],this.projectedGeoMaskBbox=Ve(this.projectedGeoMask),this.projectedGeoMaskRectangle=this.projectedTransformer.transformToGeo([this.resourceMaskRectangle],{maxDepth:0})[0]}updateProjectedFullGeoMask(){this.projectedGeoFullMask=this.projectedTransformer.transformToGeo([this.resourceFullMask])[0],this.projectedGeoFullMaskBbox=Ve(this.projectedGeoFullMask),this.projectedGeoFullMaskRectangle=this.projectedTransformer.transformToGeo([this.resourceFullMaskRectangle],{maxDepth:0})[0]}updateResourceToProjectedGeoScale(){this.resourceToProjectedGeoScale=Jo(this.resourceMaskRectangle,this.projectedGeoMaskRectangle)}updateDistortionProperties(){}destroy(){this.abortController&&this.abortController.abort()}};function ip(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var fc={exports:{}},pc=np,mc=+(Math.pow(2,27)+1);function np(i,e,t){var r=i*e,n=mc*i,s=n-i,o=n-s,a=i-o,c=mc*e,l=c-e,u=c-l,h=e-u,d=r-o*u,g=d-a*u,f=g-o*h,y=a*h-f;return t?(t[0]=y,t[1]=r,t):[y,r]}var sp=ap;function op(i,e){var t=i+e,r=t-i,n=t-r,s=e-r,o=i-n,a=o+s;return a?[a,t]:[t]}function ap(i,e){var t=i.length|0,r=e.length|0;if(t===1&&r===1)return op(i[0],e[0]);var n=t+r,s=new Array(n),o=0,a=0,c=0,l=Math.abs,u=i[a],h=l(u),d=e[c],g=l(d),f,y;h<g?(y=u,a+=1,a<t&&(u=i[a],h=l(u))):(y=d,c+=1,c<r&&(d=e[c],g=l(d))),a<t&&h<g||c>=r?(f=u,a+=1,a<t&&(u=i[a],h=l(u))):(f=d,c+=1,c<r&&(d=e[c],g=l(d)));for(var E=f+y,w=E-f,P=y-w,m=P,v=E,T,A,F,R,p;a<t&&c<r;)h<g?(f=u,a+=1,a<t&&(u=i[a],h=l(u))):(f=d,c+=1,c<r&&(d=e[c],g=l(d))),y=m,E=f+y,w=E-f,P=y-w,P&&(s[o++]=P),T=v+E,A=T-v,F=T-A,R=E-A,p=v-F,m=p+R,v=T;for(;a<t;)f=u,y=m,E=f+y,w=E-f,P=y-w,P&&(s[o++]=P),T=v+E,A=T-v,F=T-A,R=E-A,p=v-F,m=p+R,v=T,a+=1,a<t&&(u=i[a]);for(;c<r;)f=d,y=m,E=f+y,w=E-f,P=y-w,P&&(s[o++]=P),T=v+E,A=T-v,F=T-A,R=E-A,p=v-F,m=p+R,v=T,c+=1,c<r&&(d=e[c]);return m&&(s[o++]=m),v&&(s[o++]=v),o||(s[o++]=0),s.length=o,s}var cp=lp;function lp(i,e,t){var r=i+e,n=r-i,s=r-n,o=e-n,a=i-s;return t?(t[0]=a+o,t[1]=r,t):[a+o,r]}var eo=pc,up=cp,hp=dp;function dp(i,e){var t=i.length;if(t===1){var r=eo(i[0],e);return r[0]?r:[r[1]]}var n=new Array(2*t),s=[.1,.1],o=[.1,.1],a=0;eo(i[0],e,s),s[0]&&(n[a++]=s[0]);for(var c=1;c<t;++c){eo(i[c],e,o);var l=s[1];up(l,o[0],s),s[0]&&(n[a++]=s[0]);var u=o[1],h=s[1],d=u+h,g=d-u,f=h-g;s[1]=d,f&&(n[a++]=f)}return s[1]&&(n[a++]=s[1]),a===0&&(n[a++]=0),n.length=a,n}var fp=mp;function pp(i,e){var t=i+e,r=t-i,n=t-r,s=e-r,o=i-n,a=o+s;return a?[a,t]:[t]}function mp(i,e){var t=i.length|0,r=e.length|0;if(t===1&&r===1)return pp(i[0],-e[0]);var n=t+r,s=new Array(n),o=0,a=0,c=0,l=Math.abs,u=i[a],h=l(u),d=-e[c],g=l(d),f,y;h<g?(y=u,a+=1,a<t&&(u=i[a],h=l(u))):(y=d,c+=1,c<r&&(d=-e[c],g=l(d))),a<t&&h<g||c>=r?(f=u,a+=1,a<t&&(u=i[a],h=l(u))):(f=d,c+=1,c<r&&(d=-e[c],g=l(d)));for(var E=f+y,w=E-f,P=y-w,m=P,v=E,T,A,F,R,p;a<t&&c<r;)h<g?(f=u,a+=1,a<t&&(u=i[a],h=l(u))):(f=d,c+=1,c<r&&(d=-e[c],g=l(d))),y=m,E=f+y,w=E-f,P=y-w,P&&(s[o++]=P),T=v+E,A=T-v,F=T-A,R=E-A,p=v-F,m=p+R,v=T;for(;a<t;)f=u,y=m,E=f+y,w=E-f,P=y-w,P&&(s[o++]=P),T=v+E,A=T-v,F=T-A,R=E-A,p=v-F,m=p+R,v=T,a+=1,a<t&&(u=i[a]);for(;c<r;)f=d,y=m,E=f+y,w=E-f,P=y-w,P&&(s[o++]=P),T=v+E,A=T-v,F=T-A,R=E-A,p=v-F,m=p+R,v=T,c+=1,c<r&&(d=-e[c]);return m&&(s[o++]=m),v&&(s[o++]=v),o||(s[o++]=0),s.length=o,s}(function(i){var e=pc,t=sp,r=hp,n=fp,s=5,o=11102230246251565e-32,a=(3+16*o)*o,c=(7+56*o)*o;function l(m,v,T,A){return function(R,p,_){var x=m(m(v(p[1],_[0]),v(-_[1],p[0])),m(v(R[1],p[0]),v(-p[1],R[0]))),M=m(v(R[1],_[0]),v(-_[1],R[0])),K=A(x,M);return K[K.length-1]}}function u(m,v,T,A){return function(R,p,_,x){var M=m(m(T(m(v(_[1],x[0]),v(-x[1],_[0])),p[2]),m(T(m(v(p[1],x[0]),v(-x[1],p[0])),-_[2]),T(m(v(p[1],_[0]),v(-_[1],p[0])),x[2]))),m(T(m(v(p[1],x[0]),v(-x[1],p[0])),R[2]),m(T(m(v(R[1],x[0]),v(-x[1],R[0])),-p[2]),T(m(v(R[1],p[0]),v(-p[1],R[0])),x[2])))),K=m(m(T(m(v(_[1],x[0]),v(-x[1],_[0])),R[2]),m(T(m(v(R[1],x[0]),v(-x[1],R[0])),-_[2]),T(m(v(R[1],_[0]),v(-_[1],R[0])),x[2]))),m(T(m(v(p[1],_[0]),v(-_[1],p[0])),R[2]),m(T(m(v(R[1],_[0]),v(-_[1],R[0])),-p[2]),T(m(v(R[1],p[0]),v(-p[1],R[0])),_[2])))),b=A(M,K);return b[b.length-1]}}function h(m,v,T,A){return function(R,p,_,x,M){var K=m(m(m(T(m(T(m(v(x[1],M[0]),v(-M[1],x[0])),_[2]),m(T(m(v(_[1],M[0]),v(-M[1],_[0])),-x[2]),T(m(v(_[1],x[0]),v(-x[1],_[0])),M[2]))),p[3]),m(T(m(T(m(v(x[1],M[0]),v(-M[1],x[0])),p[2]),m(T(m(v(p[1],M[0]),v(-M[1],p[0])),-x[2]),T(m(v(p[1],x[0]),v(-x[1],p[0])),M[2]))),-_[3]),T(m(T(m(v(_[1],M[0]),v(-M[1],_[0])),p[2]),m(T(m(v(p[1],M[0]),v(-M[1],p[0])),-_[2]),T(m(v(p[1],_[0]),v(-_[1],p[0])),M[2]))),x[3]))),m(T(m(T(m(v(_[1],x[0]),v(-x[1],_[0])),p[2]),m(T(m(v(p[1],x[0]),v(-x[1],p[0])),-_[2]),T(m(v(p[1],_[0]),v(-_[1],p[0])),x[2]))),-M[3]),m(T(m(T(m(v(x[1],M[0]),v(-M[1],x[0])),p[2]),m(T(m(v(p[1],M[0]),v(-M[1],p[0])),-x[2]),T(m(v(p[1],x[0]),v(-x[1],p[0])),M[2]))),R[3]),T(m(T(m(v(x[1],M[0]),v(-M[1],x[0])),R[2]),m(T(m(v(R[1],M[0]),v(-M[1],R[0])),-x[2]),T(m(v(R[1],x[0]),v(-x[1],R[0])),M[2]))),-p[3])))),m(m(T(m(T(m(v(p[1],M[0]),v(-M[1],p[0])),R[2]),m(T(m(v(R[1],M[0]),v(-M[1],R[0])),-p[2]),T(m(v(R[1],p[0]),v(-p[1],R[0])),M[2]))),x[3]),m(T(m(T(m(v(p[1],x[0]),v(-x[1],p[0])),R[2]),m(T(m(v(R[1],x[0]),v(-x[1],R[0])),-p[2]),T(m(v(R[1],p[0]),v(-p[1],R[0])),x[2]))),-M[3]),T(m(T(m(v(_[1],x[0]),v(-x[1],_[0])),p[2]),m(T(m(v(p[1],x[0]),v(-x[1],p[0])),-_[2]),T(m(v(p[1],_[0]),v(-_[1],p[0])),x[2]))),R[3]))),m(T(m(T(m(v(_[1],x[0]),v(-x[1],_[0])),R[2]),m(T(m(v(R[1],x[0]),v(-x[1],R[0])),-_[2]),T(m(v(R[1],_[0]),v(-_[1],R[0])),x[2]))),-p[3]),m(T(m(T(m(v(p[1],x[0]),v(-x[1],p[0])),R[2]),m(T(m(v(R[1],x[0]),v(-x[1],R[0])),-p[2]),T(m(v(R[1],p[0]),v(-p[1],R[0])),x[2]))),_[3]),T(m(T(m(v(p[1],_[0]),v(-_[1],p[0])),R[2]),m(T(m(v(R[1],_[0]),v(-_[1],R[0])),-p[2]),T(m(v(R[1],p[0]),v(-p[1],R[0])),_[2]))),-x[3]))))),b=m(m(m(T(m(T(m(v(x[1],M[0]),v(-M[1],x[0])),_[2]),m(T(m(v(_[1],M[0]),v(-M[1],_[0])),-x[2]),T(m(v(_[1],x[0]),v(-x[1],_[0])),M[2]))),R[3]),T(m(T(m(v(x[1],M[0]),v(-M[1],x[0])),R[2]),m(T(m(v(R[1],M[0]),v(-M[1],R[0])),-x[2]),T(m(v(R[1],x[0]),v(-x[1],R[0])),M[2]))),-_[3])),m(T(m(T(m(v(_[1],M[0]),v(-M[1],_[0])),R[2]),m(T(m(v(R[1],M[0]),v(-M[1],R[0])),-_[2]),T(m(v(R[1],_[0]),v(-_[1],R[0])),M[2]))),x[3]),T(m(T(m(v(_[1],x[0]),v(-x[1],_[0])),R[2]),m(T(m(v(R[1],x[0]),v(-x[1],R[0])),-_[2]),T(m(v(R[1],_[0]),v(-_[1],R[0])),x[2]))),-M[3]))),m(m(T(m(T(m(v(_[1],M[0]),v(-M[1],_[0])),p[2]),m(T(m(v(p[1],M[0]),v(-M[1],p[0])),-_[2]),T(m(v(p[1],_[0]),v(-_[1],p[0])),M[2]))),R[3]),T(m(T(m(v(_[1],M[0]),v(-M[1],_[0])),R[2]),m(T(m(v(R[1],M[0]),v(-M[1],R[0])),-_[2]),T(m(v(R[1],_[0]),v(-_[1],R[0])),M[2]))),-p[3])),m(T(m(T(m(v(p[1],M[0]),v(-M[1],p[0])),R[2]),m(T(m(v(R[1],M[0]),v(-M[1],R[0])),-p[2]),T(m(v(R[1],p[0]),v(-p[1],R[0])),M[2]))),_[3]),T(m(T(m(v(p[1],_[0]),v(-_[1],p[0])),R[2]),m(T(m(v(R[1],_[0]),v(-_[1],R[0])),-p[2]),T(m(v(R[1],p[0]),v(-p[1],R[0])),_[2]))),-M[3])))),S=A(K,b);return S[S.length-1]}}function d(m){var v=m===3?l:m===4?u:h;return v(t,e,r,n)}var g=d(3),f=d(4),y=[function(){return 0},function(){return 0},function(v,T){return T[0]-v[0]},function(v,T,A){var F=(v[1]-A[1])*(T[0]-A[0]),R=(v[0]-A[0])*(T[1]-A[1]),p=F-R,_;if(F>0){if(R<=0)return p;_=F+R}else if(F<0){if(R>=0)return p;_=-(F+R)}else return p;var x=a*_;return p>=x||p<=-x?p:g(v,T,A)},function(v,T,A,F){var R=v[0]-F[0],p=T[0]-F[0],_=A[0]-F[0],x=v[1]-F[1],M=T[1]-F[1],K=A[1]-F[1],b=v[2]-F[2],S=T[2]-F[2],I=A[2]-F[2],j=p*K,L=_*M,Z=_*x,k=R*K,O=R*M,N=p*x,V=b*(j-L)+S*(Z-k)+I*(O-N),X=(Math.abs(j)+Math.abs(L))*Math.abs(b)+(Math.abs(Z)+Math.abs(k))*Math.abs(S)+(Math.abs(O)+Math.abs(N))*Math.abs(I),W=c*X;return V>W||-V>W?V:f(v,T,A,F)}];function E(m){var v=y[m.length];return v||(v=y[m.length]=d(m.length)),v.apply(void 0,m)}function w(m,v,T,A,F,R,p){return function(x,M,K,b,S){switch(arguments.length){case 0:case 1:return 0;case 2:return A(x,M);case 3:return F(x,M,K);case 4:return R(x,M,K,b);case 5:return p(x,M,K,b,S)}for(var I=new Array(arguments.length),j=0;j<arguments.length;++j)I[j]=arguments[j];return m(I)}}function P(){for(;y.length<=s;)y.push(d(y.length));i.exports=w.apply(void 0,[E].concat(y));for(var m=0;m<=s;++m)i.exports[m]=y[m]}P()})(fc);var gp=fc.exports,vp=yp,Fn=gp;function yp(i,e){for(var t=e[0],r=e[1],n=i.length,s=1,o=n,a=0,c=n-1;a<o;c=a++){var l=i[a],u=i[c],h=l[1],d=u[1];if(d<h){if(d<r&&r<h){var g=Fn(l,u,e);if(g===0)return 0;s^=0<g|0}else if(r===h){var f=i[(a+1)%n],y=f[1];if(h<y){var g=Fn(l,u,e);if(g===0)return 0;s^=0<g|0}}}else if(h<d){if(h<r&&r<d){var g=Fn(l,u,e);if(g===0)return 0;s^=g<0|0}else if(r===h){var f=i[(a+1)%n],y=f[1];if(y<h){var g=Fn(l,u,e);if(g===0)return 0;s^=g<0|0}}}else if(r===h){var E=Math.min(l[0],u[0]),w=Math.max(l[0],u[0]);if(a===0){for(;c>0;){var P=(c+n-1)%n,m=i[P];if(m[1]!==r)break;var v=m[0];E=Math.min(E,v),w=Math.max(w,v),c=P}if(c===0)return E<=t&&t<=w?0:1;o=c+1}for(var T=i[(c+n-1)%n][1];a+1<o;){var m=i[a+1];if(m[1]!==r)break;var v=m[0];E=Math.min(E,v),w=Math.max(w,v),a+=1}if(E<=t&&t<=w)return 0;var A=i[(a+1)%n][1];t<E&&T<r!=A<r&&(s^=1)}}return 2*s-1}const gc=ip(vp);function wp(i,e){let t=i[0];const r=[t];for(;At([t,i[1]])>e;){const n=hu(t,e,uu(i));r.push(n),t=n}return r}function bp(i,e){i=[...i,i[0]];let t=[];for(let r=0;r<i.length-1;r++)t=t.concat(wp([i[r],i[r+1]],e));return t}function _p(i,e){return i.map(t=>bp(t,e))}function Tp(i,e){const t=[];for(let r=i[0]+e,n=0;r<=i[2];n++,r+=e)for(let s=i[1]+e,o=0;s<=i[3];o++,s+=e)t.push([r,s]);return t}function vc(i,e){let t=gc(e[0],i)==-1;if(!t)return t;for(let r=1;r<e.length;r++)if(gc(e[r],i)==-1){t=!1;break}return t}const Ue=11102230246251565e-32,q=134217729,yc=(3+8*Ue)*Ue;function Ge(i,e,t,r,n){let s,o,a,c,l=e[0],u=r[0],h=0,d=0;u>l==u>-l?(s=l,l=e[++h]):(s=u,u=r[++d]);let g=0;if(h<i&&d<t)for(u>l==u>-l?(o=l+s,a=s-(o-l),l=e[++h]):(o=u+s,a=s-(o-u),u=r[++d]),s=o,a!==0&&(n[g++]=a);h<i&&d<t;)u>l==u>-l?(o=s+l,c=o-s,a=s-(o-c)+(l-c),l=e[++h]):(o=s+u,c=o-s,a=s-(o-c)+(u-c),u=r[++d]),s=o,a!==0&&(n[g++]=a);for(;h<i;)o=s+l,c=o-s,a=s-(o-c)+(l-c),l=e[++h],s=o,a!==0&&(n[g++]=a);for(;d<t;)o=s+u,c=o-s,a=s-(o-c)+(u-c),u=r[++d],s=o,a!==0&&(n[g++]=a);return(s!==0||g===0)&&(n[g++]=s),g}function ct(i,e,t,r,n,s,o,a){return Ge(Ge(i,e,t,r,o),o,n,s,a)}function G(i,e,t,r){let n,s,o,a,c,l,u,h,d,g,f;u=q*t,g=u-(u-t),f=t-g;let y=e[0];n=y*t,u=q*y,h=u-(u-y),d=y-h,o=d*f-(n-h*g-d*g-h*f);let E=0;o!==0&&(r[E++]=o);for(let w=1;w<i;w++)y=e[w],a=y*t,u=q*y,h=u-(u-y),d=y-h,c=d*f-(a-h*g-d*g-h*f),s=n+c,l=s-n,o=n-(s-l)+(c-l),o!==0&&(r[E++]=o),n=a+s,o=s-(n-a),o!==0&&(r[E++]=o);return(n!==0||E===0)&&(r[E++]=n),E}function wc(i,e){let t=e[0];for(let r=1;r<i;r++)t+=e[r];return t}function xe(i){return new Float64Array(i)}const xp=(3+16*Ue)*Ue,Mp=(2+12*Ue)*Ue,Ep=(9+64*Ue)*Ue*Ue,Dr=xe(4),bc=xe(8),_c=xe(12),Tc=xe(16),We=xe(4);function Sp(i,e,t,r,n,s,o){let a,c,l,u,h,d,g,f,y,E,w,P,m,v,T,A,F,R;const p=i-n,_=t-n,x=e-s,M=r-s;v=p*M,d=q*p,g=d-(d-p),f=p-g,d=q*M,y=d-(d-M),E=M-y,T=f*E-(v-g*y-f*y-g*E),A=x*_,d=q*x,g=d-(d-x),f=x-g,d=q*_,y=d-(d-_),E=_-y,F=f*E-(A-g*y-f*y-g*E),w=T-F,h=T-w,Dr[0]=T-(w+h)+(h-F),P=v+w,h=P-v,m=v-(P-h)+(w-h),w=m-A,h=m-w,Dr[1]=m-(w+h)+(h-A),R=P+w,h=R-P,Dr[2]=P-(R-h)+(w-h),Dr[3]=R;let K=wc(4,Dr),b=Mp*o;if(K>=b||-K>=b||(h=i-p,a=i-(p+h)+(h-n),h=t-_,l=t-(_+h)+(h-n),h=e-x,c=e-(x+h)+(h-s),h=r-M,u=r-(M+h)+(h-s),a===0&&c===0&&l===0&&u===0)||(b=Ep*o+yc*Math.abs(K),K+=p*u+M*a-(x*l+_*c),K>=b||-K>=b))return K;v=a*M,d=q*a,g=d-(d-a),f=a-g,d=q*M,y=d-(d-M),E=M-y,T=f*E-(v-g*y-f*y-g*E),A=c*_,d=q*c,g=d-(d-c),f=c-g,d=q*_,y=d-(d-_),E=_-y,F=f*E-(A-g*y-f*y-g*E),w=T-F,h=T-w,We[0]=T-(w+h)+(h-F),P=v+w,h=P-v,m=v-(P-h)+(w-h),w=m-A,h=m-w,We[1]=m-(w+h)+(h-A),R=P+w,h=R-P,We[2]=P-(R-h)+(w-h),We[3]=R;const S=Ge(4,Dr,4,We,bc);v=p*u,d=q*p,g=d-(d-p),f=p-g,d=q*u,y=d-(d-u),E=u-y,T=f*E-(v-g*y-f*y-g*E),A=x*l,d=q*x,g=d-(d-x),f=x-g,d=q*l,y=d-(d-l),E=l-y,F=f*E-(A-g*y-f*y-g*E),w=T-F,h=T-w,We[0]=T-(w+h)+(h-F),P=v+w,h=P-v,m=v-(P-h)+(w-h),w=m-A,h=m-w,We[1]=m-(w+h)+(h-A),R=P+w,h=R-P,We[2]=P-(R-h)+(w-h),We[3]=R;const I=Ge(S,bc,4,We,_c);v=a*u,d=q*a,g=d-(d-a),f=a-g,d=q*u,y=d-(d-u),E=u-y,T=f*E-(v-g*y-f*y-g*E),A=c*l,d=q*c,g=d-(d-c),f=c-g,d=q*l,y=d-(d-l),E=l-y,F=f*E-(A-g*y-f*y-g*E),w=T-F,h=T-w,We[0]=T-(w+h)+(h-F),P=v+w,h=P-v,m=v-(P-h)+(w-h),w=m-A,h=m-w,We[1]=m-(w+h)+(h-A),R=P+w,h=R-P,We[2]=P-(R-h)+(w-h),We[3]=R;const j=Ge(I,_c,4,We,Tc);return Tc[j-1]}function $t(i,e,t,r,n,s){const o=(e-s)*(t-n),a=(i-n)*(r-s),c=o-a,l=Math.abs(o+a);return Math.abs(c)>=xp*l?c:-Sp(i,e,t,r,n,s,l)}const Pp=(10+96*Ue)*Ue,Rp=(4+48*Ue)*Ue,Ip=(44+576*Ue)*Ue*Ue,ir=xe(4),nr=xe(4),sr=xe(4),Tt=xe(4),xt=xe(4),Mt=xe(4),Xe=xe(4),Ye=xe(4),to=xe(8),ro=xe(8),io=xe(8),no=xe(8),so=xe(8),oo=xe(8),On=xe(8),Gn=xe(8),Nn=xe(8),gr=xe(4),vr=xe(4),yr=xe(4),ee=xe(8),se=xe(16),Pe=xe(16),Re=xe(16),Ee=xe(32),or=xe(32),ke=xe(48),Qe=xe(64);let Vr=xe(1152),ao=xe(1152);function Ae(i,e,t){i=Ge(i,Vr,e,t,ao);const r=Vr;return Vr=ao,ao=r,i}function kp(i,e,t,r,n,s,o,a,c){let l,u,h,d,g,f,y,E,w,P,m,v,T,A,F,R,p,_,x,M,K,b,S,I,j,L,Z,k,O,N,V,X,W,te,re;const ge=i-o,ve=t-o,ye=n-o,_e=e-a,we=r-a,Te=s-a;V=ve*Te,S=q*ve,I=S-(S-ve),j=ve-I,S=q*Te,L=S-(S-Te),Z=Te-L,X=j*Z-(V-I*L-j*L-I*Z),W=ye*we,S=q*ye,I=S-(S-ye),j=ye-I,S=q*we,L=S-(S-we),Z=we-L,te=j*Z-(W-I*L-j*L-I*Z),k=X-te,b=X-k,ir[0]=X-(k+b)+(b-te),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N-W,b=N-k,ir[1]=N-(k+b)+(b-W),re=O+k,b=re-O,ir[2]=O-(re-b)+(k-b),ir[3]=re,V=ye*_e,S=q*ye,I=S-(S-ye),j=ye-I,S=q*_e,L=S-(S-_e),Z=_e-L,X=j*Z-(V-I*L-j*L-I*Z),W=ge*Te,S=q*ge,I=S-(S-ge),j=ge-I,S=q*Te,L=S-(S-Te),Z=Te-L,te=j*Z-(W-I*L-j*L-I*Z),k=X-te,b=X-k,nr[0]=X-(k+b)+(b-te),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N-W,b=N-k,nr[1]=N-(k+b)+(b-W),re=O+k,b=re-O,nr[2]=O-(re-b)+(k-b),nr[3]=re,V=ge*we,S=q*ge,I=S-(S-ge),j=ge-I,S=q*we,L=S-(S-we),Z=we-L,X=j*Z-(V-I*L-j*L-I*Z),W=ve*_e,S=q*ve,I=S-(S-ve),j=ve-I,S=q*_e,L=S-(S-_e),Z=_e-L,te=j*Z-(W-I*L-j*L-I*Z),k=X-te,b=X-k,sr[0]=X-(k+b)+(b-te),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N-W,b=N-k,sr[1]=N-(k+b)+(b-W),re=O+k,b=re-O,sr[2]=O-(re-b)+(k-b),sr[3]=re,l=Ge(Ge(Ge(G(G(4,ir,ge,ee),ee,ge,se),se,G(G(4,ir,_e,ee),ee,_e,Pe),Pe,Ee),Ee,Ge(G(G(4,nr,ve,ee),ee,ve,se),se,G(G(4,nr,we,ee),ee,we,Pe),Pe,or),or,Qe),Qe,Ge(G(G(4,sr,ye,ee),ee,ye,se),se,G(G(4,sr,Te,ee),ee,Te,Pe),Pe,Ee),Ee,Vr);let vt=wc(l,Vr),Er=Rp*c;if(vt>=Er||-vt>=Er||(b=i-ge,u=i-(ge+b)+(b-o),b=e-_e,g=e-(_e+b)+(b-a),b=t-ve,h=t-(ve+b)+(b-o),b=r-we,f=r-(we+b)+(b-a),b=n-ye,d=n-(ye+b)+(b-o),b=s-Te,y=s-(Te+b)+(b-a),u===0&&h===0&&d===0&&g===0&&f===0&&y===0)||(Er=Ip*c+yc*Math.abs(vt),vt+=(ge*ge+_e*_e)*(ve*y+Te*h-(we*d+ye*f))+2*(ge*u+_e*g)*(ve*Te-we*ye)+((ve*ve+we*we)*(ye*g+_e*d-(Te*u+ge*y))+2*(ve*h+we*f)*(ye*_e-Te*ge))+((ye*ye+Te*Te)*(ge*f+we*u-(_e*h+ve*g))+2*(ye*d+Te*y)*(ge*we-_e*ve)),vt>=Er||-vt>=Er))return vt;if((h!==0||f!==0||d!==0||y!==0)&&(V=ge*ge,S=q*ge,I=S-(S-ge),j=ge-I,X=j*j-(V-I*I-(I+I)*j),W=_e*_e,S=q*_e,I=S-(S-_e),j=_e-I,te=j*j-(W-I*I-(I+I)*j),k=X+te,b=k-X,Tt[0]=X-(k-b)+(te-b),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N+W,b=k-N,Tt[1]=N-(k-b)+(W-b),re=O+k,b=re-O,Tt[2]=O-(re-b)+(k-b),Tt[3]=re),(d!==0||y!==0||u!==0||g!==0)&&(V=ve*ve,S=q*ve,I=S-(S-ve),j=ve-I,X=j*j-(V-I*I-(I+I)*j),W=we*we,S=q*we,I=S-(S-we),j=we-I,te=j*j-(W-I*I-(I+I)*j),k=X+te,b=k-X,xt[0]=X-(k-b)+(te-b),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N+W,b=k-N,xt[1]=N-(k-b)+(W-b),re=O+k,b=re-O,xt[2]=O-(re-b)+(k-b),xt[3]=re),(u!==0||g!==0||h!==0||f!==0)&&(V=ye*ye,S=q*ye,I=S-(S-ye),j=ye-I,X=j*j-(V-I*I-(I+I)*j),W=Te*Te,S=q*Te,I=S-(S-Te),j=Te-I,te=j*j-(W-I*I-(I+I)*j),k=X+te,b=k-X,Mt[0]=X-(k-b)+(te-b),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N+W,b=k-N,Mt[1]=N-(k-b)+(W-b),re=O+k,b=re-O,Mt[2]=O-(re-b)+(k-b),Mt[3]=re),u!==0&&(E=G(4,ir,u,to),l=Ae(l,ct(G(E,to,2*ge,se),se,G(G(4,Mt,u,ee),ee,we,Pe),Pe,G(G(4,xt,u,ee),ee,-Te,Re),Re,Ee,ke),ke)),g!==0&&(w=G(4,ir,g,ro),l=Ae(l,ct(G(w,ro,2*_e,se),se,G(G(4,xt,g,ee),ee,ye,Pe),Pe,G(G(4,Mt,g,ee),ee,-ve,Re),Re,Ee,ke),ke)),h!==0&&(P=G(4,nr,h,io),l=Ae(l,ct(G(P,io,2*ve,se),se,G(G(4,Tt,h,ee),ee,Te,Pe),Pe,G(G(4,Mt,h,ee),ee,-_e,Re),Re,Ee,ke),ke)),f!==0&&(m=G(4,nr,f,no),l=Ae(l,ct(G(m,no,2*we,se),se,G(G(4,Mt,f,ee),ee,ge,Pe),Pe,G(G(4,Tt,f,ee),ee,-ye,Re),Re,Ee,ke),ke)),d!==0&&(v=G(4,sr,d,so),l=Ae(l,ct(G(v,so,2*ye,se),se,G(G(4,xt,d,ee),ee,_e,Pe),Pe,G(G(4,Tt,d,ee),ee,-we,Re),Re,Ee,ke),ke)),y!==0&&(T=G(4,sr,y,oo),l=Ae(l,ct(G(T,oo,2*Te,se),se,G(G(4,Tt,y,ee),ee,ve,Pe),Pe,G(G(4,xt,y,ee),ee,-ge,Re),Re,Ee,ke),ke)),u!==0||g!==0){if(h!==0||f!==0||d!==0||y!==0?(V=h*Te,S=q*h,I=S-(S-h),j=h-I,S=q*Te,L=S-(S-Te),Z=Te-L,X=j*Z-(V-I*L-j*L-I*Z),W=ve*y,S=q*ve,I=S-(S-ve),j=ve-I,S=q*y,L=S-(S-y),Z=y-L,te=j*Z-(W-I*L-j*L-I*Z),k=X+te,b=k-X,Xe[0]=X-(k-b)+(te-b),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N+W,b=k-N,Xe[1]=N-(k-b)+(W-b),re=O+k,b=re-O,Xe[2]=O-(re-b)+(k-b),Xe[3]=re,V=d*-we,S=q*d,I=S-(S-d),j=d-I,S=q*-we,L=S-(S- -we),Z=-we-L,X=j*Z-(V-I*L-j*L-I*Z),W=ye*-f,S=q*ye,I=S-(S-ye),j=ye-I,S=q*-f,L=S-(S- -f),Z=-f-L,te=j*Z-(W-I*L-j*L-I*Z),k=X+te,b=k-X,Ye[0]=X-(k-b)+(te-b),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N+W,b=k-N,Ye[1]=N-(k-b)+(W-b),re=O+k,b=re-O,Ye[2]=O-(re-b)+(k-b),Ye[3]=re,F=Ge(4,Xe,4,Ye,Gn),V=h*y,S=q*h,I=S-(S-h),j=h-I,S=q*y,L=S-(S-y),Z=y-L,X=j*Z-(V-I*L-j*L-I*Z),W=d*f,S=q*d,I=S-(S-d),j=d-I,S=q*f,L=S-(S-f),Z=f-L,te=j*Z-(W-I*L-j*L-I*Z),k=X-te,b=X-k,vr[0]=X-(k+b)+(b-te),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N-W,b=N-k,vr[1]=N-(k+b)+(b-W),re=O+k,b=re-O,vr[2]=O-(re-b)+(k-b),vr[3]=re,_=4):(Gn[0]=0,F=1,vr[0]=0,_=1),u!==0){const Ze=G(F,Gn,u,Re);l=Ae(l,Ge(G(E,to,u,se),se,G(Ze,Re,2*ge,Ee),Ee,ke),ke);const Be=G(_,vr,u,ee);l=Ae(l,ct(G(Be,ee,2*ge,se),se,G(Be,ee,u,Pe),Pe,G(Ze,Re,u,Ee),Ee,or,Qe),Qe),f!==0&&(l=Ae(l,G(G(4,Mt,u,ee),ee,f,se),se)),y!==0&&(l=Ae(l,G(G(4,xt,-u,ee),ee,y,se),se))}if(g!==0){const Ze=G(F,Gn,g,Re);l=Ae(l,Ge(G(w,ro,g,se),se,G(Ze,Re,2*_e,Ee),Ee,ke),ke);const Be=G(_,vr,g,ee);l=Ae(l,ct(G(Be,ee,2*_e,se),se,G(Be,ee,g,Pe),Pe,G(Ze,Re,g,Ee),Ee,or,Qe),Qe)}}if(h!==0||f!==0){if(d!==0||y!==0||u!==0||g!==0?(V=d*_e,S=q*d,I=S-(S-d),j=d-I,S=q*_e,L=S-(S-_e),Z=_e-L,X=j*Z-(V-I*L-j*L-I*Z),W=ye*g,S=q*ye,I=S-(S-ye),j=ye-I,S=q*g,L=S-(S-g),Z=g-L,te=j*Z-(W-I*L-j*L-I*Z),k=X+te,b=k-X,Xe[0]=X-(k-b)+(te-b),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N+W,b=k-N,Xe[1]=N-(k-b)+(W-b),re=O+k,b=re-O,Xe[2]=O-(re-b)+(k-b),Xe[3]=re,M=-Te,K=-y,V=u*M,S=q*u,I=S-(S-u),j=u-I,S=q*M,L=S-(S-M),Z=M-L,X=j*Z-(V-I*L-j*L-I*Z),W=ge*K,S=q*ge,I=S-(S-ge),j=ge-I,S=q*K,L=S-(S-K),Z=K-L,te=j*Z-(W-I*L-j*L-I*Z),k=X+te,b=k-X,Ye[0]=X-(k-b)+(te-b),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N+W,b=k-N,Ye[1]=N-(k-b)+(W-b),re=O+k,b=re-O,Ye[2]=O-(re-b)+(k-b),Ye[3]=re,R=Ge(4,Xe,4,Ye,Nn),V=d*g,S=q*d,I=S-(S-d),j=d-I,S=q*g,L=S-(S-g),Z=g-L,X=j*Z-(V-I*L-j*L-I*Z),W=u*y,S=q*u,I=S-(S-u),j=u-I,S=q*y,L=S-(S-y),Z=y-L,te=j*Z-(W-I*L-j*L-I*Z),k=X-te,b=X-k,yr[0]=X-(k+b)+(b-te),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N-W,b=N-k,yr[1]=N-(k+b)+(b-W),re=O+k,b=re-O,yr[2]=O-(re-b)+(k-b),yr[3]=re,x=4):(Nn[0]=0,R=1,yr[0]=0,x=1),h!==0){const Ze=G(R,Nn,h,Re);l=Ae(l,Ge(G(P,io,h,se),se,G(Ze,Re,2*ve,Ee),Ee,ke),ke);const Be=G(x,yr,h,ee);l=Ae(l,ct(G(Be,ee,2*ve,se),se,G(Be,ee,h,Pe),Pe,G(Ze,Re,h,Ee),Ee,or,Qe),Qe),y!==0&&(l=Ae(l,G(G(4,Tt,h,ee),ee,y,se),se)),g!==0&&(l=Ae(l,G(G(4,Mt,-h,ee),ee,g,se),se))}if(f!==0){const Ze=G(R,Nn,f,Re);l=Ae(l,Ge(G(m,no,f,se),se,G(Ze,Re,2*we,Ee),Ee,ke),ke);const Be=G(x,yr,f,ee);l=Ae(l,ct(G(Be,ee,2*we,se),se,G(Be,ee,f,Pe),Pe,G(Ze,Re,f,Ee),Ee,or,Qe),Qe)}}if(d!==0||y!==0){if(u!==0||g!==0||h!==0||f!==0?(V=u*we,S=q*u,I=S-(S-u),j=u-I,S=q*we,L=S-(S-we),Z=we-L,X=j*Z-(V-I*L-j*L-I*Z),W=ge*f,S=q*ge,I=S-(S-ge),j=ge-I,S=q*f,L=S-(S-f),Z=f-L,te=j*Z-(W-I*L-j*L-I*Z),k=X+te,b=k-X,Xe[0]=X-(k-b)+(te-b),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N+W,b=k-N,Xe[1]=N-(k-b)+(W-b),re=O+k,b=re-O,Xe[2]=O-(re-b)+(k-b),Xe[3]=re,M=-_e,K=-g,V=h*M,S=q*h,I=S-(S-h),j=h-I,S=q*M,L=S-(S-M),Z=M-L,X=j*Z-(V-I*L-j*L-I*Z),W=ve*K,S=q*ve,I=S-(S-ve),j=ve-I,S=q*K,L=S-(S-K),Z=K-L,te=j*Z-(W-I*L-j*L-I*Z),k=X+te,b=k-X,Ye[0]=X-(k-b)+(te-b),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N+W,b=k-N,Ye[1]=N-(k-b)+(W-b),re=O+k,b=re-O,Ye[2]=O-(re-b)+(k-b),Ye[3]=re,A=Ge(4,Xe,4,Ye,On),V=u*f,S=q*u,I=S-(S-u),j=u-I,S=q*f,L=S-(S-f),Z=f-L,X=j*Z-(V-I*L-j*L-I*Z),W=h*g,S=q*h,I=S-(S-h),j=h-I,S=q*g,L=S-(S-g),Z=g-L,te=j*Z-(W-I*L-j*L-I*Z),k=X-te,b=X-k,gr[0]=X-(k+b)+(b-te),O=V+k,b=O-V,N=V-(O-b)+(k-b),k=N-W,b=N-k,gr[1]=N-(k+b)+(b-W),re=O+k,b=re-O,gr[2]=O-(re-b)+(k-b),gr[3]=re,p=4):(On[0]=0,A=1,gr[0]=0,p=1),d!==0){const Ze=G(A,On,d,Re);l=Ae(l,Ge(G(v,so,d,se),se,G(Ze,Re,2*ye,Ee),Ee,ke),ke);const Be=G(p,gr,d,ee);l=Ae(l,ct(G(Be,ee,2*ye,se),se,G(Be,ee,d,Pe),Pe,G(Ze,Re,d,Ee),Ee,or,Qe),Qe),g!==0&&(l=Ae(l,G(G(4,xt,d,ee),ee,g,se),se)),f!==0&&(l=Ae(l,G(G(4,Tt,-d,ee),ee,f,se),se))}if(y!==0){const Ze=G(A,On,y,Re);l=Ae(l,Ge(G(T,oo,y,se),se,G(Ze,Re,2*Te,Ee),Ee,ke),ke);const Be=G(p,gr,y,ee);l=Ae(l,ct(G(Be,ee,2*Te,se),se,G(Be,ee,y,Pe),Pe,G(Ze,Re,y,Ee),Ee,or,Qe),Qe)}}return Vr[l-1]}function Ap(i,e,t,r,n,s,o,a){const c=i-o,l=t-o,u=n-o,h=e-a,d=r-a,g=s-a,f=l*g,y=u*d,E=c*c+h*h,w=u*h,P=c*g,m=l*l+d*d,v=c*d,T=l*h,A=u*u+g*g,F=E*(f-y)+m*(w-P)+A*(v-T),R=(Math.abs(f)+Math.abs(y))*E+(Math.abs(w)+Math.abs(P))*m+(Math.abs(v)+Math.abs(T))*A,p=Pp*R;return F>p||-F>p?F:kp(i,e,t,r,n,s,o,a,R)}const xc=Math.pow(2,-52),Zn=new Uint32Array(512);class co{static from(e,t=Op,r=Gp){const n=e.length,s=new Float64Array(n*2);for(let o=0;o<n;o++){const a=e[o];s[2*o]=t(a),s[2*o+1]=r(a)}return new co(s)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*t-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:r,_hullTri:n,_hullHash:s}=this,o=e.length>>1;let a=1/0,c=1/0,l=-1/0,u=-1/0;for(let p=0;p<o;p++){const _=e[2*p],x=e[2*p+1];_<a&&(a=_),x<c&&(c=x),_>l&&(l=_),x>u&&(u=x),this._ids[p]=p}const h=(a+l)/2,d=(c+u)/2;let g,f,y;for(let p=0,_=1/0;p<o;p++){const x=lo(h,d,e[2*p],e[2*p+1]);x<_&&(g=p,_=x)}const E=e[2*g],w=e[2*g+1];for(let p=0,_=1/0;p<o;p++){if(p===g)continue;const x=lo(E,w,e[2*p],e[2*p+1]);x<_&&x>0&&(f=p,_=x)}let P=e[2*f],m=e[2*f+1],v=1/0;for(let p=0;p<o;p++){if(p===g||p===f)continue;const _=Lp(E,w,P,m,e[2*p],e[2*p+1]);_<v&&(y=p,v=_)}let T=e[2*y],A=e[2*y+1];if(v===1/0){for(let x=0;x<o;x++)this._dists[x]=e[2*x]-e[0]||e[2*x+1]-e[1];Br(this._ids,this._dists,0,o-1);const p=new Uint32Array(o);let _=0;for(let x=0,M=-1/0;x<o;x++){const K=this._ids[x],b=this._dists[K];b>M&&(p[_++]=K,M=b)}this.hull=p.subarray(0,_),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if($t(E,w,P,m,T,A)<0){const p=f,_=P,x=m;f=y,P=T,m=A,y=p,T=_,A=x}const F=Fp(E,w,P,m,T,A);this._cx=F.x,this._cy=F.y;for(let p=0;p<o;p++)this._dists[p]=lo(e[2*p],e[2*p+1],F.x,F.y);Br(this._ids,this._dists,0,o-1),this._hullStart=g;let R=3;r[g]=t[y]=f,r[f]=t[g]=y,r[y]=t[f]=g,n[g]=0,n[f]=1,n[y]=2,s.fill(-1),s[this._hashKey(E,w)]=g,s[this._hashKey(P,m)]=f,s[this._hashKey(T,A)]=y,this.trianglesLen=0,this._addTriangle(g,f,y,-1,-1,-1);for(let p=0,_,x;p<this._ids.length;p++){const M=this._ids[p],K=e[2*M],b=e[2*M+1];if(p>0&&Math.abs(K-_)<=xc&&Math.abs(b-x)<=xc||(_=K,x=b,M===g||M===f||M===y))continue;let S=0;for(let k=0,O=this._hashKey(K,b);k<this._hashSize&&(S=s[(O+k)%this._hashSize],!(S!==-1&&S!==r[S]));k++);S=t[S];let I=S,j;for(;j=r[I],$t(K,b,e[2*I],e[2*I+1],e[2*j],e[2*j+1])>=0;)if(I=j,I===S){I=-1;break}if(I===-1)continue;let L=this._addTriangle(I,M,r[I],-1,-1,n[I]);n[M]=this._legalize(L+2),n[I]=L,R++;let Z=r[I];for(;j=r[Z],$t(K,b,e[2*Z],e[2*Z+1],e[2*j],e[2*j+1])<0;)L=this._addTriangle(Z,M,j,n[M],-1,n[Z]),n[M]=this._legalize(L+2),r[Z]=Z,R--,Z=j;if(I===S)for(;j=t[I],$t(K,b,e[2*j],e[2*j+1],e[2*I],e[2*I+1])<0;)L=this._addTriangle(j,M,I,-1,n[I],n[j]),this._legalize(L+2),n[j]=L,r[I]=I,R--,I=j;this._hullStart=t[M]=I,r[I]=t[Z]=M,r[M]=Z,s[this._hashKey(K,b)]=M,s[this._hashKey(e[2*I],e[2*I+1])]=I}this.hull=new Uint32Array(R);for(let p=0,_=this._hullStart;p<R;p++)this.hull[p]=_,_=r[_];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(Cp(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:r,coords:n}=this;let s=0,o=0;for(;;){const a=r[e],c=e-e%3;if(o=c+(e+2)%3,a===-1){if(s===0)break;e=Zn[--s];continue}const l=a-a%3,u=c+(e+1)%3,h=l+(a+2)%3,d=t[o],g=t[e],f=t[u],y=t[h];if(jp(n[2*d],n[2*d+1],n[2*g],n[2*g+1],n[2*f],n[2*f+1],n[2*y],n[2*y+1])){t[e]=y,t[a]=d;const w=r[h];if(w===-1){let m=this._hullStart;do{if(this._hullTri[m]===h){this._hullTri[m]=e;break}m=this._hullPrev[m]}while(m!==this._hullStart)}this._link(e,w),this._link(a,r[o]),this._link(o,h);const P=l+(a+1)%3;s<Zn.length&&(Zn[s++]=P)}else{if(s===0)break;e=Zn[--s]}}return o}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,r,n,s,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=r,this._link(a,n),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function Cp(i,e){const t=i/(Math.abs(i)+Math.abs(e));return(e>0?3-t:1+t)/4}function lo(i,e,t,r){const n=i-t,s=e-r;return n*n+s*s}function jp(i,e,t,r,n,s,o,a){const c=i-o,l=e-a,u=t-o,h=r-a,d=n-o,g=s-a,f=c*c+l*l,y=u*u+h*h,E=d*d+g*g;return c*(h*E-y*g)-l*(u*E-y*d)+f*(u*g-h*d)<0}function Lp(i,e,t,r,n,s){const o=t-i,a=r-e,c=n-i,l=s-e,u=o*o+a*a,h=c*c+l*l,d=.5/(o*l-a*c),g=(l*u-a*h)*d,f=(o*h-c*u)*d;return g*g+f*f}function Fp(i,e,t,r,n,s){const o=t-i,a=r-e,c=n-i,l=s-e,u=o*o+a*a,h=c*c+l*l,d=.5/(o*l-a*c),g=i+(l*u-a*h)*d,f=e+(o*h-c*u)*d;return{x:g,y:f}}function Br(i,e,t,r){if(r-t<=20)for(let n=t+1;n<=r;n++){const s=i[n],o=e[s];let a=n-1;for(;a>=t&&e[i[a]]>o;)i[a+1]=i[a--];i[a+1]=s}else{const n=t+r>>1;let s=t+1,o=r;Mi(i,n,s),e[i[t]]>e[i[r]]&&Mi(i,t,r),e[i[s]]>e[i[r]]&&Mi(i,s,r),e[i[t]]>e[i[s]]&&Mi(i,t,s);const a=i[s],c=e[a];for(;;){do s++;while(e[i[s]]<c);do o--;while(e[i[o]]>c);if(o<s)break;Mi(i,s,o)}i[t+1]=i[o],i[o]=a,r-s+1>=o-t?(Br(i,e,s,r),Br(i,e,t,o-1)):(Br(i,e,t,o-1),Br(i,e,s,r))}}function Mi(i,e,t){const r=i[e];i[e]=i[t],i[t]=r}function Op(i){return i[0]}function Gp(i){return i[1]}class Np{constructor(e,t){this.W=e,this.bs=t}add(e){const t=this.W,r=e/t|0,n=e%t;return this.bs[r]|=1<<n,this}delete(e){const t=this.W,r=e/t|0,n=e%t;return this.bs[r]&=~(1<<n),this}set(e,t){const r=this.W,n=e/r|0,s=e%r,o=1<<s;return this.bs[n]^=(-t^this.bs[n])&o,t}has(e){const t=this.W,r=e/t|0,n=e%t;return!!(this.bs[r]&1<<n)}forEach(e){const t=this.W,r=this.bs,n=r.length;for(let s=0;s<n;s++){let o=0;for(;r[s]&&o<t;)r[s]&1<<o&&e(s*t+o),o++}return this}}class Mc extends Np{constructor(e){const r=new Uint8Array(Math.ceil(e/8)).fill(0);super(8,r)}}function wr(i){return i%3===2?i-2:i+1}function zt(i){return i%3===0?i+2:i-1}class Ec{constructor(e,t){if(!e||typeof e!="object"||!e.triangles||!e.halfedges||!e.coords)throw new Error("Expected an object with Delaunator output");if(e.triangles.length%3||e.halfedges.length!==e.triangles.length||e.coords.length%2)throw new Error("Delaunator output appears inconsistent");if(e.triangles.length<3)throw new Error("No edges in triangulation");this.del=e;const r=2**32-1,n=e.coords.length>>1,s=e.triangles.length;this.vertMap=new Uint32Array(n).fill(r),this.flips=new Mc(s),this.consd=new Mc(s);for(let o=0;o<s;o++){const a=e.triangles[o];this.vertMap[a]===r&&this.updateVert(o)}t&&this.constrainAll(t)}constrainOne(e,t){const{triangles:r,halfedges:n}=this.del,s=this.vertMap,o=this.consd,a=s[e];let c=a;do{const g=r[c],f=wr(c);if(g===t)return this.protect(c);const y=zt(c),E=r[y];if(E===t)return this.protect(f),f;if(this.intersectSegments(e,t,E,g)){c=y;break}c=n[f]}while(c!==-1&&c!==a);let l=c,u=-1;for(;c!==-1;){const g=n[c],f=zt(c),y=zt(g),E=wr(g);if(g===-1)throw new Error("Constraining edge exited the hull");if(o.has(c))throw new Error("Edge intersects already constrained edge");if(this.isCollinear(e,t,r[c])||this.isCollinear(e,t,r[g]))throw new Error("Constraining edge intersects point");if(!this.intersectSegments(r[c],r[g],r[f],r[y])){if(u===-1&&(u=c),r[y]===t){if(c===u)throw new Error("Infinite loop: non-convex quadrilateral");c=u,u=-1;continue}if(this.intersectSegments(e,t,r[y],r[g]))c=y;else if(this.intersectSegments(e,t,r[E],r[y]))c=E;else if(u===c)throw new Error("Infinite loop: no further intersect after non-convex");continue}if(this.flipDiagonal(c),this.intersectSegments(e,t,r[f],r[y])&&(u===-1&&(u=f),u===f))throw new Error("Infinite loop: flipped diagonal still intersects");r[y]===t?(l=y,c=u,u=-1):this.intersectSegments(e,t,r[E],r[y])&&(c=E)}const h=this.flips;this.protect(l);do{var d=0;h.forEach(g=>{h.delete(g);const f=n[g];f!==-1&&(h.delete(f),this.isDelaunay(g)||(this.flipDiagonal(g),d++))})}while(d>0);return this.findEdge(e,t)}delaunify(e=!1){const t=this.del.halfedges,r=this.flips,n=this.consd,s=t.length;do{var o=0;for(let a=0;a<s;a++){if(n.has(a))continue;r.delete(a);const c=t[a];c!==-1&&(r.delete(c),this.isDelaunay(a)||(this.flipDiagonal(a),o++))}}while(e&&o>0);return this}constrainAll(e){const t=e.length;for(let r=0;r<t;r++){const n=e[r];this.constrainOne(n[0],n[1])}return this}isConstrained(e){return this.consd.has(e)}findEdge(e,t){const r=this.vertMap[t],{triangles:n,halfedges:s}=this.del;let o=r,a=-1;do{if(n[o]===e)return o;a=wr(o),o=s[a]}while(o!==-1&&o!==r);return n[wr(a)]===e?-a:1/0}protect(e){const t=this.del.halfedges[e],r=this.flips,n=this.consd;return r.delete(e),n.add(e),t!==-1?(r.delete(t),n.add(t),t):-e}markFlip(e){const t=this.del.halfedges,r=this.flips;if(this.consd.has(e))return!1;const s=t[e];return s!==-1&&(r.add(e),r.add(s)),!0}flipDiagonal(e){const{triangles:t,halfedges:r}=this.del,n=this.flips,s=this.consd,o=r[e],a=zt(e),c=wr(e),l=zt(o),u=wr(o),h=r[a],d=r[l];if(s.has(e))throw new Error("Trying to flip a constrained edge");return t[e]=t[l],r[e]=d,n.set(e,n.has(l))||s.set(e,s.has(l)),d!==-1&&(r[d]=e),r[a]=l,t[o]=t[a],r[o]=h,n.set(o,n.has(a))||s.set(o,s.has(a)),h!==-1&&(r[h]=o),r[l]=a,this.markFlip(e),this.markFlip(c),this.markFlip(o),this.markFlip(u),n.add(a),s.delete(a),n.add(l),s.delete(l),this.updateVert(e),this.updateVert(c),this.updateVert(o),this.updateVert(u),a}isDelaunay(e){const{triangles:t,halfedges:r}=this.del,n=r[e];if(n===-1)return!0;const s=t[zt(e)],o=t[e],a=t[wr(e)],c=t[zt(n)];return!this.inCircle(s,o,a,c)}updateVert(e){const{triangles:t,halfedges:r}=this.del,n=this.vertMap,s=t[e];let o=zt(e),a=r[o];for(;a!==-1&&a!==e;)o=zt(a),a=r[o];return n[s]=o,o}intersectSegments(e,t,r,n){const s=this.del.coords;return e===r||e===n||t===r||t===n?!1:Sc(s[e*2],s[e*2+1],s[t*2],s[t*2+1],s[r*2],s[r*2+1],s[n*2],s[n*2+1])}inCircle(e,t,r,n){const s=this.del.coords;return Ap(s[e*2],s[e*2+1],s[t*2],s[t*2+1],s[r*2],s[r*2+1],s[n*2],s[n*2+1])<0}isCollinear(e,t,r){const n=this.del.coords;return $t(n[e*2],n[e*2+1],n[t*2],n[t*2+1],n[r*2],n[r*2+1])===0}}Ec.intersectSegments=Sc;function Sc(i,e,t,r,n,s,o,a){const c=$t(i,e,n,s,o,a),l=$t(t,r,n,s,o,a);if(c>0&&l>0||c<0&&l<0)return!1;const u=$t(n,s,i,e,t,r),h=$t(o,a,i,e,t,r);return u>0&&h>0||u<0&&h<0?!1:c===0&&l===0&&u===0&&h===0?!(Math.max(n,o)<Math.min(i,t)||Math.max(i,t)<Math.min(n,o)||Math.max(s,a)<Math.min(e,r)||Math.max(e,r)<Math.min(s,a)):!0}const Zp=.001;function Dp(i,e,t=Zp){i=ys(i);let r=[],n=[],s=[],o=[];e?(r=_p(i,e),n=r.flat(),s=Tp(Ve(i),e),o=s.filter(P=>vc(P,i))):(r=i,n=i.flat());const a=[...n,...o],c=new co(a.flat());let l=0;const u=r.map(P=>{const m=P.map((v,T)=>l+T);return l+=P.length,m}),h=u.map(P=>P.map(m=>[m,(m+1)%P.length])).flat(),d=new Ec(c,h);let g=[],f=[];const y=[];for(let P=0;P<d.del.triangles.length;P+=3)g.push([d.del.triangles[P],d.del.triangles[P+1],d.del.triangles[P+2]]),f.push([a[d.del.triangles[P]],a[d.del.triangles[P+1]],a[d.del.triangles[P+2]]]),y.push(d.del.triangles[P]<n.length||d.del.triangles[P+1]<n.length||d.del.triangles[P+2]<n.length);t=e?e*e*t:t;const E=f.map((P,m)=>y[m]?vc(Ts(...P),i)&&du(P)>t:!0);g=g.filter((P,m)=>E[m]),f=f.filter((P,m)=>E[m]);const w=[];for(let P=0;P<h.length;P+=1)w.push([a[h[P][0]],a[h[P][1]]]);return{constrainautor:d,interpolatedPolygon:r,interpolatedPolygonPoints:n,gridPoints:s,gridPointsInPolygon:o,uniquePoints:a,triangles:f,uniquePointIndexTriangles:g,uniquePointIndexInterpolatedPolygon:u,uniquePointIndexEdges:h}}const Vp=["log2sigma","twoOmega"],Bp=10;function Up(){return{}}let $p=class extends rp{previousResourceResolution;resourceResolution;triangulateErrorCount=0;projectedGcpPreviousTriangulation;projectedGcpTriangulation;projectedGcpTriangulationByTransformationTypeAndResourceResolution=new Map;resourceTrianglePoints=[];projectedGeoPreviousTrianglePoints=[];projectedGeoTrianglePoints=[];previousTrianglePointsDistortion=[];trianglePointsDistortion=[];projectedGeoPreviousTriangulationMask=[];projectedGeoTriangulationMask=[];constructor(e,t,r){r={...Up(),...r},super(e,t,r),this.updateTriangulation()}setResourceMask(e){super.setResourceMask(e),this.updateTriangulation()}resetPrevious(){super.resetPrevious(),this.previousResourceResolution=this.resourceResolution,this.projectedGcpPreviousTriangulation=this.projectedGcpTriangulation,this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints,this.previousTrianglePointsDistortion=this.trianglePointsDistortion,this.projectedGeoPreviousTriangulationMask=this.projectedGeoTriangulationMask}mixPreviousAndNew(e){super.mixPreviousAndNew(e),this.projectedGcpPreviousTriangulation&&this.projectedGcpTriangulation&&(this.previousResourceResolution=this.resourceResolution,this.projectedGcpPreviousTriangulation={resourceResolution:this.projectedGcpPreviousTriangulation.resourceResolution,gcpUniquePoints:this.projectedGcpPreviousTriangulation.gcpUniquePoints.map((t,r)=>({resource:t.resource,geo:_s(this.projectedGcpTriangulation.gcpUniquePoints[r].geo,t.geo,e),distortions:this.projectedGcpTriangulation.gcpUniquePoints[r].distortions,distortion:bs(this.projectedGcpTriangulation.gcpUniquePoints[r].distortion||0,t.distortion||0,e)})),uniquePointIndices:this.projectedGcpPreviousTriangulation.uniquePointIndices,uniquePointIndexInterpolatedPolygon:this.projectedGcpPreviousTriangulation.uniquePointIndexInterpolatedPolygon},this.projectedGeoPreviousTrianglePoints=this.projectedGcpPreviousTriangulation.uniquePointIndices.map(t=>this.projectedGcpPreviousTriangulation.gcpUniquePoints[t].geo),this.previousTrianglePointsDistortion=this.projectedGcpPreviousTriangulation.uniquePointIndices.map(t=>this.projectedGcpPreviousTriangulation.gcpUniquePoints[t].distortion)),this.projectedGeoPreviousTriangulationMask=this.projectedGeoTriangulationMask.map((t,r)=>_s(t,this.projectedGeoPreviousTriangulationMask[r],e))}updateTriangulation(){if(!this.projectedGcpTriangulationByTransformationTypeAndResourceResolution)return;const e=Xf(this.resourceMaskBbox,this.projectedTransformer,{});let t=!1;e&&this.previousResourceResolution&&(t=this.previousResourceResolution<e,this.resourceResolution=Math.min(e,this.previousResourceResolution)),e&&!this.previousResourceResolution&&(t=!0,this.resourceResolution=e),!e&&this.previousResourceResolution?this.resourceResolution=this.previousResourceResolution:!e&&!this.previousResourceResolution&&(this.resourceResolution=void 0),this.projectedGcpTriangulation=Qo(this.projectedGcpTriangulationByTransformationTypeAndResourceResolution,this.transformationType,this.resourceResolution,()=>{try{const{uniquePoints:r,uniquePointIndexTriangles:n,uniquePointIndexInterpolatedPolygon:s}=Dp([this.resourceMask],this.resourceResolution),o=this.resourceResolution,a=r.map(l=>this.resourceToResourceProjectedGeoDistortions(l,this.projectedTransformer,this.getReferenceScale())),c=n.flat();return{resourceResolution:o,gcpUniquePoints:a,uniquePointIndices:c,uniquePointIndexInterpolatedPolygon:s}}catch(r){this.triangulateErrorCount++,this.triangulateErrorCount<=Bp&&(console.error(`Error computing triangulation for map ${this.mapId}.`,`Fix this map with Allmaps Editor: https://editor.allmaps.org/#/collection?url=${this.parsedImage?.uri}/info.json`),this.triangulateErrorCount===1&&console.error(r))}}),this.projectedGcpPreviousTriangulation||(this.projectedGcpPreviousTriangulation=this.projectedGcpTriangulation),t&&(this.previousResourceResolution=this.resourceResolution,this.projectedGcpPreviousTriangulation=Qo(this.projectedGcpTriangulationByTransformationTypeAndResourceResolution,this.previousTransformationType,this.previousResourceResolution,()=>({resourceResolution:this.projectedGcpTriangulation.resourceResolution,gcpUniquePoints:this.projectedGcpTriangulation.gcpUniquePoints.map(r=>this.resourceToResourceProjectedGeoDistortions(r.resource,this.projectedPreviousTransformer,this.getReferenceScale())),uniquePointIndices:this.projectedGcpTriangulation.uniquePointIndices,uniquePointIndexInterpolatedPolygon:this.projectedGcpTriangulation.uniquePointIndexInterpolatedPolygon}),()=>!this.mixed,()=>!this.mixed)),this.updateTrianglePoints()}updateTrianglePoints(){!this.projectedGcpPreviousTriangulation||!this.projectedGcpTriangulation||(this.resourceTrianglePoints=this.projectedGcpTriangulation.uniquePointIndices.map(e=>this.projectedGcpTriangulation.gcpUniquePoints[e].resource),this.projectedGeoTrianglePoints=this.projectedGcpTriangulation.uniquePointIndices.map(e=>this.projectedGcpTriangulation.gcpUniquePoints[e].geo),this.projectedGeoPreviousTrianglePoints=this.projectedGcpPreviousTriangulation.uniquePointIndices.map(e=>this.projectedGcpPreviousTriangulation.gcpUniquePoints[e].geo),this.projectedGeoTriangulationMask=this.projectedGcpTriangulation.uniquePointIndexInterpolatedPolygon.map(e=>e.map(t=>this.projectedGcpTriangulation.gcpUniquePoints[t].geo)).flat(),this.projectedGeoPreviousTriangulationMask=this.projectedGcpPreviousTriangulation.uniquePointIndexInterpolatedPolygon.map(e=>e.map(t=>this.projectedGcpPreviousTriangulation.gcpUniquePoints[t].geo)).flat(),this.updateTrianglePointsDistortion())}updateTrianglePointsDistortion(){!this.projectedGcpPreviousTriangulation||!this.projectedGcpTriangulation||(this.trianglePointsDistortion=this.projectedGcpTriangulation.uniquePointIndices.map(e=>this.distortionMeasure?this.projectedGcpTriangulation.gcpUniquePoints[e].distortions.get(this.distortionMeasure):0),this.previousTrianglePointsDistortion=this.projectedGcpPreviousTriangulation.uniquePointIndices.map(e=>this.previousDistortionMeasure?this.projectedGcpPreviousTriangulation.gcpUniquePoints[e].distortions.get(this.previousDistortionMeasure):0))}resourceToResourceProjectedGeoDistortions(e,t,r){const n=t.transformToGeo(e),s=t.transformToGeo(e,{evaluationType:"partialDerivativeX"}),o=t.transformToGeo(e,{evaluationType:"partialDerivativeY"}),a=Yf(Vp,s,o,r);return{resource:e,geo:n,distortions:a,distortion:0}}updateTransformerProperties(e=!0){super.updateTransformerProperties(e),this.updateTriangulation()}updateDistortionProperties(){super.updateDistortionProperties(),this.updateTrianglePointsDistortion()}};var zp=typeof global=="object"&&global&&global.Object===Object&&global,Wp=typeof self=="object"&&self&&self.Object===Object&&self,Pc=zp||Wp||Function("return this")(),Dn=Pc.Symbol,Rc=Object.prototype,Xp=Rc.hasOwnProperty,Yp=Rc.toString,Ei=Dn?Dn.toStringTag:void 0;function Hp(i){var e=Xp.call(i,Ei),t=i[Ei];try{i[Ei]=void 0;var r=!0}catch{}var n=Yp.call(i);return r&&(e?i[Ei]=t:delete i[Ei]),n}var qp=Object.prototype,Kp=qp.toString;function Jp(i){return Kp.call(i)}var Qp="[object Null]",em="[object Undefined]",Ic=Dn?Dn.toStringTag:void 0;function tm(i){return i==null?i===void 0?em:Qp:Ic&&Ic in Object(i)?Hp(i):Jp(i)}function rm(i){return i!=null&&typeof i=="object"}var im="[object Symbol]";function nm(i){return typeof i=="symbol"||rm(i)&&tm(i)==im}var sm=/\s/;function om(i){for(var e=i.length;e--&&sm.test(i.charAt(e)););return e}var am=/^\s+/;function cm(i){return i&&i.slice(0,om(i)+1).replace(am,"")}function Vn(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}var kc=NaN,lm=/^[-+]0x[0-9a-f]+$/i,um=/^0b[01]+$/i,hm=/^0o[0-7]+$/i,dm=parseInt;function Ac(i){if(typeof i=="number")return i;if(nm(i))return kc;if(Vn(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=Vn(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=cm(i);var t=um.test(i);return t||hm.test(i)?dm(i.slice(2),t?2:8):lm.test(i)?kc:+i}var uo=function(){return Pc.Date.now()},fm="Expected a function",pm=Math.max,mm=Math.min;function gm(i,e,t){var r,n,s,o,a,c,l=0,u=!1,h=!1,d=!0;if(typeof i!="function")throw new TypeError(fm);e=Ac(e)||0,Vn(t)&&(u=!!t.leading,h="maxWait"in t,s=h?pm(Ac(t.maxWait)||0,e):s,d="trailing"in t?!!t.trailing:d);function g(A){var F=r,R=n;return r=n=void 0,l=A,o=i.apply(R,F),o}function f(A){return l=A,a=setTimeout(w,e),u?g(A):o}function y(A){var F=A-c,R=A-l,p=e-F;return h?mm(p,s-R):p}function E(A){var F=A-c,R=A-l;return c===void 0||F>=e||F<0||h&&R>=s}function w(){var A=uo();if(E(A))return P(A);a=setTimeout(w,y(A))}function P(A){return a=void 0,d&&r?g(A):(r=n=void 0,o)}function m(){a!==void 0&&clearTimeout(a),l=0,r=c=n=a=void 0}function v(){return a===void 0?o:P(uo())}function T(){var A=uo(),F=E(A);if(r=arguments,n=this,c=A,F){if(a===void 0)return f(c);if(h)return clearTimeout(a),a=setTimeout(w,e),g(c)}return a===void 0&&(a=setTimeout(w,e)),o}return T.cancel=m,T.flush=v,T}var vm="Expected a function";function ho(i,e,t){var r=!0,n=!0;if(typeof i!="function")throw new TypeError(vm);return Vn(t)&&(r="leading"in t?!!t.leading:r,n="trailing"in t?!!t.trailing:n),gm(i,e,{leading:r,maxWait:e,trailing:n})}const Si="#222222",Bn="#ffffff",ym="inherit",wm="currentColor",bm="transparent",Wt=4,Cc=["#dff7fa","#c0eff5","#a1e7f0","#82dfeb","#63d8e6","#4facb8","#3b818a","#27565c","#132b2d"],jc=["#d7d9ee","#b0b4de","#898ecd","#6269bd","#3b44ad","#2f368a","#232867","#171b45","#0b0d22"],Lc=["#f3dcf0","#e7b9e1","#dc97d2","#d074c3","#c552b5","#9d4190","#76316c","#4e2048","#271024"],Fc=["#ffddf1","#ffbbe3","#ff99d5","#ff77c7","#ff56ba","#cc4494","#99336f","#66224a","#321125"],Oc=["#ffe3d0","#ffc7a1","#ffab72","#ff8f43","#ff7415","#cc5c10","#99450c","#662e08","#321704"],Gc=["#fededf","#febebf","#fe9e9f","#fe7e7f","#fe5e60","#cb4b4c","#983839","#652526","#321213"],Nc=["#e0f2e8","#c1e6d2","#a2d9bb","#83cda5","#64c18f","#509a72","#3c7355","#284d39","#13261c"],Zc=["#fff3d9","#ffe8b3","#ffdd8d","#ffd267","#ffc742","#cc9f34","#997727","#664f1a","#32270d"],Dc=["#efefef","#e0e0e0","#d0d0d0","#c1c1c1","#b2b2b2","#8e8e8e","#6a6a6a","#474747","#232323"],Xt={blue:Cc,darkblue:jc,purple:Lc,pink:Fc,orange:Oc,red:Gc,green:Nc,yellow:Zc,gray:Dc},Vc=Cc[Wt],Bc=jc[Wt],_m=Lc[Wt],fo=Fc[Wt],Tm=Oc[Wt],po=Gc[Wt],Uc=Nc[Wt],mo=Zc[Wt],$c=Dc[Wt];function Yt(i,e){return e.reduce((t,r,n)=>{const s=(n+1)*100,o=`${i}-${s}`;return t[o]=r,t},{})}({...Yt("blue",Xt.blue),...Yt("darkblue",Xt.darkblue),...Yt("purple",Xt.purple),...Yt("pink",Xt.pink),...Yt("orange",Xt.orange),...Yt("red",Xt.red),...Yt("green",Xt.green),...Yt("yellow",Xt.yellow),...Yt("gray",Xt.gray)});function lt(i,e,t){const r=i.createShader(e);if(r){if(i.shaderSource(r,t),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS))return r;{const n=i.getShaderInfoLog(r);throw i.deleteShader(r),new Error("Failed to compile shader: "+n)}}else throw new Error("Failed to create shader")}function Ur(i,e,t){const r=i.createProgram();if(r){if(i.attachShader(r,e),i.attachShader(r,t),i.linkProgram(r),i.getProgramParameter(r,i.LINK_STATUS))return r;{const n=i.getProgramInfoLog(r);throw i.deleteProgram(r),new Error("Failed to link program: "+n)}}else throw new Error("Failed to create program")}function Le(i,e,t,r,n){const s=i.createBuffer();if(!s)throw new Error("Failed to create buffer");i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,t,i.STATIC_DRAW);const o=i.FLOAT,a=!1,c=0,l=0,u=i.getAttribLocation(e,n);return i.vertexAttribPointer(u,r,o,a,c,l),i.enableVertexAttribArray(u),s}function xm(i,e,t,r){let n=Number.POSITIVE_INFINITY,s=i.at(-1);for(const o of i){const a=Math.abs(Math.log2(o.scaleFactor)-(Math.log2(e+t)+r));a<n&&(n=a,s=o)}return s}function Mm(i,e,t){const r=Em(i,e),n=Sm(r),s=Rm(n,e,t),o=Pr(Ve(i));return s.sort((a,c)=>Xc(a,o)-Xc(c,o)),s}function Em(i,e){return i.map(t=>[t[0]/e.originalWidth,t[1]/e.originalHeight])}function Sm(i){const e={};for(let t=0;t<i.length;t++){const r=[i[t],i[(t+1)%i.length]];Pm(r).forEach(([n,s])=>{e[n]||(e[n]=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]),s<e[n][0]&&(e[n][0]=s),s>e[n][1]&&(e[n][1]=s)})}return e}function Pm([i,e]){let t=Math.floor(i[0]),r=Math.floor(i[1]);const n=Math.floor(e[0]),s=Math.floor(e[1]),o=[[t,r]];if(t===n&&r===s)return o;const a=Math.sign(e[0]-i[0]),c=Math.sign(e[1]-i[1]),l=Math.abs(i[0]-t-Math.max(0,a)),u=Math.abs(i[1]-r-Math.max(0,c)),h=Math.abs(i[0]-e[0]),d=Math.abs(i[1]-e[1]);let g=l/h,f=u/d;const y=1/h,E=1/d;for(;!(t===n&&r===s);)g<f?(g=g+y,t=t+a):(f=f+E,r=r+c),o.push([t,r]);return o}function Rm(i,e,t){const r=[];for(const n in i){const s=parseInt(n);if(s<0||s>=e.columns)break;const o=Math.max(i[s][0],0),a=Math.min(i[s][1],e.rows-1);for(let c=o;c<=a;c++)r.push({column:s,row:c,tileZoomLevel:e,imageSize:t})}return r}function zc(i,e,t,r){let n=Math.floor(i.column*i.tileZoomLevel.scaleFactor/t);n=n>=0?n:0;const s=Math.ceil((i.column+1)*i.tileZoomLevel.scaleFactor/t);let o=Math.floor(i.row*i.tileZoomLevel.scaleFactor/t);o=o>=0?o:0;const a=Math.ceil((i.row+1)*i.tileZoomLevel.scaleFactor/t);return Wc(t,e,n,s,o,a,r)}function Wc(i,e,t,r,n,s,o=a=>!0){const a=e.tileZoomLevels.find(u=>u.scaleFactor==i),c=[e.width,e.height];if(!a)return[];t=t||0,r=r||a.columns,n=n||0,s=s||a.rows;const l=[];for(let u=t;u<r;u++)for(let h=n;h<s;h++){const d={column:u,row:h,tileZoomLevel:a,imageSize:c};o(d)&&l.push(d)}return l}function Xc(i,e){return Ct(Im(i),e)}function Im(i){const e=Yc(i);return[(e[2]-e[0])/2+e[0],(e[3]-e[1])/2+e[1]]}function km(i){return[i.column*i.tileZoomLevel.originalWidth,i.row*i.tileZoomLevel.originalHeight]}function Yc(i){const e=km(i),t=Math.min(e[0]+i.tileZoomLevel.originalWidth,i.imageSize[0]),r=Math.min(e[1]+i.tileZoomLevel.originalHeight,i.imageSize[1]);return[e[0],e[1],t,r]}function Am(i){return[i.tileZoomLevel.width,i.tileZoomLevel.height]}function Cm(i){return Su(Am(i))}function jm(i){return i.map(e=>Cm(e)).reduce((e,t)=>e+t,0)}function Lm(i){return i.rows*i.width*i.columns*i.height}function Fm(i,e,t,r,n,s){const o=[],a=qc(i,e,t,r,s);for(const c of a)c&&o.push(c);if(o.length==0){const c=Hc(i,e,t,n,s);c&&o.push(c)}return o}function Hc(i,e,t,r,n){const s=2**(Math.log2(t)+1);if(s>e.tileZoomLevels.map(a=>a.scaleFactor).reduce((a,c)=>a+c,0)-t||r==0)return;const o=Om(i,e,s,n);return o!==void 0?o:Hc(i,e,s,r--,n)}function qc(i,e,t,r,n){const s=2**(Math.log2(t)-1);if(s<=0||r==0)return[];const o=Kc(i,e,s,n),a=Kc(i,e,s,c=>!0);return o.length==a.length?o:[...o,...qc(i,e,s,r--,n)]}function Om(i,e,t,r){const n=zc(i,e,t,r);if(n.length!=0)return n[0]}function Kc(i,e,t,r){return zc(i,e,t,r)}function Gm(i){return Nm(i.mapId,i.tileUrl)}function Nm(i,e){return`${i}:${e}`}function go(i){return Zm(i.tileZoomLevel.scaleFactor,i.row,i.column)}function Zm(i,e,t){return`${i}:${e}:${t}`}function Dm(i,e,t){if(e.overviewTileZoomLevelForViewport&&i.tileZoomLevel.scaleFactor==e.overviewTileZoomLevelForViewport.scaleFactor)return!1;if(e.resourceViewportRingBboxForViewport==null||e.tileZoomLevelForViewport==null)return!0;const r=Math.log2(i.tileZoomLevel.scaleFactor)-Math.log2(e.tileZoomLevelForViewport.scaleFactor);return r>t.maxHigherLog2ScaleFactorDiff||-r>t.maxLowerLog2ScaleFactorDiff||!Tu(Ko(Yc(i),Math.max(0,r)),e.resourceViewportRingBboxForViewport)}function vo(i){return Array.isArray(i)?`[${i.map(e=>vo(e)).join(",")}]`:typeof i=="number"?`${i}`:typeof i=="string"?`"${i}"`:typeof i=="object"&&i!==null?Object.keys(i).sort().map(e=>`${e}:${vo(i[e])}`).join("|"):String(i)}async function Vm(i){const e=await crypto.subtle.digest("SHA-1",new TextEncoder().encode(i));return Array.from(new Uint8Array(e)).map(n=>n.toString(16).padStart(2,"0")).join("")}async function Bm(i,e=16){return(await Vm(String(i))).slice(0,e)}async function Um(i,e){return await Bm(vo(i),e)}var Se;(function(i){i.assertEqual=n=>n;function e(n){}i.assertIs=e;function t(n){throw new Error}i.assertNever=t,i.arrayToEnum=n=>{const s={};for(const o of n)s[o]=o;return s},i.getValidEnumValues=n=>{const s=i.objectKeys(n).filter(a=>typeof n[n[a]]!="number"),o={};for(const a of s)o[a]=n[a];return i.objectValues(o)},i.objectValues=n=>i.objectKeys(n).map(function(s){return n[s]}),i.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const s=[];for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&s.push(o);return s},i.find=(n,s)=>{for(const o of n)if(s(o))return o},i.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function r(n,s=" | "){return n.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}i.joinValues=r,i.jsonStringifyReplacer=(n,s)=>typeof s=="bigint"?s.toString():s})(Se||(Se={}));var yo;(function(i){i.mergeShapes=(e,t)=>({...e,...t})})(yo||(yo={}));const Q=Se.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ht=i=>{switch(typeof i){case"undefined":return Q.undefined;case"string":return Q.string;case"number":return isNaN(i)?Q.nan:Q.number;case"boolean":return Q.boolean;case"function":return Q.function;case"bigint":return Q.bigint;case"symbol":return Q.symbol;case"object":return Array.isArray(i)?Q.array:i===null?Q.null:i.then&&typeof i.then=="function"&&i.catch&&typeof i.catch=="function"?Q.promise:typeof Map<"u"&&i instanceof Map?Q.map:typeof Set<"u"&&i instanceof Set?Q.set:typeof Date<"u"&&i instanceof Date?Q.date:Q.object;default:return Q.unknown}},U=Se.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),$m=i=>JSON.stringify(i,null,2).replace(/"([^"]+)":/g,"$1:");class rt extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(s){return s.message},r={_errors:[]},n=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(n);else if(o.code==="invalid_return_type")n(o.returnTypeError);else if(o.code==="invalid_arguments")n(o.argumentsError);else if(o.path.length===0)r._errors.push(t(o));else{let a=r,c=0;for(;c<o.path.length;){const l=o.path[c];c===o.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(t(o))):a[l]=a[l]||{_errors:[]},a=a[l],c++}}};return n(this),r}static assert(e){if(!(e instanceof rt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Se.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}rt.create=i=>new rt(i);const $r=(i,e)=>{let t;switch(i.code){case U.invalid_type:i.received===Q.undefined?t="Required":t=`Expected ${i.expected}, received ${i.received}`;break;case U.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(i.expected,Se.jsonStringifyReplacer)}`;break;case U.unrecognized_keys:t=`Unrecognized key(s) in object: ${Se.joinValues(i.keys,", ")}`;break;case U.invalid_union:t="Invalid input";break;case U.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Se.joinValues(i.options)}`;break;case U.invalid_enum_value:t=`Invalid enum value. Expected ${Se.joinValues(i.options)}, received '${i.received}'`;break;case U.invalid_arguments:t="Invalid function arguments";break;case U.invalid_return_type:t="Invalid function return type";break;case U.invalid_date:t="Invalid date";break;case U.invalid_string:typeof i.validation=="object"?"includes"in i.validation?(t=`Invalid input: must include "${i.validation.includes}"`,typeof i.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${i.validation.position}`)):"startsWith"in i.validation?t=`Invalid input: must start with "${i.validation.startsWith}"`:"endsWith"in i.validation?t=`Invalid input: must end with "${i.validation.endsWith}"`:Se.assertNever(i.validation):i.validation!=="regex"?t=`Invalid ${i.validation}`:t="Invalid";break;case U.too_small:i.type==="array"?t=`Array must contain ${i.exact?"exactly":i.inclusive?"at least":"more than"} ${i.minimum} element(s)`:i.type==="string"?t=`String must contain ${i.exact?"exactly":i.inclusive?"at least":"over"} ${i.minimum} character(s)`:i.type==="number"?t=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="date"?t=`Date must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(i.minimum))}`:t="Invalid input";break;case U.too_big:i.type==="array"?t=`Array must contain ${i.exact?"exactly":i.inclusive?"at most":"less than"} ${i.maximum} element(s)`:i.type==="string"?t=`String must contain ${i.exact?"exactly":i.inclusive?"at most":"under"} ${i.maximum} character(s)`:i.type==="number"?t=`Number must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="bigint"?t=`BigInt must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="date"?t=`Date must be ${i.exact?"exactly":i.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(i.maximum))}`:t="Invalid input";break;case U.custom:t="Invalid input";break;case U.invalid_intersection_types:t="Intersection results could not be merged";break;case U.not_multiple_of:t=`Number must be a multiple of ${i.multipleOf}`;break;case U.not_finite:t="Number must be finite";break;default:t=e.defaultError,Se.assertNever(i)}return{message:t}};let Jc=$r;function zm(i){Jc=i}function Un(){return Jc}const $n=i=>{const{data:e,path:t,errorMaps:r,issueData:n}=i,s=[...t,...n.path||[]],o={...n,path:s};if(n.message!==void 0)return{...n,path:s,message:n.message};let a="";const c=r.filter(l=>!!l).slice().reverse();for(const l of c)a=l(o,{data:e,defaultError:a}).message;return{...n,path:s,message:a}},Wm=[];function H(i,e){const t=Un(),r=$n({issueData:e,data:i.data,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,t,t===$r?void 0:$r].filter(n=>!!n)});i.common.issues.push(r)}class $e{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const n of t){if(n.status==="aborted")return le;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const n of t){const s=await n.key,o=await n.value;r.push({key:s,value:o})}return $e.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const n of t){const{key:s,value:o}=n;if(s.status==="aborted"||o.status==="aborted")return le;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||n.alwaysSet)&&(r[s.value]=o.value)}return{status:e.value,value:r}}}const le=Object.freeze({status:"aborted"}),zr=i=>({status:"dirty",value:i}),He=i=>({status:"valid",value:i}),wo=i=>i.status==="aborted",bo=i=>i.status==="dirty",br=i=>i.status==="valid",Pi=i=>typeof Promise<"u"&&i instanceof Promise;function zn(i,e,t,r){if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(i)}function Qc(i,e,t,r,n){if(typeof e=="function"?i!==e||!n:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(i,t),t}typeof SuppressedError=="function"&&SuppressedError;var ne;(function(i){i.errToObj=e=>typeof e=="string"?{message:e}:e||{},i.toString=e=>typeof e=="string"?e:e?.message})(ne||(ne={}));var Ri,Ii;class Et{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const el=(i,e)=>{if(br(e))return{success:!0,data:e.value};if(!i.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new rt(i.common.issues);return this._error=t,this._error}}};function de(i){if(!i)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:n}=i;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(o,a)=>{var c,l;const{message:u}=i;return o.code==="invalid_enum_value"?{message:u??a.defaultError}:typeof a.data>"u"?{message:(c=u??r)!==null&&c!==void 0?c:a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:(l=u??t)!==null&&l!==void 0?l:a.defaultError}},description:n}}class pe{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}get description(){return this._def.description}_getType(e){return Ht(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new $e,ctx:{common:e.parent.common,data:e.data,parsedType:Ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Pi(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const n={common:{issues:[],async:(r=t?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)},s=this._parseSync({data:e,path:n.path,parent:n});return el(n,s)}"~validate"(e){var t,r,n;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)};if(!this["~standard"].async)try{const o=this._parseSync({data:e,path:[],parent:s});return br(o)?{value:o.value}:{issues:s.common.issues}}catch(o){!((n=(r=(t=o)===null||t===void 0?void 0:t.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(o=>br(o)?{value:o.value}:{issues:s.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)},n=this._parse({data:e,path:r.path,parent:r}),s=await(Pi(n)?n:Promise.resolve(n));return el(r,s)}refine(e,t){const r=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,s)=>{const o=e(n),a=()=>s.addIssue({code:U.custom,...r(n)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof t=="function"?t(r,n):t),!1))}_refinement(e){return new gt({schema:this,typeName:ae.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Pt.create(this,this._def)}nullable(){return ur.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return mt.create(this)}promise(){return Hr.create(this,this._def)}or(e){return ji.create([this,e],this._def)}and(e){return Li.create(this,e,this._def)}transform(e){return new gt({...de(this._def),schema:this,typeName:ae.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Zi({...de(this._def),innerType:this,defaultValue:t,typeName:ae.ZodDefault})}brand(){return new xo({typeName:ae.ZodBranded,type:this,...de(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Di({...de(this._def),innerType:this,catchValue:t,typeName:ae.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Vi.create(this,e)}readonly(){return Bi.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Xm=/^c[^\s-]{8,}$/i,Ym=/^[0-9a-z]+$/,Hm=/^[0-9A-HJKMNP-TV-Z]{26}$/i,qm=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Km=/^[a-z0-9_-]{21}$/i,Jm=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Qm=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,eg=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,tg="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let _o;const rg=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ig=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ng=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sg=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,og=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ag=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,tl="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",cg=new RegExp(`^${tl}$`);function rl(i){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return i.precision?e=`${e}\\.\\d{${i.precision}}`:i.precision==null&&(e=`${e}(\\.\\d+)?`),e}function lg(i){return new RegExp(`^${rl(i)}$`)}function il(i){let e=`${tl}T${rl(i)}`;const t=[];return t.push(i.local?"Z?":"Z"),i.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function ug(i,e){return!!((e==="v4"||!e)&&rg.test(i)||(e==="v6"||!e)&&ng.test(i))}function hg(i,e){if(!Jm.test(i))return!1;try{const[t]=i.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function dg(i,e){return!!((e==="v4"||!e)&&ig.test(i)||(e==="v6"||!e)&&sg.test(i))}class pt extends pe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Q.string){const s=this._getOrReturnCtx(e);return H(s,{code:U.invalid_type,expected:Q.string,received:s.parsedType}),le}const r=new $e;let n;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(n=this._getOrReturnCtx(e,n),H(n,{code:U.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(n=this._getOrReturnCtx(e,n),H(n,{code:U.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const o=e.data.length>s.value,a=e.data.length<s.value;(o||a)&&(n=this._getOrReturnCtx(e,n),o?H(n,{code:U.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&H(n,{code:U.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")eg.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"email",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")_o||(_o=new RegExp(tg,"u")),_o.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"emoji",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")qm.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"uuid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")Km.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"nanoid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")Xm.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"cuid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")Ym.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"cuid2",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")Hm.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"ulid",code:U.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),H(n,{validation:"url",code:U.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"regex",code:U.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(n=this._getOrReturnCtx(e,n),H(n,{code:U.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(n=this._getOrReturnCtx(e,n),H(n,{code:U.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(n=this._getOrReturnCtx(e,n),H(n,{code:U.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?il(s).test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{code:U.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?cg.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{code:U.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?lg(s).test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{code:U.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?Qm.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"duration",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?ug(e.data,s.version)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"ip",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?hg(e.data,s.alg)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"jwt",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?dg(e.data,s.version)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"cidr",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?og.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"base64",code:U.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?ag.test(e.data)||(n=this._getOrReturnCtx(e,n),H(n,{validation:"base64url",code:U.invalid_string,message:s.message}),r.dirty()):Se.assertNever(s);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(n=>e.test(n),{validation:t,code:U.invalid_string,...ne.errToObj(r)})}_addCheck(e){return new pt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ne.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ne.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ne.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ne.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ne.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ne.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ne.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ne.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ne.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ne.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ne.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ne.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ne.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,...ne.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...ne.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...ne.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...ne.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...ne.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...ne.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...ne.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...ne.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...ne.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...ne.errToObj(t)})}nonempty(e){return this.min(1,ne.errToObj(e))}trim(){return new pt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new pt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new pt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}pt.create=i=>{var e;return new pt({checks:[],typeName:ae.ZodString,coerce:(e=i?.coerce)!==null&&e!==void 0?e:!1,...de(i)})};function fg(i,e){const t=(i.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=t>r?t:r,s=parseInt(i.toFixed(n).replace(".","")),o=parseInt(e.toFixed(n).replace(".",""));return s%o/Math.pow(10,n)}class ar extends pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Q.number){const s=this._getOrReturnCtx(e);return H(s,{code:U.invalid_type,expected:Q.number,received:s.parsedType}),le}let r;const n=new $e;for(const s of this._def.checks)s.kind==="int"?Se.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),H(r,{code:U.invalid_type,expected:"integer",received:"float",message:s.message}),n.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),H(r,{code:U.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),H(r,{code:U.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):s.kind==="multipleOf"?fg(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),H(r,{code:U.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),H(r,{code:U.not_finite,message:s.message}),n.dirty()):Se.assertNever(s);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ne.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ne.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ne.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ne.toString(t))}setLimit(e,t,r,n){return new ar({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:ne.toString(n)}]})}_addCheck(e){return new ar({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ne.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ne.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ne.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ne.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ne.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ne.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:ne.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ne.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ne.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Se.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ar.create=i=>new ar({checks:[],typeName:ae.ZodNumber,coerce:i?.coerce||!1,...de(i)});class cr extends pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Q.bigint)return this._getInvalidInput(e);let r;const n=new $e;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),H(r,{code:U.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),H(r,{code:U.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),H(r,{code:U.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):Se.assertNever(s);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return H(t,{code:U.invalid_type,expected:Q.bigint,received:t.parsedType}),le}gte(e,t){return this.setLimit("min",e,!0,ne.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ne.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ne.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ne.toString(t))}setLimit(e,t,r,n){return new cr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:ne.toString(n)}]})}_addCheck(e){return new cr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ne.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ne.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ne.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ne.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ne.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}cr.create=i=>{var e;return new cr({checks:[],typeName:ae.ZodBigInt,coerce:(e=i?.coerce)!==null&&e!==void 0?e:!1,...de(i)})};class ki extends pe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Q.boolean){const r=this._getOrReturnCtx(e);return H(r,{code:U.invalid_type,expected:Q.boolean,received:r.parsedType}),le}return He(e.data)}}ki.create=i=>new ki({typeName:ae.ZodBoolean,coerce:i?.coerce||!1,...de(i)});class _r extends pe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Q.date){const s=this._getOrReturnCtx(e);return H(s,{code:U.invalid_type,expected:Q.date,received:s.parsedType}),le}if(isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return H(s,{code:U.invalid_date}),le}const r=new $e;let n;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(n=this._getOrReturnCtx(e,n),H(n,{code:U.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(n=this._getOrReturnCtx(e,n),H(n,{code:U.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):Se.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new _r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:ne.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:ne.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}_r.create=i=>new _r({checks:[],coerce:i?.coerce||!1,typeName:ae.ZodDate,...de(i)});class Wn extends pe{_parse(e){if(this._getType(e)!==Q.symbol){const r=this._getOrReturnCtx(e);return H(r,{code:U.invalid_type,expected:Q.symbol,received:r.parsedType}),le}return He(e.data)}}Wn.create=i=>new Wn({typeName:ae.ZodSymbol,...de(i)});class Ai extends pe{_parse(e){if(this._getType(e)!==Q.undefined){const r=this._getOrReturnCtx(e);return H(r,{code:U.invalid_type,expected:Q.undefined,received:r.parsedType}),le}return He(e.data)}}Ai.create=i=>new Ai({typeName:ae.ZodUndefined,...de(i)});class Ci extends pe{_parse(e){if(this._getType(e)!==Q.null){const r=this._getOrReturnCtx(e);return H(r,{code:U.invalid_type,expected:Q.null,received:r.parsedType}),le}return He(e.data)}}Ci.create=i=>new Ci({typeName:ae.ZodNull,...de(i)});class Wr extends pe{constructor(){super(...arguments),this._any=!0}_parse(e){return He(e.data)}}Wr.create=i=>new Wr({typeName:ae.ZodAny,...de(i)});class Tr extends pe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return He(e.data)}}Tr.create=i=>new Tr({typeName:ae.ZodUnknown,...de(i)});class qt extends pe{_parse(e){const t=this._getOrReturnCtx(e);return H(t,{code:U.invalid_type,expected:Q.never,received:t.parsedType}),le}}qt.create=i=>new qt({typeName:ae.ZodNever,...de(i)});class Xn extends pe{_parse(e){if(this._getType(e)!==Q.undefined){const r=this._getOrReturnCtx(e);return H(r,{code:U.invalid_type,expected:Q.void,received:r.parsedType}),le}return He(e.data)}}Xn.create=i=>new Xn({typeName:ae.ZodVoid,...de(i)});class mt extends pe{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==Q.array)return H(t,{code:U.invalid_type,expected:Q.array,received:t.parsedType}),le;if(n.exactLength!==null){const o=t.data.length>n.exactLength.value,a=t.data.length<n.exactLength.value;(o||a)&&(H(t,{code:o?U.too_big:U.too_small,minimum:a?n.exactLength.value:void 0,maximum:o?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(H(t,{code:U.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(H(t,{code:U.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>n.type._parseAsync(new Et(t,o,t.path,a)))).then(o=>$e.mergeArray(r,o));const s=[...t.data].map((o,a)=>n.type._parseSync(new Et(t,o,t.path,a)));return $e.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new mt({...this._def,minLength:{value:e,message:ne.toString(t)}})}max(e,t){return new mt({...this._def,maxLength:{value:e,message:ne.toString(t)}})}length(e,t){return new mt({...this._def,exactLength:{value:e,message:ne.toString(t)}})}nonempty(e){return this.min(1,e)}}mt.create=(i,e)=>new mt({type:i,minLength:null,maxLength:null,exactLength:null,typeName:ae.ZodArray,...de(e)});function Xr(i){if(i instanceof je){const e={};for(const t in i.shape){const r=i.shape[t];e[t]=Pt.create(Xr(r))}return new je({...i._def,shape:()=>e})}else return i instanceof mt?new mt({...i._def,type:Xr(i.element)}):i instanceof Pt?Pt.create(Xr(i.unwrap())):i instanceof ur?ur.create(Xr(i.unwrap())):i instanceof St?St.create(i.items.map(e=>Xr(e))):i}class je extends pe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Se.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Q.object){const l=this._getOrReturnCtx(e);return H(l,{code:U.invalid_type,expected:Q.object,received:l.parsedType}),le}const{status:r,ctx:n}=this._processInputParams(e),{shape:s,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof qt&&this._def.unknownKeys==="strip"))for(const l in n.data)o.includes(l)||a.push(l);const c=[];for(const l of o){const u=s[l],h=n.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Et(n,h,n.path,l)),alwaysSet:l in n.data})}if(this._def.catchall instanceof qt){const l=this._def.unknownKeys;if(l==="passthrough")for(const u of a)c.push({key:{status:"valid",value:u},value:{status:"valid",value:n.data[u]}});else if(l==="strict")a.length>0&&(H(n,{code:U.unrecognized_keys,keys:a}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const u of a){const h=n.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Et(n,h,n.path,u)),alwaysSet:u in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const l=[];for(const u of c){const h=await u.key,d=await u.value;l.push({key:h,value:d,alwaysSet:u.alwaysSet})}return l}).then(l=>$e.mergeObjectSync(r,l)):$e.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(e){return ne.errToObj,new je({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var n,s,o,a;const c=(o=(s=(n=this._def).errorMap)===null||s===void 0?void 0:s.call(n,t,r).message)!==null&&o!==void 0?o:r.defaultError;return t.code==="unrecognized_keys"?{message:(a=ne.errToObj(e).message)!==null&&a!==void 0?a:c}:{message:c}}}:{}})}strip(){return new je({...this._def,unknownKeys:"strip"})}passthrough(){return new je({...this._def,unknownKeys:"passthrough"})}extend(e){return new je({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new je({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ae.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new je({...this._def,catchall:e})}pick(e){const t={};return Se.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new je({...this._def,shape:()=>t})}omit(e){const t={};return Se.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new je({...this._def,shape:()=>t})}deepPartial(){return Xr(this)}partial(e){const t={};return Se.objectKeys(this.shape).forEach(r=>{const n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()}),new je({...this._def,shape:()=>t})}required(e){const t={};return Se.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Pt;)s=s._def.innerType;t[r]=s}}),new je({...this._def,shape:()=>t})}keyof(){return nl(Se.objectKeys(this.shape))}}je.create=(i,e)=>new je({shape:()=>i,unknownKeys:"strip",catchall:qt.create(),typeName:ae.ZodObject,...de(e)}),je.strictCreate=(i,e)=>new je({shape:()=>i,unknownKeys:"strict",catchall:qt.create(),typeName:ae.ZodObject,...de(e)}),je.lazycreate=(i,e)=>new je({shape:i,unknownKeys:"strip",catchall:qt.create(),typeName:ae.ZodObject,...de(e)});class ji extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function n(s){for(const a of s)if(a.result.status==="valid")return a.result;for(const a of s)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(a=>new rt(a.ctx.common.issues));return H(t,{code:U.invalid_union,unionErrors:o}),le}if(t.common.async)return Promise.all(r.map(async s=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(n);{let s;const o=[];for(const c of r){const l={...t,common:{...t.common,issues:[]},parent:null},u=c._parseSync({data:t.data,path:t.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!s&&(s={result:u,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const a=o.map(c=>new rt(c));return H(t,{code:U.invalid_union,unionErrors:a}),le}}get options(){return this._def.options}}ji.create=(i,e)=>new ji({options:i,typeName:ae.ZodUnion,...de(e)});const Kt=i=>i instanceof Oi?Kt(i.schema):i instanceof gt?Kt(i.innerType()):i instanceof Gi?[i.value]:i instanceof lr?i.options:i instanceof Ni?Se.objectValues(i.enum):i instanceof Zi?Kt(i._def.innerType):i instanceof Ai?[void 0]:i instanceof Ci?[null]:i instanceof Pt?[void 0,...Kt(i.unwrap())]:i instanceof ur?[null,...Kt(i.unwrap())]:i instanceof xo||i instanceof Bi?Kt(i.unwrap()):i instanceof Di?Kt(i._def.innerType):[];class Yn extends pe{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Q.object)return H(t,{code:U.invalid_type,expected:Q.object,received:t.parsedType}),le;const r=this.discriminator,n=t.data[r],s=this.optionsMap.get(n);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(H(t,{code:U.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),le)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const n=new Map;for(const s of t){const o=Kt(s.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of o){if(n.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);n.set(a,s)}}return new Yn({typeName:ae.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...de(r)})}}function To(i,e){const t=Ht(i),r=Ht(e);if(i===e)return{valid:!0,data:i};if(t===Q.object&&r===Q.object){const n=Se.objectKeys(e),s=Se.objectKeys(i).filter(a=>n.indexOf(a)!==-1),o={...i,...e};for(const a of s){const c=To(i[a],e[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(t===Q.array&&r===Q.array){if(i.length!==e.length)return{valid:!1};const n=[];for(let s=0;s<i.length;s++){const o=i[s],a=e[s],c=To(o,a);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return t===Q.date&&r===Q.date&&+i==+e?{valid:!0,data:i}:{valid:!1}}class Li extends pe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=(s,o)=>{if(wo(s)||wo(o))return le;const a=To(s.value,o.value);return a.valid?((bo(s)||bo(o))&&t.dirty(),{status:t.value,value:a.data}):(H(r,{code:U.invalid_intersection_types}),le)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,o])=>n(s,o)):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Li.create=(i,e,t)=>new Li({left:i,right:e,typeName:ae.ZodIntersection,...de(t)});class St extends pe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Q.array)return H(r,{code:U.invalid_type,expected:Q.array,received:r.parsedType}),le;if(r.data.length<this._def.items.length)return H(r,{code:U.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),le;!this._def.rest&&r.data.length>this._def.items.length&&(H(r,{code:U.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...r.data].map((o,a)=>{const c=this._def.items[a]||this._def.rest;return c?c._parse(new Et(r,o,r.path,a)):null}).filter(o=>!!o);return r.common.async?Promise.all(s).then(o=>$e.mergeArray(t,o)):$e.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new St({...this._def,rest:e})}}St.create=(i,e)=>{if(!Array.isArray(i))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new St({items:i,typeName:ae.ZodTuple,rest:null,...de(e)})};class Fi extends pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Q.object)return H(r,{code:U.invalid_type,expected:Q.object,received:r.parsedType}),le;const n=[],s=this._def.keyType,o=this._def.valueType;for(const a in r.data)n.push({key:s._parse(new Et(r,a,r.path,a)),value:o._parse(new Et(r,r.data[a],r.path,a)),alwaysSet:a in r.data});return r.common.async?$e.mergeObjectAsync(t,n):$e.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof pe?new Fi({keyType:e,valueType:t,typeName:ae.ZodRecord,...de(r)}):new Fi({keyType:pt.create(),valueType:e,typeName:ae.ZodRecord,...de(t)})}}class Hn extends pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Q.map)return H(r,{code:U.invalid_type,expected:Q.map,received:r.parsedType}),le;const n=this._def.keyType,s=this._def.valueType,o=[...r.data.entries()].map(([a,c],l)=>({key:n._parse(new Et(r,a,r.path,[l,"key"])),value:s._parse(new Et(r,c,r.path,[l,"value"]))}));if(r.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const c of o){const l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return le;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(l.value,u.value)}return{status:t.value,value:a}})}else{const a=new Map;for(const c of o){const l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return le;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(l.value,u.value)}return{status:t.value,value:a}}}}Hn.create=(i,e,t)=>new Hn({valueType:e,keyType:i,typeName:ae.ZodMap,...de(t)});class xr extends pe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Q.set)return H(r,{code:U.invalid_type,expected:Q.set,received:r.parsedType}),le;const n=this._def;n.minSize!==null&&r.data.size<n.minSize.value&&(H(r,{code:U.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&r.data.size>n.maxSize.value&&(H(r,{code:U.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const s=this._def.valueType;function o(c){const l=new Set;for(const u of c){if(u.status==="aborted")return le;u.status==="dirty"&&t.dirty(),l.add(u.value)}return{status:t.value,value:l}}const a=[...r.data.values()].map((c,l)=>s._parse(new Et(r,c,r.path,l)));return r.common.async?Promise.all(a).then(c=>o(c)):o(a)}min(e,t){return new xr({...this._def,minSize:{value:e,message:ne.toString(t)}})}max(e,t){return new xr({...this._def,maxSize:{value:e,message:ne.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}xr.create=(i,e)=>new xr({valueType:i,minSize:null,maxSize:null,typeName:ae.ZodSet,...de(e)});class Yr extends pe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Q.function)return H(t,{code:U.invalid_type,expected:Q.function,received:t.parsedType}),le;function r(a,c){return $n({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Un(),$r].filter(l=>!!l),issueData:{code:U.invalid_arguments,argumentsError:c}})}function n(a,c){return $n({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Un(),$r].filter(l=>!!l),issueData:{code:U.invalid_return_type,returnTypeError:c}})}const s={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof Hr){const a=this;return He(async function(...c){const l=new rt([]),u=await a._def.args.parseAsync(c,s).catch(g=>{throw l.addIssue(r(c,g)),l}),h=await Reflect.apply(o,this,u);return await a._def.returns._def.type.parseAsync(h,s).catch(g=>{throw l.addIssue(n(h,g)),l})})}else{const a=this;return He(function(...c){const l=a._def.args.safeParse(c,s);if(!l.success)throw new rt([r(c,l.error)]);const u=Reflect.apply(o,this,l.data),h=a._def.returns.safeParse(u,s);if(!h.success)throw new rt([n(u,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Yr({...this._def,args:St.create(e).rest(Tr.create())})}returns(e){return new Yr({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Yr({args:e||St.create([]).rest(Tr.create()),returns:t||Tr.create(),typeName:ae.ZodFunction,...de(r)})}}class Oi extends pe{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Oi.create=(i,e)=>new Oi({getter:i,typeName:ae.ZodLazy,...de(e)});class Gi extends pe{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return H(t,{received:t.data,code:U.invalid_literal,expected:this._def.value}),le}return{status:"valid",value:e.data}}get value(){return this._def.value}}Gi.create=(i,e)=>new Gi({value:i,typeName:ae.ZodLiteral,...de(e)});function nl(i,e){return new lr({values:i,typeName:ae.ZodEnum,...de(e)})}class lr extends pe{constructor(){super(...arguments),Ri.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return H(t,{expected:Se.joinValues(r),received:t.parsedType,code:U.invalid_type}),le}if(zn(this,Ri)||Qc(this,Ri,new Set(this._def.values)),!zn(this,Ri).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return H(t,{received:t.data,code:U.invalid_enum_value,options:r}),le}return He(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return lr.create(e,{...this._def,...t})}exclude(e,t=this._def){return lr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}Ri=new WeakMap,lr.create=nl;class Ni extends pe{constructor(){super(...arguments),Ii.set(this,void 0)}_parse(e){const t=Se.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Q.string&&r.parsedType!==Q.number){const n=Se.objectValues(t);return H(r,{expected:Se.joinValues(n),received:r.parsedType,code:U.invalid_type}),le}if(zn(this,Ii)||Qc(this,Ii,new Set(Se.getValidEnumValues(this._def.values))),!zn(this,Ii).has(e.data)){const n=Se.objectValues(t);return H(r,{received:r.data,code:U.invalid_enum_value,options:n}),le}return He(e.data)}get enum(){return this._def.values}}Ii=new WeakMap,Ni.create=(i,e)=>new Ni({values:i,typeName:ae.ZodNativeEnum,...de(e)});class Hr extends pe{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Q.promise&&t.common.async===!1)return H(t,{code:U.invalid_type,expected:Q.promise,received:t.parsedType}),le;const r=t.parsedType===Q.promise?t.data:Promise.resolve(t.data);return He(r.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Hr.create=(i,e)=>new Hr({type:i,typeName:ae.ZodPromise,...de(e)});class gt extends pe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ae.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,s={addIssue:o=>{H(r,o),o.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),n.type==="preprocess"){const o=n.transform(r.data,s);if(r.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return le;const c=await this._def.schema._parseAsync({data:a,path:r.path,parent:r});return c.status==="aborted"?le:c.status==="dirty"||t.value==="dirty"?zr(c.value):c});{if(t.value==="aborted")return le;const a=this._def.schema._parseSync({data:o,path:r.path,parent:r});return a.status==="aborted"?le:a.status==="dirty"||t.value==="dirty"?zr(a.value):a}}if(n.type==="refinement"){const o=a=>{const c=n.refinement(a,s);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?le:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?le:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(n.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!br(o))return o;const a=n.transform(o.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>br(o)?Promise.resolve(n.transform(o.value,s)).then(a=>({status:t.value,value:a})):o);Se.assertNever(n)}}gt.create=(i,e,t)=>new gt({schema:i,typeName:ae.ZodEffects,effect:e,...de(t)}),gt.createWithPreprocess=(i,e,t)=>new gt({schema:e,effect:{type:"preprocess",transform:i},typeName:ae.ZodEffects,...de(t)});class Pt extends pe{_parse(e){return this._getType(e)===Q.undefined?He(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Pt.create=(i,e)=>new Pt({innerType:i,typeName:ae.ZodOptional,...de(e)});class ur extends pe{_parse(e){return this._getType(e)===Q.null?He(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ur.create=(i,e)=>new ur({innerType:i,typeName:ae.ZodNullable,...de(e)});class Zi extends pe{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===Q.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Zi.create=(i,e)=>new Zi({innerType:i,typeName:ae.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...de(e)});class Di extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Pi(n)?n.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new rt(r.common.issues)},input:r.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new rt(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Di.create=(i,e)=>new Di({innerType:i,typeName:ae.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...de(e)});class qn extends pe{_parse(e){if(this._getType(e)!==Q.nan){const r=this._getOrReturnCtx(e);return H(r,{code:U.invalid_type,expected:Q.nan,received:r.parsedType}),le}return{status:"valid",value:e.data}}}qn.create=i=>new qn({typeName:ae.ZodNaN,...de(i)});const pg=Symbol("zod_brand");class xo extends pe{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Vi extends pe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?le:s.status==="dirty"?(t.dirty(),zr(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const n=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return n.status==="aborted"?le:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:r.path,parent:r})}}static create(e,t){return new Vi({in:e,out:t,typeName:ae.ZodPipeline})}}class Bi extends pe{_parse(e){const t=this._def.innerType._parse(e),r=n=>(br(n)&&(n.value=Object.freeze(n.value)),n);return Pi(t)?t.then(n=>r(n)):r(t)}unwrap(){return this._def.innerType}}Bi.create=(i,e)=>new Bi({innerType:i,typeName:ae.ZodReadonly,...de(e)});function sl(i,e={},t){return i?Wr.create().superRefine((r,n)=>{var s,o;if(!i(r)){const a=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,c=(o=(s=a.fatal)!==null&&s!==void 0?s:t)!==null&&o!==void 0?o:!0,l=typeof a=="string"?{message:a}:a;n.addIssue({code:"custom",...l,fatal:c})}}):Wr.create()}const mg={object:je.lazycreate};var ae;(function(i){i.ZodString="ZodString",i.ZodNumber="ZodNumber",i.ZodNaN="ZodNaN",i.ZodBigInt="ZodBigInt",i.ZodBoolean="ZodBoolean",i.ZodDate="ZodDate",i.ZodSymbol="ZodSymbol",i.ZodUndefined="ZodUndefined",i.ZodNull="ZodNull",i.ZodAny="ZodAny",i.ZodUnknown="ZodUnknown",i.ZodNever="ZodNever",i.ZodVoid="ZodVoid",i.ZodArray="ZodArray",i.ZodObject="ZodObject",i.ZodUnion="ZodUnion",i.ZodDiscriminatedUnion="ZodDiscriminatedUnion",i.ZodIntersection="ZodIntersection",i.ZodTuple="ZodTuple",i.ZodRecord="ZodRecord",i.ZodMap="ZodMap",i.ZodSet="ZodSet",i.ZodFunction="ZodFunction",i.ZodLazy="ZodLazy",i.ZodLiteral="ZodLiteral",i.ZodEnum="ZodEnum",i.ZodEffects="ZodEffects",i.ZodNativeEnum="ZodNativeEnum",i.ZodOptional="ZodOptional",i.ZodNullable="ZodNullable",i.ZodDefault="ZodDefault",i.ZodCatch="ZodCatch",i.ZodPromise="ZodPromise",i.ZodBranded="ZodBranded",i.ZodPipeline="ZodPipeline",i.ZodReadonly="ZodReadonly"})(ae||(ae={}));const gg=(i,e={message:`Input not instance of ${i.name}`})=>sl(t=>t instanceof i,e),ol=pt.create,al=ar.create,vg=qn.create,yg=cr.create,cl=ki.create,wg=_r.create,bg=Wn.create,_g=Ai.create,Tg=Ci.create,xg=Wr.create,Mg=Tr.create,Eg=qt.create,Sg=Xn.create,Pg=mt.create,Rg=je.create,Ig=je.strictCreate,kg=ji.create,Ag=Yn.create,Cg=Li.create,jg=St.create,Lg=Fi.create,Fg=Hn.create,Og=xr.create,Gg=Yr.create,Ng=Oi.create,Zg=Gi.create,Dg=lr.create,Vg=Ni.create,Bg=Hr.create,ll=gt.create,Ug=Pt.create,$g=ur.create,zg=gt.createWithPreprocess,Wg=Vi.create;var D=Object.freeze({__proto__:null,defaultErrorMap:$r,setErrorMap:zm,getErrorMap:Un,makeIssue:$n,EMPTY_PATH:Wm,addIssueToContext:H,ParseStatus:$e,INVALID:le,DIRTY:zr,OK:He,isAborted:wo,isDirty:bo,isValid:br,isAsync:Pi,get util(){return Se},get objectUtil(){return yo},ZodParsedType:Q,getParsedType:Ht,ZodType:pe,datetimeRegex:il,ZodString:pt,ZodNumber:ar,ZodBigInt:cr,ZodBoolean:ki,ZodDate:_r,ZodSymbol:Wn,ZodUndefined:Ai,ZodNull:Ci,ZodAny:Wr,ZodUnknown:Tr,ZodNever:qt,ZodVoid:Xn,ZodArray:mt,ZodObject:je,ZodUnion:ji,ZodDiscriminatedUnion:Yn,ZodIntersection:Li,ZodTuple:St,ZodRecord:Fi,ZodMap:Hn,ZodSet:xr,ZodFunction:Yr,ZodLazy:Oi,ZodLiteral:Gi,ZodEnum:lr,ZodNativeEnum:Ni,ZodPromise:Hr,ZodEffects:gt,ZodTransformer:gt,ZodOptional:Pt,ZodNullable:ur,ZodDefault:Zi,ZodCatch:Di,ZodNaN:qn,BRAND:pg,ZodBranded:xo,ZodPipeline:Vi,ZodReadonly:Bi,custom:sl,Schema:pe,ZodSchema:pe,late:mg,get ZodFirstPartyTypeKind(){return ae},coerce:{string:i=>pt.create({...i,coerce:!0}),number:i=>ar.create({...i,coerce:!0}),boolean:i=>ki.create({...i,coerce:!0}),bigint:i=>cr.create({...i,coerce:!0}),date:i=>_r.create({...i,coerce:!0})},any:xg,array:Pg,bigint:yg,boolean:cl,date:wg,discriminatedUnion:Ag,effect:ll,enum:Dg,function:Gg,instanceof:gg,intersection:Cg,lazy:Ng,literal:Zg,map:Fg,nan:vg,nativeEnum:Vg,never:Eg,null:Tg,nullable:$g,number:al,object:Rg,oboolean:()=>cl().optional(),onumber:()=>al().optional(),optional:Ug,ostring:()=>ol().optional(),pipeline:Wg,preprocess:zg,promise:Bg,record:Lg,set:Og,strictObject:Ig,string:ol,symbol:bg,transformer:ll,tuple:jg,undefined:_g,union:kg,unknown:Mg,void:Sg,NEVER:le,ZodIssueCode:U,quotelessJson:$m,ZodError:rt});const Xg=D.string().or(D.number()).or(D.boolean()),Yg=D.record(D.string(),Xg.array()),hr=D.tuple([D.number(),D.number()]),ul=D.object({type:D.literal("Point"),coordinates:hr}),hl=hr.array().min(3),Ui=D.enum(["ImageService1","ImageService2","ImageService3"]),Kn=D.object({id:D.string().url(),type:D.string(),label:Yg.optional()}).extend({partOf:D.lazy(()=>Kn.array()).optional()}),Jn=D.union([D.any(),D.object({type:D.enum(["helmert","polynomial","thinPlateSpline","projective"]).or(D.string()),options:D.object({}).optional()})]).transform(i=>{if(i&&typeof i=="object"&&"type"in i)return i}),Qn=D.union([D.string().url().array(),D.string().url()]),Hg=/^<svg\s+width="\d+"\s+height="\d+"\s*>\s*<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>\s*<\/svg>$/,qg=D.object({type:D.literal("SvgSelector"),value:D.string().regex(Hg)}),Kg=D.object({source:D.string().url(),service:D.array(D.object({"@id":D.string().url(),type:Ui})).length(1),selector:qg}),dl=D.object({pixelCoords:hr}),Jg=D.object({type:D.literal("FeatureCollection"),transformation:Jn.optional(),features:D.array(D.object({type:D.literal("Feature"),properties:dl,geometry:ul}))}),Mo=D.object({id:D.string().optional(),type:D.literal("Annotation"),"@context":Qn.optional(),motivation:D.string().default("georeferencing").optional(),target:Kg,body:Jg}),fl=D.object({id:D.string().optional(),type:D.literal("AnnotationPage"),"@context":Qn.optional(),items:D.array(Mo)}),Eo=/<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>/,Qg=new RegExp(`^<svg\\s+width="\\d+"\\s+height="\\d+"\\s*>\\s*${Eo.source}\\s*</svg>$`),ev=new RegExp(`^<svg\\s+height="\\d+"\\s+width="\\d+"\\s*>\\s*${Eo.source}\\s*</svg>$`),tv=new RegExp(`^<svg\\s*>\\s*${Eo.source}\\s*</svg>$`),rv=D.string().regex(tv),iv=D.string().regex(Qg),nv=D.string().regex(ev),sv=D.object({type:D.literal("SvgSelector"),value:rv.or(iv).or(nv)}),ov=D.object({"@id":D.string().url(),type:Ui,height:D.number().positive(),width:D.number().positive(),partOf:Kn.array().optional()}),av=D.object({id:D.string().url(),type:Ui,height:D.number().positive().optional(),width:D.number().positive().optional(),partOf:Kn.array().optional()}),cv=D.object({type:D.literal("SpecificResource"),source:ov.or(av),selector:sv}),pl=D.object({resourceCoords:hr}),lv=D.object({type:D.literal("FeatureCollection"),transformation:Jn.optional(),features:D.array(D.object({type:D.literal("Feature"),properties:pl,geometry:ul}))}),So=D.object({id:D.string().optional(),type:D.literal("Annotation"),"@context":Qn.optional(),motivation:D.string().default("georeferencing").optional(),created:D.string().datetime().optional(),modified:D.string().datetime().optional(),target:cv,body:lv}),ml=D.object({id:D.string().optional(),type:D.literal("AnnotationPage"),"@context":Qn.optional(),items:D.array(So)});Mo.or(So),fl.or(ml),dl.or(pl);function gl(i){return Array.isArray(i)}function uv(i){return!!(i&&typeof i=="object"&&"type"in i&&i.type==="AnnotationPage")}function es(i){return!!(i&&typeof i=="object"&&"type"in i&&i.type==="GeoreferencedMap")}function vl(i){return!!(i&&typeof i=="object"&&"target"in i&&i.target&&typeof i.target=="object"&&"source"in i.target&&typeof i.target.source=="string")}function ts(i){return"type"in i&&i.type==="GeoreferencedMap"}function rs(i){return"source"in i.target&&typeof i.target.source=="object"}function hv(i){return{id:dv(i),...yv(i),type:fv(i),partOf:pv(i)}}function dv(i){if(rs(i)){const e=i.target.source;return"id"in e?e.id:e["@id"]}else return i.target.service[0]["@id"]}function fv(i){return"service"in i.target?i.target.service[0].type:i.target.source.type}function pv(i){if(rs(i))return i.target.source.partOf}function mv(i){return"pixelCoords"in i?i.pixelCoords:i.resourceCoords}function gv(i){return i.body.features.map(e=>({resource:mv(e.properties),geo:e.geometry.coordinates}))}function vv(i){if(rs(i))return{created:i.created,modified:i.modified}}function yv(i){if(rs(i))return{width:i.target.source.width,height:i.target.source.height};const t=i.target.selector.value,r=/width="(?<width>\d+)"/.exec(t),n=/height="(?<height>\d+)"/.exec(t),s=r?.groups?.width,o=n?.groups?.height;if(!s||!o)throw new Error("Could not parse image dimensions");return{width:parseInt(s),height:parseInt(o)}}function wv(i){const t=i.target.selector.value,n=/points="(?<points>.+)"/.exec(t)?.groups;if(n&&n.points){const s=n.points.trim().split(/\s+/);if(s[0]===s[s.length-1]&&s.splice(-1),s.length>=3)return s.map(o=>{const a=o.split(",");if(a.length===2)return[parseFloat(a[0]),parseFloat(a[1])];throw new Error("Could not parse resource mask")});throw new Error("Could not parse resource mask")}else throw new Error("Could not parse resource mask")}function yl(i){return{"@context":"https://schemas.allmaps.org/map/2/context.json",type:"GeoreferencedMap",id:i.id,...vv(i),resource:hv(i),gcps:gv(i),resourceMask:wv(i),transformation:i.body.transformation}}function Po(i){if(uv(i)){let e;return"items"in i&&Array.isArray(i.items)&&vl(i.items[0])?e=fl.parse(i):e=ml.parse(i),e.items.map(t=>yl(t))}else{let e;return vl(i)?e=Mo.parse(i):e=So.parse(i),[yl(e)]}}const wl=D.object({image:hr,world:hr}),bv=D.object({uri:D.string().url(),width:D.number(),height:D.number(),type:Ui}),is=D.object({id:D.string().optional(),version:D.number().min(1).max(1).default(1),image:bv,gcps:wl.array(),pixelMask:hl,transformation:Jn.optional()}),Ro=D.array(is),bl=D.object({resource:hr,geo:hr}),_v=D.object({id:D.string().url(),height:D.number().positive().optional(),width:D.number().positive().optional(),type:Ui,partOf:Kn.array().optional()}),ns=D.object({"@context":D.literal("https://schemas.allmaps.org/map/2/context.json").optional(),type:D.literal("GeoreferencedMap"),id:D.string().optional(),created:D.string().datetime().optional(),modified:D.string().datetime().optional(),resource:_v,gcps:bl.array(),resourceMask:hl,transformation:Jn.optional()}),Io=D.array(ns);is.or(ns),Ro.or(Io),wl.or(bl);function Tv(i){let e,t,r;ts(i)?(e=i.resource.width,t=i.resource.height,r=i.resourceMask):(e=i.image.width,t=i.image.height,r=i.pixelMask);let n="<svg>";return e&&t&&(n=`<svg width="${e}" height="${t}">`),{type:"SvgSelector",value:`${n}<polygon points="${r.map(s=>s.join(",")).join(" ")}" /></svg>`}}function xv(i){let e,t,r,n,s;return ts(i)?(e=i.resource.id,t=i.resource.type,r=i.resource.width,n=i.resource.height,s=i.resource.partOf):(e=i.image.uri,t=i.image.type,r=i.image.width,n=i.image.height),{id:e,type:t,height:n,width:r,partOf:s}}function Mv(i){if(ts(i))return{created:i.created,modified:i.modified}}function Ev(){return["http://iiif.io/api/extension/georef/1/context.json","http://iiif.io/api/presentation/3/context.json"]}function Sv(i){let e,t;return"resource"in i?(e=i.resource,t=i.geo):(e=i.image,t=i.world),{type:"Feature",properties:{resourceCoords:e},geometry:{type:"Point",coordinates:t}}}function _l(i){const e={type:"SpecificResource",source:xv(i),selector:Tv(i)},t={type:"FeatureCollection",transformation:i.transformation,features:i.gcps.map(r=>Sv(r))};return{id:i.id,type:"Annotation","@context":Ev(),...Mv(i),motivation:"georeferencing",target:e,body:t}}function Pv(i){if(gl(i)){let e;return es(i[0])?e=Io.parse(i):e=Ro.parse(i),{type:"AnnotationPage","@context":"http://www.w3.org/ns/anno.jsonld",items:e.map(r=>_l(r))}}else{let e;return es(i)?e=ns.parse(i):e=is.parse(i),_l(e)}}function Tl(i){return ts(i)?i:Po(Pv(i))[0]}function Rv(i){return i.map(Tl)}function xl(i){if(gl(i)){let e;return es(i[0])?e=Io.parse(i):e=Ro.parse(i),Rv(e)}else{let e;return es(i)?e=ns.parse(i):e=is.parse(i),Tl(e)}}function Iv(i,e,t,r,n){Ml(i,e,t||0,r||i.length-1,n||kv)}function Ml(i,e,t,r,n){for(;r>t;){if(r-t>600){var s=r-t+1,o=e-t+1,a=Math.log(s),c=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*c*(s-c)/s)*(o-s/2<0?-1:1),u=Math.max(t,Math.floor(e-o*c/s+l)),h=Math.min(r,Math.floor(e+(s-o)*c/s+l));Ml(i,e,u,h,n)}var d=i[e],g=t,f=r;for($i(i,t,e),n(i[r],d)>0&&$i(i,t,r);g<f;){for($i(i,g,f),g++,f--;n(i[g],d)<0;)g++;for(;n(i[f],d)>0;)f--}n(i[t],d)===0?$i(i,t,f):(f++,$i(i,f,r)),f<=e&&(t=f+1),e<=f&&(r=f-1)}}function $i(i,e,t){var r=i[e];i[e]=i[t],i[t]=r}function kv(i,e){return i<e?-1:i>e?1:0}class Av{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const r=[];if(!os(e,t))return r;const n=this.toBBox,s=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],c=t.leaf?n(a):a;os(e,c)&&(t.leaf?r.push(a):Ao(e,c)?this._all(a,r):s.push(a))}t=s.pop()}return r}collides(e){let t=this.data;if(!os(e,t))return!1;const r=[];for(;t;){for(let n=0;n<t.children.length;n++){const s=t.children[n],o=t.leaf?this.toBBox(s):s;if(os(e,o)){if(t.leaf||Ao(e,o))return!0;r.push(s)}}t=r.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let r=0;r<e.length;r++)this.insert(e[r]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const r=this.data;this.data=t,t=r}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Kr([]),this}remove(e,t){if(!e)return this;let r=this.data;const n=this.toBBox(e),s=[],o=[];let a,c,l;for(;r||s.length;){if(r||(r=s.pop(),c=s[s.length-1],a=o.pop(),l=!0),r.leaf){const u=Cv(e,r.children,t);if(u!==-1)return r.children.splice(u,1),s.push(r),this._condense(s),this}!l&&!r.leaf&&Ao(r,n)?(s.push(r),o.push(a),a=0,c=r,r=r.children[0]):c?(a++,r=c.children[a],l=!1):r=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const r=[];for(;e;)e.leaf?t.push(...e.children):r.push(...e.children),e=r.pop();return t}_build(e,t,r,n){const s=r-t+1;let o=this._maxEntries,a;if(s<=o)return a=Kr(e.slice(t,r+1)),qr(a,this.toBBox),a;n||(n=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,n-1))),a=Kr([]),a.leaf=!1,a.height=n;const c=Math.ceil(s/o),l=c*Math.ceil(Math.sqrt(o));El(e,t,r,l,this.compareMinX);for(let u=t;u<=r;u+=l){const h=Math.min(u+l-1,r);El(e,u,h,c,this.compareMinY);for(let d=u;d<=h;d+=c){const g=Math.min(d+c-1,h);a.children.push(this._build(e,d,g,n-1))}}return qr(a,this.toBBox),a}_chooseSubtree(e,t,r,n){for(;n.push(t),!(t.leaf||n.length-1===r);){let s=1/0,o=1/0,a;for(let c=0;c<t.children.length;c++){const l=t.children[c],u=ko(l),h=Fv(e,l)-u;h<o?(o=h,s=u<s?u:s,a=l):h===o&&u<s&&(s=u,a=l)}t=a||t.children[0]}return t}_insert(e,t,r){const n=r?e:this.toBBox(e),s=[],o=this._chooseSubtree(n,this.data,t,s);for(o.children.push(e),Wi(o,n);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(n,s,t)}_split(e,t){const r=e[t],n=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,n);const o=this._chooseSplitIndex(r,s,n),a=Kr(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,qr(r,this.toBBox),qr(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,t){this.data=Kr([e,t]),this.data.height=e.height+1,this.data.leaf=!1,qr(this.data,this.toBBox)}_chooseSplitIndex(e,t,r){let n,s=1/0,o=1/0;for(let a=t;a<=r-t;a++){const c=zi(e,0,a,this.toBBox),l=zi(e,a,r,this.toBBox),u=Ov(c,l),h=ko(c)+ko(l);u<s?(s=u,n=a,o=h<o?h:o):u===s&&h<o&&(o=h,n=a)}return n||r-t}_chooseSplitAxis(e,t,r){const n=e.leaf?this.compareMinX:jv,s=e.leaf?this.compareMinY:Lv,o=this._allDistMargin(e,t,r,n),a=this._allDistMargin(e,t,r,s);o<a&&e.children.sort(n)}_allDistMargin(e,t,r,n){e.children.sort(n);const s=this.toBBox,o=zi(e,0,t,s),a=zi(e,r-t,r,s);let c=ss(o)+ss(a);for(let l=t;l<r-t;l++){const u=e.children[l];Wi(o,e.leaf?s(u):u),c+=ss(o)}for(let l=r-t-1;l>=t;l--){const u=e.children[l];Wi(a,e.leaf?s(u):u),c+=ss(a)}return c}_adjustParentBBoxes(e,t,r){for(let n=r;n>=0;n--)Wi(t[n],e)}_condense(e){for(let t=e.length-1,r;t>=0;t--)e[t].children.length===0?t>0?(r=e[t-1].children,r.splice(r.indexOf(e[t]),1)):this.clear():qr(e[t],this.toBBox)}}function Cv(i,e,t){if(!t)return e.indexOf(i);for(let r=0;r<e.length;r++)if(t(i,e[r]))return r;return-1}function qr(i,e){zi(i,0,i.children.length,e,i)}function zi(i,e,t,r,n){n||(n=Kr(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s=e;s<t;s++){const o=i.children[s];Wi(n,i.leaf?r(o):o)}return n}function Wi(i,e){return i.minX=Math.min(i.minX,e.minX),i.minY=Math.min(i.minY,e.minY),i.maxX=Math.max(i.maxX,e.maxX),i.maxY=Math.max(i.maxY,e.maxY),i}function jv(i,e){return i.minX-e.minX}function Lv(i,e){return i.minY-e.minY}function ko(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function ss(i){return i.maxX-i.minX+(i.maxY-i.minY)}function Fv(i,e){return(Math.max(e.maxX,i.maxX)-Math.min(e.minX,i.minX))*(Math.max(e.maxY,i.maxY)-Math.min(e.minY,i.minY))}function Ov(i,e){const t=Math.max(i.minX,e.minX),r=Math.max(i.minY,e.minY),n=Math.min(i.maxX,e.maxX),s=Math.min(i.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,s-r)}function Ao(i,e){return i.minX<=e.minX&&i.minY<=e.minY&&e.maxX<=i.maxX&&e.maxY<=i.maxY}function os(i,e){return e.minX<=i.maxX&&e.minY<=i.maxY&&e.maxX>=i.minX&&e.maxY>=i.minY}function Kr(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function El(i,e,t,r,n){const s=[e,t];for(;s.length;){if(t=s.pop(),e=s.pop(),t-e<=r)continue;const o=e+Math.ceil((t-e)/r/2)*r;Iv(i,o,e,t,n),s.push(e,o,o,t)}}function Gv(i,e,t){if(t===void 0&&(t={}),!i)throw new Error("point is required");if(!e)throw new Error("polygon is required");var r=Fr(i),n=Rd(e),s=n.type,o=e.bbox,a=n.coordinates;if(o&&Nv(r,o)===!1)return!1;s==="Polygon"&&(a=[a]);for(var c=!1,l=0;l<a.length&&!c;l++)if(Sl(r,a[l][0],t.ignoreBoundary)){for(var u=!1,h=1;h<a[l].length&&!u;)Sl(r,a[l][h],!t.ignoreBoundary)&&(u=!0),h++;u||(c=!0)}return c}function Sl(i,e,t){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var n=0,s=e.length-1;n<e.length;s=n++){var o=e[n][0],a=e[n][1],c=e[s][0],l=e[s][1],u=i[1]*(o-c)+a*(c-i[0])+l*(i[0]-o)===0&&(o-i[0])*(c-i[0])<=0&&(a-i[1])*(l-i[1])<=0;if(u)return!t;var h=a>i[1]!=l>i[1]&&i[0]<(c-o)*(i[1]-a)/(l-a)+o;h&&(r=!r)}return r}function Nv(i,e){return e[0]<=i[0]&&e[1]<=i[1]&&e[2]>=i[0]&&e[3]>=i[1]}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Pl=Symbol("Comlink.proxy"),Zv=Symbol("Comlink.endpoint"),Dv=Symbol("Comlink.releaseProxy"),Co=Symbol("Comlink.finalizer"),as=Symbol("Comlink.thrown"),Rl=i=>typeof i=="object"&&i!==null||typeof i=="function",Vv={canHandle:i=>Rl(i)&&i[Pl],serialize(i){const{port1:e,port2:t}=new MessageChannel;return kl(i,e),[t,[t]]},deserialize(i){return i.start(),Cl(i)}},Bv={canHandle:i=>Rl(i)&&as in i,serialize({value:i}){let e;return i instanceof Error?e={isError:!0,value:{message:i.message,name:i.name,stack:i.stack}}:e={isError:!1,value:i},[e,[]]},deserialize(i){throw i.isError?Object.assign(new Error(i.value.message),i.value):i.value}},Il=new Map([["proxy",Vv],["throw",Bv]]);function Uv(i,e){for(const t of i)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function kl(i,e=globalThis,t=["*"]){e.addEventListener("message",function r(n){if(!n||!n.data)return;if(!Uv(t,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}const{id:s,type:o,path:a}=Object.assign({path:[]},n.data),c=(n.data.argumentList||[]).map(Mr);let l;try{const u=a.slice(0,-1).reduce((d,g)=>d[g],i),h=a.reduce((d,g)=>d[g],i);switch(o){case"GET":l=h;break;case"SET":u[a.slice(-1)[0]]=Mr(n.data.value),l=!0;break;case"APPLY":l=h.apply(u,c);break;case"CONSTRUCT":{const d=new h(...c);l=Ol(d)}break;case"ENDPOINT":{const{port1:d,port2:g}=new MessageChannel;kl(i,g),l=Yv(d,[d])}break;case"RELEASE":l=void 0;break;default:return}}catch(u){l={value:u,[as]:0}}Promise.resolve(l).catch(u=>({value:u,[as]:0})).then(u=>{const[h,d]=hs(u);e.postMessage(Object.assign(Object.assign({},h),{id:s}),d),o==="RELEASE"&&(e.removeEventListener("message",r),Al(e),Co in i&&typeof i[Co]=="function"&&i[Co]())}).catch(u=>{const[h,d]=hs({value:new TypeError("Unserializable return value"),[as]:0});e.postMessage(Object.assign(Object.assign({},h),{id:s}),d)})}),e.start&&e.start()}function $v(i){return i.constructor.name==="MessagePort"}function Al(i){$v(i)&&i.close()}function Cl(i,e){const t=new Map;return i.addEventListener("message",function(n){const{data:s}=n;if(!s||!s.id)return;const o=t.get(s.id);if(o)try{o(s)}finally{t.delete(s.id)}}),jo(i,t,[],e)}function cs(i){if(i)throw new Error("Proxy has been released and is not useable")}function jl(i){return Jr(i,new Map,{type:"RELEASE"}).then(()=>{Al(i)})}const ls=new WeakMap,us="FinalizationRegistry"in globalThis&&new FinalizationRegistry(i=>{const e=(ls.get(i)||0)-1;ls.set(i,e),e===0&&jl(i)});function zv(i,e){const t=(ls.get(e)||0)+1;ls.set(e,t),us&&us.register(i,e,i)}function Wv(i){us&&us.unregister(i)}function jo(i,e,t=[],r=function(){}){let n=!1;const s=new Proxy(r,{get(o,a){if(cs(n),a===Dv)return()=>{Wv(s),jl(i),e.clear(),n=!0};if(a==="then"){if(t.length===0)return{then:()=>s};const c=Jr(i,e,{type:"GET",path:t.map(l=>l.toString())}).then(Mr);return c.then.bind(c)}return jo(i,e,[...t,a])},set(o,a,c){cs(n);const[l,u]=hs(c);return Jr(i,e,{type:"SET",path:[...t,a].map(h=>h.toString()),value:l},u).then(Mr)},apply(o,a,c){cs(n);const l=t[t.length-1];if(l===Zv)return Jr(i,e,{type:"ENDPOINT"}).then(Mr);if(l==="bind")return jo(i,e,t.slice(0,-1));const[u,h]=Ll(c);return Jr(i,e,{type:"APPLY",path:t.map(d=>d.toString()),argumentList:u},h).then(Mr)},construct(o,a){cs(n);const[c,l]=Ll(a);return Jr(i,e,{type:"CONSTRUCT",path:t.map(u=>u.toString()),argumentList:c},l).then(Mr)}});return zv(s,i),s}function Xv(i){return Array.prototype.concat.apply([],i)}function Ll(i){const e=i.map(hs);return[e.map(t=>t[0]),Xv(e.map(t=>t[1]))]}const Fl=new WeakMap;function Yv(i,e){return Fl.set(i,e),i}function Ol(i){return Object.assign(i,{[Pl]:!0})}function hs(i){for(const[e,t]of Il)if(t.canHandle(i)){const[r,n]=t.serialize(i);return[{type:"HANDLER",name:e,value:r},n]}return[{type:"RAW",value:i},Fl.get(i)||[]]}function Mr(i){switch(i.type){case"HANDLER":return Il.get(i.name).deserialize(i.value);case"RAW":return i.value}}function Jr(i,e,t,r){return new Promise(n=>{const s=Hv();e.set(s,n),i.start&&i.start(),i.postMessage(Object.assign({id:s},t),r)})}function Hv(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const qv=200,Kv={leading:!0,trailing:!0},Jv=1,Qv=1,e0=6,t0=[...Fe(Si),1],r0=0,i0=[...Fe(Bn),1],n0=16,s0=[...Fe(Si),1],o0=1,a0=[...Fe(Bn),1],c0=5,l0=1;function u0(i,e,t,r){return(n,s,o)=>new h0(n,s,i,e,t,r,o)}class h0 extends $p{gl;mapProgram;linesProgram;pointsProgram;mapVao=null;linesVao=null;pointsVao=null;lineLayers=[];pointLayers=[];cachedTilesByTileKey=new Map;cachedTilesByTileUrl=new Map;cachedTilesForTexture=[];previousCachedTilesForTexture=[];opacity=Jv;saturation=Qv;renderOptions={};cachedTilesTextureArray=null;cachedTilesResourceOriginPointsAndDimensionsTexture=null;cachedTilesScaleFactorsTexture=null;invertedRenderTransform;throttledUpdateTextures;constructor(e,t,r,n,s,o,a){super(e,t,a),this.gl=r,this.initializeWebGL(n,s,o),this.invertedRenderTransform=Ql(),this.throttledUpdateTextures=ho(this.updateTextures.bind(this),qv,Kv)}initializeWebGL(e,t,r){this.mapProgram=e,this.linesProgram=t,this.pointsProgram=r,this.mapVao=this.gl.createVertexArray(),this.linesVao=this.gl.createVertexArray(),this.pointsVao=this.gl.createVertexArray(),this.cachedTilesTextureArray=this.gl.createTexture(),this.cachedTilesScaleFactorsTexture=this.gl.createTexture(),this.cachedTilesResourceOriginPointsAndDimensionsTexture=this.gl.createTexture()}updateVertexBuffers(e){this.invertedRenderTransform=gs(e),this.updateVertexBuffersMap(e)}clearTextures(){this.throttledUpdateTextures()}addCachedTileAndUpdateTextures(e){this.cachedTilesByTileKey.set(e.tileKey,e),this.cachedTilesByTileUrl.set(e.tileUrl,e),this.throttledUpdateTextures()}removeCachedTileAndUpdateTextures(e){const t=this.cachedTilesByTileUrl.get(e);t&&this.cachedTilesByTileKey.delete(t.tileKey),this.cachedTilesByTileUrl.delete(e),this.throttledUpdateTextures()}cancelThrottledFunctions(){this.throttledUpdateTextures.cancel()}destroy(){this.gl.deleteVertexArray(this.mapVao),this.gl.deleteVertexArray(this.linesVao),this.gl.deleteVertexArray(this.pointsVao),this.gl.deleteTexture(this.cachedTilesTextureArray),this.gl.deleteTexture(this.cachedTilesScaleFactorsTexture),this.gl.deleteTexture(this.cachedTilesResourceOriginPointsAndDimensionsTexture),this.cancelThrottledFunctions(),super.destroy()}setLineLayers(){this.lineLayers=[{projectedGeoLines:Yo(this.projectedGeoTriangulationMask),projectedGeoPreviousLines:Yo(this.projectedGeoPreviousTriangulationMask),viewportSize:8,color:[...Fe(fo),1]},{projectedGeoLines:Xo(this.projectedGeoPoints,this.projectedGeoTransformedResourcePoints),projectedGeoPreviousLines:Xo(this.projectedGeoPoints,this.projectedGeoPreviousTransformedResourcePoints),color:[...Fe(Si),1],borderColor:[...Fe(Bn),1]}]}setPointLayers(){this.pointLayers=[{projectedGeoPoints:this.projectedGeoPoints,color:[...Fe(Vc),1]},{projectedGeoPoints:this.projectedGeoTransformedResourcePoints,projectedGeoPreviousPoints:this.projectedGeoPreviousTransformedResourcePoints,color:[...Fe(fo),1]},{projectedGeoPoints:this.projectedGeoPreviousTrianglePoints,color:[...Fe($c),1]},{projectedGeoPoints:this.projectedGeoTrianglePoints,color:[...Fe(mo),1]}]}updateVertexBuffersMap(e){if(!this.mapVao)return;const t=this.gl,r=this.mapProgram;t.bindVertexArray(this.mapVao),Le(t,r,new Float32Array(this.resourceTrianglePoints.flat()),2,"a_resourceTrianglePoint");const n=this.projectedGeoPreviousTrianglePoints.map(a=>et(e,a));Le(t,r,new Float32Array(n.flat()),2,"a_clipPreviousTrianglePoint");const s=this.projectedGeoTrianglePoints.map(a=>et(e,a));Le(t,r,new Float32Array(s.flat()),2,"a_clipTrianglePoint"),Le(t,r,new Float32Array(this.previousTrianglePointsDistortion),1,"a_previousTrianglePointDistortion"),Le(t,r,new Float32Array(this.trianglePointsDistortion),1,"a_trianglePointDistortion");const o=new Float32Array(this.resourceTrianglePoints.length).map((a,c)=>c);Le(t,r,o,1,"a_trianglePointIndex")}updateVertexBuffersLines(e){if(!this.linesVao)return;const t=this.gl,r=this.linesProgram;t.bindVertexArray(this.linesVao),this.setLineLayers();const n=this.lineLayers.reduce((f,y)=>f.concat(y.projectedGeoLines),[]).map(f=>[f[0],f[0],f[0],f[1],f[1],f[1]]).flat().map(f=>et(e,f));Le(t,r,new Float32Array(n.flat()),2,"a_clipPoint");const s=this.lineLayers.reduce((f,y)=>f.concat(y.projectedGeoLines),[]).map(f=>[f[1],f[1],f[1],f[0],f[0],f[0]]).flat().map(f=>et(e,f));Le(t,r,new Float32Array(s.flat()),2,"a_clipOtherPoint");const o=this.lineLayers.reduce((f,y)=>f.concat(y.projectedGeoPreviousLines||y.projectedGeoLines),[]).map(f=>[f[0],f[0],f[0],f[1],f[1],f[1]]).flat().map(f=>et(e,f));Le(t,r,new Float32Array(o.flat()),2,"a_clipPreviousPoint");const a=this.lineLayers.reduce((f,y)=>f.concat(y.projectedGeoPreviousLines||y.projectedGeoLines),[]).map(f=>[f[1],f[1],f[1],f[0],f[0],f[0]]).flat().map(f=>et(e,f));Le(t,r,new Float32Array(a.flat()),2,"a_clipPreviousOtherPoint");const c=this.lineLayers.reduce((f,y)=>f.concat(y.projectedGeoLines.flatMap(E=>[0,0,1,0,0,1])),[]);Le(t,r,new Float32Array(c),1,"a_isOtherPoint");const l=this.lineLayers.reduce((f,y)=>f.concat(y.projectedGeoLines.flatMap(E=>[1,-1,1,1,-1,1])),[]);Le(t,r,new Float32Array(l),1,"a_normalSign");const u=this.lineLayers.reduce((f,y)=>f.concat(y.projectedGeoLines.flatMap(E=>Array(6).fill(Object.prototype.hasOwnProperty.call(y,"viewportSize")?y.viewportSize:e0))),[]);Le(t,r,new Float32Array(u),1,"a_viewportSize");const h=this.lineLayers.reduce((f,y)=>f.concat(y.projectedGeoLines.flatMap(E=>Array(6).fill(Object.prototype.hasOwnProperty.call(y,"color")?y.color:t0))),[]);Le(t,r,new Float32Array(h.flat()),4,"a_color");const d=this.lineLayers.reduce((f,y)=>f.concat(y.projectedGeoLines.flatMap(E=>Array(6).fill(y.viewportBorderSize||r0))),[]);Le(t,r,new Float32Array(d),1,"a_viewportBorderSize");const g=this.lineLayers.reduce((f,y)=>f.concat(y.projectedGeoLines.flatMap(E=>Array(6).fill(Object.prototype.hasOwnProperty.call(y,"borderColor")?y.borderColor:i0))),[]);Le(t,r,new Float32Array(g.flat()),4,"a_borderColor")}updateVertexBuffersPoints(e){if(!this.pointsVao)return;const t=this.gl,r=this.pointsProgram;t.bindVertexArray(this.pointsVao),this.setPointLayers();const n=this.pointLayers.reduce((u,h)=>u.concat(h.projectedGeoPoints),[]).map(u=>et(e,u));Le(t,r,new Float32Array(n.flat()),2,"a_clipPoint");const s=this.pointLayers.reduce((u,h)=>u.concat(h.projectedGeoPreviousPoints||h.projectedGeoPoints),[]).map(u=>et(e,u));Le(t,r,new Float32Array(s.flat()),2,"a_clipPreviousPoint");const o=this.pointLayers.reduce((u,h)=>u.concat(h.projectedGeoPoints.map(d=>Object.prototype.hasOwnProperty.call(h,"viewportSize")?h.viewportSize:n0)),[]);Le(t,r,new Float32Array(o),1,"a_viewportSize");const a=this.pointLayers.reduce((u,h)=>u.concat(h.projectedGeoPoints.map(d=>Object.prototype.hasOwnProperty.call(h,"color")?h.color:s0)),[]);Le(t,r,new Float32Array(a.flat()),4,"a_color");const c=this.pointLayers.reduce((u,h)=>u.concat(h.projectedGeoPoints.map(d=>h.viewportBorderSize||o0)),[]);Le(t,r,new Float32Array(c),1,"a_viewportBorderSize");const l=this.pointLayers.reduce((u,h)=>u.concat(h.projectedGeoPoints.map(d=>Object.prototype.hasOwnProperty.call(h,"borderColor")?h.borderColor:a0)),[]);Le(t,r,new Float32Array(l.flat()),4,"a_borderColor")}async updateTextures(){const e=this.gl;if(this.updateCachedTilesForTextures(),this.cachedTilesForTexture.length!==0&&Iu(this.previousCachedTilesForTexture.map(a=>a.tileUrl),this.cachedTilesForTexture.map(a=>a.tileUrl)))return;const t=Math.max(...this.parsedImage.tileZoomLevels.map(a=>a.width)),r=Math.max(...this.parsedImage.tileZoomLevels.map(a=>a.height)),n=this.cachedTilesForTexture.length;e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.bindTexture(e.TEXTURE_2D_ARRAY,this.cachedTilesTextureArray),e.texImage3D(e.TEXTURE_2D_ARRAY,0,e.RGBA,t,r,n,0,e.RGBA,e.UNSIGNED_BYTE,null);for(let a=0;a<this.cachedTilesForTexture.length;a++){const c=this.cachedTilesForTexture[a].data,l=e.createBuffer();e.bindBuffer(e.PIXEL_UNPACK_BUFFER,l),e.bufferData(e.PIXEL_UNPACK_BUFFER,c.data,e.STATIC_DRAW),e.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,a,c.width,c.height,1,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null)}e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const s=this.cachedTilesForTexture.map(a=>{if(a&&a.imageRequest&&a.imageRequest.region)return[a.imageRequest.region.x,a.imageRequest.region.y,a.imageRequest.region.width,a.imageRequest.region.height]});e.bindTexture(e.TEXTURE_2D,this.cachedTilesResourceOriginPointsAndDimensionsTexture),e.texImage2D(e.TEXTURE_2D,0,e.R32I,1,this.cachedTilesForTexture.length*4,0,e.RED_INTEGER,e.INT,new Int32Array(s.flat())),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const o=this.cachedTilesForTexture.map(a=>a.tile.tileZoomLevel.scaleFactor);e.bindTexture(e.TEXTURE_2D,this.cachedTilesScaleFactorsTexture),e.texImage2D(e.TEXTURE_2D,0,e.R32I,1,this.cachedTilesForTexture.length,0,e.RED_INTEGER,e.INT,new Int32Array(o)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.dispatchEvent(new ue($.TEXTURESUPDATED))}updateCachedTilesForTextures(){const e=[],t=[],r=[];for(const o of this.fetchableTilesForViewport){const a=this.cachedTilesByTileUrl.get(o.tileUrl);if(a)e.push(a);else for(const c of this.getCachedTilesAtOtherScaleFactors(o.tile))t.push(c)}for(const o of this.overviewFetchableTilesForViewport){const a=this.cachedTilesByTileUrl.get(o.tileUrl);if(a){const c=this.tileZoomLevelForViewport?this.tileZoomLevelForViewport.rows*this.tileZoomLevelForViewport.columns:void 0;(e.length==0||c&&e.length<c)&&r.push(a)}}let n=[...e,...t,...r];const s=new Map;n.forEach(o=>s.set(o.tileUrl,o)),n=[...s.values()],this.previousCachedTilesForTexture=this.cachedTilesForTexture,this.cachedTilesForTexture=n}getCachedTilesAtOtherScaleFactors(e){if(this.cachedTilesByTileUrl.size==0)return[];if(!this.tileZoomLevelForViewport)return[];const t=[];for(e of Fm(e,this.parsedImage,this.tileZoomLevelForViewport.scaleFactor,l0,c0,this.tileInCachedTiles.bind(this))){const r=this.tileToCachedTile(e);if(r)t.push(r);else throw new Error("Tile supposed to be in cache isn't.")}return t}tileToCachedTile(e){return this.cachedTilesByTileKey.get(go(e))}tileInCachedTiles(e){return this.cachedTilesByTileKey.has(go(e))}}const d0=!0;class f0{rbush=new Av;polygonsById=new Map;bboxesById=new Map;itemsById=new Map;addItem(e,t){this.removeItem(e);const r=Ve(t),n={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],id:e};this.polygonsById.set(e,t),this.bboxesById.set(e,r),this.itemsById.set(e,n),this.rbush.insert(n)}removeItem(e){const t=this.itemsById.get(e);t&&(this.rbush.remove(t),this.polygonsById.delete(e),this.bboxesById.delete(e),this.itemsById.delete(e))}clear(){this.polygonsById.clear(),this.bboxesById.clear(),this.itemsById.clear(),this.rbush.clear()}search(e,t,r,n){return this.rbush.search({minX:e,minY:t,maxX:r,maxY:n})}getBbox(e){return this.bboxesById.get(e)}getPolygon(e){return this.polygonsById.get(e)}searchFromBbox(e){const[t,r,n,s]=e;return this.search(t,r,n,s).map(o=>o.id)}searchFromPoint(e,t=d0){const[r,n,s,o]=[e[0],e[1],e[0],e[1]],a=this.search(r,n,s,o);return t?a.filter(c=>{const l=this.polygonsById.get(c.id);return l?Gv(e,l):!1}).map(c=>c.id):a.map(c=>c.id)}}function p0(){return{createRTree:!0,imageInformations:new Map}}class m0 extends EventTarget{warpedMapFactory;warpedMapsById=new Map;zIndices=new Map;rtree;imageInformations;transformation;fetchFn;constructor(e,t){super(),this.warpedMapFactory=e,t={...p0(),...t},this.fetchFn=t?.fetchFn,this.imageInformations=t.imageInformations,this.transformation=t.transformation,t.createRTree&&(this.rtree=new f0)}getMapIds(){return this.warpedMapsById.keys()}getWarpedMaps(e){if(e===void 0)return this.warpedMapsById.values();{const t=[];for(const r of e){const n=this.warpedMapsById.get(r);n&&t.push(n)}return t}}getWarpedMap(e){return this.warpedMapsById.get(e)}getMapZIndex(e){return this.zIndices.get(e)}getCenter(){const e=this.getBbox();if(e)return Pr(e)}getProjectedCenter(){const e=this.getProjectedBbox();if(e)return Pr(e)}getBbox(){let e;for(const t of this.getWarpedMaps())t.visible&&(e?e=qo(e,t.geoMaskBbox):e=t.geoMaskBbox);return e}getProjectedBbox(){let e;for(const t of this.getWarpedMaps())t.visible&&(e?e=qo(e,t.projectedGeoMaskBbox):e=t.projectedGeoMaskBbox);return e}getMapsByGeoBbox(e){return this.rtree?this.rtree.searchFromBbox(e):Array.from(this.warpedMapsById.keys())}setImageInformations(e){this.imageInformations=e}setMapResourceMask(e,t){const r=this.warpedMapsById.get(e);r&&(r.setResourceMask(t),this.addToOrUpdateRtree(r),this.dispatchEvent(new ue($.RESOURCEMASKUPDATED,e)))}setMapGcps(e,t){const r=this.warpedMapsById.get(e);r&&(r.setGcps(t),this.addToOrUpdateRtree(r),this.dispatchEvent(new ue($.GCPSUPDATED,e)))}setMapTransformationType(e,t){this.setMapsTransformationType([e],t)}setMapsTransformationType(e,t){const r=[];for(const n of e){const s=this.warpedMapsById.get(n);s&&s.transformationType!==t&&r.push(n)}r.length>0&&(this.dispatchEvent(new ue($.PRECHANGE,r)),r.forEach(n=>{const s=this.warpedMapsById.get(n);s&&(s.setTransformationType(t),this.addToOrUpdateRtree(s))}),this.dispatchEvent(new ue($.TRANSFORMATIONCHANGED,r)))}setMapsDistortionMeasure(e,t){const r=[];for(const n of e){const s=this.warpedMapsById.get(n);s&&s.distortionMeasure!==t&&r.push(n)}r.length>0&&(this.dispatchEvent(new ue($.PRECHANGE,r)),r.forEach(n=>{const s=this.warpedMapsById.get(n);s&&(s.setDistortionMeasure(t),this.addToOrUpdateRtree(s))}),this.dispatchEvent(new ue($.DISTORTIONCHANGED,r)))}removeGeoreferencedMapById(e){const t=this.warpedMapsById.get(e);t&&(this.removeGeoreferencedMap(t),this.removeFromRtree(t),this.dispatchEvent(new ue($.WARPEDMAPREMOVED,e)))}bringMapsToFront(e){let t=this.warpedMapsById.size;for(const r of e)this.zIndices.has(r)&&(this.zIndices.set(r,t),t++);this.removeZIndexHoles(),this.dispatchEvent(new ue($.ZINDICESCHANGED))}sendMapsToBack(e){let t=-Array.from(e).length;for(const r of e)this.zIndices.has(r)&&(this.zIndices.set(r,t),t++);this.removeZIndexHoles(),this.dispatchEvent(new ue($.ZINDICESCHANGED))}bringMapsForward(e){for(const[t,r]of this.zIndices.entries())this.zIndices.set(t,r*2);for(const t of e){const r=this.zIndices.get(t);r!==void 0&&this.zIndices.set(t,r+3)}this.removeZIndexHoles(),this.dispatchEvent(new ue($.ZINDICESCHANGED))}sendMapsBackward(e){for(const[t,r]of this.zIndices.entries())this.zIndices.set(t,r*2);for(const t of e){const r=this.zIndices.get(t);r!==void 0&&this.zIndices.set(t,r-3)}this.removeZIndexHoles(),this.dispatchEvent(new ue($.ZINDICESCHANGED))}showMaps(e){for(const t of e){const r=this.warpedMapsById.get(t);r&&(r.visible=!0)}this.dispatchEvent(new ue($.VISIBILITYCHANGED,e))}hideMaps(e){for(const t of e){const r=this.warpedMapsById.get(t);r&&(r.visible=!1)}this.dispatchEvent(new ue($.VISIBILITYCHANGED,e))}async addGeoreferencedMap(e){const t=xl(e),r=Array.isArray(t)?t[0]:t;return this.addGeoreferencedMapInternal(r)}async removeGeoreferencedMap(e){const t=xl(e),r=Array.isArray(t)?t[0]:t;return this.removeGeoreferencedMapInternal(r)}async addGeoreferenceAnnotation(e){const t=[],r=Po(e),n=await Promise.allSettled(r.map(s=>this.addGeoreferencedMapInternal(s)));for(const s of n)s.status==="fulfilled"?t.push(s.value):t.push(s.reason);return this.dispatchEvent(new ue($.GEOREFERENCEANNOTATIONADDED)),this.dispatchEvent(new ue($.ZINDICESCHANGED)),t}async removeGeoreferenceAnnotation(e){const t=[],r=Po(e);for(const n of r){const s=await this.removeGeoreferencedMapInternal(n);t.push(s)}return this.dispatchEvent(new ue($.GEOREFERENCEANNOTATIONREMOVED)),t}clear(){this.warpedMapsById=new Map,this.zIndices=new Map,this.rtree?.clear(),this.dispatchEvent(new ue($.CLEARED))}destroy(){for(const e of this.getWarpedMaps())this.removeEventListenersFromWarpedMap(e),e.destroy();this.clear()}async addGeoreferencedMapInternal(e){const t=await this.getOrComputeMapId(e),r=this.warpedMapFactory(t,e,{imageInformations:this.imageInformations,fetchFn:this.fetchFn,transformation:this.transformation});return this.warpedMapsById.set(t,r),this.zIndices.set(t,this.warpedMapsById.size-1),this.addToOrUpdateRtree(r),this.addEventListenersToWarpedMap(r),this.dispatchEvent(new ue($.WARPEDMAPADDED,t)),t}async removeGeoreferencedMapInternal(e){const t=await this.getOrComputeMapId(e),r=this.warpedMapsById.get(t);if(r)this.warpedMapsById.delete(t),this.zIndices.delete(t),this.removeFromRtree(r),this.dispatchEvent(new ue($.WARPEDMAPREMOVED,t)),this.removeZIndexHoles(),this.dispatchEvent(new ue($.ZINDICESCHANGED)),r.destroy();else throw new Error(`No map found with ID ${t}`);return t}async getOrComputeMapId(e){return e.id||await Um(e)}addToOrUpdateRtree(e){this.rtree&&(this.rtree.removeItem(e.mapId),this.rtree.addItem(e.mapId,e.geoMask))}removeFromRtree(e){this.rtree&&this.rtree.removeItem(e.mapId)}removeZIndexHoles(){const e=[...this.zIndices.entries()].sort((r,n)=>r[1]-n[1]);let t=0;for(const r of e){const n=r[0];this.zIndices.set(n,t),t++}}imageInfoLoaded(){this.dispatchEvent(new ue($.IMAGEINFOLOADED))}addEventListenersToWarpedMap(e){e.addEventListener($.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}removeEventListenersFromWarpedMap(e){e.removeEventListener($.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}}class g0 extends EventTarget{tile;imageRequest;tileUrl;tileKey;fetchFn;abortController;data;constructor(e,t){super(),this.tile=e.tile,this.imageRequest=e.imageRequest,this.tileUrl=e.tileUrl,this.tileKey=e.tileKey,this.fetchFn=t,this.abortController=new AbortController}isCachedTile(){return this.data!==void 0}abort(){this.abortController.signal.aborted||this.abortController.abort()}}class Gl{mapId;tile;imageRequest;tileUrl;tileKey;fetchableTileKey;constructor(e,t){this.mapId=t.mapId,this.tile=e;const r=t.parsedImage.getIiifTile(e.tileZoomLevel,e.column,e.row);this.imageRequest=r,this.tileUrl=t.parsedImage.getImageUrl(r),this.tileKey=go(e),this.fetchableTileKey=Gm(this)}}const v0=4,y0=2;let w0=class extends EventTarget{cachableTileFactory;fetchFn;tilesByTileUrl=new Map;mapIdsByTileUrl=new Map;tileUrlsByMapId=new Map;tilesFetchingCount=0;fetchableTiles=[];constructor(e,t){super(),this.cachableTileFactory=e,this.fetchFn=t?.fetchFn}getCacheableTiles(){return this.tilesByTileUrl.values()}getCacheableTile(e){return this.tilesByTileUrl.get(e)}getMapCacheableTiles(e){const t=[];for(const r of this.tilesByTileUrl.values())this.tileUrlsByMapId.get(e)?.has(r.tileUrl)&&t.push(r);return t}getCachedTiles(){const e=[];for(const t of this.tilesByTileUrl.values())t.isCachedTile()&&e.push(t);return e}getCachedTile(e){const t=this.tilesByTileUrl.get(e);if(t&&t.isCachedTile())return t}getMapCachedTiles(e){const t=[];for(const r of this.tilesByTileUrl.values())r.isCachedTile()&&this.tileUrlsByMapId.get(e)?.has(r.tileUrl)&&t.push(r);return t}getTileUrls(){return this.tilesByTileUrl.keys()}getMapTileUrls(e){return this.tileUrlsByMapId.get(e)||new Set}requestFetchableTiles(e){const t=new Set(this.fetchableTiles.map(n=>n.fetchableTileKey)),r=new Set(e.map(n=>n.fetchableTileKey));if(!ku(t,r)){for(const n of e)this.requestFetchableTile(n);this.fetchableTiles=e}}async allRequestedTilesLoaded(){return new Promise(e=>{if(this.finished)e();else{const t=()=>{this.removeEventListener($.ALLREQUESTEDTILESLOADED,t),e()};this.addEventListener($.ALLREQUESTEDTILESLOADED,t)}})}prune(e){for(const[t,r]of this.mapIdsByTileUrl.entries())for(const n of r){const s=e.get(n),o=this.tilesByTileUrl.get(t)?.tile;o&&(!s||Dm(o,s,{maxHigherLog2ScaleFactorDiff:v0,maxLowerLog2ScaleFactorDiff:y0}))&&this.removeCacheableTileForMapId(t,n)}}clear(){for(const e of this.getCacheableTiles())e.abort(),this.removeEventListenersFromCacheableTile(e);this.tilesByTileUrl=new Map,this.mapIdsByTileUrl=new Map,this.tileUrlsByMapId=new Map,this.tilesFetchingCount=0}destroy(){this.clear()}requestFetchableTile(e){const t=e.mapId,r=e.tileUrl;if(this.tilesByTileUrl.has(r))this.tilesByTileUrl.get(r)?.isCachedTile()&&this.dispatchEvent(new ue($.MAPTILELOADED,{mapId:t,tileUrl:r}));else{const n=this.cachableTileFactory(e,this.fetchFn);this.addEventListenersToCacheableTile(n),this.addCacheableTile(n)}this.addTileUrlForMapId(r,t),this.addMapIdForTileUrl(t,r)}addCacheableTile(e){this.tilesByTileUrl.set(e.tileUrl,e),e.fetch(),this.updateTilesFetchingCount(1)}removeCacheableTileForMapId(e,t){const r=this.tilesByTileUrl.get(e);if(!r)return;const n=this.removeMapIdForTileUrl(t,e);this.removeTileUrlForMapId(e,t),n.size||(r.isCachedTile()||(r.abort(),this.updateTilesFetchingCount(-1)),this.tilesByTileUrl.delete(e)),this.dispatchEvent(new ue($.MAPTILEREMOVED,{mapId:t,tileUrl:e}))}tileFetched(e){if(e instanceof ue){const t=e.data;this.updateTilesFetchingCount(-1);for(const r of this.mapIdsByTileUrl.get(t)||[])this.dispatchEvent(new ue($.MAPTILELOADED,{mapId:r,tileUrl:t})),this.tileUrlsByMapId.get(r)?.values().next().value===t&&this.dispatchEvent(new ue($.FIRSTMAPTILELOADED,{mapId:r,tileUrl:t}))}}tileFetchError(e){if(e instanceof ue){const t=e.data;this.tilesByTileUrl.has(t)||this.updateTilesFetchingCount(-1)}}addMapIdForTileUrl(e,t){let r=this.mapIdsByTileUrl.get(t);return r?r.add(e):r=new Set([e]),this.mapIdsByTileUrl.set(t,r),r}removeMapIdForTileUrl(e,t){const r=this.mapIdsByTileUrl.get(t);if(r)r.delete(e);else return new Set;return r.size?this.mapIdsByTileUrl.set(t,r):this.mapIdsByTileUrl.delete(t),r}addTileUrlForMapId(e,t){let r=this.tileUrlsByMapId.get(t);return r?r.add(e):r=new Set([e]),this.tileUrlsByMapId.set(t,r),r}removeTileUrlForMapId(e,t){const r=this.tileUrlsByMapId.get(t);return r?(r.delete(e),r.size?this.tileUrlsByMapId.set(t,r):this.tileUrlsByMapId.delete(t),r):new Set}get finished(){return this.tilesFetchingCount===0}updateTilesFetchingCount(e){this.tilesFetchingCount+=e,this.tilesFetchingCount===0&&this.dispatchEvent(new ue($.ALLREQUESTEDTILESLOADED))}addEventListenersToCacheableTile(e){e.addEventListener($.TILEFETCHED,this.tileFetched.bind(this)),e.addEventListener($.TILEFETCHERROR,this.tileFetchError.bind(this))}removeEventListenersFromCacheableTile(e){e.removeEventListener($.TILEFETCHED,this.tileFetched.bind(this)),e.removeEventListener($.TILEFETCHERROR,this.tileFetchError.bind(this))}};const b0=5,Nl=0,_0=2,T0=4,Zl=10,x0=0,M0=.4,E0=1024*1024,S0=10;class P0 extends EventTarget{warpedMapList;tileCache;mapsInPreviousViewport=new Set;mapsInViewport=new Set;mapsWithRequestedTilesForViewport=new Set;viewport;constructor(e,t,r){super(),this.tileCache=new w0(e,r),this.warpedMapList=new m0(t,r)}async addGeoreferenceAnnotation(e){return this.warpedMapList.addGeoreferenceAnnotation(e)}async addGeoreferencedMap(e){return this.warpedMapList.addGeoreferencedMap(e)}loadMissingImageInfosInViewport(){return this.viewport?Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).map(e=>this.warpedMapList.getWarpedMap(e)).filter(e=>!e.hasImageInfo()&&!e.loadingImageInfo).map(e=>e.loadImageInfo()):[]}someImageInfosInViewport(){return this.viewport?Array.from(this.findMapsInViewport(this.shouldAnticipateInteraction()?Zl:0)).map(e=>this.warpedMapList.getWarpedMap(e)).map(e=>e.hasImageInfo()).some(Boolean):!1}shouldRequestFetchableTiles(){return!0}shouldAnticipateInteraction(){return!1}requestFetchableTiles(){if(!this.shouldRequestFetchableTiles())return;const e=[],t=[],r=this.findMapsInViewport(this.shouldAnticipateInteraction()?Nl:0),n=this.findMapsInViewport(this.shouldAnticipateInteraction()?_0:0),s=this.findMapsInViewport(this.shouldAnticipateInteraction()?T0:0),o=this.findMapsInViewport(this.shouldAnticipateInteraction()?Zl:0);for(const a of this.warpedMapList.getWarpedMaps())a.resetForViewport();for(const a of s)e.push(...this.getMapFetchableTilesForViewport(a,r));if(this.shouldAnticipateInteraction())for(const a of o)t.push(...this.getMapOverviewFetchableTilesForViewport(a,[...e,...t],n));this.tileCache.requestFetchableTiles([...e,...t]),this.updateMapsForViewport([...e,...t]),this.pruneTileCache(o)}findMapsInViewport(e=0){if(!this.viewport)return new Set;const t=this.viewport,r=this.viewport.getProjectedGeoBufferedRectangle(e),n=Ve(r.map(s=>Es(s)));return new Set(Array.from(this.warpedMapList.getMapsByGeoBbox(n)).sort((s,o)=>{const a=this.warpedMapList.getWarpedMap(s),c=this.warpedMapList.getWarpedMap(o);return a&&c?Ct(Pr(a.geoMaskBbox),t.geoCenter)-Ct(Pr(c.geoMaskBbox),t.geoCenter):0}))}getMapFetchableTilesForViewport(e,t){if(!this.viewport)return[];const r=this.viewport,n=this.warpedMapList.getWarpedMap(e);if(!n)return[];if(!n.visible)return[];if(!n.hasImageInfo())return[];if(Eu(n.getViewportMaskBbox(r))<b0)return[];const s=xm(n.parsedImage.tileZoomLevels,n.getResourceToCanvasScale(r),x0,M0);n.setTileZoomLevelForViewport(s);const o={maxDepth:0,sourceIsGeographic:!1,destinationIsGeographic:!0},a=r.getProjectedGeoBufferedRectangle(this.shouldAnticipateInteraction()?Nl:0),c=n.projectedTransformer.transformBackward([a],o)[0];if(n.setProjectedGeoBufferedViewportRectangleForViewport(a),n.setResourceBufferedViewportRingForViewport(c),!t.has(e))return[];const l=Mm(c,s,[n.parsedImage.width,n.parsedImage.height]).map(u=>new Gl(u,n));return n.setFetchableTilesForViewport(l),l}getMapOverviewFetchableTilesForViewport(e,t,r){if(!this.viewport)return[];const n=this.warpedMapList.getWarpedMap(e);if(!n)return[];if(!n.visible)return[];if(!n.hasImageInfo())return[];const s=jm(t.map(l=>l.tile)),o=this.viewport.canvasResolution*S0;if(s>o)return[];const a=n.parsedImage.tileZoomLevels.filter(l=>Lm(l)<=E0).sort((l,u)=>l.scaleFactor-u.scaleFactor).at(-1);if(n.setOverviewTileZoomLevelForViewport(a),!r.has(e))return[];if(!a||n.tileZoomLevelForViewport&&a.scaleFactor<=n.tileZoomLevelForViewport.scaleFactor)return[];const c=Wc(a.scaleFactor,n.parsedImage).map(l=>new Gl(l,n));return n.setOverviewFetchableTilesForViewport(c),c}updateMapsForViewport(e){this.mapsWithRequestedTilesForViewport=new Set(e.map(o=>o.mapId).filter((o,a,c)=>c.indexOf(o)===a).sort((o,a)=>{const c=this.warpedMapList.getMapZIndex(o),l=this.warpedMapList.getMapZIndex(a);return c!==void 0&&l!==void 0?c-l:0})),this.mapsInPreviousViewport=this.mapsInViewport,this.mapsInViewport=this.findMapsInViewport();const t=Array.from(this.mapsInPreviousViewport),r=Array.from(this.mapsInViewport),n=r.filter(o=>!t.includes(o)),s=t.filter(o=>!r.includes(o));for(const o of n)this.dispatchEvent(new ue($.WARPEDMAPENTER,o));for(const o of s)this.clearMap(o),this.dispatchEvent(new ue($.WARPEDMAPLEAVE,o));return{mapsEnteringViewport:n,mapsLeavingViewport:s}}pruneTileCache(e){const t=new Map;for(const r of this.warpedMapList.getWarpedMaps(e))t.set(r.mapId,{tileZoomLevelForViewport:r.tileZoomLevelForViewport,overviewTileZoomLevelForViewport:r.overviewTileZoomLevelForViewport,resourceViewportRingBboxForViewport:r.resourceBufferedViewportRingBboxForViewport});this.tileCache.prune(t)}destroy(){this.tileCache.destroy(),this.warpedMapList.destroy()}clearMap(e){}mapTileLoaded(e){}mapTileRemoved(e){}imageInfoLoaded(e){}warpedMapAdded(e){}warpedMapRemoved(e){}preChange(e){}transformationChanged(e){}distortionChanged(e){}addEventListeners(){this.tileCache.addEventListener($.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.addEventListener($.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.addEventListener($.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.addEventListener($.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.addEventListener($.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.addEventListener($.PRECHANGE,this.preChange.bind(this)),this.warpedMapList.addEventListener($.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.addEventListener($.DISTORTIONCHANGED,this.distortionChanged.bind(this))}removeEventListeners(){this.tileCache.removeEventListener($.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.removeEventListener($.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.removeEventListener($.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.removeEventListener($.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.removeEventListener($.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.removeEventListener($.PRECHANGE,this.preChange.bind(this)),this.warpedMapList.removeEventListener($.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.removeEventListener($.DISTORTIONCHANGED,this.distortionChanged.bind(this))}}class Lo extends g0{async fetch(){try{const e=new Worker(new URL(""+new URL("data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiOy8qKgogKiBAbGljZW5zZQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDCiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wCiAqL2NvbnN0IEE9U3ltYm9sKCJDb21saW5rLnByb3h5Iiksej1TeW1ib2woIkNvbWxpbmsuZW5kcG9pbnQiKSxEPVN5bWJvbCgiQ29tbGluay5yZWxlYXNlUHJveHkiKSxrPVN5bWJvbCgiQ29tbGluay5maW5hbGl6ZXIiKSxkPVN5bWJvbCgiQ29tbGluay50aHJvd24iKSxQPWU9PnR5cGVvZiBlPT0ib2JqZWN0IiYmZSE9PW51bGx8fHR5cGVvZiBlPT0iZnVuY3Rpb24iLE49e2NhbkhhbmRsZTplPT5QKGUpJiZlW0FdLHNlcmlhbGl6ZShlKXtjb25zdHtwb3J0MTp0LHBvcnQyOnJ9PW5ldyBNZXNzYWdlQ2hhbm5lbDtyZXR1cm4geChlLHQpLFtyLFtyXV19LGRlc2VyaWFsaXplKGUpe3JldHVybiBlLnN0YXJ0KCksVihlKX19LEg9e2NhbkhhbmRsZTplPT5QKGUpJiZkIGluIGUsc2VyaWFsaXplKHt2YWx1ZTplfSl7bGV0IHQ7cmV0dXJuIGUgaW5zdGFuY2VvZiBFcnJvcj90PXtpc0Vycm9yOiEwLHZhbHVlOnttZXNzYWdlOmUubWVzc2FnZSxuYW1lOmUubmFtZSxzdGFjazplLnN0YWNrfX06dD17aXNFcnJvcjohMSx2YWx1ZTplfSxbdCxbXV19LGRlc2VyaWFsaXplKGUpe3Rocm93IGUuaXNFcnJvcj9PYmplY3QuYXNzaWduKG5ldyBFcnJvcihlLnZhbHVlLm1lc3NhZ2UpLGUudmFsdWUpOmUudmFsdWV9fSxNPW5ldyBNYXAoW1sicHJveHkiLE5dLFsidGhyb3ciLEhdXSk7ZnVuY3Rpb24gTChlLHQpe2Zvcihjb25zdCByIG9mIGUpaWYodD09PXJ8fHI9PT0iKiJ8fHIgaW5zdGFuY2VvZiBSZWdFeHAmJnIudGVzdCh0KSlyZXR1cm4hMDtyZXR1cm4hMX1mdW5jdGlvbiB4KGUsdD1nbG9iYWxUaGlzLHI9WyIqIl0pe3QuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsZnVuY3Rpb24gcyhuKXtpZighbnx8IW4uZGF0YSlyZXR1cm47aWYoIUwocixuLm9yaWdpbikpe2NvbnNvbGUud2FybihgSW52YWxpZCBvcmlnaW4gJyR7bi5vcmlnaW59JyBmb3IgY29tbGluayBwcm94eWApO3JldHVybn1jb25zdHtpZDpvLHR5cGU6ZyxwYXRoOmN9PU9iamVjdC5hc3NpZ24oe3BhdGg6W119LG4uZGF0YSksZj0obi5kYXRhLmFyZ3VtZW50TGlzdHx8W10pLm1hcChtKTtsZXQgaTt0cnl7Y29uc3QgYT1jLnNsaWNlKDAsLTEpLnJlZHVjZSgodSx3KT0+dVt3XSxlKSxsPWMucmVkdWNlKCh1LHcpPT51W3ddLGUpO3N3aXRjaChnKXtjYXNlIkdFVCI6aT1sO2JyZWFrO2Nhc2UiU0VUIjphW2Muc2xpY2UoLTEpWzBdXT1tKG4uZGF0YS52YWx1ZSksaT0hMDticmVhaztjYXNlIkFQUExZIjppPWwuYXBwbHkoYSxmKTticmVhaztjYXNlIkNPTlNUUlVDVCI6e2NvbnN0IHU9bmV3IGwoLi4uZik7aT1HKHUpfWJyZWFrO2Nhc2UiRU5EUE9JTlQiOntjb25zdHtwb3J0MTp1LHBvcnQyOnd9PW5ldyBNZXNzYWdlQ2hhbm5lbDt4KGUsdyksaT1JKHUsW3VdKX1icmVhaztjYXNlIlJFTEVBU0UiOmk9dm9pZCAwO2JyZWFrO2RlZmF1bHQ6cmV0dXJufX1jYXRjaChhKXtpPXt2YWx1ZTphLFtkXTowfX1Qcm9taXNlLnJlc29sdmUoaSkuY2F0Y2goYT0+KHt2YWx1ZTphLFtkXTowfSkpLnRoZW4oYT0+e2NvbnN0W2wsdV09cChhKTt0LnBvc3RNZXNzYWdlKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxsKSx7aWQ6b30pLHUpLGc9PT0iUkVMRUFTRSImJih0LnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLHMpLFModCksayBpbiBlJiZ0eXBlb2YgZVtrXT09ImZ1bmN0aW9uIiYmZVtrXSgpKX0pLmNhdGNoKGE9Pntjb25zdFtsLHVdPXAoe3ZhbHVlOm5ldyBUeXBlRXJyb3IoIlVuc2VyaWFsaXphYmxlIHJldHVybiB2YWx1ZSIpLFtkXTowfSk7dC5wb3N0TWVzc2FnZShPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sbCkse2lkOm99KSx1KX0pfSksdC5zdGFydCYmdC5zdGFydCgpfWZ1bmN0aW9uIFcoZSl7cmV0dXJuIGUuY29uc3RydWN0b3IubmFtZT09PSJNZXNzYWdlUG9ydCJ9ZnVuY3Rpb24gUyhlKXtXKGUpJiZlLmNsb3NlKCl9ZnVuY3Rpb24gVihlLHQpe2NvbnN0IHI9bmV3IE1hcDtyZXR1cm4gZS5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIixmdW5jdGlvbihuKXtjb25zdHtkYXRhOm99PW47aWYoIW98fCFvLmlkKXJldHVybjtjb25zdCBnPXIuZ2V0KG8uaWQpO2lmKGcpdHJ5e2cobyl9ZmluYWxseXtyLmRlbGV0ZShvLmlkKX19KSxDKGUscixbXSx0KX1mdW5jdGlvbiBiKGUpe2lmKGUpdGhyb3cgbmV3IEVycm9yKCJQcm94eSBoYXMgYmVlbiByZWxlYXNlZCBhbmQgaXMgbm90IHVzZWFibGUiKX1mdW5jdGlvbiBPKGUpe3JldHVybiB5KGUsbmV3IE1hcCx7dHlwZToiUkVMRUFTRSJ9KS50aGVuKCgpPT57UyhlKX0pfWNvbnN0IEU9bmV3IFdlYWtNYXAsaD0iRmluYWxpemF0aW9uUmVnaXN0cnkiaW4gZ2xvYmFsVGhpcyYmbmV3IEZpbmFsaXphdGlvblJlZ2lzdHJ5KGU9Pntjb25zdCB0PShFLmdldChlKXx8MCktMTtFLnNldChlLHQpLHQ9PT0wJiZPKGUpfSk7ZnVuY3Rpb24gXyhlLHQpe2NvbnN0IHI9KEUuZ2V0KHQpfHwwKSsxO0Uuc2V0KHQsciksaCYmaC5yZWdpc3RlcihlLHQsZSl9ZnVuY3Rpb24gVShlKXtoJiZoLnVucmVnaXN0ZXIoZSl9ZnVuY3Rpb24gQyhlLHQscj1bXSxzPWZ1bmN0aW9uKCl7fSl7bGV0IG49ITE7Y29uc3Qgbz1uZXcgUHJveHkocyx7Z2V0KGcsYyl7aWYoYihuKSxjPT09RClyZXR1cm4oKT0+e1UobyksTyhlKSx0LmNsZWFyKCksbj0hMH07aWYoYz09PSJ0aGVuIil7aWYoci5sZW5ndGg9PT0wKXJldHVybnt0aGVuOigpPT5vfTtjb25zdCBmPXkoZSx0LHt0eXBlOiJHRVQiLHBhdGg6ci5tYXAoaT0+aS50b1N0cmluZygpKX0pLnRoZW4obSk7cmV0dXJuIGYudGhlbi5iaW5kKGYpfXJldHVybiBDKGUsdCxbLi4ucixjXSl9LHNldChnLGMsZil7YihuKTtjb25zdFtpLGFdPXAoZik7cmV0dXJuIHkoZSx0LHt0eXBlOiJTRVQiLHBhdGg6Wy4uLnIsY10ubWFwKGw9PmwudG9TdHJpbmcoKSksdmFsdWU6aX0sYSkudGhlbihtKX0sYXBwbHkoZyxjLGYpe2Iobik7Y29uc3QgaT1yW3IubGVuZ3RoLTFdO2lmKGk9PT16KXJldHVybiB5KGUsdCx7dHlwZToiRU5EUE9JTlQifSkudGhlbihtKTtpZihpPT09ImJpbmQiKXJldHVybiBDKGUsdCxyLnNsaWNlKDAsLTEpKTtjb25zdFthLGxdPVQoZik7cmV0dXJuIHkoZSx0LHt0eXBlOiJBUFBMWSIscGF0aDpyLm1hcCh1PT51LnRvU3RyaW5nKCkpLGFyZ3VtZW50TGlzdDphfSxsKS50aGVuKG0pfSxjb25zdHJ1Y3QoZyxjKXtiKG4pO2NvbnN0W2YsaV09VChjKTtyZXR1cm4geShlLHQse3R5cGU6IkNPTlNUUlVDVCIscGF0aDpyLm1hcChhPT5hLnRvU3RyaW5nKCkpLGFyZ3VtZW50TGlzdDpmfSxpKS50aGVuKG0pfX0pO3JldHVybiBfKG8sZSksb31mdW5jdGlvbiBqKGUpe3JldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLGUpfWZ1bmN0aW9uIFQoZSl7Y29uc3QgdD1lLm1hcChwKTtyZXR1cm5bdC5tYXAocj0+clswXSksaih0Lm1hcChyPT5yWzFdKSldfWNvbnN0IFI9bmV3IFdlYWtNYXA7ZnVuY3Rpb24gSShlLHQpe3JldHVybiBSLnNldChlLHQpLGV9ZnVuY3Rpb24gRyhlKXtyZXR1cm4gT2JqZWN0LmFzc2lnbihlLHtbQV06ITB9KX1mdW5jdGlvbiBwKGUpe2Zvcihjb25zdFt0LHJdb2YgTSlpZihyLmNhbkhhbmRsZShlKSl7Y29uc3RbcyxuXT1yLnNlcmlhbGl6ZShlKTtyZXR1cm5be3R5cGU6IkhBTkRMRVIiLG5hbWU6dCx2YWx1ZTpzfSxuXX1yZXR1cm5be3R5cGU6IlJBVyIsdmFsdWU6ZX0sUi5nZXQoZSl8fFtdXX1mdW5jdGlvbiBtKGUpe3N3aXRjaChlLnR5cGUpe2Nhc2UiSEFORExFUiI6cmV0dXJuIE0uZ2V0KGUubmFtZSkuZGVzZXJpYWxpemUoZS52YWx1ZSk7Y2FzZSJSQVciOnJldHVybiBlLnZhbHVlfX1mdW5jdGlvbiB5KGUsdCxyLHMpe3JldHVybiBuZXcgUHJvbWlzZShuPT57Y29uc3Qgbz12KCk7dC5zZXQobyxuKSxlLnN0YXJ0JiZlLnN0YXJ0KCksZS5wb3N0TWVzc2FnZShPYmplY3QuYXNzaWduKHtpZDpvfSxyKSxzKX0pfWZ1bmN0aW9uIHYoKXtyZXR1cm4gbmV3IEFycmF5KDQpLmZpbGwoMCkubWFwKCgpPT5NYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpLnRvU3RyaW5nKDE2KSkuam9pbigiLSIpfWFzeW5jIGZ1bmN0aW9uIEYoZSx0LHIpe2xldCBzO2lmKHR5cGVvZiByPT0iZnVuY3Rpb24iP3M9YXdhaXQgcihlLHQpOnM9YXdhaXQgZmV0Y2goZSx0KSwhcy5vayl0aHJvdyBuZXcgRXJyb3Iocy5zdGF0dXNUZXh0KTtyZXR1cm4gc314KHthc3luYyBnZXRJbWFnZURhdGEoZSx0LHIscyxuKXtjb25zdCBvPW5ldyBBYm9ydENvbnRyb2xsZXI7dCgpO2NvbnN0IGM9YXdhaXQoYXdhaXQgRihlLHtzaWduYWw6by5zaWduYWx9LHIpKS5ibG9iKCksZj1hd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChjLDAsMCxzLG4pLGE9bmV3IE9mZnNjcmVlbkNhbnZhcyhzLG4pLmdldENvbnRleHQoIjJkIik7aWYoIWEpdGhyb3cgbmV3IEVycm9yKCJDb3VsZCBub3QgY3JlYXRlIE9mZnNjcmVlbkNhbnZhcyBjb250ZXh0Iik7YS5kcmF3SW1hZ2UoZiwwLDApO2NvbnN0IGw9YS5nZXRJbWFnZURhdGEoMCwwLHMsbik7cmV0dXJuIEkobCxbbC5kYXRhLmJ1ZmZlcl0pfX0pfSkoKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmV0Y2gtYW5kLWdldC1pbWFnZS1kYXRhLUM0U0x6U2Q0LmpzLm1hcAo=",typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:wt&&wt.tagName.toUpperCase()==="SCRIPT"&&wt.src||new URL("bundled/allmaps-maplibre-4.0.umd.js",document.baseURI).href).href,typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:wt&&wt.tagName.toUpperCase()==="SCRIPT"&&wt.src||new URL("bundled/allmaps-maplibre-4.0.umd.js",document.baseURI).href));Cl(e).getImageData(this.tileUrl,Ol(()=>this.abortController.abort()),this.fetchFn,this.tile.tileZoomLevel.width,this.tile.tileZoomLevel.height).then(t=>{this.data=t,this.dispatchEvent(new ue($.TILEFETCHED,this.tileUrl)),e.terminate()}).catch(t=>{t instanceof Error&&t.name==="AbortError"?console.log("Fetch aborted"):console.error(t),e.terminate()})}catch(e){e instanceof Error&&e.name==="AbortError"||this.dispatchEvent(new ue($.TILEFETCHERROR,this.tileUrl))}return this.data}static createFactory(){return(e,t)=>new Lo(e,t)}}var Dl=`#version 300 es

precision highp float;

float easing(float t) {
  return t;

  
  
}

uniform mat4 u_renderTransform;
uniform float u_animationProgress;

in vec2 a_resourceTrianglePoint;
in vec2 a_clipPreviousTrianglePoint;
in vec2 a_clipTrianglePoint;
in float a_previousTrianglePointDistortion;
in float a_trianglePointDistortion;
in float a_trianglePointIndex;

out vec2 v_resourceTrianglePoint;
out float v_trianglePointDistortion;
out float v_trianglePointIndex;
out vec4 v_trianglePointBarycentric;

void main() {
  
  vec2 clipTrianglePoint = mix(a_clipPreviousTrianglePoint, a_clipTrianglePoint, easing(u_animationProgress));
  float trianglePointDistortion = mix(a_previousTrianglePointDistortion, a_trianglePointDistortion, easing(u_animationProgress));

  
  
  

  gl_Position = u_renderTransform * vec4(clipTrianglePoint, 0.0f, 1.0f);

  
  v_resourceTrianglePoint = a_resourceTrianglePoint;
  v_trianglePointDistortion = trianglePointDistortion;
  v_trianglePointIndex = a_trianglePointIndex;

  float trianglePointLocalIndex = mod(a_trianglePointIndex, 3.0);
  if(trianglePointLocalIndex == 0.0) v_trianglePointBarycentric = vec4(1.0, 0, 0, 1.0);
  if(trianglePointLocalIndex == 1.0) v_trianglePointBarycentric = vec4(0.0, 1.0, 0, 1.0);
  if(trianglePointLocalIndex == 2.0) v_trianglePointBarycentric = vec4(0.0, 0, 1.0, 1.0);
}`,Vl=`#version 300 es

precision highp float;
precision highp isampler2D;

float easing(float t) {
  return t;

  
  
}

uniform float u_debug;

uniform bool u_removeColor;
uniform vec3 u_removeColorOptionsColor;
uniform float u_removeColorOptionsThreshold;
uniform float u_removeColorOptionsHardness;

uniform bool u_colorize;
uniform vec3 u_colorizeOptionsColor;

uniform bool u_grid;

uniform float u_opacity;
uniform float u_saturation;

uniform bool u_distortion;
uniform int u_distortionOptionsdistortionMeasure;

uniform int u_scaleFactorForViewport;

uniform lowp sampler2DArray u_cachedTilesTextureArray;
uniform isampler2D u_cachedTilesResourceOriginPointsAndDimensionsTexture;
uniform isampler2D u_cachedTilesScaleFactorsTexture;

uniform vec4 u_colorDistortion00;
uniform vec4 u_colorDistortion01;
uniform vec4 u_colorDistortion1;
uniform vec4 u_colorDistortion2;
uniform vec4 u_colorDistortion3;
uniform vec4 u_colorGrid;

in vec2 v_resourceTrianglePoint;
in float v_trianglePointDistortion;
in float v_trianglePointIndex;
in vec4 v_trianglePointBarycentric;

out vec4 color;

void main() {
  float resourceTrianglePointX = v_resourceTrianglePoint.x;
  float resourceTrianglePointY = v_resourceTrianglePoint.y;

  
  ivec3 cachedTilesTextureSize = textureSize(u_cachedTilesTextureArray, 0);
  int cachedTilesCount = cachedTilesTextureSize.z;

  
  int smallestScaleFactor;
  bool found = false;
  int foundIndex;

  
  vec3 cachedTilesTexturePoint = vec3(0.0f, 0.0f, 0.0f);

  
  color = vec4(0.0f, 0.0f, 0.0f, 0.0f);

  
  for(int index = 0; index < cachedTilesCount; index += 1) {

    
    float cachedTileResourceOriginPointX = float(texelFetch(u_cachedTilesResourceOriginPointsAndDimensionsTexture, ivec2(0, (index * 4)), 0));
    float cachedTileResourceOriginPointY = float(texelFetch(u_cachedTilesResourceOriginPointsAndDimensionsTexture, ivec2(0, (index * 4) + 1), 0));
    float cachedTileDimensionWidth = float(texelFetch(u_cachedTilesResourceOriginPointsAndDimensionsTexture, ivec2(0, (index * 4) + 2), 0));
    float cachedTileDimensionHeight = float(texelFetch(u_cachedTilesResourceOriginPointsAndDimensionsTexture, ivec2(0, (index * 4) + 3), 0));

    int cachedTileScaleFactor = texelFetch(u_cachedTilesScaleFactorsTexture, ivec2(0, index), 0).r;

    
    if(resourceTrianglePointX >= cachedTileResourceOriginPointX &&
      resourceTrianglePointX < cachedTileResourceOriginPointX + cachedTileDimensionWidth &&
      resourceTrianglePointY >= cachedTileResourceOriginPointY &&
      resourceTrianglePointY < cachedTileResourceOriginPointY + cachedTileDimensionHeight) {

      
      
      
      
      
      if(!(smallestScaleFactor > 0) || cachedTileScaleFactor <= smallestScaleFactor) {
        smallestScaleFactor = cachedTileScaleFactor;
        found = true;
        foundIndex = index;

        float cachedTilePointX = (resourceTrianglePointX - cachedTileResourceOriginPointX) / float(cachedTileScaleFactor);
        float cachedTilePointY = (resourceTrianglePointY - cachedTileResourceOriginPointY) / float(cachedTileScaleFactor);

        float cachedTilesTexturePointX = cachedTilePointX / float(cachedTilesTextureSize.x);
        float cachedTilesTexturePointY = cachedTilePointY / float(cachedTilesTextureSize.y);

        cachedTilesTexturePoint = vec3(cachedTilesTexturePointX, cachedTilesTexturePointY, index);
      }
    }
  }

  if(found == true) {
    
    color = texture(u_cachedTilesTextureArray, cachedTilesTexturePoint);

    if(u_removeColorOptionsThreshold > 0.0f) {
  vec3 backgroundColorDiff = color.rgb - u_removeColorOptionsColor.rgb;
  float backgroundColorDistance = length(backgroundColorDiff);
  if(u_removeColor && backgroundColorDistance < u_removeColorOptionsThreshold) {
    float amount = smoothstep(u_removeColorOptionsThreshold - u_removeColorOptionsThreshold * (1.0f - u_removeColorOptionsHardness), u_removeColorOptionsThreshold, backgroundColorDistance);
    color = vec4(color.rgb * amount, amount);
  }
}

float gray = 0.21f * color.r + 0.71f * color.g + 0.07f * color.b;
color = vec4(color.rgb * (u_saturation) + (gray * (1.0f - u_saturation)), color.a);

if(u_colorize) {
  color = vec4((u_colorizeOptionsColor + color.rgb) * color.a, color.a);
}

color = vec4(color.rgb * u_opacity, color.a * u_opacity);
    if(u_distortion) {
  
  

  float trianglePointDistortion = v_trianglePointDistortion;

  
  trianglePointDistortion = floor(trianglePointDistortion * 10.0f) / 10.0f;

  
  switch(u_distortionOptionsdistortionMeasure) {
    case 0:
      if(trianglePointDistortion > 0.0f) {
        color = mix(color, u_colorDistortion00, trianglePointDistortion);
      } else {
        color = mix(color, u_colorDistortion01, abs(trianglePointDistortion));
      }
      break;
    case 1:
      color = mix(color, u_colorDistortion1, trianglePointDistortion);
      break;
    case 2:
      color = mix(color, u_colorDistortion2, trianglePointDistortion);
      break;
    case 3:
      color = trianglePointDistortion == -1.0f ? u_colorDistortion3 : color;
      break;
    default:
      color = color;
  }
}

if(u_grid) {
  float gridSize = 20.0f * float(u_scaleFactorForViewport);
  float gridWidth = 2.0f * float(u_scaleFactorForViewport);
  if(mod(float(resourceTrianglePointX) + gridWidth / 2.0f, gridSize) < gridWidth || mod(float(resourceTrianglePointY) + gridWidth / 2.0f, gridSize) < gridWidth) {
    color = u_colorGrid;
  }
}
    if(bool(u_debug)) {
  
  

  float dist = 0.99; 
  if(
    v_trianglePointBarycentric.x + v_trianglePointBarycentric.y > dist ||
    v_trianglePointBarycentric.y + v_trianglePointBarycentric.z > dist ||
    v_trianglePointBarycentric.z + v_trianglePointBarycentric.x > dist
  )
  color = vec4(0, 0, 0, 1);
}
  }
}`,Bl=`#version 300 es

precision highp float;

float easing(float t) {
  return t;

  
  
}

uniform mat4 u_renderTransform;
uniform mat4 u_viewportToClipTransform;
uniform mat4 u_clipToViewportTransform;
uniform float u_animationProgress;

in vec2 a_clipPoint;
in vec2 a_clipOtherPoint;
in vec2 a_clipPreviousPoint;
in vec2 a_clipPreviousOtherPoint;
in float a_isOtherPoint;
in float a_normalSign;
in float a_viewportSize;
in vec4 a_color;
in float a_viewportBorderSize;
in vec4 a_borderColor;

out float v_viewportLineLength;
out vec2 v_linePoint;
out float v_viewportSize;
out vec4 v_color;
out float v_viewportBorderSize;
out vec4 v_borderColor;
out float v_viewportFeatherSize;
out float v_viewportTotalSize;

void main() {
  vec2 clipPoint = mix(a_clipPreviousPoint, a_clipPoint, easing(u_animationProgress));
  vec2 clipOtherPoint = mix(a_clipPreviousOtherPoint, a_clipOtherPoint, easing(u_animationProgress));

  vec2 viewportPoint = (u_clipToViewportTransform * u_renderTransform * vec4(clipPoint, 0.0f, 1.0f)).xy;
  vec2 viewportOtherPoint = (u_clipToViewportTransform * u_renderTransform * vec4(clipOtherPoint, 0.0f, 1.0f)).xy;

  vec2 viewportLine = vec2(viewportOtherPoint.x-viewportPoint.x, viewportOtherPoint.y-viewportPoint.y);
  vec2 viewportNormalizedLine = normalize(viewportLine);
  vec2 viewportNormalizedLineNormal = vec2(viewportNormalizedLine.y, -viewportNormalizedLine.x);
  v_viewportLineLength = length(viewportLine);

  v_viewportFeatherSize = 1.0;

  
  
  
  float viewportSize = a_viewportSize / 2.0;
  float viewportBorderSize = a_viewportBorderSize / 2.0;
  v_viewportFeatherSize = v_viewportFeatherSize / 2.0;

  v_viewportTotalSize = viewportSize + viewportBorderSize + v_viewportFeatherSize;
  float lineX = -1.0 * v_viewportTotalSize / 2.0 + a_isOtherPoint * (v_viewportLineLength + 2.0 * (v_viewportTotalSize / 2.0));
  float lineY = a_normalSign * v_viewportTotalSize / 2.0;
  v_linePoint = vec2(lineX, lineY);
  
  
  
  
  
  

  v_viewportSize = viewportSize;
  v_color = a_color;
  v_viewportBorderSize = viewportBorderSize;
  v_borderColor = a_borderColor;

  gl_Position =  u_viewportToClipTransform * vec4(viewportPoint + lineX * viewportNormalizedLine + lineY * viewportNormalizedLineNormal, 0, 1);
}`,Ul=`#version 300 es

precision highp float;
precision highp isampler2D;

in float v_viewportLineLength;
in vec2 v_linePoint;
in float v_viewportSize;
in vec4 v_color;
in float v_viewportBorderSize;
in vec4 v_borderColor;
in float v_viewportFeatherSize;
in float v_viewportTotalSize;

out vec4 color;

void main() {
  float distance;
  if (v_linePoint.x < 0.0) {
    distance = length(v_linePoint - vec2(0.0,0.0)) / (v_viewportTotalSize / 2.0);
  } else if (v_linePoint.x > v_viewportLineLength) {
    distance = length(v_linePoint - vec2(v_viewportLineLength,0.0)) / (v_viewportTotalSize / 2.0);
  } else {
    distance = abs(v_linePoint.y) / (v_viewportTotalSize / 2.0);
  }
  if (distance > 1.0) {
    discard;
  }
  float viewportDistance = distance * v_viewportTotalSize / 2.0;

  
  color = vec4(0, 0, 0, 0);
  if (v_viewportSize >= v_viewportFeatherSize) {
    color = v_color;
  }

  
  
  
  float borderSmoothStep;
  if(v_viewportBorderSize >= v_viewportFeatherSize) {
    borderSmoothStep = smoothstep(
      v_viewportSize / 2.0 - v_viewportBorderSize / 2.0 - v_viewportFeatherSize / 2.0,
      v_viewportSize / 2.0 - v_viewportBorderSize / 2.0 + v_viewportFeatherSize / 2.0,
      viewportDistance
    );
    color = ((1.0 - borderSmoothStep) * color) + (borderSmoothStep * v_borderColor);
  }

  
  
  
  borderSmoothStep = smoothstep(
      v_viewportSize / 2.0 + v_viewportBorderSize / 2.0 - v_viewportFeatherSize / 2.0,
      v_viewportSize / 2.0 + v_viewportBorderSize / 2.0 + v_viewportFeatherSize / 2.0,
      viewportDistance
  );
  color = ((1.0 - borderSmoothStep) * color) + (borderSmoothStep * vec4(0, 0, 0, 0));
}`,$l=`#version 300 es

precision highp float;

float easing(float t) {
  return t;

  
  
}

uniform mat4 u_renderTransform;
uniform float u_animationProgress;

in float a_viewportSize;
in vec4 a_color;
in float a_viewportBorderSize;
in vec4 a_borderColor;

in vec2 a_clipPoint;
in vec2 a_clipPreviousPoint;

out float v_viewportSize;
out vec4 v_color;
out float v_viewportBorderSize;
out vec4 v_borderColor;
out float v_viewportFeatherSize;
out float v_viewportTotalSize;

void main() {
  vec2 clipPoint = mix(a_clipPreviousPoint, a_clipPoint, easing(u_animationProgress));

  gl_Position = u_renderTransform * vec4(clipPoint, 0.0f, 1.0f);

  v_viewportFeatherSize = 1.0;

  v_viewportTotalSize = a_viewportSize + a_viewportBorderSize + v_viewportFeatherSize;
  gl_PointSize = v_viewportTotalSize;
  
  
  
  
  
  
  

  v_viewportSize = a_viewportSize;
  v_color = a_color;
  v_viewportBorderSize = a_viewportBorderSize;
  v_borderColor = a_borderColor;
}`,zl=`#version 300 es

precision highp float;
precision highp isampler2D;

in float v_viewportSize;
in vec4 v_color;
in float v_viewportBorderSize;
in vec4 v_borderColor;
in float v_viewportFeatherSize;
in float v_viewportTotalSize;

out vec4 color;

void main() {
  
  float distance = length(2.0 * gl_PointCoord - 1.0);
  if (distance > 1.0) {
    discard;
  }
  float viewportDistance = distance * v_viewportTotalSize / 2.0;

  
  color = vec4(0, 0, 0, 0);
  if (v_viewportSize >= v_viewportFeatherSize) {
    color = v_color;
  }

  
  
  
  float borderSmoothStep;
  if(v_viewportBorderSize >= v_viewportFeatherSize) {
    borderSmoothStep = smoothstep(
      v_viewportSize / 2.0 - v_viewportBorderSize / 2.0 - v_viewportFeatherSize / 2.0,
      v_viewportSize / 2.0 - v_viewportBorderSize / 2.0 + v_viewportFeatherSize / 2.0,
      viewportDistance
    );
    color = ((1.0 - borderSmoothStep) * color) + (borderSmoothStep * v_borderColor);
  }

  
  
  
  borderSmoothStep = smoothstep(
      v_viewportSize / 2.0 + v_viewportBorderSize / 2.0 - v_viewportFeatherSize / 2.0,
      v_viewportSize / 2.0 + v_viewportBorderSize / 2.0 + v_viewportFeatherSize / 2.0,
      viewportDistance
  );
  color = ((1.0 - borderSmoothStep) * color) + (borderSmoothStep * vec4(0, 0, 0, 0));
}`;const R0=200,I0={leading:!0,trailing:!0},k0=50,A0={leading:!0,trailing:!0},Fo=1,Oo=1,C0=0,j0=.7,L0=5,Wl=750;class F0 extends P0{gl;mapProgram;linesProgram;pointsProgram;previousSignificantViewport;opacity=Fo;saturation=Oo;renderOptions={};lastAnimationFrameRequestId;animating=!1;transformationTransitionStart;animationProgress=0;disableRender=!1;throttledPrepareRenderInternal;throttledChanged;constructor(e,t){const r=lt(e,e.VERTEX_SHADER,Dl),n=lt(e,e.FRAGMENT_SHADER,Vl),s=lt(e,e.VERTEX_SHADER,Bl),o=lt(e,e.FRAGMENT_SHADER,Ul),a=lt(e,e.VERTEX_SHADER,$l),c=lt(e,e.FRAGMENT_SHADER,zl),l=Ur(e,r,n),u=Ur(e,s,o),h=Ur(e,a,c);super(Lo.createFactory(),u0(e,l,u,h),t),this.gl=e,this.mapProgram=l,this.linesProgram=u,this.pointsProgram=h,e.deleteShader(r),e.deleteShader(n),e.deleteShader(r),e.deleteShader(n),e.deleteShader(r),e.deleteShader(n),e.disable(e.DEPTH_TEST),this.addEventListeners(),this.throttledPrepareRenderInternal=ho(this.prepareRenderInternal.bind(this),R0,I0),this.throttledChanged=ho(this.changed.bind(this),k0,A0)}initializeWebGL(e){const t=lt(e,e.VERTEX_SHADER,Dl),r=lt(e,e.FRAGMENT_SHADER,Vl),n=lt(e,e.VERTEX_SHADER,Bl),s=lt(e,e.FRAGMENT_SHADER,Ul),o=lt(e,e.VERTEX_SHADER,$l),a=lt(e,e.FRAGMENT_SHADER,zl),c=Ur(e,t,r),l=Ur(e,n,s),u=Ur(e,o,a);this.gl=e,this.mapProgram=c,this.linesProgram=l,this.pointsProgram=u,e.disable(e.DEPTH_TEST);for(const h of this.warpedMapList.getWarpedMaps())h.initializeWebGL(c,l,u)}getOpacity(){return this.opacity}setOpacity(e){this.opacity=e}resetOpacity(){this.opacity=Fo}getMapOpacity(e){const t=this.warpedMapList.getWarpedMap(e);if(t)return t.opacity}setMapOpacity(e,t){const r=this.warpedMapList.getWarpedMap(e);r&&(r.opacity=Math.min(Math.max(t,0),1))}resetMapOpacity(e){const t=this.warpedMapList.getWarpedMap(e);t&&(t.opacity=Fo)}getRemoveColorOptions(){return this.renderOptions.removeColorOptions}setRemoveColorOptions(e){this.renderOptions.removeColorOptions=e}resetRemoveColorOptions(){this.renderOptions.removeColorOptions=void 0}getMapRemoveColorOptions(e){const t=this.warpedMapList.getWarpedMap(e);if(t)return t.renderOptions.removeColorOptions}setMapRemoveColorOptions(e,t){const r=this.warpedMapList.getWarpedMap(e);r&&(r.renderOptions.removeColorOptions=t)}resetMapRemoveColorOptions(e){const t=this.warpedMapList.getWarpedMap(e);t&&(t.renderOptions.removeColorOptions=void 0)}getColorizeOptions(){return this.renderOptions.colorizeOptions}setColorizeOptions(e){this.renderOptions.colorizeOptions=e}resetColorizeOptions(){this.renderOptions.colorizeOptions=void 0}getMapColorizeOptions(e){const t=this.warpedMapList.getWarpedMap(e);if(t)return t.renderOptions.colorizeOptions}setMapColorizeOptions(e,t){const r=this.warpedMapList.getWarpedMap(e);r&&(r.renderOptions.colorizeOptions=t)}resetMapColorizeOptions(e){const t=this.warpedMapList.getWarpedMap(e);t&&(t.renderOptions.colorizeOptions=void 0)}getGridOptions(){return this.renderOptions.gridOptions}setGridOptions(e){this.renderOptions.gridOptions=e}resetGridOptions(){this.renderOptions.gridOptions=void 0}getMapGridOptions(e){const t=this.warpedMapList.getWarpedMap(e);if(t)return t.renderOptions.gridOptions}setMapGridOptions(e,t){const r=this.warpedMapList.getWarpedMap(e);r&&(r.renderOptions.gridOptions=t)}resetMapGridOptions(e){const t=this.warpedMapList.getWarpedMap(e);t&&(t.renderOptions.gridOptions=void 0)}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}resetSaturation(){this.saturation=Oo}getMapSaturation(e){const t=this.warpedMapList.getWarpedMap(e);if(t)return t.saturation}setMapSaturation(e,t){const r=this.warpedMapList.getWarpedMap(e);r&&(r.saturation=t)}resetMapSaturation(e){const t=this.warpedMapList.getWarpedMap(e);t&&(t.saturation=Oo)}render(e){this.disableRender||(this.viewport=e,this.loadMissingImageInfosInViewport(),this.someImageInfosInViewport()&&this.throttledPrepareRenderInternal(),this.renderInternal())}clear(){this.warpedMapList.clear(),this.mapsInViewport=new Set,this.mapsWithRequestedTilesForViewport=new Set,this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT),this.tileCache.clear()}cancelThrottledFunctions(){this.throttledPrepareRenderInternal.cancel(),this.throttledChanged.cancel()}destroy(){this.cancelThrottledFunctions();for(const e of this.warpedMapList.getWarpedMaps())this.removeEventListenersFromWebGL2WarpedMap(e);this.removeEventListeners(),super.destroy(),this.gl.deleteProgram(this.mapProgram),this.gl.deleteProgram(this.linesProgram),this.gl.deleteProgram(this.pointsProgram)}updateMapsForViewport(e){const{mapsEnteringViewport:t,mapsLeavingViewport:r}=super.updateMapsForViewport(e);for(const n of t){const s=this.warpedMapList.getWarpedMap(n);if(!s||!this.viewport)break;s.updateVertexBuffers(this.viewport.projectedGeoToClipTransform)}return{mapsEnteringViewport:t,mapsLeavingViewport:r}}prepareRenderInternal(){this.requestFetchableTiles()}shouldRequestFetchableTiles(){if(!this.viewport||this.animating)return!1;if(this.previousSignificantViewport){const e=[];for(let r=0;r<4;r++)e.push(Ct(this.previousSignificantViewport.projectedGeoRectangle[r],this.viewport.projectedGeoRectangle[r])/Math.pow(this.viewport.projectedGeoPerViewportScale,2));const t=Math.max(...e);return t===0?!0:t>Math.pow(L0,2)?(this.previousSignificantViewport=this.viewport,!0):!1}else return this.previousSignificantViewport=this.viewport,!0}shouldAnticipateInteraction(){return!0}renderInternal(){if(!this.viewport)return;const e=this.gl;e.viewport(0,0,e.canvas.width,e.canvas.height),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.renderMapsInternal()}renderMapsInternal(){if(this.viewport){this.setMapProgramUniforms();for(const e of this.mapsWithRequestedTilesForViewport){const t=this.warpedMapList.getWarpedMap(e);if(!t)continue;this.setMapProgramRenderOptionsUniforms(this.renderOptions,t.renderOptions),this.setMapProgramMapUniforms(t);const r=t.resourceTrianglePoints.length,n=this.gl.TRIANGLES;this.gl.bindVertexArray(t.mapVao),this.gl.drawArrays(n,0,r)}}}renderLinesInternal(){this.setLinesProgramUniforms();for(const e of this.mapsInViewport){const t=this.warpedMapList.getWarpedMap(e);if(!t)continue;this.setLinesProgramMapUniforms(t);const r=t.lineLayers.reduce((o,a)=>o+a.projectedGeoLines.length,0)*6,n=this.gl.TRIANGLES;this.gl.bindVertexArray(t.linesVao),this.gl.drawArrays(n,0,r)}}renderPointsInternal(){this.setPointsProgramUniforms();for(const e of this.mapsInViewport){const t=this.warpedMapList.getWarpedMap(e);if(!t)continue;this.setPointsProgramMapUniforms(t);const r=t.pointLayers.reduce((o,a)=>o+a.projectedGeoPoints.length,0),n=this.gl.POINTS;this.gl.bindVertexArray(t.pointsVao),this.gl.drawArrays(n,0,r)}}setMapProgramUniforms(){const e=this.mapProgram,t=this.gl;t.useProgram(e);const r=t.getUniformLocation(e,"u_debug");t.uniform1f(r,0);const n=t.getUniformLocation(e,"u_animationProgress");t.uniform1f(n,this.animationProgress);const s=t.getUniformLocation(e,"u_colorDistortion00");t.uniform4f(s,...Fe(po),1);const o=t.getUniformLocation(e,"u_colorDistortion01");t.uniform4f(o,...Fe(Bc),1);const a=t.getUniformLocation(e,"u_colorDistortion1");t.uniform4f(a,...Fe(Uc),1);const c=t.getUniformLocation(e,"u_colorDistortion2");t.uniform4f(c,...Fe(mo),1);const l=t.getUniformLocation(e,"u_colorDistortion3");t.uniform4f(l,...Fe(po),1);const u=t.getUniformLocation(e,"u_colorGrid");t.uniform4f(u,...Fe(Si),1)}setMapProgramRenderOptionsUniforms(e,t){const r=this.gl,n=this.mapProgram;r.useProgram(n);const s={removeColorOptions:{color:t.removeColorOptions?.color||e.removeColorOptions?.color,hardness:ea(t.removeColorOptions?.hardness,e.removeColorOptions?.hardness),threshold:ea(t.removeColorOptions?.threshold,e.removeColorOptions?.threshold)},colorizeOptions:{...e.colorizeOptions,...t.colorizeOptions},gridOptions:{...e.gridOptions,...t.gridOptions}},o=s.removeColorOptions?.color,a=r.getUniformLocation(n,"u_removeColor");if(r.uniform1f(a,o?1:0),o){const d=r.getUniformLocation(n,"u_removeColorOptionsColor");r.uniform3fv(d,o);const g=r.getUniformLocation(n,"u_removeColorOptionsThreshold");r.uniform1f(g,s.removeColorOptions?.threshold||C0);const f=r.getUniformLocation(n,"u_removeColorOptionsHardness");r.uniform1f(f,s.removeColorOptions?.hardness||j0)}const c=s.colorizeOptions?.color,l=r.getUniformLocation(n,"u_colorize");if(r.uniform1f(l,c?1:0),c){const d=r.getUniformLocation(n,"u_colorizeOptionsColor");r.uniform3fv(d,c)}const u=s.gridOptions?.enabled,h=r.getUniformLocation(n,"u_grid");r.uniform1f(h,u?1:0)}setMapProgramMapUniforms(e){if(!this.viewport)return;const t=this.gl,r=this.mapProgram;t.useProgram(r);const n=ps(this.viewport.projectedGeoToClipTransform,e.invertedRenderTransform),s=t.getUniformLocation(r,"u_renderTransform");t.uniformMatrix4fv(s,!1,Qr(n));const o=t.getUniformLocation(r,"u_opacity");t.uniform1f(o,this.opacity*e.opacity);const a=t.getUniformLocation(r,"u_saturation");t.uniform1f(a,this.saturation*e.saturation);const c=t.getUniformLocation(r,"u_distortion");t.uniform1f(c,e.distortionMeasure?1:0);const l=t.getUniformLocation(r,"u_distortionOptionsdistortionMeasure");t.uniform1i(l,e.distortionMeasure?Js.indexOf(e.distortionMeasure):0);const u=t.getUniformLocation(r,"u_scaleFactorForViewport"),h=e.tileZoomLevelForViewport?e.tileZoomLevelForViewport.scaleFactor:1;t.uniform1i(u,h);const d=t.getUniformLocation(r,"u_cachedTilesTextureArray");t.uniform1i(d,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D_ARRAY,e.cachedTilesTextureArray);const g=t.getUniformLocation(r,"u_cachedTilesResourceOriginPointsAndDimensionsTexture");t.uniform1i(g,1),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,e.cachedTilesResourceOriginPointsAndDimensionsTexture);const f=t.getUniformLocation(r,"u_cachedTilesScaleFactorsTexture");t.uniform1i(f,2),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,e.cachedTilesScaleFactorsTexture)}setLinesProgramUniforms(){if(!this.viewport)return;const e=this.gl,t=this.linesProgram;e.useProgram(t);const r=e.getUniformLocation(t,"u_viewportToClipTransform");e.uniformMatrix4fv(r,!1,Qr(this.viewport.viewportToClipTransform));const n=e.getUniformLocation(t,"u_clipToViewportTransform");e.uniformMatrix4fv(n,!1,Qr(gs(this.viewport.viewportToClipTransform)));const s=e.getUniformLocation(t,"u_animationProgress");e.uniform1f(s,this.animationProgress)}setLinesProgramMapUniforms(e){if(!this.viewport)return;const t=this.gl,r=this.linesProgram;t.useProgram(r);const n=ps(this.viewport.projectedGeoToClipTransform,e.invertedRenderTransform),s=t.getUniformLocation(r,"u_renderTransform");t.uniformMatrix4fv(s,!1,Qr(n))}setPointsProgramUniforms(){if(!this.viewport)return;const e=this.gl,t=this.pointsProgram;e.useProgram(t);const r=e.getUniformLocation(t,"u_animationProgress");e.uniform1f(r,this.animationProgress)}setPointsProgramMapUniforms(e){if(!this.viewport)return;const t=this.gl,r=this.pointsProgram;t.useProgram(r);const n=ps(this.viewport.projectedGeoToClipTransform,e.invertedRenderTransform),s=t.getUniformLocation(r,"u_renderTransform");t.uniformMatrix4fv(s,!1,Qr(n))}startTransformationTransition(e){for(const t of this.warpedMapList.getWarpedMaps(e)){if(!this.viewport)break;t.updateVertexBuffers(this.viewport.projectedGeoToClipTransform)}this.lastAnimationFrameRequestId!==void 0&&cancelAnimationFrame(this.lastAnimationFrameRequestId),this.animating=!0,this.transformationTransitionStart=void 0,this.lastAnimationFrameRequestId=requestAnimationFrame((t=>this.transformationTransitionFrame(t,e)).bind(this))}transformationTransitionFrame(e,t){if(this.transformationTransitionStart||(this.transformationTransitionStart=e),e-this.transformationTransitionStart<Wl)this.animationProgress=(e-this.transformationTransitionStart)/Wl,this.renderInternal(),this.lastAnimationFrameRequestId=requestAnimationFrame((r=>this.transformationTransitionFrame(r,t)).bind(this));else{for(const r of this.warpedMapList.getWarpedMaps(t)){if(r.resetPrevious(),!this.viewport)break;r.updateVertexBuffers(this.viewport.projectedGeoToClipTransform)}this.animating=!1,this.animationProgress=0,this.transformationTransitionStart=void 0,this.changed()}}changed(){this.dispatchEvent(new ue($.CHANGED))}imageInfoLoaded(e){e instanceof ue&&this.dispatchEvent(new ue($.IMAGEINFOLOADED))}clearMap(e){const t=this.warpedMapList.getWarpedMap(e);t&&t.clearTextures()}mapTileLoaded(e){if(e instanceof ue){const{mapId:t,tileUrl:r}=e.data,n=this.tileCache.getCacheableTile(r);if(!n||!n.isCachedTile())return;const s=this.warpedMapList.getWarpedMap(t);if(!s)return;s.addCachedTileAndUpdateTextures(n)}}mapTileRemoved(e){if(e instanceof ue){const{mapId:t,tileUrl:r}=e.data,n=this.warpedMapList.getWarpedMap(t);if(!n)return;n.removeCachedTileAndUpdateTextures(r)}}warpedMapAdded(e){if(e instanceof ue){const t=e.data,r=this.warpedMapList.getWarpedMap(t);r&&this.addEventListenersToWebGL2WarpedMap(r)}}preChange(e){if(e instanceof ue){const t=e.data;for(const r of this.warpedMapList.getWarpedMaps(t))this.animating&&r.mixPreviousAndNew(1-this.animationProgress)}}transformationChanged(e){if(e instanceof ue){const t=e.data;this.startTransformationTransition(t)}}distortionChanged(e){if(e instanceof ue){const t=e.data;this.startTransformationTransition(t)}}addEventListenersToWebGL2WarpedMap(e){e.addEventListener($.TEXTURESUPDATED,this.throttledChanged.bind(this))}removeEventListenersFromWebGL2WarpedMap(e){e.removeEventListener($.TEXTURESUPDATED,this.throttledChanged.bind(this))}contextLost(){this.disableRender=!0,this.cancelThrottledFunctions();for(const e of this.warpedMapList.getWarpedMaps())e.cancelThrottledFunctions();this.tileCache.clear()}contextRestored(){this.initializeWebGL(this.gl),this.disableRender=!1}}const O0="Renderer not defined. Add the layer to a map before calling this function.";function me(i){if(!i)throw new Error(O0)}class G0{id="warped-map-layer";type="custom";renderingMode="2d";map;renderer;options;constructor(e,t){e&&(this.id=e),this.options=t}onAdd(e,t){this.map=e,this.renderer=new F0(t,this.options),this.addEventListeners()}onRemove(){this.renderer&&(this.removeEventListeners(),this.renderer.destroy())}async addGeoreferenceAnnotation(e){me(this.renderer);const t=await this.renderer.warpedMapList.addGeoreferenceAnnotation(e);return this.map?.triggerRepaint(),t}async removeGeoreferenceAnnotation(e){me(this.renderer);const t=await this.renderer.warpedMapList.removeGeoreferenceAnnotation(e);return this.map?.triggerRepaint(),t}async addGeoreferenceAnnotationByUrl(e){const t=await fetch(e).then(r=>r.json());return this.addGeoreferenceAnnotation(t)}async removeGeoreferenceAnnotationByUrl(e){const t=await fetch(e).then(n=>n.json());return this.removeGeoreferenceAnnotation(t)}async addGeoreferencedMap(e){me(this.renderer);const t=this.renderer.warpedMapList.addGeoreferencedMap(e);return this.map?.triggerRepaint(),t}async removeGeoreferencedMap(e){me(this.renderer);const t=this.renderer.warpedMapList.removeGeoreferencedMap(e);return this.map?.triggerRepaint(),t}getWarpedMapList(){return me(this.renderer),this.renderer.warpedMapList}getWarpedMap(e){return me(this.renderer),this.renderer.warpedMapList.getWarpedMap(e)}showMap(e){me(this.renderer),this.renderer.warpedMapList.showMaps([e]),this.map?.triggerRepaint()}showMaps(e){me(this.renderer),this.renderer.warpedMapList.showMaps(e),this.map?.triggerRepaint()}hideMap(e){me(this.renderer),this.renderer.warpedMapList.hideMaps([e]),this.map?.triggerRepaint()}hideMaps(e){me(this.renderer),this.renderer.warpedMapList.hideMaps(e),this.map?.triggerRepaint()}isMapVisible(e){return me(this.renderer),this.renderer.warpedMapList.getWarpedMap(e)?.visible}setMapResourceMask(e,t){me(this.renderer),this.renderer.warpedMapList.setMapResourceMask(e,t),this.map?.triggerRepaint()}setMapsTransformationType(e,t){me(this.renderer),this.renderer.warpedMapList.setMapsTransformationType(e,t),this.map?.triggerRepaint()}setMapsDistortionMeasure(e,t){me(this.renderer),this.renderer.warpedMapList.setMapsDistortionMeasure(e,t),this.map?.triggerRepaint()}getBounds(){me(this.renderer);const e=this.renderer.warpedMapList.getBbox();if(e)return[[e[0],e[1]],[e[2],e[3]]]}bringMapsToFront(e){me(this.renderer),this.renderer.warpedMapList.bringMapsToFront(e),this.map?.triggerRepaint()}sendMapsToBack(e){me(this.renderer),this.renderer.warpedMapList.sendMapsToBack(e),this.map?.triggerRepaint()}bringMapsForward(e){me(this.renderer),this.renderer.warpedMapList.bringMapsForward(e),this.map?.triggerRepaint()}sendMapsBackward(e){me(this.renderer),this.renderer.warpedMapList.sendMapsBackward(e),this.map?.triggerRepaint()}getMapZIndex(e){return me(this.renderer),this.renderer.warpedMapList.getMapZIndex(e)}setImageInformations(e){me(this.renderer),this.renderer.warpedMapList.setImageInformations(e)}getOpacity(){return me(this.renderer),this.renderer.getOpacity()}setOpacity(e){me(this.renderer),this.renderer.setOpacity(e),this.map?.triggerRepaint()}resetOpacity(){me(this.renderer),this.renderer.resetOpacity(),this.map?.triggerRepaint()}getMapOpacity(e){return me(this.renderer),this.renderer.getMapOpacity(e)}setMapOpacity(e,t){me(this.renderer),this.renderer.setMapOpacity(e,t),this.map?.triggerRepaint()}resetMapOpacity(e){me(this.renderer),this.renderer.resetMapOpacity(e),this.map?.triggerRepaint()}setSaturation(e){me(this.renderer),this.renderer.setSaturation(e),this.map?.triggerRepaint()}resetSaturation(){me(this.renderer),this.renderer.resetSaturation(),this.map?.triggerRepaint()}setMapSaturation(e,t){me(this.renderer),this.renderer.setMapSaturation(e,t),this.map?.triggerRepaint()}resetMapSaturation(e){me(this.renderer),this.renderer.resetMapSaturation(e),this.map?.triggerRepaint()}setRemoveColor(e){me(this.renderer);const t=e.hexColor?Fe(e.hexColor):void 0;this.renderer.setRemoveColorOptions({color:t,threshold:e.threshold,hardness:e.hardness}),this.map?.triggerRepaint()}resetRemoveColor(){me(this.renderer),this.renderer.resetRemoveColorOptions(),this.map?.triggerRepaint()}setMapRemoveColor(e,t){me(this.renderer);const r=t.hexColor?Fe(t.hexColor):void 0;this.renderer.setMapRemoveColorOptions(e,{color:r,threshold:t.threshold,hardness:t.hardness}),this.map?.triggerRepaint()}resetMapRemoveColor(e){me(this.renderer),this.renderer.resetMapRemoveColorOptions(e)}setColorize(e){me(this.renderer);const t=Fe(e);t&&(this.renderer.setColorizeOptions({color:t}),this.map?.triggerRepaint())}resetColorize(){me(this.renderer),this.renderer.resetColorizeOptions(),this.map?.triggerRepaint()}setMapColorize(e,t){me(this.renderer);const r=Fe(t);r&&(this.renderer.setMapColorizeOptions(e,{color:r}),this.map?.triggerRepaint())}resetMapColorize(e){me(this.renderer),this.renderer.resetMapColorizeOptions(e),this.map?.triggerRepaint()}clear(){me(this.renderer),this.renderer.clear(),this.map?.triggerRepaint()}preparerender(){}render(){if(!this.map||!this.renderer)return;const e=this.map.getCanvas(),t=[e.width/window.devicePixelRatio,e.height/window.devicePixelRatio],r=this.map.getCenter(),n=Rr([r.lng,r.lat]),s=this.map.unproject([0,t[1]]),o=this.map.unproject([t[0],t[1]]),a=this.map.unproject([t[0],0]),c=this.map.unproject([0,0]),l=Rr([s.lng,s.lat]),u=Rr([o.lng,o.lat]),h=Rr([a.lng,a.lat]),d=Rr([c.lng,c.lat]),f=xs([l,u,h,d]),y=sn(f,t),E=-(this.map.getBearing()/180)*Math.PI,w=new Du(t,n,y,E,window.devicePixelRatio);this.renderer.render(w)}contextLost(){this.renderer?.contextLost()}contextRestored(){this.renderer?.contextRestored()}addEventListeners(){!this.renderer||!this.map||(this.map.on("webglcontextlost",this.contextLost.bind(this)),this.map.on("webglcontextrestored",this.contextRestored.bind(this)),this.renderer.addEventListener($.CHANGED,this.render.bind(this)),this.renderer.addEventListener($.IMAGEINFOLOADED,this.render.bind(this)),this.renderer.addEventListener($.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.addEventListener($.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener($.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener($.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener($.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener($.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener($.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener($.VISIBILITYCHANGED,this.render.bind(this)),this.renderer.warpedMapList.addEventListener($.CLEARED,this.render.bind(this)))}removeEventListeners(){!this.renderer||!this.map||(this.map.off("webglcontextlost",this.contextLost.bind(this)),this.map.off("webglcontextrestored",this.contextRestored.bind(this)),this.renderer.removeEventListener($.CHANGED,this.render.bind(this)),this.renderer.removeEventListener($.IMAGEINFOLOADED,this.render.bind(this)),this.renderer.removeEventListener($.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.removeEventListener($.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener($.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener($.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener($.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener($.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener($.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener($.VISIBILITYCHANGED,this.render.bind(this)),this.renderer.warpedMapList.removeEventListener($.CLEARED,this.render.bind(this)))}passWarpedMapEvent(e){e instanceof ue&&this.map&&this.map.fire(e.type,e.data)}}Sr.WarpedMapLayer=G0,Object.defineProperty(Sr,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=allmaps-maplibre-4.0.umd.js.map
